{
  "docs": [
    {
      "id": "3a5d9238-0fa8-4154-a6d5-92340f2ad733",
      "doc_id": "3a5d9238-0fa8-4154-a6d5-92340f2ad733",
      "title": "3a5d9238-0fa8-4154-a6d5-92340f2ad733",
      "updated": 1696747320000,
      "body_original": "\nå¾®æœåŠ¡ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†æˆ‘ä»¬ç¨‹åºæ‹†åˆ†ä¸ºæœ€å°åŒ–å•å…ƒæ¥æä¾›æœåŠ¡ã€‚åœ¨ä¸€ä½“åŒ–ç³»ç»Ÿä¸­ï¼Œå„ä¸ªå¾®æœåŠ¡ä¹Ÿæ˜¯ä¸å¯èƒ½ç‹¬ç«‹å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå¾®æœåŠ¡ä¹‹é—´æ¶‰åŠåˆ°çš„æ•°æ®ä¾èµ–é—®é¢˜ï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬ä»åœºæ™¯å…¥æ‰‹æ¥åˆ†æè€ƒè™‘æ­¤ç±»é—®é¢˜ã€‚\n\n\n## **ä¸€ã€åœºæ™¯**\n\n\nåœ¨ä¸€ä¸ªä¾›åº”é“¾ç³»ç»Ÿä¸­ï¼Œå­˜åœ¨å•†å“ã€é”€å”®è®¢å•ã€é‡‡è´­ä¸‰ä¸ªå¾®æœåŠ¡ï¼Œä»–ä»¬çš„ä¸»æ•°æ®éƒ¨åˆ†æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\n\n\nå•†å“ï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151508807.png)\n\n\nè®¢å•å’Œå­è®¢å•ï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151508648.png)\n\n\né‡‡è´­å•å’Œå­è®¢å•ï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151508948.png)\n\n\nåœ¨è®¾è®¡è¿™ä¸ªä¾›åº”é“¾ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªéœ€æ±‚ï¼š\n\n- æ ¹æ®å•†å“çš„å‹å·/åˆ†ç±»/ç”Ÿæˆå¹´ä»½/ç¼–ç ç­‰æŸ¥æ‰¾è®¢å•ï¼›\n- æ ¹æ®å•†å“çš„å‹å·/åˆ†ç±»/ç”Ÿæˆå¹´ä»½/ç¼–ç ç­‰æŸ¥æ‰¾é‡‡è´­è®¢å•ã€‚\n\nåˆæœŸæˆ‘ä»¬çš„æ–¹æ¡ˆæ˜¯è¿™æ ·è®¾è®¡çš„ï¼šä¸¥æ ¼æŒ‰ç…§çš„å¾®æœåŠ¡åˆ’åˆ†åŸåˆ™å°†å•†å“ç›¸å…³çš„èŒè´£å­˜æ”¾åœ¨å•†å“ç³»ç»Ÿä¸­ã€‚å› æ­¤ï¼Œåœ¨æŸ¥è¯¢è®¢å•ä¸é‡‡è´­å•æ—¶ï¼Œå¦‚æœæŸ¥è¯¢å­—æ®µåŒ…å«å•†å“å­—æ®µï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§å¦‚ä¸‹é¡ºåºè¿›è¡ŒæŸ¥è¯¢ï¼š\n\n- å…ˆæ ¹æ®å•†å“å­—æ®µè°ƒç”¨å•†å“çš„æœåŠ¡ï¼Œç„¶åè¿”å›åŒ¹é…çš„å•†å“ä¿¡æ¯ï¼›\n- åœ¨è®¢å•æˆ–é‡‡è´­å•ä¸­ï¼Œé€šè¿‡ IN è¯­å¥åŒ¹é…å•†å“ IDï¼Œå†å…³è”æŸ¥è¯¢å¯¹åº”çš„å•æ®ã€‚\n\nä¸ºäº†æ–¹ä¾¿ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œè®¢å•æŸ¥è¯¢æµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![](https://mmbiz.qpic.cn/sz_mmbiz_png/knmrNHnmCLEDxC5VyDG939eNmSKG8Ss1JefXwrKlDMa75ZnvAGdkGSGibc4FP547PlYCvtlX8hw3tlomQ6LYKdg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\n\n\nå›¾ç‰‡\n\n\nå›¾ç‰‡\n\n\nåˆæœŸæ–¹æ¡ˆè®¾è®¡å®Œåï¼Œå¾ˆå¿«æˆ‘ä»¬å°±é‡åˆ°äº†ä¸€ç³»åˆ—é—®é¢˜ï¼š\n\n- éšç€å•†å“æ•°é‡çš„å¢å¤šï¼ŒåŒ¹é…çš„å•†å“è¶Šæ¥è¶Šå¤šï¼Œäºæ˜¯è®¢å•æœåŠ¡ä¸­åŒ…å« IN è¯­å¥çš„æŸ¥è¯¢æ•ˆç‡è¶Šæ¥è¶Šæ…¢ï¼›\n- å•†å“ä½œä¸ºä¸€ä¸ªæ ¸å¿ƒæœåŠ¡ï¼Œä¾èµ–å®ƒçš„æœåŠ¡è¶Šæ¥è¶Šå¤šï¼ŒåŒæ—¶éšç€å•†å“æ•°æ®é‡çš„å¢é•¿ï¼Œå•†å“æœåŠ¡å·²ä¸å ªé‡è´Ÿï¼Œå“åº”é€Ÿåº¦ä¹Ÿå˜æ…¢ï¼Œè¿˜å­˜åœ¨è¯·æ±‚è¶…æ—¶çš„æƒ…å†µï¼›\n- ç”±äºå•†å“æœåŠ¡è¶…æ—¶ï¼Œç›¸å…³æœåŠ¡å¤„ç†è¯·æ±‚ç»å¸¸å¤±è´¥ã€‚\n\nç»“æœå°±æ˜¯ä¸šåŠ¡æ–¹æ¯æ¬¡æŸ¥è¯¢è®¢å•æˆ–é‡‡è´­å•æ—¶ï¼Œåªè¦å¸¦ä¸Šäº†å•†å“è¿™ä¸ªå…³é”®å­—ï¼ŒæŸ¥è¯¢æ•ˆç‡å°±ä¼šå¾ˆæ…¢è€Œä¸”è€æ˜¯å¤±è´¥ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬é‡æ–°æƒ³äº†ä¸€ä¸ªæ–°æ–¹æ¡ˆâ€”â€”æ•°æ®å†—ä½™ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹ã€‚\n\n\næ¬¢è¿å…³æ³¨SpringForAllç¤¾åŒºï¼ˆhttp://spring4all.comï¼‰ï¼Œä¸“æ³¨åˆ†äº«å…³äºSpringçš„ä¸€åˆ‡ï¼Œæ¯å‘¨è¿˜æœ‰2-3æ¬¡çš„ç¦åˆ©èµ ä¹¦æ´»åŠ¨ï¼Œä¸€èµ·æ¥å­¦ä¹ ã€åˆ†äº«ã€äº¤æµå§ã€‚\n\n\n## **äºŒã€æ•°æ®å†—ä½™çš„æ–¹æ¡ˆ**\n\n\næ•°æ®å†—ä½™è¯´ç™½äº†å°±æ˜¯åœ¨è®¢å•ã€é‡‡è´­å•ä¸­ä¿å­˜ä¸€äº›å•†å“å­—æ®µä¿¡æ¯ã€‚\n\n\nä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å€ŸåŠ©ä¸Šé¢å®é™…ä¸šåŠ¡åœºæ™¯å…·ä½“è¯´æ˜ä¸‹ï¼Œçœ‹çœ‹ä¸¤è€…çš„åŒºåˆ«ã€‚\n\n\nå•†å“ï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151511076.png)\n\n\nè®¢å•å’Œå­è®¢å•ï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151512290.png)\n\n\né‡‡è´­å•å’Œå­è®¢å•ï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151512847.png)\n\n\nè°ƒæ•´æ¶æ„æ–¹æ¡ˆåï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸å†ä¾èµ–å•†å“æœåŠ¡äº†ã€‚\n\n\nä½†æ˜¯ï¼Œå¦‚æœå•†å“è¿›è¡Œäº†æ›´æ–°ï¼Œæˆ‘ä»¬å¦‚ä½•åŒæ­¥å†—ä½™çš„æ•°æ®å‘¢ï¼Ÿåœ¨æ­¤åˆ†äº«2ç§è§£å†³åŠæ³•ã€‚\n\n- æ¯æ¬¡æ›´æ–°å•†å“æ—¶ï¼Œå…ˆè°ƒç”¨è®¢å•ä¸é‡‡è´­æœåŠ¡ï¼Œå†æ›´æ–°å•†å“çš„å†—ä½™æ•°æ®ã€‚\n- æ¯æ¬¡æ›´æ–°å•†å“æ—¶ï¼Œå…ˆå‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œè®¢å•ä¸é‡‡è´­æœåŠ¡å„è‡ªè®¢é˜…è¿™æ¡æ¶ˆæ¯åï¼Œå†å„è‡ªæ›´æ–°å•†å“å†—ä½™æ•°æ®ã€‚\n\nçœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯è§‰å¾—å¾ˆçœ¼ç†Ÿäº†å‘¢ï¼Ÿæ²¡é”™ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸Šä¸€ç¯‡æåˆ°è¿‡çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚é‚£ä¹ˆè¿™2ç§æ–¹æ¡ˆä¼šå‡ºç°å“ªäº›é—®é¢˜å‘¢ï¼Ÿ\n\n\n**å¦‚æœå•†å“æœåŠ¡æ¯æ¬¡æ›´æ–°å•†å“éƒ½è¦è°ƒç”¨è®¢å•ä¸é‡‡è´­æœåŠ¡ï¼Œç„¶åå†æ›´æ–°å†—ä½™æ•°æ®ï¼Œåˆ™ä¼šå‡ºç°ä»¥ä¸‹ä¸¤ç§é—®é¢˜ã€‚**\n\n- **æ•°æ®ä¸€è‡´æ€§é—®é¢˜**ï¼šå¦‚æœè®¢å•ä¸é‡‡è´­çš„å†—ä½™æ•°æ®æ›´æ–°å¤±è´¥äº†ï¼Œæ•´ä¸ªæ“ä½œéƒ½éœ€è¦å›æ»šã€‚è¿™æ—¶å•†å“æœåŠ¡çš„å¼€å‘äººå‘˜è‚¯å®šä¸ä¹æ„ï¼Œå› ä¸ºå†—ä½™æ•°æ®ä¸æ˜¯å•†å“æœåŠ¡çš„æ ¸å¿ƒéœ€æ±‚ï¼Œä¸èƒ½å› ä¸ºè¾¹ç¼˜æµç¨‹é˜»æ–­äº†è‡ªèº«çš„æ ¸å¿ƒæµç¨‹ã€‚\n- **ä¾èµ–é—®é¢˜**ï¼šä»èŒè´£æ¥è¯´ï¼Œå•†å“æœåŠ¡åº”è¯¥åªå…³æ³¨å•†å“æœ¬èº«ï¼Œä½†æ˜¯ç°åœ¨å•†å“è¿˜éœ€è¦è°ƒç”¨è®¢å•ä¸é‡‡è´­æœåŠ¡ã€‚è€Œä¸”ï¼Œä¾èµ–å•†å“è¿™ä¸ªæ ¸å¿ƒæœåŠ¡çš„æœåŠ¡å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œä¹Ÿå°±å¯¼è‡´åç»­å•†å“æœåŠ¡æ¯æ¬¡æ›´æ–°å•†å“æ—¶ï¼Œéƒ½éœ€è¦è°ƒç”¨æ›´æ–°è®¢å•å†—ä½™æ•°æ®ã€æ›´æ–°é‡‡è´­å†—ä½™æ•°æ®ã€æ›´æ–°é—¨åº—åº“å­˜å†—ä½™æ•°æ®ã€æ›´æ–°è¿è¥å†—ä½™æ•°æ®ç­‰ä¸€å¤§å †æœåŠ¡ã€‚é‚£ä¹ˆå•†å“åˆ°åº•æ˜¯ä¸‹æ¸¸æœåŠ¡è¿˜æ˜¯ä¸Šæ¸¸æœåŠ¡ï¼Ÿè¿˜èƒ½ä¸èƒ½å®‰å¿ƒå½“åº•å±‚æ ¸å¿ƒæœåŠ¡ï¼Ÿ\n\nå› æ­¤ï¼Œç¬¬ä¸€ä¸ªè§£å†³åŠæ³•ç›´æ¥è¢«æˆ‘ä»¬å¦å†³äº†ï¼Œå³æˆ‘ä»¬é‡‡å–çš„ç¬¬äºŒä¸ªè§£å†³åŠæ³•â€”â€”é€šè¿‡æ¶ˆæ¯å‘å¸ƒè®¢é˜…çš„æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒå­˜åœ¨å¦‚ä¸‹ 2 ç‚¹ä¼˜åŠ¿ã€‚\n\n- å•†å“æ— é¡»è°ƒç”¨å…¶ä»–æœåŠ¡ï¼Œå®ƒåªéœ€è¦å…³æ³¨è‡ªèº«é€»è¾‘å³å¯ï¼Œé¡¶å¤šå¤šç”Ÿæˆä¸€æ¡æ¶ˆæ¯é€åˆ° MQã€‚\n- å¦‚æœè®¢å•ã€é‡‡è´­ç­‰æœåŠ¡çš„æ›´æ–°å†—ä½™æ•°æ®å¤±è´¥äº†ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¶ˆæ¯é‡è¯•æœºåˆ¶å°±å¯ä»¥äº†ï¼Œæœ€ç»ˆèƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚\n\næ­¤æ—¶ï¼Œæˆ‘ä»¬çš„æ¶æ„æ–¹æ¡ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151215375.png)\n\n\nè¿™ä¸ªæ–¹æ¡ˆçœ‹èµ·æ¥å·²ç»æŒºå®Œç¾äº†ï¼Œè€Œä¸”å¸‚é¢ä¸ŠåŸºæœ¬ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ï¼Œä¸è¿‡è¯¥æ–¹æ¡ˆå­˜åœ¨å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ã€‚\n\n\n1.åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œä»…ä»…ä¿å­˜å†—ä½™æ•°æ®è¿˜è¿œè¿œä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å•†å“åˆ†ç±»ä¸ç”Ÿäº§æ‰¹å·çš„æ¸…å•è¿›è¡Œå…³è”æŸ¥è¯¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªæœåŠ¡ä¸åªæ˜¯è®¢é˜…å•†å“å˜æ›´è¿™ä¸€ç§æ¶ˆæ¯ï¼Œè¿˜éœ€è¦è®¢é˜…å•†å“åˆ†ç±»ã€å•†å“ç”Ÿäº§æ‰¹å·å˜æ›´ç­‰æ¶ˆæ¯ã€‚ä¸‹é¢è¯·æ³¨æ„æŸ¥çœ‹è®¢å•è¡¨ç»“æ„çš„åŠ ç²—éƒ¨åˆ†å†…å®¹ã€‚\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151512057.png)\n\n\nä»¥ä¸Šåªæ˜¯åˆ—ä¸¾äº†ä¸€éƒ¨åˆ†çš„ç»“æ„ï¼Œäº‹å®ä¸Šï¼Œå•†å“è¡¨ä¸­è¿˜æœ‰å¾ˆå¤šå­—æ®µå­˜åœ¨å†—ä½™ï¼Œæ¯”å¦‚ä¿ä¿®ç±»å‹ã€åŒ…æ¢ç±»å‹ç­‰ã€‚ä¸ºäº†æ›´æ–°è¿™äº›å†—ä½™æ•°æ®ï¼Œé‡‡è´­æœåŠ¡ä¸è®¢å•æœåŠ¡å¾€å¾€éœ€è¦è®¢é˜…è¿‘åç§æ¶ˆæ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šéœ€è¦æŠŠå•†å“çš„ä¸€å°åŠé€»è¾‘å¤åˆ¶è¿‡æ¥ã€‚\n\n\n2.æ¯ä¸ªä¾èµ–çš„æœåŠ¡éœ€è¦é‡å¤å®ç°å†—ä½™æ•°æ®æ›´æ–°åŒæ­¥çš„é€»è¾‘ã€‚å‰é¢æˆ‘ä»¬è®²äº†é‡‡è´­ã€è®¢å•åŠå…¶ä»–æœåŠ¡éƒ½éœ€è¦ä¾èµ–å•†å“æ•°æ®ï¼Œå› æ­¤æ¯ä¸ªæœåŠ¡éœ€è¦å°†å†—ä½™æ•°æ®çš„è®¢é˜…ã€æ›´æ–°é€»è¾‘åšä¸€éï¼Œæœ€ç»ˆé‡å¤çš„ä»£ç å°±ä¼šå¾ˆå¤šã€‚\n\n\n3.MQ æ¶ˆæ¯ç±»å‹å¤ªå¤šäº†ï¼šè”è°ƒæ—¶æœ€éº»çƒ¦çš„æ˜¯ MQ ä¹‹é—´çš„è”åŠ¨ï¼Œå¦‚æœæ˜¯æ¥å£è”è°ƒè¿˜å¥½è¯´ï¼Œå› ä¸ºè°ƒç”¨å“ªä¸ªæœåŠ¡å™¨çš„æ¥å£ç›¸å¯¹å¯æ§è€Œä¸”æ¯”è¾ƒå¥½è¿½æº¯ï¼›å¦‚æœæ˜¯æ¶ˆæ¯è”è°ƒå°±æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºæˆ‘ä»¬å¸¸å¸¸ä¸çŸ¥é“æŸæ¡æ¶ˆæ¯è¢«å“ªå°æœåŠ¡èŠ‚ç‚¹æ¶ˆè´¹äº†ï¼Œä¸ºäº†è®©ç‰¹å®šçš„æœåŠ¡å™¨æ¶ˆè´¹ç‰¹å®šçš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸´æ—¶æ”¹åŠ¨åŒæ–¹çš„ä»£ç ã€‚ä¸è¿‡è”è°ƒå®Œæˆåï¼Œæˆ‘ä»¬ç»å¸¸å¿˜äº†æ”¹å›åŸä»£ç ã€‚\n\n\nä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›é’ˆå¯¹å†—ä½™æ•°æ®è¿™ç§éæ ¸å¿ƒéœ€æ±‚å‡ºç°å¦‚æ­¤å¤šçš„é—®é¢˜ï¼Œæœ€ç»ˆå†³å®šä½¿ç”¨ä¸€ä¸ªç‰¹åˆ«çš„åŒæ­¥å†—ä½™æ•°æ®æ–¹æ¡ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›ä¸€æ­¥è¯´æ˜ã€‚\n\n\n## **ä¸‰ã€è§£è€¦ä¸šåŠ¡é€»è¾‘çš„æ•°æ®åŒæ­¥æ–¹æ¡ˆ**\n\n\nè§£è€¦ä¸šåŠ¡é€»è¾‘çš„æ•°æ®åŒæ­¥æ–¹æ¡ˆçš„è®¾è®¡æ€è·¯æ˜¯è¿™æ ·çš„ï¼š\n\n- å°†å•†å“åŠå•†å“ç›¸å…³çš„ä¸€äº›è¡¨ï¼ˆæ¯”å¦‚åˆ†ç±»è¡¨ã€ç”Ÿäº§æ‰¹å·è¡¨ã€ä¿ä¿®ç±»å‹ã€åŒ…æ¢ç±»å‹ç­‰ï¼‰å®æ—¶åŒæ­¥åˆ°éœ€è¦ä¾èµ–ä½¿ç”¨å®ƒä»¬çš„æœåŠ¡çš„æ•°æ®åº“ï¼Œå¹¶ä¸”ä¿æŒè¡¨ç»“æ„ä¸å˜ï¼›\n- åœ¨æŸ¥è¯¢é‡‡è´­ã€è®¢å•ç­‰æœåŠ¡æ—¶ï¼Œç›´æ¥å…³è”åŒæ­¥è¿‡æ¥çš„å•†å“ç›¸å…³è¡¨ï¼›\n- ä¸å…è®¸é‡‡è´­ã€è®¢å•ç­‰æœåŠ¡ä¿®æ”¹å•†å“ç›¸å…³è¡¨ã€‚\n\næ­¤æ—¶ï¼Œæ•´ä¸ªæ–¹æ¡ˆçš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151216480.png)\n\n\nä»¥ä¸Šæ–¹æ¡ˆå°±èƒ½è½»æ¾è§£å†³å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š\n\n- å•†å“æ— é¡»ä¾èµ–å…¶ä»–æœåŠ¡ï¼Œå¦‚æœå…¶ä»–æœåŠ¡çš„å†—ä½™æ•°æ®åŒæ­¥å¤±è´¥ï¼Œå®ƒä¹Ÿä¸éœ€è¦å›æ»šè‡ªèº«çš„æµç¨‹ï¼›\n- é‡‡è´­ã€è®¢å•ç­‰æœåŠ¡æ— é¡»å…³æ³¨å†—ä½™æ•°æ®çš„åŒæ­¥ã€‚\n\nä¸è¿‡ï¼Œè¯¥æ–¹æ¡ˆçš„â€œç¼ºç‚¹â€æ˜¯å¢åŠ äº†è®¢å•ã€é‡‡è´­ç­‰æ•°æ®åº“çš„å­˜å‚¨ç©ºé—´ï¼ˆå› ä¸ºå¢åŠ äº†å•†å“ç›¸å…³è¡¨ï¼‰ã€‚\n\n\nä»”ç»†è®¡ç®—åï¼Œæˆ‘ä»¬å‘ç°ä¹‹å‰æ•°æ®å†—ä½™çš„æ–¹æ¡ˆä¸­æ¯ä¸ªè®¢å•éƒ½éœ€è¦ä¿å­˜ä¸€ä»½å•†å“çš„å†—ä½™æ•°æ®ï¼Œå‡è®¾è®¢å•æ€»æ•°æ˜¯ Nï¼Œå•†å“æ€»æ•°æ˜¯ Mï¼Œè€Œ N ä¸€èˆ¬è¿œè¿œå¤§äº Mã€‚å› æ­¤ï¼Œåœ¨ä¹‹å‰æ•°æ®å†—ä½™çš„æ–¹æ¡ˆä¸­ï¼ŒN æ¡è®¢å•å°±ä¼šäº§ç”Ÿ N æ¡å•†å“çš„å†—ä½™æ•°æ®ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œè§£è€¦ä¸šåŠ¡é€»è¾‘çš„æ•°æ®åŒæ­¥æ–¹æ¡ˆæ›´çœç©ºé—´ï¼Œå› ä¸ºåªå¢åŠ äº† M æ¡å•†å“çš„æ•°æ®ã€‚\n\n\næ­¤æ—¶é—®é¢˜åˆæ¥äº†ï¼Œå¦‚ä½•å®æ—¶åŒæ­¥ç›¸å…³è¡¨çš„æ•°æ®å‘¢ï¼Ÿæˆ‘ä»¬ç›´æ¥æ‰¾ä¸€ä¸ªç°æˆçš„å¼€æºä¸­é—´ä»¶å°±å¯ä»¥äº†ï¼Œä¸è¿‡å®ƒéœ€è¦æ»¡è¶³æ”¯æŒå®æ—¶åŒæ­¥ã€æ”¯æŒå¢é‡åŒæ­¥ã€ä¸ç”¨å†™ä¸šåŠ¡é€»è¾‘ã€æ”¯æŒ MySQL ä¹‹é—´åŒæ­¥ã€æ´»è·ƒåº¦é«˜è¿™äº”ç‚¹è¦æ±‚ã€‚\n\n\næ ¹æ®è¿™äº”ç‚¹è¦æ±‚ï¼Œæˆ‘ä»¬åœ¨å¸‚é¢ä¸Šæ‰¾äº†ä¸€åœˆï¼Œå‘ç°äº† Canalã€Debeziumã€DataXã€Databusã€Flinkxã€Bifrost è¿™å‡ æ¬¾å¼€æºä¸­é—´ä»¶ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151216798.png)\n\n\nä»å¯¹æ¯”è¡¨ä¸­æ¥çœ‹ï¼Œæ¯”è¾ƒè´´è¿‘æˆ‘ä»¬éœ€æ±‚çš„å¼€æºä¸­é—´ä»¶æ˜¯ Bifrostï¼ŒåŸå› å¦‚ä¸‹ï¼š\n\n- å®ƒçš„ç•Œé¢ç®¡ç†ä¸é”™ï¼›\n- å®ƒçš„æ¶æ„æ¯”è¾ƒç®€å•ï¼Œå‡ºç°é—®é¢˜åï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œè°ƒæŸ¥ï¼Œä¹‹åå°±ç®—ä½œè€…ä¸ç»´æŠ¤äº†ä¹Ÿå¯ä»¥è‡ªæˆ‘ç»´æŠ¤ï¼Œç›¸å¯¹æ¯”è¾ƒå¯æ§ã€‚\n- ä½œè€…æ›´æ–°æ´»è·ƒï¼›\n- è‡ªå¸¦ç›‘æ§æŠ¥è­¦åŠŸèƒ½ã€‚\n\nå› æ­¤ï¼Œæœ€ç»ˆæˆ‘ä»¬ä½¿ç”¨äº† Bifrost å¼€æºä¸­é—´ä»¶ï¼Œæ­¤æ—¶æ•´ä¸ªæ–¹æ¡ˆçš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151216381.png)\n\n\n## **å››ã€ä¸Šçº¿æ•ˆæœ**\n\n\næ•´ä¸ªæ¶æ„æ–¹æ¡ˆä¸Šçº¿åï¼Œå•†å“æ•°æ®çš„åŒæ­¥è¿˜ç®—æ¯”è¾ƒç¨³å®šï¼Œæ­¤æ—¶å•†å“æœåŠ¡çš„å¼€å‘äººå‘˜åªéœ€è¦å…³æ³¨è‡ªèº«é€»è¾‘ï¼Œæ— é¡»å†å…³æ³¨ä½¿ç”¨æ•°æ®çš„äººã€‚å¦‚æœéœ€è¦å…³è”ä½¿ç”¨å•†å“æ•°æ®çš„è®¢å•ï¼Œé‡‡è´­æœåŠ¡çš„å¼€å‘äººå‘˜ä¹Ÿæ— é¡»å…³æ³¨å•†å“æ•°æ®çš„åŒæ­¥é—®é¢˜ï¼Œåªéœ€è¦åœ¨æŸ¥è¯¢æ—¶åŠ ä¸Šå…³è”è¯­å¥å³å¯ï¼Œå®ç°äº†åŒèµ¢ã€‚\n\n\nç„¶è€Œï¼Œå”¯ä¸€è®©æˆ‘ä»¬æ‹…å¿ƒçš„æ˜¯ Bifrost ä¸æ”¯æŒé›†ç¾¤ï¼Œæ²¡æ³•ä¿éšœé«˜å¯ç”¨æ€§ã€‚ä¸è¿‡ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒè¿˜æ²¡æœ‰å‡ºç°å®•æœºçš„æƒ…å†µï¼Œåè€Œæ˜¯é‚£äº›éƒ¨ç½²å¤šå°èŠ‚ç‚¹è´Ÿè½½å‡è¡¡çš„åå°æœåŠ¡å¸¸å¸¸ä¼šå‡ºç°å®•æœºã€‚\n\n\næœ€ç»ˆï¼Œæˆ‘ä»¬æ€»ç®—è§£å†³äº†æœåŠ¡ä¹‹é—´æ•°æ®ä¾èµ–çš„é—®é¢˜ã€‚\n\n\n## **äº”ã€æ€»ç»“**\n\n\nè¿™é‡Œæˆ‘ä»¬æ¢è®¨äº†æœåŠ¡é—´çš„æ•°æ®ä¾èµ–é—®é¢˜ï¼Œå¹¶ç»™å‡ºäº†ç›®å‰è¾ƒä¸ºåˆé€‚çš„è§£å†³æ–¹æ¡ˆã€‚å…¶å®è¿™é‡Œæåˆ°çš„æ–¹æ¡ˆä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§ä¼—çš„æ–¹æ¡ˆï¼Œè‚¯å®šä¼šå­˜åœ¨ä¸€äº›é—æ¼çš„é—®é¢˜æ²¡è€ƒè™‘ï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºã€‚\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-09-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "springcloud-data-202309",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "å¾®æœåŠ¡"
        ],
        "summary": "å¾®æœåŠ¡ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†æˆ‘ä»¬ç¨‹åºæ‹†åˆ†ä¸ºæœ€å°åŒ–å•å…ƒæ¥æä¾›æœåŠ¡ã€‚åœ¨ä¸€ä½“åŒ–ç³»ç»Ÿä¸­ï¼Œå„ä¸ªå¾®æœåŠ¡ä¹Ÿæ˜¯ä¸å¯èƒ½ç‹¬ç«‹å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå¾®æœåŠ¡ä¹‹é—´æ¶‰åŠåˆ°çš„æ•°æ®ä¾èµ–é—®é¢˜ï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬ä»åœºæ™¯å…¥æ‰‹æ¥åˆ†æè€ƒè™‘æ­¤ç±»é—®é¢˜ã€‚",
        "sort": "",
        "title": "å¾®æœåŠ¡ä¹‹é—´çš„æ•°æ®ä¾èµ–é—®é¢˜ï¼Œè¯¥å¦‚ä½•è§£å†³ï¼Ÿ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "3a5d9238-0fa8-4154-a6d5-92340f2ad733"
        }
      ],
      "body": "",
      "realName": "å¾®æœåŠ¡ä¹‹é—´çš„æ•°æ®ä¾èµ–é—®é¢˜ï¼Œè¯¥å¦‚ä½•è§£å†³ï¼Ÿ",
      "relativePath": "/archives/å¾®æœåŠ¡ä¹‹é—´çš„æ•°æ®ä¾èµ–é—®é¢˜ï¼Œè¯¥å¦‚ä½•è§£å†³ï¼Ÿ.md"
    },
    {
      "id": "f8b19b63-1f95-492f-afb0-70b7d69ca735",
      "doc_id": "f8b19b63-1f95-492f-afb0-70b7d69ca735",
      "title": "f8b19b63-1f95-492f-afb0-70b7d69ca735",
      "updated": 1696747200000,
      "body_original": "\n### 1 ä»€ä¹ˆæ˜¯å¤šç§Ÿæˆ·æ¶æ„ï¼Ÿ\n\n\nå¤šç§Ÿæˆ·æ¶æ„æ˜¯æŒ‡åœ¨ä¸€ä¸ªåº”ç”¨ä¸­æ”¯æŒå¤šä¸ªç§Ÿæˆ·ï¼ˆTenantï¼‰åŒæ—¶è®¿é—®ï¼Œæ¯ä¸ªç§Ÿæˆ·æ‹¥æœ‰ç‹¬ç«‹çš„èµ„æºå’Œæ•°æ®ï¼Œå¹¶ä¸”å½¼æ­¤ä¹‹é—´å®Œå…¨éš”ç¦»ã€‚é€šä¿—æ¥è¯´ï¼Œå¤šç§Ÿæˆ·å°±æ˜¯æŠŠä¸€ä¸ªåº”ç”¨æŒ‰ç…§å®¢æˆ·çš„éœ€æ±‚â€œåˆ†å‰²â€æˆå¤šä¸ªç‹¬ç«‹çš„å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹äº’ä¸å¹²æ‰°ã€‚\n\n\n### 2 å¤šç§Ÿæˆ·æ¶æ„çš„ä¼˜åŠ¿\n\n- æ›´å¥½åœ°æ»¡è¶³ä¸åŒç§Ÿæˆ·çš„ä¸ªæ€§åŒ–éœ€æ±‚ã€‚\n- å¯ä»¥é™ä½è¿ç»´æˆæœ¬ï¼Œå‡å°‘ç¡¬ä»¶ã€ç½‘ç»œç­‰åŸºç¡€è®¾æ–½çš„æŠ•å…¥ã€‚\n- èŠ‚çº¦å¼€å‘æˆæœ¬ï¼Œé€šè¿‡å¤ç”¨ä»£ç ï¼Œå¿«é€Ÿä¸Šçº¿æ–°çš„ç§Ÿæˆ·å®ä¾‹ã€‚\n- å¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ä¼¸ç¼©æ€§ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œæ¯ä¸ªç§Ÿæˆ·çš„æ•°æ®å’Œèµ„æºå‡å¯ç®¡ç†å’Œæ§åˆ¶ã€‚\n\n### 3 å®ç°å¤šç§Ÿæˆ·æ¶æ„çš„æŠ€æœ¯é€‰æ‹©\n\n\nå¯¹äºå®ç°å¤šç§Ÿæˆ·æ¶æ„æŠ€æœ¯ä¸æ˜¯æœ€é‡è¦çš„æœ€é‡è¦çš„æ˜¯æ­£ç¡®çš„æ¶æ„æ€è·¯ã€‚ä½†æ˜¯é€‰æ‹©æ­£ç¡®çš„æŠ€æœ¯å¯ä»¥æ›´å¿«åœ°å®ç°å¤šç§Ÿæˆ·æ¶æ„ã€‚\n\n\n### 1 æ¶æ„é€‰å‹\n\n\nåŸºäºJavaå¼€å‘å¤šç§Ÿæˆ·åº”ç”¨æ¨èä½¿ç”¨Spring Bootå’ŒSpring Cloudã€‚Spring Bootèƒ½å¿«é€Ÿæ­å»ºåº”ç”¨å¹¶æä¾›è®¸å¤šæˆç†Ÿçš„æ’ä»¶ã€‚Spring Cloudåˆ™æä¾›äº†è®¸å¤šå®ç°å¾®æœåŠ¡æ¶æ„çš„å·¥å…·å’Œç»„ä»¶ã€‚\n\n\n### 1.1 Spring Boot\n\n\nä½¿ç”¨Spring Bootå¯ä»¥ç®€åŒ–é¡¹ç›®çš„æ­å»ºè¿‡ç¨‹è‡ªåŠ¨é…ç½®è®¸å¤šå¸¸è§çš„ç¬¬ä¸‰æ–¹åº“å’Œç»„ä»¶ï¼Œå‡å°‘äº†å¼€å‘äººå‘˜çš„å·¥ä½œé‡ã€‚\n\n\n```java\n@RestController\npublicÂ classÂ TenantControllerÂ {\n\n\t\t@GetMapping(\"/hello\")\n\t\tpublicÂ StringÂ hello(@RequestHeader(\"tenant-id\")Â StringÂ tenantId)Â {\n\t\t\treturnÂ \"Hello,Â \"Â +Â tenantId;\n\t\t}\n}\n```\n\n\n### 1.2 Spring Cloud\n\n\nåœ¨æ¶æ„å¤šç§Ÿæˆ·çš„ç³»ç»Ÿæ—¶Spring Cloudä¼šæ›´åŠ æœ‰ç”¨ã€‚Spring Cloudæä¾›äº†ä¸€äº›æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚Eurekaã€Zookeeperã€Consulç­‰ï¼Œä»¥å®ç°æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰å¾®æœåŠ¡åŠŸèƒ½ã€‚\n\n\n### 2 æ•°æ®åº“è®¾è®¡\n\n\nåœ¨å¤šç§Ÿæˆ·ç¯å¢ƒä¸­æ•°æ®åº“å¿…é¡»ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ†åˆ«å­˜å‚¨æ•°æ®å¹¶ç¡®ä¿æ•°æ®éš”ç¦»ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°ï¼š\n\n- å¤šä¸ªç§Ÿæˆ·å…±äº«ç›¸åŒçš„æ•°æ®åº“ï¼Œæ¯ä¸ªè¡¨ä¸­éƒ½åŒ…å«tenant_idè¿™ä¸€åˆ—ï¼Œç”¨äºåŒºåˆ†ä¸åŒç§Ÿæˆ·çš„æ•°æ®ã€‚\n- ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ›å»ºå•ç‹¬çš„æ•°æ®åº“ï¼Œæ¯ä¸ªæ•°æ®åº“å†…çš„è¡¨ç»“æ„ç›¸åŒï¼Œä½†æ•°æ®ç›¸äº’éš”ç¦»ã€‚\n\n### 3 åº”ç”¨å¤šç§Ÿæˆ·éƒ¨ç½²\n\n\nä¸ºäº†å®ç°å¤šç§Ÿæˆ·åœ¨åº”ç”¨éƒ¨ç½²æ—¶æˆ‘ä»¬éœ€è¦è€ƒè™‘ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ã€‚\n\n\n### 3.1 åº”ç”¨éš”ç¦»\n\n\nåœ¨å¤šç§Ÿæˆ·ç¯å¢ƒä¸­ä¸åŒç§Ÿæˆ·éœ€è¦è®¿é—®ä¸åŒçš„èµ„æºï¼Œå› æ­¤éœ€è¦è¿›è¡Œåº”ç”¨éš”ç¦»ã€‚å¯ä»¥é€šè¿‡æ„å»ºç‹¬ç«‹çš„å®¹å™¨æˆ–è™šæ‹Ÿæœºã€ä½¿ç”¨å‘½åç©ºé—´ç­‰æ–¹å¼å®ç°ã€‚Dockerå°±æ˜¯ä¸€ç§éå¸¸æµè¡Œçš„éš”ç¦»å®¹å™¨æŠ€æœ¯ã€‚\n\n\n### 3.2 åº”ç”¨é…ç½®\n\n\nç”±äºæ¯ä¸ªç§Ÿæˆ·éƒ½æœ‰è‡ªå·±çš„é…ç½®éœ€æ±‚å› æ­¤éœ€è¦ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ†åˆ«è®¾ç½®åº”ç”¨é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ç«¯å£å·ã€SSLè¯ä¹¦ç­‰ç­‰ã€‚è¿™äº›é…ç½®å¯ä»¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨äº‘é…ç½®ä¸­å¿ƒä¸­ã€‚\n\n\n### 4 ç§Ÿæˆ·ç®¡ç†\n\n\nåœ¨å¤šç§Ÿæˆ·ç³»ç»Ÿä¸­éœ€è¦èƒ½å¤Ÿç®¡ç†ä¸åŒç§Ÿæˆ·çš„æ•°æ®å’Œèµ„æºï¼ŒåŒæ—¶éœ€è¦ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ†é…ç›¸åº”çš„æƒé™ã€‚è§£å†³æ–¹æ¡ˆé€šå¸¸åŒ…æ‹¬ä»¥ä¸‹ä¸¤éƒ¨åˆ†ã€‚\n\n\n### 4.1 ç§Ÿæˆ·ä¿¡æ¯ç»´æŠ¤\n\n\nç§Ÿæˆ·ä¿¡æ¯çš„ç»´æŠ¤åŒ…æ‹¬æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥è¯¢ç­‰æ“ä½œï¼Œè¦æ±‚èƒ½å¤Ÿæ ¹æ®ç§Ÿæˆ·åç§°æˆ–ç§Ÿæˆ·IDå¿«é€ŸæŸ¥æ‰¾å¯¹åº”çš„ç§Ÿæˆ·ä¿¡æ¯ã€‚\n\n\n```sql\nCREATEÂ TABLEÂ tenantÂ ( Â Â Â \n\tidÂ BIGINTÂ AUTO_INCREMENTÂ PRIMARYÂ KEY,\nÂ Â Â Â nameÂ VARCHAR(50)Â NOTÂ NULLÂ UNIQUE,\nÂ Â Â Â descriptionÂ VARCHAR(255),\nÂ Â Â Â created_timeÂ TIMESTAMPÂ DEFAULTÂ CURRENT_TIMESTAMP,\nÂ Â Â Â updated_timeÂ TIMESTAMPÂ DEFAULTÂ CURRENT_TIMESTAMPÂ ONÂ UPDATEÂ CURRENT_TIMESTAMP\n);\n```\n\n\n### 4.2 ç§Ÿæˆ·æƒé™æ§åˆ¶\n\n\nåœ¨å¤šç§Ÿæˆ·åº”ç”¨ä¸­å¿…é¡»ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ†åˆ«è®¾ç½®å¯¹ç³»ç»Ÿèµ„æºçš„è®¿é—®æƒé™ã€‚ä¾‹å¦‚ï¼ŒAç§Ÿæˆ·å’ŒBç§Ÿæˆ·ä¸èƒ½è®¿é—®å½¼æ­¤çš„æ•°æ®ã€‚\n\n\n```java\n@EnableGlobalMethodSecurity(prePostEnabled = true)\n@Configuration \npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\n\t@Override\n\tprotected void configure(HttpSecurity http) throws Exception {\n\t    http.authorizeRequests()\n\t        .antMatchers(\"/api/tenant/**\").hasRole(\"ADMIN\")\n\t        .anyRequest().authenticated()\n\t        .and()\n\t        .formLogin();\n\t}\n\t@Autowired\n\tpublic void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {\n\t    auth.userDetailsService(userDetailsService())\n\t        .passwordEncoder(new BCryptPasswordEncoder())\n\t        .and()\n\t        .inMemoryAuthentication()\n\t        .withUser(\"admin\")\n\t        .password(new BCryptPasswordEncoder().encode(\"123456\"))\n\t        .roles(\"ADMIN\");\n\t}\n}\n```\n\n\n### 1 Spring Bootä¸­çš„å¤šç§Ÿæˆ·å®ç°\n\n\nåœ¨Spring Bootä¸­å¯ä»¥é€šè¿‡å¤šæ•°æ®æºå’ŒåŠ¨æ€è·¯ç”±æ¥å®ç°å¤šç§Ÿæˆ·æœºåˆ¶ã€‚\n\n\n### 1.1 å¤šæ•°æ®æºå®ç°\n\n\nå¤šæ•°æ®æºæ˜¯æŒ‡ä¸ºä¸åŒçš„ç§Ÿæˆ·é…ç½®ä¸åŒçš„æ•°æ®æºï¼Œä½¿å¾—æ¯ä¸ªç§Ÿæˆ·éƒ½å¯ä»¥è®¿é—®è‡ªå·±çš„ç‹¬ç«‹æ•°æ®ã€‚å…·ä½“å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š\n\n\n```java\n@Configuration \npublic class DataSourceConfig {\n\t\t@Bean(name = \"dataSourceA\")\n\t\t@ConfigurationProperties(prefix = \"spring.datasource.a\")\n\t\tpublic DataSource dataSourceA() {\n\t\t    return DataSourceBuilder.create().build();\n\t\t}\n\t\t\n\t\t@Bean(name = \"dataSourceB\")\n\t\t@ConfigurationProperties(prefix = \"spring.datasource.b\")\n\t\tpublic DataSource dataSourceB() {\n\t\t    return DataSourceBuilder.create().build();\n\t\t}\n\t\t\n\t\t@Bean(name = \"dataSourceC\")\n\t\t@ConfigurationProperties(prefix = \"spring.datasource.c\")\n\t\tpublic DataSource dataSourceC() {\n\t\t    return DataSourceBuilder.create().build();\n\t\t}\n}\n```\n\n\nä»¥ä¸Šä»£ç æ˜¯é…ç½®äº†ä¸‰ä¸ªæ•°æ®æºåˆ†åˆ«å¯¹åº”ä¸‰ä¸ªç§Ÿæˆ·ã€‚ç„¶ååœ¨ä½¿ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ³¨è§£æ ‡è®°éœ€è¦è¿æ¥çš„æ•°æ®æºã€‚\n\n\n```java\n@Service\npublicÂ classÂ ProductServiceÂ {\n\t@Autowired\n\t@Qualifier(â€œdataSourceAâ€)\n\tprivateÂ DataSourceÂ dataSource;\n\t//Â â€¦\n}\n```\n\n\n### 1.2 åŠ¨æ€è·¯ç”±å®ç°\n\n\nåŠ¨æ€è·¯ç”±æ˜¯æŒ‡æ ¹æ®è¯·æ±‚çš„URLæˆ–å‚æ•°åŠ¨æ€åœ°åˆ‡æ¢åˆ°å¯¹åº”ç§Ÿæˆ·çš„æ•°æ®æºã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š\n\n\n```java\npublic class DynamicDataSource extends AbstractRoutingDataSource {\n\t@Override\n\tprotected Object determineCurrentLookupKey() {\n\treturn TenantContextHolder.getTenantId();\n\t}\n}\n\n@Configuration\npublic class DataSourceConfig {\n\n\t@Bean(name = \"dataSource\")\n\t@ConfigurationProperties(prefix = \"spring.datasource\")\n\tpublic DataSource dataSource() {\n\t\treturn DataSourceBuilder.create().type(DynamicDataSource.class).build();\n\t}\n}\n```\n\n\nä»¥ä¸Šæ˜¯åŠ¨æ€è·¯ç”±çš„æ ¸å¿ƒä»£ç `DynamicDataSource`ç»§æ‰¿è‡ª`AbstractRoutingDataSource`ï¼Œé€šè¿‡`determineCurrentLookupKey()`æ–¹æ³•åŠ¨æ€è·å¾—ç§Ÿæˆ·IDï¼Œç„¶ååˆ‡æ¢åˆ°å¯¹åº”çš„æ•°æ®æºã€‚\n\n\n### 2 Spring Cloudä¸­çš„å¤šç§Ÿæˆ·å®ç°\n\n\nåœ¨Spring Cloudä¸­å¯ä»¥é€šè¿‡æœåŠ¡æ³¨å†Œä¸å‘ç°ã€é…ç½®ä¸­å¿ƒã€è´Ÿè½½å‡è¡¡ç­‰æ–¹å¼å®ç°å¤šç§Ÿæˆ·æœºåˆ¶ã€‚\n\n\n```java\n/**\n * å¤šç§Ÿæˆ·é…ç½®ç±»\n */\n@Configuration\npublic class TenantConfig {\n\n    /**\n     * æ³¨å†Œå¤šç§Ÿæˆ·æ‹¦æˆªå™¨\n     */\n    @Bean\n    public TenantInterceptor tenantInterceptor() {\n        return new TenantInterceptor();\n    }\n\n    /**\n     * æ³¨å†Œå¤šç§Ÿæˆ·æ•°æ®æº\n     */\n    @Bean\n    @ConfigurationProperties(prefix = \"spring.datasource\")\n    public DataSource dataSource() {\n        return DataSourceBuilder.create().build();\n    }\n\n    /**\n     * é…ç½®å¤šç§Ÿæˆ·Mybatisæ’ä»¶\n     */\n    @Bean\n    public MybatisPlusInterceptor mybatisPlusInterceptor() {\n        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();\n        interceptor.addInnerInterceptor(new TenantLineInnerInterceptor(new TenantHandler()));\n        return interceptor;\n    }\n\n    /**\n     * é…ç½®å¤šç§Ÿæˆ·Mybatisæ‹¦æˆªå™¨\n     */\n    @Bean\n    public MybatisInterceptor mybatisInterceptor() {\n        MybatisInterceptor interceptor = new MybatisInterceptor();\n        interceptor.addInnerInterceptor(new TenantLineInnerInterceptor(new TenantHandler()));\n        return interceptor;\n    }\n\n    /**\n     * é…ç½®å¤šç§Ÿæˆ·Feignæ‹¦æˆªå™¨\n     */\n    @Bean\n    public RequestInterceptor feignInterceptor() {\n        return new TenantFeignInterceptor();\n    }\n\n    /**\n     * é…ç½®å¤šç§Ÿæˆ·Ribbonæ‹¦æˆªå™¨\n     */\n    @Bean\n    public LoadBalancerInterceptor ribbonInterceptor() {\n        return new TenantLoadBalancerInterceptor();\n    }\n\n    /**\n     * æ³¨å†Œå¤šç§Ÿæˆ·Redisé…ç½®\n     */\n    @Bean\n    public TenantRedisConfig tenantRedisConfig() {\n        return new TenantRedisConfig();\n    }\n\n}\n```\n\n\n### 2.1 æœåŠ¡æ³¨å†Œä¸å‘ç°\n\n\nä½¿ç”¨Spring Cloudä¸­çš„Eurekaå®ç°æœåŠ¡æ³¨å†Œä¸å‘ç°ã€‚æ¯ä¸ªç§Ÿæˆ·çš„æœåŠ¡éƒ½åœ¨æ³¨å†Œä¸­å¿ƒä»¥ä¸åŒçš„åº”ç”¨åç§°è¿›è¡Œæ³¨å†Œï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡æœåŠ¡åç§°æ¥è®¿é—®å¯¹åº”ç§Ÿæˆ·çš„æœåŠ¡ã€‚\n\n\n### 2.2 é…ç½®ä¸­å¿ƒ\n\n\nä½¿ç”¨Spring Cloud Configä½œä¸ºé…ç½®ä¸­å¿ƒã€‚é…ç½®æ–‡ä»¶ä»¥ç§Ÿæˆ·IDè¿›è¡ŒåŒºåˆ†ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¯»å–å¯¹åº”ç§Ÿæˆ·çš„é…ç½®æ–‡ä»¶æ¥è·å–é…ç½®ä¿¡æ¯ã€‚\n\n\n### 2.3 è´Ÿè½½å‡è¡¡\n\n\nä½¿ç”¨Spring Cloud Ribbonä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ã€‚æ ¹æ®è¯·æ±‚çš„URLæˆ–å‚æ•°é€‰æ‹©å¯¹åº”ç§Ÿæˆ·çš„æœåŠ¡å®ä¾‹è¿›è¡Œè¯·æ±‚è½¬å‘ã€‚\n\n\n### 2.4 API\n\n\nåœ¨APIç½‘å…³å±‚é¢å®ç°å¤šç§Ÿæˆ·æœºåˆ¶æ ¹æ®è¯·æ±‚çš„URLæˆ–å‚æ•°åˆ¤æ–­æ‰€å±ç§Ÿæˆ·ï¼Œå¹¶è½¬å‘åˆ°å¯¹åº”ç§Ÿæˆ·çš„æœåŠ¡å®ä¾‹ã€‚\n\n\n### 1 ç§æœ‰äº‘ç¯å¢ƒ\n\n\nç§æœ‰äº‘ç¯å¢ƒæŒ‡çš„æ˜¯ç”±ä¼ä¸šè‡ªè¡Œæ­å»ºçš„äº‘ç¯å¢ƒï¼Œä¸å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸»è¦åº”ç”¨äºä¼ä¸šå†…éƒ¨çš„æ•°æ®å­˜å‚¨ã€ç®¡ç†ã€å…±äº«å’Œå®‰å…¨æ§åˆ¶ã€‚ç›¸è¾ƒäºå…¬æœ‰äº‘ï¼Œç§æœ‰äº‘çš„ä¼˜ç‚¹åœ¨äºå¯ä»¥æ›´å¥½åœ°ä¿æŠ¤ä¼ä¸šæ ¸å¿ƒæ•°æ®ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿæ»¡è¶³ä¼ä¸šå¯¹äºæ•°æ®å®‰å…¨æ€§å’Œå¯æ§æ€§çš„è¦æ±‚ã€‚\n\n\n### 2 å…¬æœ‰äº‘ç¯å¢ƒ\n\n\nå…¬æœ‰äº‘ç¯å¢ƒæŒ‡çš„æ˜¯ç”±äº‘æœåŠ¡å•†æ­å»ºå¹¶å¯¹å¤–æä¾›æœåŠ¡çš„äº‘ç¯å¢ƒï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è´­ä¹°ç›¸åº”çš„äº‘æœåŠ¡ï¼Œå¦‚äº‘å­˜å‚¨ã€äº‘è®¡ç®—ã€äº‘æ•°æ®åº“ç­‰ã€‚ç›¸è¾ƒäºç§æœ‰äº‘ï¼Œå…¬æœ‰äº‘çš„ä¼˜ç‚¹åœ¨äºå…·æœ‰æˆæœ¬ä½å»‰ã€å¼¹æ€§ä¼¸ç¼©ã€å…¨çƒåŒ–éƒ¨ç½²ç­‰ç‰¹ç‚¹ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ»¡è¶³ä¼ä¸šå¿«é€Ÿå‘å±•çš„éœ€æ±‚ã€‚\n\n\n### 3 ä¼ä¸šçº§åº”ç”¨\n\n\nä¼ä¸šçº§åº”ç”¨æ˜¯æŒ‡é¢å‘ä¼ä¸šå®¢æˆ·çš„åº”ç”¨ç¨‹åºï¼Œä¸»è¦åŒ…æ‹¬ERPã€CRMã€OAç­‰ä¸€ç³»åˆ—åº”ç”¨ç³»ç»Ÿã€‚è¿™ç±»åº”ç”¨çš„ç‰¹ç‚¹åœ¨äºåŠŸèƒ½å¼ºå¤§ã€æµç¨‹å¤æ‚ã€æ•°æ®é‡å¤§ï¼Œéœ€è¦æ»¡è¶³ä¼ä¸šçš„é«˜æ•ˆç‡ã€é«˜å¯é æ€§ã€é«˜å®‰å…¨æ€§å’Œæ˜“ç»´æŠ¤æ€§ç­‰è¦æ±‚ã€‚åœ¨äº‘è®¡ç®—ç¯å¢ƒä¸‹ï¼Œä¼ä¸šå¯ä»¥å°†è¿™äº›åº”ç”¨éƒ¨ç½²åœ¨ç§æœ‰äº‘æˆ–å…¬æœ‰äº‘ä¸Šï¼Œå‡å°‘äº†ç¡¬ä»¶è®¾å¤‡çš„æŠ•å…¥å’Œç»´æŠ¤æˆæœ¬ï¼Œæé«˜äº†ç®¡ç†æ•ˆç‡ã€‚\n\n\n### 1 æ­å»ºSpring Bootå’ŒSpring Cloudç¯å¢ƒ\n\n\né¦–å…ˆéœ€è¦åœ¨Mavené¡¹ç›®ä¸­å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼š\n\n\n```xml\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-web</artifactId>\n</dependency>\n<dependencyManagement>\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-dependencies</artifactId>\n            <version>2020.0.3</version>\n            <type>pom</type>\n            <scope>import</scope>\n        </dependency>\n    </dependencies>\n</dependencyManagement>\n```\n\n\nç„¶åéœ€è¦åœ¨application.ymlä¸­é…ç½®ç›¸åº”çš„å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n\n```yaml\nspring:\n  datasource:\n    url: jdbc:mysql://localhost:3306/appdb?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai\n    username: root\n    password: 123456\n  mybatis:\n    type-aliases-package: com.example.demo.model\n    mapper-locations: classpath:mapper/*.xml\nserver:\n  port: 8080\neureka:\n  client:\n    serviceUrl:\n      defaultZone: http://localhost:8761/eureka/\n  management:\n    endpoints:\n      web:\n        exposure:\n          include: \"*\"\n```\n\n\nå…¶ä¸­`datasource.url`ä¸ºæ•°æ®åº“è¿æ¥çš„URLï¼Œusernameå’Œpasswordä¸ºæ•°æ®åº“è¿æ¥çš„è´¦å·å’Œå¯†ç ï¼›`server.port`ä¸ºSpring Bootåº”ç”¨å¯åŠ¨çš„ç«¯å£ï¼›`eureka.client.serviceUrl.defaultZone`ä¸ºEurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„URLã€‚\n\n\n### 2 ä¿®æ”¹æ•°æ®åº“è®¾è®¡\n\n\næ¥ä¸‹æ¥éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ï¼Œä»¥æ”¯æŒå¤šç§Ÿæˆ·éƒ¨ç½²ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸€ä¸ªä¸ç§Ÿæˆ·ç›¸å…³çš„å­—æ®µï¼Œä»¥ä¾¿åœ¨åº”ç”¨ä¸­åŒºåˆ†ä¸åŒçš„ç§Ÿæˆ·ã€‚\n\n\n### 3 å®ç°åº”ç”¨å¤šç§Ÿæˆ·éƒ¨ç½²\n\n\næ¥ç€éœ€è¦åœ¨ä»£ç ä¸­å®ç°åº”ç”¨çš„å¤šç§Ÿæˆ·éƒ¨ç½²åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªç§Ÿæˆ·å®ä¾‹åŒ–å¯¹åº”çš„Spring Beanï¼Œå¹¶æ ¹æ®ç§Ÿæˆ·IDå°†è¯·æ±‚è·¯ç”±åˆ°ç›¸åº”çš„Beanä¸­å»å¤„ç†ã€‚\n\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å®ç°ç¤ºä¾‹ï¼š\n\n\n```java\n@Configuration\npublic class MultiTenantConfig {\n    // æä¾›å¯¹åº”ç§Ÿæˆ·çš„æ•°æ®æº\n    @Bean\n    public DataSource dataSource(TenantRegistry tenantRegistry) {\n        return new TenantAwareDataSource(tenantRegistry);\n    }\n\n    // å¤šç§Ÿæˆ·Sessionå·¥å‚\n    @Bean(name = \"sqlSessionFactory\")\n    public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception {\n        SqlSessionFactoryBean sessionFactory = new SqlSessionFactoryBean();\n        sessionFactory.setDataSource(dataSource);\n        return sessionFactory.getObject();\n    }\n\n    // åŠ¨æ€åˆ‡æ¢ç§Ÿæˆ·\n    @Bean\n    public MultiTenantInterceptor multiTenantInterceptor(TenantResolver tenantResolver) {\n        MultiTenantInterceptor interceptor = new MultiTenantInterceptor();\n        interceptor.setTenantResolver(tenantResolver);\n        return interceptor;\n    }\n\n    // æ³¨å†Œæ‹¦æˆªå™¨\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(multiTenantInterceptor());\n    }\n\n    // æ³¨å†Œç§Ÿæˆ·ä¿¡æ¯\n    @Bean\n    public TenantRegistry tenantRegistry() {\n        return new TenantRegistryImpl();\n    }\n\n    // è§£æç§Ÿæˆ·ID\n    @Bean\n    public TenantResolver tenantResolver() {\n        return new HeaderTenantResolver();\n    }\n}\n```\n\n\nå…¶ä¸­`MultiTenantConfig`æ˜¯å¤šç§Ÿæˆ·éƒ¨ç½²çš„æ ¸å¿ƒé…ç½®ç±»ï¼Œå®ƒæä¾›äº†å¯¹åº”ç§Ÿæˆ·æ•°æ®æºã€å¤šç§Ÿæˆ·Sessionå·¥å‚ã€åŠ¨æ€åˆ‡æ¢ç§Ÿæˆ·ç­‰åŠŸèƒ½ã€‚\n\n\n### 4 å®ç°ç§Ÿæˆ·ç®¡ç†\n\n\næœ€åéœ€è¦å®ç°ä¸€ä¸ªç§Ÿæˆ·ç®¡ç†çš„åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿä¸­ç®¡ç†ä¸åŒçš„ç§Ÿæˆ·ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Spring Cloudçš„æœåŠ¡æ³¨å†Œä¸å‘ç°ç»„ä»¶Eurekaæ¥æ³¨å†Œæ¯ä¸ªç§Ÿæˆ·çš„å®ä¾‹ï¼Œå¹¶åœ¨ç®¡ç†ç•Œé¢ä¸­è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸ºæ¯ä¸ªç§Ÿæˆ·æä¾›ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“ï¼Œä»¥ä¿è¯æ•°æ®éš”ç¦»æ€§ã€‚\n\n\næœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Spring Bootå’ŒSpring Cloudå®ç°ä¸€ä¸ªæ”¯æŒå¤šç§Ÿæˆ·éƒ¨ç½²çš„åº”ç”¨ã€‚ä¸»è¦åŒ…æ‹¬æ­å»ºSpring Bootå’ŒSpring Cloudç¯å¢ƒã€ä¿®æ”¹æ•°æ®åº“è®¾è®¡ã€å®ç°åº”ç”¨å¤šç§Ÿæˆ·éƒ¨ç½²ã€å®ç°ç§Ÿæˆ·ç®¡ç†ç­‰æ–¹é¢ã€‚\n\n\nåº”ç”¨åœºæ™¯ä¸»è¦åŒ…æ‹¬SaaSåº”ç”¨ã€å¤šç§Ÿæˆ·äº‘æœåŠ¡ç­‰ã€‚ä¼˜åŠ£åŠ¿ä¸»è¦ä½“ç°åœ¨æå‡äº†åº”ç”¨çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œä½†ä¹Ÿå¢åŠ äº†éƒ¨ç½²å’Œç®¡ç†çš„å¤æ‚åº¦ã€‚æœªæ¥çš„æ”¹è¿›æ–¹å‘å¯ä»¥è€ƒè™‘è¿›ä¸€æ­¥æå‡å¤šç§Ÿæˆ·ç®¡ç†çš„è‡ªåŠ¨åŒ–ç¨‹åº¦ï¼Œå‡å°‘äººå·¥å¹²é¢„å’Œé”™è¯¯ç‡ã€‚\n\n\næ·»åŠ Eurekaä¾èµ–\n\n\n```xml\n\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\n</dependency>\n// åˆ›å»ºç§Ÿæˆ·æœåŠ¡\n// æ·»åŠ Eurekaä¾èµ–\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n</dependency>\n// åˆ›å»ºç§Ÿæˆ·ç®¡ç†æ¨¡å—\n// æ·»åŠ Spring Data JPAä¾èµ–\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-jpa</artifactId>\n</dependency>\n```\n\n\n```java\n// åœ¨Spring Bootå’ŒSpring Cloudç¯å¢ƒä¸‹æ­å»ºå¤šç§Ÿæˆ·åº”ç”¨\n// ä¿®æ”¹æ•°æ®åº“è®¾è®¡ï¼Œå®ç°åº”ç”¨å¤šç§Ÿæˆ·éƒ¨ç½²ï¼Œå®ç°ç§Ÿæˆ·ç®¡ç†\n// ä½¿ç”¨EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°ç»„ä»¶æ³¨å†Œæ¯ä¸ªç§Ÿæˆ·çš„å®ä¾‹\n\n\n\n// å¯ç”¨Eureka\n@EnableEurekaServer\n@SpringBootApplication\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n\n\n// æ³¨å†Œç§Ÿæˆ·æœåŠ¡\n@EnableDiscoveryClient\n@SpringBootApplication\npublic class TenantServiceApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(TenantServiceApplication.class, args);\n    }\n}\n\n// é…ç½®æ–‡ä»¶\nspring:\n  application:\n    name: tenant-service\neureka:\n  client:\n    service-url:\n      defaultZone: http://localhost:8761/eureka/\n\n\n\n// åˆ›å»ºTenantå®ä½“ç±»\n@Entity\n@Table(name = \"tenant\")\npublic class Tenant {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n    private String name;\n    private String databaseName;\n    private String databaseUsername;\n    private String databasePassword;\n    // getterå’Œsetter\n}\n\n// åˆ›å»ºTenantRepositoryæ¥å£\npublic interface TenantRepository extends JpaRepository<Tenant, Long> {\n}\n\n// åˆ›å»ºTenantServiceç±»\n@Service\npublic class TenantService {\n    @Autowired\n    private TenantRepository tenantRepository;\n    // æ·»åŠ ç§Ÿæˆ·\n    public Tenant addTenant(Tenant tenant) {\n        return tenantRepository.save(tenant);\n    }\n    // è·å–æ‰€æœ‰ç§Ÿæˆ·\n    public List<Tenant> getAllTenants() {\n        return tenantRepository.findAll();\n    }\n    // æ ¹æ®idè·å–ç§Ÿæˆ·\n    public Tenant getTenantById(Long id) {\n        return tenantRepository.findById(id).orElse(null);\n    }\n    // æ ¹æ®idåˆ é™¤ç§Ÿæˆ·\n    public void deleteTenantById(Long id) {\n        tenantRepository.deleteById(id);\n    }\n}\n\n// åˆ›å»ºTenantControllerç±»\n@RestController\n@RequestMapping(\"/tenants\")\npublic class TenantController {\n    @Autowired\n    private TenantService tenantService;\n    // æ·»åŠ ç§Ÿæˆ·\n    @PostMapping(\"\")\n    public Tenant addTenant(@RequestBody Tenant tenant) {\n        return tenantService.addTenant(tenant);\n    }\n    // è·å–æ‰€æœ‰ç§Ÿæˆ·\n    @GetMapping(\"\")\n    public List<Tenant> getAllTenants() {\n        return tenantService.getAllTenants();\n    }\n    // æ ¹æ®idè·å–ç§Ÿæˆ·\n    @GetMapping(\"/{id}\")\n    public Tenant getTenantById(@PathVariable Long id) {\n        return tenantService.getTenantById(id);\n    }\n    // æ ¹æ®idåˆ é™¤ç§Ÿæˆ·\n    @DeleteMapping(\"/{id}\")\n    public void deleteTenantById(@PathVariable Long id) {\n        tenantService.deleteTenantById(id);\n    }\n}\n\n// åˆ›å»ºå¤šç§Ÿæˆ·æ•°æ®åº“\npublic class MultiTenantConnectionProviderImpl implements MultiTenantConnectionProvider {\n    private Map<String, DataSource> dataSourceMap = new HashMap<>();\n    @Override\n    public Connection getAnyConnection() throws SQLException {\n        return dataSourceMap.values().iterator().next().getConnection();\n    }\n    @Override\n    public Connection getConnection(String tenantIdentifier) throws SQLException {\n        DataSource dataSource = dataSourceMap.get(tenantIdentifier);\n        if (dataSource == null) {\n            throw new SQLException(\"No dataSource found for tenantIdentifier: \" + tenantIdentifier);\n        }\n        return dataSource.getConnection();\n    }\n    @Override\n    public void releaseAnyConnection(Connection connection) throws SQLException {\n        connection.close();\n    }\n    @Override\n    public void releaseConnection(String tenantIdentifier, Connection connection) throws SQLException {\n        connection.close();\n    }\n    @Override\n    public boolean supportsAggressiveRelease() {\n        return true;\n    }\n}\n\n// åˆ›å»ºå¤šç§Ÿæˆ·å®ä½“ç±»\n@Entity\n@Table(name = \"customer\", schema = \"tenant1\")\npublic class Customer {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n    private String name;\n    private String email;\n    // getterå’Œsetter\n}\n\n// åˆ›å»ºå¤šç§Ÿæˆ·Repositoryæ¥å£\npublic interface CustomerRepository extends JpaRepository<Customer, Long> {\n    List<Customer> findByTenantId(Long tenantId);\n}\n\n// åˆ›å»ºå¤šç§Ÿæˆ·Serviceç±»\n@Service\npublic class CustomerService {\n    @Autowired\n    private CustomerRepository customerRepository;\n    // æ·»åŠ å®¢æˆ·\n    public Customer addCustomer(Customer customer) {\n        return customerRepository.save(customer);\n    }\n    // è·å–æ‰€æœ‰å®¢æˆ·\n    public List<Customer> getAllCustomers(Long tenantId) {\n        return customerRepository.findByTenantId(tenantId);\n    }\n    // æ ¹æ®idè·å–å®¢æˆ·\n    public Customer getCustomerById(Long id) {\n        return customerRepository.findById(id).orElse(null);\n    }\n    // æ ¹æ®idåˆ é™¤å®¢æˆ·\n    public void deleteCustomerById(Long id) {\n        customerRepository.deleteById(id);\n    }\n}\n\n// åˆ›å»ºå¤šç§Ÿæˆ·Controllerç±»\n@RestController\n@RequestMapping(\"/{tenantId}/customers\")\npublic class CustomerController {\n    @Autowired\n    private CustomerService customerService;\n    // æ·»åŠ å®¢æˆ·\n    @PostMapping(\"\")\n    public Customer addCustomer(@RequestBody Customer customer) {\n        return customerService.addCustomer(customer);\n    }\n    // è·å–æ‰€æœ‰å®¢æˆ·\n    @GetMapping(\"\")\n    public List<Customer> getAllCustomers(@PathVariable Long tenantId) {\n        return customerService.getAllCustomers(tenantId);\n    }\n    // æ ¹æ®idè·å–å®¢æˆ·\n    @GetMapping(\"/{id}\")\n    public Customer getCustomerById(@PathVariable Long id) {\n        return customerService.getCustomerById(id);\n    }\n    // æ ¹æ®idåˆ é™¤å®¢æˆ·\n    @DeleteMapping(\"/{id}\")\n    public void deleteCustomerById(@PathVariable Long id) {\n        customerService.deleteCustomerById(id);\n    }\n}\n```\n\n\n```yaml\n// é…ç½®æ–‡ä»¶\nspring:\n  application:\n    name: eureka-server\nserver:\n  port: 8761\n```\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-09-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "spring-boot-tenant-202309",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "å¾®æœåŠ¡",
          "SAAS"
        ],
        "summary": "å¸¸è§çš„æŠ€æœ¯é€‰æ‹©åŒ…æ‹¬ï¼š\nâ€¢ æ•°æ®åº“çº§å¤šç§Ÿæˆ·ï¼šä½¿ç”¨å¤šä¸ªæ•°æ®åº“å®ä¾‹åˆ†åˆ«å­˜å‚¨å„ä¸ªç§Ÿæˆ·çš„æ•°æ®ï¼Œæ¯ä¸ªç§Ÿæˆ·å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“ã€‚\nâ€¢ æ¨¡å¼çº§å¤šç§Ÿæˆ·ï¼šä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“å®ä¾‹ï¼Œä½†æ˜¯ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ›å»ºç‹¬ç«‹çš„æ•°æ®åº“æ¨¡å¼ï¼Œå®ç°æ•°æ®éš”ç¦»ã€‚\nâ€¢ è¡¨çº§å¤šç§Ÿæˆ·ï¼šåœ¨åŒä¸€ä¸ªæ•°æ®åº“æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ä¸åŒçš„è¡¨æ¥å­˜å‚¨å„ä¸ªç§Ÿæˆ·çš„æ•°æ®ï¼Œå®ç°æ•°æ®éš”ç¦»ã€‚\nâ€¢ åº”ç”¨çº§å¤šç§Ÿæˆ·ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­å®ç°ç§Ÿæˆ·éš”ç¦»ï¼Œä¾‹å¦‚ä½¿ç”¨Spring Cloudç­‰å¾®æœåŠ¡æ¡†æ¶ã€‚\nâ€¢ å®¹å™¨çº§å¤šç§Ÿæˆ·ï¼šä½¿ç”¨å®¹å™¨æŠ€æœ¯ï¼Œä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ›å»ºç‹¬ç«‹çš„å®¹å™¨ï¼Œå®ç°èµ„æºéš”ç¦»å’Œæ§åˆ¶ã€‚\n4 å®ç°å¤šç§Ÿæˆ·æ¶æ„çš„æ³¨æ„äº‹é¡¹\nâ€¢ ä¿è¯ç§Ÿæˆ·æ•°æ®çš„éš”ç¦»æ€§å’Œå®‰å…¨æ€§ã€‚\nâ€¢ è®¾è®¡åˆç†çš„ç§Ÿæˆ·æ•°æ®ç»“æ„å’Œå…³ç³»æ¨¡å‹ã€‚\nâ€¢ ç»Ÿä¸€ç®¡ç†ç§Ÿæˆ·çš„é…ç½®å’Œæƒé™ã€‚\nâ€¢ ä¿è¯ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ä¼¸ç¼©æ€§ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•ã€‚\nâ€¢ ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚\nâ€¢ å¯¹ç§Ÿæˆ·æ•°æ®è¿›è¡Œå¤‡ä»½å’Œæ¢å¤ï¼Œä¿è¯æ•°æ®çš„å¯é æ€§å’Œå®Œæ•´æ€§ã€‚",
        "sort": "",
        "title": "Spring Boot å®ç°å¤šç§Ÿæˆ·æ¶æ„ï¼šæ”¯æŒåº”ç”¨å¤šç§Ÿæˆ·éƒ¨ç½²å’Œç®¡ç†",
        "status": "Published",
        "updated": "2023-10-08 14:40:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "f8b19b63-1f95-492f-afb0-70b7d69ca735"
        }
      ],
      "body": "",
      "realName": "Spring Boot å®ç°å¤šç§Ÿæˆ·æ¶æ„ï¼šæ”¯æŒåº”ç”¨å¤šç§Ÿæˆ·éƒ¨ç½²å’Œç®¡ç†",
      "relativePath": "/archives/Spring Boot å®ç°å¤šç§Ÿæˆ·æ¶æ„ï¼šæ”¯æŒåº”ç”¨å¤šç§Ÿæˆ·éƒ¨ç½²å’Œç®¡ç†.md"
    },
    {
      "id": "28f5e6a0-2d06-439d-b947-b7121480c146",
      "doc_id": "28f5e6a0-2d06-439d-b947-b7121480c146",
      "title": "28f5e6a0-2d06-439d-b947-b7121480c146",
      "updated": 1696747320000,
      "body_original": "\nåšä¸€äº›Cç«¯ä¸šåŠ¡ï¼Œä¸å¯é¿å…çš„è¦å¼•å…¥ä¸€çº§ç¼“å­˜æ¥ä»£æ›¿æ•°æ®åº“çš„å‹åŠ›å¹¶ä¸”å‡å°‘ä¸šåŠ¡å“åº”æ—¶é—´ï¼Œå…¶å®æ¯æ¬¡å¼•å…¥ä¸€ä¸ªä¸­é—´ä»¶æ¥è§£å†³é—®é¢˜çš„åŒæ—¶ï¼Œå¿…ç„¶ä¼šå¸¦æ¥å¾ˆå¤šæ–°çš„é—®é¢˜éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚\n\n\né‚£ä¹ˆå…¶å®è¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–é—®é¢˜æ¯”å¦‚ä½¿ç”¨Redisä½œä¸ºä¸€çº§ç¼“å­˜æ—¶å¯èƒ½å¸¦æ¥çš„çƒ­keyã€å¤§keyç­‰é—®é¢˜ï¼Œæœ¬æ–‡æˆ‘ä»¬å°±çƒ­keyï¼ˆhot keyï¼‰é—®é¢˜æ¥è®¨è®ºï¼Œå¦‚ä½•åˆç†çš„è§£å†³çƒ­keyé—®é¢˜ã€‚\n\n\n## èƒŒæ™¯\n\n\n> çƒ­keyæ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•å¯¼è‡´çš„ï¼Ÿ\n\n\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ç¼“å­˜Rediséƒ½æ˜¯å¤šèŠ‚ç‚¹çš„é›†ç¾¤ç‰ˆï¼Œå¯¹æŸä¸ªkeyè¿›è¡Œè¯»å†™æ—¶ï¼Œä¼šæ ¹æ®è¯¥keyçš„hashè®¡ç®—å‡ºå¯¹åº”çš„slotï¼Œæ ¹æ®è¿™ä¸ªslotå°±èƒ½æ‰¾åˆ°ä¸ä¹‹å¯¹åº”çš„åˆ†ç‰‡(ä¸€ä¸ªmasterå’Œå¤šä¸ªslaveç»„æˆçš„ä¸€ç»„redisé›†ç¾¤)æ¥å­˜å–è¯¥K-Vã€‚ä½†æ˜¯åœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯¹äºæŸäº›ç‰¹å®šä¸šåŠ¡æˆ–è€…ä¸€äº›ç‰¹å®šçš„æ—¶æ®µï¼ˆæ¯”å¦‚ç”µå•†ä¸šåŠ¡çš„å•†å“ç§’æ€æ´»åŠ¨ï¼‰ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¤§é‡çš„è¯·æ±‚è®¿é—®åŒä¸€ä¸ªkeyã€‚\n\n\næ‰€æœ‰çš„è¯·æ±‚ï¼ˆä¸”è¿™ç±»è¯·æ±‚è¯»å†™æ¯”ä¾‹éå¸¸é«˜ï¼‰éƒ½ä¼šè½åˆ°åŒä¸€ä¸ªredis serverä¸Šï¼Œè¯¥redisçš„è´Ÿè½½å°±ä¼šä¸¥é‡åŠ å‰§ï¼Œæ­¤æ—¶æ•´ä¸ªç³»ç»Ÿå¢åŠ æ–°rediså®ä¾‹ä¹Ÿæ²¡æœ‰ä»»ä½•ç”¨å¤„ï¼Œå› ä¸ºæ ¹æ®hashç®—æ³•ï¼ŒåŒä¸€ä¸ªkeyçš„è¯·æ±‚è¿˜æ˜¯ä¼šè½åˆ°åŒä¸€å°æ–°æœºå™¨ä¸Šï¼Œè¯¥æœºå™¨ä¾ç„¶ä¼šæˆä¸ºç³»ç»Ÿç“¶é¢ˆ2ï¼Œç”šè‡³é€ æˆæ•´ä¸ªé›†ç¾¤å®•æ‰ï¼Œè‹¥æ­¤çƒ­ç‚¹keyçš„value ä¹Ÿæ¯”è¾ƒå¤§ï¼Œä¹Ÿä¼šé€ æˆç½‘å¡è¾¾åˆ°ç“¶é¢ˆï¼Œè¿™ç§é—®é¢˜ç§°ä¸º â€œçƒ­keyâ€ é—®é¢˜ã€‚\n\n\nå¦‚ä¸‹å›¾1ã€2æ‰€ç¤ºï¼Œåˆ†åˆ«æ˜¯æ­£å¸¸redis clusteré›†ç¾¤å’Œä½¿ç”¨ä¸€å±‚proxyä»£ç†çš„redis é›†ç¾¤keyè®¿é—®ã€‚\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309121604507.png)\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309121605080.png)\n\n\nå¦‚ä¸Šæ‰€è¯´ï¼Œçƒ­keyä¼šç»™é›†ç¾¤ä¸­çš„å°‘éƒ¨åˆ†èŠ‚ç‚¹å¸¦æ¥è¶…é«˜çš„è´Ÿè½½å‹åŠ›ï¼Œå¦‚æœä¸æ­£ç¡®å¤„ç†ï¼Œé‚£ä¹ˆè¿™äº›èŠ‚ç‚¹å®•æœºéƒ½æœ‰å¯èƒ½ï¼Œä»è€Œä¼šå½±å“æ•´ä¸ªç¼“å­˜é›†ç¾¤çš„è¿ä½œï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»åŠæ—¶å‘ç°çƒ­keyã€è§£å†³çƒ­keyé—®é¢˜ã€‚\n\n\n## 1.çƒ­keyæ¢æµ‹\n\n\nçƒ­keyæ¢æµ‹ï¼Œçœ‹åˆ°ç”±äºredisé›†ç¾¤çš„åˆ†æ•£æ€§ä»¥åŠçƒ­ç‚¹keyå¸¦æ¥çš„ä¸€äº›æ˜¾è‘—å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç”±ç²—åŠç»†çš„æ€è€ƒæµç¨‹æ¥åšçƒ­ç‚¹keyæ¢æµ‹çš„æ–¹æ¡ˆã€‚\n\n\n### 1.1 é›†ç¾¤ä¸­æ¯ä¸ªslotçš„qpsç›‘æ§\n\n\nçƒ­keyæœ€æ˜æ˜¾çš„å½±å“æ˜¯æ•´ä¸ªredisé›†ç¾¤ä¸­çš„qpså¹¶æ²¡æœ‰é‚£ä¹ˆå¤§çš„å‰æä¸‹ï¼Œæµé‡åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­slotä¸å‡çš„é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯å¯¹äºæ¯ä¸ªslotä¸­çš„æµé‡åšç›‘æ§ï¼Œä¸ŠæŠ¥ä¹‹ååšæ¯ä¸ªslotçš„æµé‡å¯¹æ¯”ï¼Œå°±èƒ½åœ¨çƒ­keyå‡ºç°æ—¶å‘ç°å½±å“åˆ°çš„å…·ä½“slotã€‚è™½ç„¶è¿™ä¸ªç›‘æ§æœ€ä¸ºæ–¹ä¾¿ï¼Œä½†æ˜¯ç²’åº¦è¿‡äºç²—äº†ï¼Œä»…é€‚ç”¨äºå‰æœŸé›†ç¾¤ç›‘æ§æ–¹æ¡ˆï¼Œå¹¶ä¸é€‚ç”¨äºç²¾å‡†æ¢æµ‹åˆ°çƒ­keyçš„åœºæ™¯ã€‚\n\n\n### 1.2 proxyçš„ä»£ç†æœºåˆ¶ä½œä¸ºæ•´ä¸ªæµé‡å…¥å£ç»Ÿè®¡\n\n\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å›¾2çš„redisé›†ç¾¤proxyä»£ç†æ¨¡å¼ï¼Œç”±äºæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šå…ˆåˆ°proxyå†åˆ°å…·ä½“çš„slotèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªçƒ­ç‚¹keyçš„æ¢æµ‹ç»Ÿè®¡å°±å¯ä»¥æ”¾åœ¨proxyä¸­åšï¼Œåœ¨proxyä¸­åŸºäºæ—¶é—´æ»‘åŠ¨çª—å£ï¼Œå¯¹æ¯ä¸ªkeyåšè®¡æ•°ï¼Œç„¶åç»Ÿè®¡å‡ºè¶…å‡ºå¯¹åº”é˜ˆå€¼çš„keyã€‚ä¸ºäº†é˜²æ­¢è¿‡å¤šå†—ä½™çš„ç»Ÿè®¡ï¼Œè¿˜å¯ä»¥è®¾å®šä¸€äº›è§„åˆ™ï¼Œä»…ç»Ÿè®¡å¯¹åº”å‰ç¼€å’Œç±»å‹çš„keyã€‚è¿™ç§æ–¹å¼éœ€è¦è‡³å°‘æœ‰proxyçš„ä»£ç†æœºåˆ¶ï¼Œå¯¹äºredisæ¶æ„æœ‰è¦æ±‚ã€‚\n\n\n### 1.3 redisåŸºäºLFUçš„çƒ­ç‚¹keyå‘ç°æœºåˆ¶\n\n\nredis 4.0ä»¥ä¸Šçš„ç‰ˆæœ¬æ”¯æŒäº†æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„åŸºäºLFUçš„çƒ­ç‚¹keyå‘ç°æœºåˆ¶ï¼Œä½¿ç”¨redis-cli â€“hotkeyså³å¯ï¼Œæ‰§è¡Œredis-cliæ—¶åŠ ä¸Šâ€“hotkeysé€‰é¡¹ã€‚å¯ä»¥å®šæ—¶åœ¨èŠ‚ç‚¹ä¸­ä½¿ç”¨è¯¥å‘½ä»¤æ¥å‘ç°å¯¹åº”çƒ­ç‚¹keyã€‚\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309121606497.png)\n\n\nå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°redis-cli â€“hotkeysçš„æ‰§è¡Œç»“æœï¼Œçƒ­keyçš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤çš„æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œå¯ä»¥è®¾ç½®å®šæ—¶æ‰§è¡Œæ¥ç»Ÿè®¡ã€‚\n\n\n### 1.4 åŸºäºRediså®¢æˆ·ç«¯åšæ¢æµ‹\n\n\nç”±äºredisçš„å‘½ä»¤æ¯æ¬¡éƒ½æ˜¯ä»å®¢æˆ·ç«¯å‘å‡ºï¼ŒåŸºäºæ­¤æˆ‘ä»¬å¯ä»¥åœ¨redis clientçš„ä¸€äº›ä»£ç å¤„è¿›è¡Œç»Ÿè®¡è®¡æ•°ï¼Œæ¯ä¸ªclientåšåŸºäºæ—¶é—´æ»‘åŠ¨çª—å£çš„ç»Ÿè®¡ï¼Œè¶…è¿‡ä¸€å®šçš„é˜ˆå€¼ä¹‹åä¸ŠæŠ¥è‡³serverï¼Œç„¶åç»Ÿä¸€ç”±serverä¸‹å‘è‡³å„ä¸ªclientï¼Œå¹¶ä¸”é…ç½®å¯¹åº”çš„è¿‡æœŸæ—¶é—´ã€‚\n\n\nè¿™ä¸ªæ–¹å¼çœ‹èµ·æ¥æ›´ä¼˜ç¾ï¼Œå…¶å®åœ¨ä¸€äº›åº”ç”¨åœºæ™¯ä¸­å¹¶ä¸æ˜¯é‚£ä¹ˆåˆé€‚ï¼Œå› ä¸ºåœ¨clientç«¯è¿™ä¸€ä¾§çš„æ”¹é€ ï¼Œä¼šç»™è¿è¡Œçš„è¿›ç¨‹å¸¦æ¥æ›´å¤§çš„å†…å­˜å¼€é”€ï¼Œæ›´ç›´æ¥çš„æ¥è¯´ï¼Œå¯¹äºJavaå’ŒgoLangè¿™ç§è‡ªåŠ¨å†…å­˜ç®¡ç†çš„è¯­è¨€ï¼Œä¼šæ›´åŠ é¢‘ç¹çš„åˆ›å»ºå¯¹è±¡ï¼Œä»è€Œè§¦å‘gcå¯¼è‡´æ¥å£å“åº”è€—æ—¶å¢åŠ çš„é—®é¢˜ï¼Œè¿™ä¸ªåè€Œæ˜¯ä¸å¤ªå®¹æ˜“é¢„æ–™åˆ°çš„äº‹æƒ…ã€‚\n\n\næœ€ç»ˆå¯ä»¥é€šè¿‡å„ä¸ªå…¬å¸çš„åŸºå»ºï¼Œåšå‡ºå¯¹åº”çš„é€‰æ‹©ã€‚\n\n\n## 2.çƒ­keyè§£å†³\n\n\né€šè¿‡ä¸Šè¿°å‡ ç§æ–¹å¼æˆ‘ä»¬æ¢æµ‹åˆ°äº†å¯¹åº”çƒ­keyæˆ–è€…çƒ­slotï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦è§£å†³å¯¹åº”çš„çƒ­keyé—®é¢˜ã€‚è§£å†³çƒ­keyä¹Ÿæœ‰å¥½å‡ ç§æ€è·¯å¯ä»¥å‚è€ƒï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ‹ä¸€ä¸‹ã€‚\n\n\n### 2.1 å¯¹ç‰¹å®škeyæˆ–slotåšé™æµ\n\n\nä¸€ç§æœ€ç®€å•ç²—æš´çš„æ–¹å¼ï¼Œå¯¹äºç‰¹å®šçš„slotæˆ–è€…çƒ­keyåšé™æµï¼Œè¿™ä¸ªæ–¹æ¡ˆæ˜æ˜¾å¯¹äºä¸šåŠ¡æ¥è¯´æ˜¯æœ‰æŸçš„ï¼Œæ‰€ä»¥å»ºè®®åªç”¨åœ¨å‡ºç°çº¿ä¸Šé—®é¢˜ï¼Œéœ€è¦æ­¢æŸçš„æ—¶å€™è¿›è¡Œç‰¹å®šçš„é™æµã€‚\n\n\n### 2.2 ä½¿ç”¨äºŒçº§ï¼ˆæœ¬åœ°ï¼‰ç¼“å­˜\n\n\næœ¬åœ°ç¼“å­˜ä¹Ÿæ˜¯ä¸€ä¸ªæœ€å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢ç„¶æˆ‘ä»¬çš„ä¸€çº§ç¼“å­˜æ‰›ä¸ä½è¿™ä¹ˆå¤§çš„å‹åŠ›ï¼Œå°±å†åŠ ä¸€ä¸ªäºŒçº§ç¼“å­˜å§ã€‚ç”±äºæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç”±serviceå‘å‡ºçš„ï¼Œè¿™ä¸ªäºŒçº§ç¼“å­˜åŠ åœ¨serviceç«¯æ˜¯å†åˆé€‚ä¸è¿‡äº†ï¼Œå› æ­¤å¯ä»¥åœ¨æœåŠ¡ç«¯æ¯æ¬¡è·å–åˆ°å¯¹åº”çƒ­keyæ—¶ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜å­˜å‚¨ä¸€ä»½ï¼Œç­‰æœ¬åœ°ç¼“å­˜è¿‡æœŸåå†é‡æ–°è¯·æ±‚ï¼Œé™ä½redisé›†ç¾¤å‹åŠ›ã€‚ä»¥javaä¸ºä¾‹ï¼ŒguavaCacheå°±æ˜¯ç°æˆçš„å·¥å…·ã€‚ä»¥ä¸‹ç¤ºä¾‹ï¼š\n\n\n```java\n//æœ¬åœ°ç¼“å­˜åˆå§‹åŒ–ä»¥åŠæ„é€ \n\nprivateÂ staticÂ LoadingCache<String,Â List>Â configCache\nÂ Â Â Â Â Â Â Â =Â CacheBuilder.newBuilder()\nÂ Â Â Â Â Â Â Â .concurrencyLevel(8)Â Â //å¹¶å‘è¯»å†™çš„çº§åˆ«ï¼Œå»ºè®®è®¾ç½®cpuæ ¸æ•°\nÂ Â Â Â Â Â Â Â .expireAfterWrite(10,Â TimeUnit.SECONDS)Â Â //å†™å…¥æ•°æ®åå¤šä¹…è¿‡æœŸ\nÂ Â Â Â Â Â Â Â .initialCapacity(10)Â //åˆå§‹åŒ–cacheçš„å®¹å™¨å¤§å°\nÂ Â Â Â Â Â Â Â .maximumSize(10)//cacheçš„å®¹å™¨æœ€å¤§\nÂ Â Â Â Â Â Â Â .recordStats()\nÂ Â Â Â Â Â Â Â //Â buildæ–¹æ³•ä¸­å¯ä»¥æŒ‡å®šCacheLoaderï¼Œåœ¨ç¼“å­˜ä¸å­˜åœ¨æ—¶é€šè¿‡CacheLoaderçš„å®ç°è‡ªåŠ¨åŠ è½½ç¼“å­˜\nÂ Â Â Â Â Â Â Â .build(newÂ CacheLoader<String,Â List>()Â {\nÂ Â Â Â Â Â Â Â Â Â Â Â @Override\nÂ Â Â Â Â Â Â Â Â Â Â Â publicÂ ListÂ load(StringÂ hotKey)Â throwsÂ ExceptionÂ {\n\n}\n\n});\n\n//æœ¬åœ°ç¼“å­˜è·å–\n\nObjectÂ resultÂ =Â configCache.get(key);\n```\n\n\næœ¬åœ°ç¼“å­˜å¯¹äºæˆ‘ä»¬çš„æœ€å¤§çš„å½±å“å°±æ˜¯æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæˆ‘ä»¬è®¾ç½®å¤šé•¿çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå°±ä¼šå¯¼è‡´æœ€é•¿æœ‰å¤šä¹…çš„çº¿ä¸Šæ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œè¿™ä¸ªç¼“å­˜æ—¶é—´éœ€è¦è¡¡é‡è‡ªèº«çš„é›†ç¾¤å‹åŠ›ä»¥åŠä¸šåŠ¡æ¥å—çš„æœ€å¤§ä¸ä¸€è‡´æ—¶é—´ã€‚\n\n\n### 2.3 æ‹†key\n\n\nå¦‚ä½•æ—¢èƒ½ä¿è¯ä¸å‡ºç°çƒ­keyé—®é¢˜ï¼Œåˆèƒ½å°½é‡çš„ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿæ‹†keyä¹Ÿæ˜¯ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆã€‚\n\n\næˆ‘ä»¬åœ¨æ”¾å…¥ç¼“å­˜æ—¶å°±å°†å¯¹åº”ä¸šåŠ¡çš„ç¼“å­˜keyæ‹†åˆ†æˆå¤šä¸ªä¸åŒçš„keyã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨æ›´æ–°ç¼“å­˜çš„ä¸€ä¾§ï¼Œå°†keyæ‹†æˆNä»½ï¼Œæ¯”å¦‚ä¸€ä¸ªkeyåå­—å«åšâ€œgood_100â€ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒæ‹†æˆå››ä»½ï¼Œâ€œ`good_100_copy1`â€ã€â€œ`good_100_copy2`â€ã€â€œ`good_100_copy3`â€ã€â€œ`good_100_copy4`â€ï¼Œæ¯æ¬¡æ›´æ–°å’Œæ–°å¢æ—¶éƒ½éœ€è¦å»æ”¹åŠ¨è¿™Nä¸ªkeyï¼Œè¿™ä¸€æ­¥å°±æ˜¯æ‹†keyã€‚\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309121606262.png)\n\n\nå¯¹äºserviceç«¯æ¥è®²ï¼Œæˆ‘ä»¬å°±éœ€è¦æƒ³åŠæ³•å°½é‡å°†è‡ªå·±è®¿é—®çš„æµé‡è¶³å¤Ÿçš„å‡åŒ€ï¼Œå¦‚ä½•ç»™è‡ªå·±å³å°†è®¿é—®çš„çƒ­keyä¸ŠåŠ å…¥åç¼€ã€‚å‡ ç§åŠæ³•ï¼Œæ ¹æ®æœ¬æœºçš„ipæˆ–macåœ°å€åšhashï¼Œä¹‹åçš„å€¼ä¸æ‹†keyçš„æ•°é‡åšå–ä½™ï¼Œæœ€ç»ˆå†³å®šæ‹¼æ¥æˆä»€ä¹ˆæ ·çš„keyåç¼€ï¼Œä»è€Œæ‰“åˆ°å“ªå°æœºå™¨ä¸Šï¼›æœåŠ¡å¯åŠ¨æ—¶çš„ä¸€ä¸ªéšæœºæ•°å¯¹æ‹†keyçš„æ•°é‡åšå–ä½™ã€‚\n\n\n### 2.4 æœ¬åœ°ç¼“å­˜çš„å¦å¤–ä¸€ç§æ€è·¯ é…ç½®ä¸­å¿ƒ\n\n\nå¯¹äºç†Ÿæ‚‰å¾®æœåŠ¡é…ç½®ä¸­å¿ƒçš„ä¼™ä¼´æ¥è®²ï¼Œæˆ‘ä»¬çš„æ€è·¯å¯ä»¥å‘é…ç½®ä¸­å¿ƒçš„ä¸€è‡´æ€§è½¬å˜ä¸€ä¸‹ã€‚æ‹¿nacosæ¥ä¸¾ä¾‹ï¼Œå®ƒæ˜¯å¦‚ä½•åšåˆ°åˆ†å¸ƒå¼çš„é…ç½®ä¸€è‡´æ€§çš„ï¼Œå¹¶ä¸”ç›¸åº”é€Ÿåº¦å¾ˆå¿«ï¼Ÿé‚£æˆ‘ä»¬å¯ä»¥å°†ç¼“å­˜ç±»æ¯”é…ç½®ï¼Œè¿™æ ·å»åšã€‚\n\n\né•¿è½®è¯¢+æœ¬åœ°åŒ–çš„é…ç½®ã€‚é¦–å…ˆæœåŠ¡å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å…¨éƒ¨çš„é…ç½®ï¼Œç„¶åå®šæ—¶å¯åŠ¨é•¿è½®è¯¢å»æŸ¥è¯¢å½“å‰æœåŠ¡ç›‘å¬çš„é…ç½®æœ‰æ²¡æœ‰å˜æ›´ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œé•¿è½®è¯¢çš„è¯·æ±‚ä¾¿ä¼šç«‹åˆ»è¿”å›ï¼Œæ›´æ–°æœ¬åœ°é…ç½®ï¼›å¦‚æœæ²¡æœ‰å˜æ›´ï¼Œå¯¹äºæ‰€æœ‰çš„ä¸šåŠ¡ä»£ç éƒ½æ˜¯ä½¿ç”¨æœ¬åœ°çš„å†…å­˜ç¼“å­˜é…ç½®ã€‚è¿™æ ·å°±èƒ½ä¿è¯åˆ†å¸ƒå¼çš„ç¼“å­˜é…ç½®æ—¶æ•ˆæ€§ä¸ä¸€è‡´æ€§ã€‚\n\n\n### 2.5 å…¶ä»–å¯ä»¥æå‰åšçš„é¢„æ¡ˆ\n\n\nä¸Šé¢çš„æ¯ä¸€ä¸ªæ–¹æ¡ˆéƒ½ç›¸å¯¹ç‹¬ç«‹çš„å»è§£å†³çƒ­keyé—®é¢˜ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬çœŸçš„åœ¨é¢ä¸´ä¸šåŠ¡è¯‰æ±‚æ—¶ï¼Œå…¶å®ä¼šæœ‰å¾ˆé•¿çš„æ—¶é—´æ¥è€ƒè™‘æ•´ä½“çš„æ–¹æ¡ˆè®¾è®¡ã€‚ä¸€äº›æç«¯çš„ç§’æ€åœºæ™¯å¸¦æ¥çš„çƒ­keyé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬é¢„ç®—å……è¶³ï¼Œå¯ä»¥ç›´æ¥åšæœåŠ¡çš„ä¸šåŠ¡éš”ç¦»ã€redisç¼“å­˜é›†ç¾¤çš„éš”ç¦»ï¼Œé¿å…å½±å“åˆ°æ­£å¸¸ä¸šåŠ¡çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¯ä»¥ä¸´æ—¶é‡‡å–æ›´å¥½çš„å®¹ç¾ã€é™æµæªæ–½ã€‚\n\n\n## ä¸€äº›æ•´åˆçš„æ–¹æ¡ˆ\n\n\nç›®å‰å¸‚é¢ä¸Šå·²ç»æœ‰äº†ä¸å°‘å…³äºhotKeyç›¸å¯¹å®Œæ•´çš„åº”ç”¨çº§è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­äº¬ä¸œåœ¨è¿™æ–¹é¢æœ‰å¼€æºçš„hotkeyå·¥å…·ï¼ŒåŸç†å°±æ˜¯åœ¨clientç«¯åšæ´å¯Ÿï¼Œç„¶åä¸ŠæŠ¥å¯¹åº”hotkeyï¼Œserverç«¯æ£€æµ‹åˆ°åï¼Œå°†å¯¹åº”hotkeyä¸‹å‘åˆ°å¯¹åº”æœåŠ¡ç«¯åšæœ¬åœ°ç¼“å­˜ï¼Œå¹¶ä¸”è¿™ä¸ªæœ¬åœ°ç¼“å­˜åœ¨è¿œç¨‹å¯¹åº”çš„keyæ›´æ–°åï¼Œä¼šåŒæ­¥æ›´æ–°ï¼Œå·²ç»æ˜¯ç›®å‰è¾ƒä¸ºæˆç†Ÿçš„è‡ªåŠ¨æ¢æµ‹çƒ­keyã€åˆ†å¸ƒå¼ä¸€è‡´æ€§ç¼“å­˜è§£å†³æ–¹æ¡ˆ\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309121607163.png)\n\n\n## æ€»ç»“\n\n\nä»¥ä¸Šå°±æ˜¯ç¬”è€…å¤§æ¦‚äº†è§£æˆ–å®è·µè¿‡çš„çš„å¦‚ä½•åº”å¯¹çƒ­keyçš„ä¸€äº›æ–¹æ¡ˆï¼Œä»å‘ç°çƒ­keyåˆ°è§£å†³çƒ­keyçš„ä¸¤ä¸ªå…³é”®é—®é¢˜çš„åº”å¯¹ã€‚æ¯ä¸€ä¸ªæ–¹æ¡ˆéƒ½æœ‰ä¼˜ç¼ºç‚¹ï¼Œæ¯”å¦‚ä¼šå¸¦æ¥ä¸šåŠ¡çš„ä¸ä¸€è‡´æ€§ï¼Œå®æ–½èµ·æ¥è¾ƒä¸ºå›°éš¾ç­‰ç­‰ï¼Œå¯ä»¥æ ¹æ®ç›®å‰è‡ªèº«ä¸šåŠ¡çš„ç‰¹ç‚¹ã€ä»¥åŠç›®å‰å…¬å¸çš„åŸºå»ºå»åšå¯¹åº”çš„è°ƒæ•´å’Œæ”¹å˜ã€‚\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-09-12",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "redis-key-202309",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Redis"
        ],
        "summary": "åšä¸€äº›Cç«¯ä¸šåŠ¡ï¼Œä¸å¯é¿å…çš„è¦å¼•å…¥ä¸€çº§ç¼“å­˜æ¥ä»£æ›¿æ•°æ®åº“çš„å‹åŠ›å¹¶ä¸”å‡å°‘ä¸šåŠ¡å“åº”æ—¶é—´ï¼Œå…¶å®æ¯æ¬¡å¼•å…¥ä¸€ä¸ªä¸­é—´ä»¶æ¥è§£å†³é—®é¢˜çš„åŒæ—¶ï¼Œå¿…ç„¶ä¼šå¸¦æ¥å¾ˆå¤šæ–°çš„é—®é¢˜éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚\né‚£ä¹ˆå…¶å®è¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–é—®é¢˜æ¯”å¦‚ä½¿ç”¨Redisä½œä¸ºä¸€çº§ç¼“å­˜æ—¶å¯èƒ½å¸¦æ¥çš„çƒ­keyã€å¤§keyç­‰é—®é¢˜ï¼Œæœ¬æ–‡æˆ‘ä»¬å°±çƒ­keyï¼ˆhot keyï¼‰é—®é¢˜æ¥è®¨è®ºï¼Œå¦‚ä½•åˆç†çš„è§£å†³çƒ­keyé—®é¢˜ã€‚",
        "sort": "",
        "title": "Redis çƒ­keyæ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•å¯¼è‡´çš„ï¼Ÿæœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Ÿ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "28f5e6a0-2d06-439d-b947-b7121480c146"
        }
      ],
      "body": "",
      "realName": "Redis çƒ­keyæ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•å¯¼è‡´çš„ï¼Ÿæœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Ÿ",
      "relativePath": "/archives/Redis çƒ­keyæ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•å¯¼è‡´çš„ï¼Ÿæœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Ÿ.md"
    },
    {
      "id": "613b560e-75d7-4f45-88e9-b487310cfe82",
      "doc_id": "613b560e-75d7-4f45-88e9-b487310cfe82",
      "title": "613b560e-75d7-4f45-88e9-b487310cfe82",
      "updated": 1696747320000,
      "body_original": "\n> é¦–å…ˆå£°æ˜ï¼šæœ¬äººæ²¡æœ‰æ¶æ„åˆ©ç”¨è¿™ä¸ªæ¼æ´å»è°‹åˆ©ï¼Œåªæ˜¯æµ‹è¯•ç”¨äº†é‚£ä¹ˆä¸€æ¬¡ã€‚ä¸æå€¡å¤§å®¶å»åšè¿™ç§è¿æ³•è¡Œä¸ºï¼Œæœ¬æ–‡ä»…ä¾›å­¦ä¹ \n\n\n> ğŸ’¡ æœ€è¿‘ç‘å¹¸åœ¨ææ´»åŠ¨ï¼Œæ¯å¤©å…è´¹é€10000ä»½å’–å•¡ï¼Œæˆ‘æ˜¯ä¸ªç‹‚çƒ­å–å’–å•¡çš„äººå„¿ï¼Œä»Šå¤©æœ€åä¸€å¤©æ¥æ•´ä¸ªæ´»å„¿ï¼Œç‚¹å¼€ç‘å¹¸å’–å•¡å°ç¨‹åºä¸»é¡µï¼Œbanner æ è½®æ’­å›¾ä¸­æœ‰ä¸€å¼ æµ·æŠ¥å…¥å£ï¼Œæ“ä½œä¸€é€šä¸‹æ¥ï¼Œæœç„¶ï¼Œæ²¡æŠ¢åˆ°ã€‚  \n> æ‰‹é€Ÿä¸å¤Ÿå¿«ä¸æ˜¯ä¸»è¦åŸå› ï¼Œæ‰‹æŒ‡æ“ä½œå»¶è¿Ÿ + ç³»ç»Ÿé¡µé¢è·³è½¬è€—æ—¶åŠ èµ·æ¥åˆ° http å‘å‡ºå°±å·²ç»è€½è¯¯äº†1 -2 ç§’é’Ÿäº†ï¼Œè¿™ä¸ªæ—¶é—´æ‰æ˜¯å…³é”®ï¼Œæœ¬æ–‡ä»æŠ€æœ¯è§’åº¦æ¢è®¨ä¸‹æ€ä¹ˆåœ¨æœ€å°æˆæœ¬æ¯”å¦‚å‡ åˆ†é’Ÿå†…ï¼Œå®ç°ä¸€ä¸ªå°å·¥å…·ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202306021513432.png)\n\n\né¦–å…ˆéœ€è¦ä¸€ä¸ªæŠ“åŒ…å·¥å…·ï¼Œiphone æ‰‹æœºå¯ä»¥ç”¨ stream, æœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼š\n\n\n1ã€é»˜è®¤å®‰è£…åæ˜¯æ— æ³•æŠ“å– https ç±»å‹çš„ï¼Œéœ€è¦åœ¨è®¾ç½®é‡Œè¿›è¡Œç›¸å…³é…ç½®ï¼š\n\n\n> å¦‚æœæ‚¨è¦æŠ“å– HTTPS çš„è¯·æ±‚ï¼Œéœ€è¦å…ˆå¯åŠ¨æŠ“åŒ…ï¼Œç„¶åå®‰è£… CA è¯ä¹¦åï¼Œå»è®¾ç½®-é€šç”¨-å…³äº-è¯ä¹¦ä¿¡ä»»è®¾ç½® é‡Œä¿¡ä»» CAï¼Œæ‰å¯ä»¥æŸ¥çœ‹è¯·æ±‚çš„å†…å®¹ã€‚\n\n\n![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/923893c1d0a9421b9f0a1bc63cf321a7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)\n\n\n2ã€æ³¨æ„å°ç¨‹åºé‡Œé¢å“¦ï¼ˆåŸç”Ÿçš„å¯èƒ½æŠ“ä¸åˆ°ï¼‰ï¼Œæ‹¿åˆ°çš„æ¥å£åå¦‚ä¸‹ï¼š\n\n\n`https://mkt.lkcoffee.com/ladder/capi/resource/m/promo/activity/send`\n\n\nstream æä¾›äº† curl çš„æ‹·è´ï¼Œå°†å…¶å¤åˆ¶å¹¶å¯¼å…¥åˆ° postman ä¸­ã€‚\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202306021523307.png)\n\n\n## postman å¯¼å…¥&å¤ç°\n\n\nç‚¹å‡» `import` æŒ‰é’®ï¼Œåœ¨å¼¹çª—ä¸­é€‰æ‹© `raw text` å°†å¤åˆ¶çš„ curl å­—ç¬¦ä¸²ç²˜è´´è¿›å»ï¼Œç‚¹å‡»ç¡®è®¤ï¼Œå°±æˆåŠŸçš„å°† è¿™ä¸ª http æ¥å£å¯¼å…¥åˆ°äº† postman ä¸­ï¼Œå°è¯•ç‚¹å‡» send æŒ‰é’®ï¼Œå‘ç°æ‹¿åˆ°äº†æ­£ç¡®çš„å“åº”ï¼ŒéªŒè¯äº†è¯¥æ¥å£å·²ç»å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202306021522744.png)\n\n\n![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f96e756ed7ad4a6f83baac571d9e00e7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)\n\n\n## è‡ªåŠ¨åŒ–è„šæœ¬ï¼Ÿ\n\n\nå…¶å®åˆ°è¿™ä¸€æ­¥ï¼Œå·²ç»å®ç°äº†ç›®æ ‡ï¼Œç‚¹å‡» `send` ç›´æ¥å‘é€è¯·æ±‚ï¼Œå¤§å¤§æå‡äº†æŠ¢åˆ°çš„æ¦‚ç‡ï¼Œå¦‚æœä½ è¿˜æƒ³æ›´è¿›ä¸€æ­¥ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•å°†å…¶å°è£…æˆ è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæ¥å®ç°å®šæ—¶ã€è‡ªåŠ¨ã€é‡å¤å‘é€ï¼›\n\n\nç‚¹å¼€å³ä¾§ä»£ç å—ï¼Œé€‰æ‹©è¯­è¨€ï¼Œå‡è®¾é€‰æ‹© `python`ï¼ˆä¹Ÿå¯ä»¥ä»»æ„é€‰æ‹©ä½ æ“…é•¿çš„è¯­è¨€ï¼‰ï¼Œç„¶åå°±è‡ªåŠ¨ç”Ÿæˆ python ç‰ˆæœ¬çš„å¯æ‰§è¡Œä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬å°±åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ‹“å±•åŠŸèƒ½ï¼›\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202306021521797.png)\n\n\nç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n\n```python\n\nimport requests\nimport time\n\nurl = \"http://example.com\"  # å°†æ­¤å¤„çš„ URL æ›¿æ¢ä¸ºä½ è¦è¯·æ±‚çš„åœ°å€payload = {}\nheaders = {\n\t#å°† postman ä¸­çš„headers å¤åˆ¶è¿‡æ¥}\n\nstart_time = \"09:59:55\"  # è®¾ç½®å¼€å§‹è¯·æ±‚çš„æ—¶é—´end_time = \"10:00:30\"  # è®¾ç½®ç»“æŸè¯·æ±‚çš„æ—¶é—´def make_request():\n    response = requests.get(url, headers=headers, data=payload)\n    if \"æˆåŠŸ\" in response.text:\n        print(\"å“åº”å†…å®¹:\", response.text)\n        raise SystemExit  # ä¸­æ–­ç¨‹åºwhile True:\n    current_time = time.strftime(\"%H:%M:%S\", time.localtime())\n    if current_time >= start_time and current_time <= end_time:\n        make_request()\n    time.sleep(1)  # æ¯ç§’æ£€æŸ¥ä¸€æ¬¡å½“å‰æ—¶é—´\n```\n\n\nå°†å…¶ä¿å­˜åˆ°æœ¬åœ°å¹¶é€šè¿‡ python æŒ‡ä»¤æ¥æ‰§è¡Œï¼Œå°±å¯ä»¥è¿è¡Œäº†ã€‚\n\n\n## æ€»ç»“\n\n\nç”¨ä»Šå¤©çš„åˆç¡æ—¶é—´ï¼Œå†™äº†è¿™ç¯‡æ–‡ï¼Œä»¥ç‘å¹¸çš„è¥é”€æ´»åŠ¨ä¸ºä¾‹å­ï¼Œå¸¦ä½ æ„Ÿå—äº†ä¸‹æŠ€æœ¯çš„é­…åŠ›ï¼Œå…¶ä¸­æ¶‰åŠåˆ°äº†æŠ“åŒ…ã€è‡ªåŠ¨åŒ–è„šæœ¬ã€å®šæ—¶ä»»åŠ¡ã€è¯·æ±‚ç­–ç•¥ã€stream å’Œ postman ç­‰çŸ¥è¯†ï¼›\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-06-02",
        "type": "Post",
        "category": "ç¢ç‰‡æ‚æ–‡",
        "urlname": "lkcoffee-shanghai-coffee-activities-20230602",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å’–å•¡",
          "æ•´æ´»",
          "æŠ€æœ¯æµ"
        ],
        "summary": "æœ€è¿‘ç‘å¹¸åœ¨ææ´»åŠ¨ï¼Œæ¯å¤©å…è´¹é€10000ä»½å’–å•¡ï¼Œæˆ‘æ˜¯ä¸ªç‹‚çƒ­å–å’–å•¡çš„äººå„¿ï¼Œä»Šå¤©æœ€åä¸€å¤©æ¥æ•´ä¸ªæ´»å„¿ï¼Œç‚¹å¼€ç‘å¹¸å’–å•¡å°ç¨‹åºä¸»é¡µï¼Œbanner æ è½®æ’­å›¾ä¸­æœ‰ä¸€å¼ æµ·æŠ¥å…¥å£ï¼Œæ“ä½œä¸€é€šä¸‹æ¥ï¼Œæœç„¶ï¼Œæ²¡æŠ¢åˆ°ã€‚\næ‰‹é€Ÿä¸å¤Ÿå¿«ä¸æ˜¯ä¸»è¦åŸå› ï¼Œæ‰‹æŒ‡æ“ä½œå»¶è¿Ÿ + ç³»ç»Ÿé¡µé¢è·³è½¬è€—æ—¶åŠ èµ·æ¥åˆ° http å‘å‡ºå°±å·²ç»è€½è¯¯äº†1 -2 ç§’é’Ÿäº†ï¼Œè¿™ä¸ªæ—¶é—´æ‰æ˜¯å…³é”®ï¼Œæœ¬æ–‡ä»æŠ€æœ¯è§’åº¦æ¢è®¨ä¸‹æ€ä¹ˆåœ¨æœ€å°æˆæœ¬æ¯”å¦‚å‡ åˆ†é’Ÿå†…ï¼Œå®ç°ä¸€ä¸ªå°å·¥å…·ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚",
        "sort": "",
        "title": "ä¸Šæµ·å’–å•¡æ–‡åŒ–å‘¨ä¹‹è–…ç‘å¹¸ç¾Šæ¯›",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "613b560e-75d7-4f45-88e9-b487310cfe82"
        }
      ],
      "body": "",
      "realName": "ä¸Šæµ·å’–å•¡æ–‡åŒ–å‘¨ä¹‹è–…ç‘å¹¸ç¾Šæ¯›",
      "relativePath": "/archives/ä¸Šæµ·å’–å•¡æ–‡åŒ–å‘¨ä¹‹è–…ç‘å¹¸ç¾Šæ¯›.md"
    },
    {
      "id": "121dcfb7-7028-42d1-998e-b81fe6e0d870",
      "doc_id": "121dcfb7-7028-42d1-998e-b81fe6e0d870",
      "title": "121dcfb7-7028-42d1-998e-b81fe6e0d870",
      "updated": 1696747320000,
      "body_original": "\n## ä»‹ç»\n\n\nSpring æ¡†æ¶ä¸€ç›´æä¾›äº†ä¸¤ç§ä¸åŒçš„å®¢æˆ·ç«¯æ¥æ‰§è¡Œ http è¯·æ±‚:\n\n- RestTemplate: å®ƒåœ¨ Spring 3 ä¸­è¢«å¼•å…¥ï¼Œæä¾›åŒæ­¥çš„é˜»å¡å¼é€šä¿¡ã€‚\n- WebClient: å®ƒåœ¨ Spring 5 çš„ Spring WebFlux åº“ä¸­ä½œä¸ºä¸€éƒ¨åˆ†è¢«å‘å¸ƒã€‚å®ƒæä¾›äº†æµå¼ API,éµå¾ªå“åº”å¼æ¨¡å‹ã€‚\n\nRestTemplate çš„æ–¹æ³•æš´éœ²äº†å¤ªå¤šçš„ HTTP ç‰¹æ€§,å¯¼è‡´äº†å¤§é‡é‡è½½çš„æ–¹æ³•ï¼Œä½¿ç”¨æˆæœ¬è¾ƒé«˜ã€‚WebClient æ˜¯ RestTemplate çš„æ›¿ä»£å“,æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨ã€‚å®ƒæ˜¯ Spring Web Reactive é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚\n\n\nç°åœ¨ Spring 6.1 M1 ç‰ˆæœ¬å¼•å…¥äº† RestClientã€‚ä¸€ä¸ªæ–°çš„åŒæ­¥ http å®¢æˆ·ç«¯,å…¶å·¥ä½œæ–¹å¼ä¸ WebClient ç±»ä¼¼,ä½¿ç”¨ä¸ RestTemplate ç›¸åŒçš„åŸºç¡€è®¾æ–½ã€‚\n\n\n## å‡†å¤‡é¡¹ç›®\n\n\n### jar ä¾èµ–\n\n\n```xml\n<dependency>Â Â \n\t<groupId>org.springframework.boot</groupId>\nÂ Â <artifactId>spring-boot-starter-web</artifactId>\n</dependency>\n```\n\n\n![](https://cdn.jsdelivr.net/gh/listener-He/images@default/202309061708385.png)\n\n\n## åˆ›å»ºå…¨å±€ RestClient\n\n\nåˆ›å»º RestClient å®ä¾‹æœ‰å¯ç”¨çš„é™æ€æ–¹æ³•:\n\n- create(): å§”æ‰˜ç»™é»˜è®¤çš„ rest å®¢æˆ·ç«¯ã€‚\n- create(String url): æ¥å—ä¸€ä¸ªé»˜è®¤çš„åŸºç¡€ urlã€‚\n- create(RestTemplate restTemplate): åŸºäºç»™å®š rest æ¨¡æ¿çš„é…ç½®åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ RestClientã€‚\n- builder(): å…è®¸ä½¿ç”¨ headersã€é”™è¯¯å¤„ç†ç¨‹åºã€æ‹¦æˆªå™¨ç­‰é€‰é¡¹è‡ªå®šä¹‰ä¸€ä¸ª RestClientã€‚\n- builder(RestTemplate restTemplate): åŸºäºç»™å®š RestTemplate çš„é…ç½®è·å–ä¸€ä¸ª RestClient builderã€‚\n\nè®©æˆ‘ä»¬ä½¿ç”¨ builder æ–¹æ³•è°ƒç”¨å®¢æˆ· API æ¥ç¼–å†™ä¸€ä¸ª RestClient:\n\n\n```java\nRestClient restClient = RestClient.builder()\n    .baseUrl(properties.getUrl())\n    .defaultHeader(HttpHeaders.AUTHORIZATION, encodeBasic(\"pig\", \"pig\"))\n    .build();\n```\n\n\nå‚æ•°è¯´æ˜:\n\n- baseUrl è®¾ç½®åŸºç¡€ url\n- defaultHeader å…è®¸è®¾ç½®ä¸€ä¸ªé»˜è®¤ http è¯·æ±‚å¤´\n\n## æ¥æ”¶æ•°æ® retrieve\n\n\nä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨å®¢æˆ·ç«¯å‘é€ http è¯·æ±‚å¹¶æ¥æ”¶å“åº”ã€‚RestClient ä¸ºæ¯ç§ HTTP æ–¹æ³•éƒ½æä¾›äº†æ–¹æ³•ã€‚ä¾‹å¦‚,è¦æœç´¢æ‰€æœ‰æ´»åŠ¨å®¢æˆ·,å¿…é¡»æ‰§è¡Œ GET è¯·æ±‚ã€‚retrieve æ–¹æ³•è·å–å“åº”å¹¶å£°æ˜å¦‚ä½•æå–å®ƒã€‚\n\n\nè®©æˆ‘ä»¬ä»ä½¿ç”¨å®Œæ•´æ­£æ–‡ä½œä¸º String çš„ç®€å•æƒ…å†µå¼€å§‹ã€‚\n\n\n```java\nString data = restClient.get()\n    .uri(\"?name={name}&type={type}\", \"lengleng\", \"1\")\n    .accept(MediaType.APPLICATION_JSON)\n    .retrieve()\n    .body(String.class);\n```\n\n\nuri æ–¹æ³•å¯ä»¥è®¾ç½® http å‚æ•°ç¬¬ä¸€ä¸ªå‚æ•°(ä¸€ä¸ªå­—ç¬¦ä¸²æ¨¡æ¿)æ˜¯é™„åŠ åˆ° RestClient ä¸­å®šä¹‰çš„ base url çš„æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¨¡æ¿çš„ uri å˜é‡(varargs)ã€‚\n\n\næˆ‘ä»¬è¿˜æŒ‡å®šåª’ä½“ç±»å‹ä¸º JSONã€‚è¾“å‡ºæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸­:\n\n\n```json\n[\n  {\n    \"id\": 1,\n    \"name\": \"lengleng\",\n    \"type\": \"1\"\n  }\n]\n```\n\n\nå¦‚æœéœ€è¦æ£€æŸ¥å“åº”çŠ¶æ€ç æˆ–å“åº”å¤´æ€ä¹ˆåŠ?åˆ«æ‹…å¿ƒ,toEntity æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª **ResponseEntity**ã€‚\n\n\n```java\nResponseEntity response = restClient\n    .get()\n    .uri(\"?name={name}&type={type}\", \"lengleng\", \"1\")\n    .accept(MediaType.APPLICATION_JSON)\n    .retrieve()\n    .toEntity(String.class);\n\nlogger.info(\"Status \" + response.getStatusCode());\nlogger.info(\"Headers \" + response.getHeaders());\n```\n\n\n## ç»“æœè½¬æ¢ Bean\n\n\nRestClient è¿˜å¯ä»¥å°†å“åº”ä¸»ä½“è½¬æ¢ä¸º JSON æ ¼å¼ã€‚Spring å°†è‡ªåŠ¨é»˜è®¤æ³¨å†Œ MappingJackson2HttpMessageConverter æˆ– MappingJacksonHttpMessageConverter,å¦‚æœåœ¨ç±»è·¯å¾„ä¸­æ£€æµ‹åˆ° Jackson 2 åº“æˆ– Jackson åº“ã€‚ä½†æ˜¯ä½ å¯ä»¥æ³¨å†Œè‡ªå·±çš„æ¶ˆæ¯è½¬æ¢å™¨å¹¶è¦†ç›–é»˜è®¤è®¾ç½®ã€‚\n\n\nåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­,å“åº”å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºè®°å½•ã€‚ä¾‹å¦‚,æ£€ç´¢ç‰¹å®šå®¢æˆ·çš„ API:\n\n\n```java\nReqUserResponse customer = restClient.get()\n    .uri(\"/{name}\", \"lengleng\")\n    .accept(MediaType.APPLICATION_JSON)\n    .retrieve()\n    .body(ReqUserResponse.class);\nlogger.info(\"res name: \" + customer.personInfo().name());\n```\n\n\nè¦æœç´¢å®¢æˆ·,æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ List ç±»,å¦‚ä¸‹æ‰€ç¤º:\n\n\n```java\nList<ReqUserResponse> customers = restClient.get()\n    .uri(\"?type={type}\", \"1\")\n    .accept(MediaType.APPLICATION_JSON)\n    .retrieve()\n    .body(List.class);\n    \nlogger.info(\"res size \" + customers.size());\n```\n\n\n## å‘å¸ƒæ•°æ®\n\n\nè¦å‘é€ post è¯·æ±‚,åªéœ€è°ƒç”¨ post æ–¹æ³•ã€‚ä¸‹ä¸€æ®µä»£ç ç‰‡æ®µåˆ›å»ºä¸€ä¸ªæ–°å®¢æˆ·ã€‚\n\n\n```java\nReqUserResponse customer = new ReqUserResponse(\"lengleng-plus\", \"1\");\nResponseEntity<Void> response = restClient\n    .post()\n    .accept(MediaType.APPLICATION_JSON)\n    .body(customer)\n    .retrieve()\n    .toBodilessEntity();\n\nif (response.getStatusCode().is2xxSuccessful()) {\n    logger.info(\"Created \" + response.getStatusCode());\n    logger.info(\"New URL \" + response.getHeaders().getLocation());\n}\n```\n\n\nå“åº”ä»£ç ç¡®è®¤å®¢æˆ·å·²æˆåŠŸåˆ›å»º:\n\n\n```text\nCreatedÂ 201Â CREATEDNewÂ URLÂ http://localhost:8080/api/v1/customers/11\n```\n\n\nè¦éªŒè¯å®¢æˆ·æ˜¯å¦å·²æ·»åŠ ,å¯ä»¥é€šè¿‡ postman æ£€ç´¢ä»¥ä¸Š URL:\n\n\n```text\n{Â Â \"id\":Â 2,Â Â \"name\":Â \"lengleng-plus\",Â Â \"type\":Â \"1\"}\n```\n\n\nå½“ç„¶,å¯ä»¥ä½¿ç”¨ä¸å‰ä¸€èŠ‚ç±»ä¼¼çš„ä»£ç é€šè¿‡ RestClient è·å–å®ƒã€‚\n\n\n## åˆ é™¤æ•°æ®\n\n\nè°ƒç”¨ delete æ–¹æ³•å‘å‡º HTTP delete è¯·æ±‚å°è¯•åˆ é™¤èµ„æºéå¸¸ç®€å•ã€‚\n\n\n```java\nResponseEntity<Void> response = restClient.delete()\n    .uri(\"/{id}\", 2)\n    .accept(MediaType.APPLICATION_JSON)\n    .retrieve()\n    .toBodilessEntity();\nlogger.info(\"Deleted with status \" + response.getStatusCode());\n```\n\n\nå€¼å¾—ä¸€æçš„æ˜¯,å¦‚æœæ“ä½œæˆåŠŸ,å“åº”ä¸»ä½“å°†ä¸ºç©ºã€‚å¯¹äºè¿™ç§æƒ…å†µ,toBodilessEntity æ–¹æ³•éå¸¸æ–¹ä¾¿ã€‚è¦åˆ é™¤çš„å®¢æˆ· ID ä½œä¸º uri å˜é‡ä¼ é€’ã€‚\n\n\n```text\nDeletedÂ withÂ statusÂ 204Â NO_CONTENT\n```\n\n\n## å¤„ç†é”™è¯¯\n\n\nå¦‚æœæˆ‘ä»¬å°è¯•åˆ é™¤æˆ–æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„å®¢æˆ·ä¼šå‘ç”Ÿä»€ä¹ˆ?å®¢æˆ·ç«¯ç‚¹å°†è¿”å›ä¸€ä¸ª 404 é”™è¯¯ä»£ç ä»¥åŠæ¶ˆæ¯è¯¦ç»†ä¿¡æ¯ã€‚ç„¶è€Œ,æ¯å½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç (400-499)æˆ–æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç (500-599)æ—¶,RestClient å°†æŠ›å‡º RestClientException çš„å­ç±»ã€‚\n\n\nè¦å®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ç¨‹åº,æœ‰ä¸¤ç§é€‰é¡¹é€‚ç”¨äºä¸åŒçš„çº§åˆ«:\n\n- åœ¨ RestClient ä¸­ä½¿ç”¨ defaultStatusHandler æ–¹æ³•(å¯¹å…¶å‘é€çš„æ‰€æœ‰ http è¯·æ±‚)\n\n```java\nRestClient restClient = RestClient.builder()\n    .baseUrl(properties.getUrl())\n    .defaultHeader(HttpHeaders.AUTHORIZATION, encodeBasic(\"pig\", \"pig\"))\n    .defaultStatusHandler(\n        HttpStatusCode::is4xxClientError,\n        (request, response) -> {\n            logger.error(\"Client Error Status \" + response.getStatusCode());\n            logger.error(\"Client Error Body \" + new String(response.getBody().readAllBytes()));\n        }\n    )\n    .build();\n```\n\n\nåœ¨è¿è¡Œåˆ é™¤å‘½ä»¤è¡Œè¿è¡Œç¨‹åºå,æ§åˆ¶å°çš„è¾“å‡ºå¦‚ä¸‹:\n\n\n```text\nClientÂ ErrorÂ StatusÂ 404Â NOT_FOUNDClientÂ ErrorÂ BodyÂ {\"status\":404,\"message\":\"EntityÂ CustomerÂ forÂ idÂ 2Â wasÂ notÂ found.\",\"timestamp\":\"2023-07-23T09:24:55.4088208\"}\n```\n\n- å¦ä¸€ç§é€‰æ‹©æ˜¯ä¸ºåˆ é™¤æ“ä½œå®ç° **onstatus** æ–¹æ³•ã€‚å®ƒä¼˜å…ˆäº RestClient é»˜è®¤å¤„ç†ç¨‹åºè¡Œä¸ºã€‚\n\n```java\nResponseEntity response = restClient.delete()\n    .uri(\"/{id}\", 2)\n    .accept(MediaType.APPLICATION_JSON)\n    .retrieve()\n    .onStatus(HttpStatusCode::is4xxClientError, (req, res) -> logger.error(\"Couldn't delete \" + res.getStatusText()))\n    .toBodilessEntity();\nif (response.getStatusCode().is2xxSuccessful())\n    logger.info(\"Deleted with status \" + response.getStatusCode());\n```\n\n\nç°åœ¨æ§åˆ¶å°ä¸­çš„æ¶ˆæ¯å°†æ˜¯:\n\n\n```text\nCouldn'tÂ deleteÂ NotÂ Found\n```\n\n\n## Exchange æ–¹æ³•\n\n\nå½“å“åº”å¿…é¡»æ ¹æ®å“åº”çŠ¶æ€è¿›è¡Œä¸åŒè§£ç æ—¶,exchange æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚ä½¿ç”¨ exchange æ–¹æ³•æ—¶,çŠ¶æ€å¤„ç†ç¨‹åºå°†è¢«å¿½ç•¥ã€‚\n\n\nåœ¨è¿™ä¸ªè™šæ„çš„ç¤ºä¾‹ä»£ç ä¸­,å“åº”åŸºäºçŠ¶æ€æ˜ å°„åˆ°å®ä½“:\n\n\n```java\nSimpleResponse simpleResponse = restClient.get()\n    .uri(\"/{id}\", 4)\n    .accept(MediaType.APPLICATION_JSON)\n    .exchange((req, res) -> switch (res.getStatusCode().value()) {\n        case 200 -> SimpleResponse.FOUND;\n        case 404 -> SimpleResponse.NOT_FOUND;\n        default -> SimpleResponse.ERROR;\n    });\n```\n\n\n## æ€»ç»“\n\n\nä¸æ—§çš„ RestTemplate ç›¸æ¯”,è¿™ä¸ªæ–° API æ›´æ˜“äºç®¡ç†ï¼Œå®˜æ–¹é‡æ„çš„ç›®çš„ç»éæ˜¯é€ è½®å­ï¼Œè€Œæ˜¯ç›®æ ‡å»å®ç°åŸºäº Loom æ ‡å‡†çš„çš„ Http å®¢æˆ·ç«¯,æ›´å¥½çš„é€‚é… JDK21 çš„è™šæ‹Ÿçº¿ç¨‹ï¼Œæä¾›æ›´é«˜æ€§èƒ½çš„å®¢æˆ·ç«¯å®ç°ã€‚\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-09-06",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "spring-restclient-2023",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "Java"
        ],
        "summary": "Spring æ¡†æ¶ä¸€ç›´æä¾›äº†ä¸¤ç§ä¸åŒçš„å®¢æˆ·ç«¯æ¥æ‰§è¡Œ http è¯·æ±‚:\nâ€¢ RestTemplate: å®ƒåœ¨ Spring 3 ä¸­è¢«å¼•å…¥ï¼Œæä¾›åŒæ­¥çš„é˜»å¡å¼é€šä¿¡ã€‚\nâ€¢ WebClient: å®ƒåœ¨ Spring 5 çš„ Spring WebFlux åº“ä¸­ä½œä¸ºä¸€éƒ¨åˆ†è¢«å‘å¸ƒã€‚å®ƒæä¾›äº†æµå¼ API,éµå¾ªå“åº”å¼æ¨¡å‹ã€‚\nRestTemplate çš„æ–¹æ³•æš´éœ²äº†å¤ªå¤šçš„ HTTP ç‰¹æ€§,å¯¼è‡´äº†å¤§é‡é‡è½½çš„æ–¹æ³•ï¼Œä½¿ç”¨æˆæœ¬è¾ƒé«˜ã€‚WebClient æ˜¯ RestTemplate çš„æ›¿ä»£å“,æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨ã€‚å®ƒæ˜¯ Spring Web Reactive é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚\nç°åœ¨ Spring 6.1 M1 ç‰ˆæœ¬å¼•å…¥äº† RestClientã€‚ä¸€ä¸ªæ–°çš„åŒæ­¥ http å®¢æˆ·ç«¯,å…¶å·¥ä½œæ–¹å¼ä¸ WebClient ç±»ä¼¼,ä½¿ç”¨ä¸ RestTemplate ç›¸åŒçš„åŸºç¡€è®¾æ–½ã€‚",
        "sort": "",
        "title": "HttpClient? RestTemplateï¼ŸWebClient? ä¸~æ˜¯ RestClient",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "121dcfb7-7028-42d1-998e-b81fe6e0d870"
        }
      ],
      "body": "",
      "realName": "HttpClient! RestTemplateï¼ŸWebClient! ä¸~æ˜¯ RestClient",
      "relativePath": "/archives/HttpClient! RestTemplateï¼ŸWebClient! ä¸~æ˜¯ RestClient.md"
    },
    {
      "id": "d8051be9-7bd7-4b59-a482-f05b9fb15699",
      "doc_id": "d8051be9-7bd7-4b59-a482-f05b9fb15699",
      "title": "d8051be9-7bd7-4b59-a482-f05b9fb15699",
      "updated": 1696747320000,
      "body_original": "\n## å‰è¨€\n\n\næœ€è¿‘é¡¹ç›®ä¸Šè¦æ±‚å‡çº§ä¸€ä¸ªå·¥å…·åŒ…`hutool`çš„ç‰ˆæœ¬ï¼Œä»¥è§£å†³å®‰å…¨æ¼æ´é—®é¢˜ï¼Œè¿™ä¸å‡çº§è¿˜å¥½ï¼Œä¸€å‡çº§åè€Œæ…å‡ºäº†æ›´å¤§çš„ç¯“å­ï¼Œç©¶ç«Ÿæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ\n\n\n## äº‹ä»¶å›é¡¾\n\n\næˆ‘ä»¬é¡¹ç›®åŸå…ˆä½¿ç”¨çš„`hutool`ç‰ˆæœ¬æ˜¯5.7.2ï¼Œåœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬çš„æ•°æ®ä¼ è¾“å¯¹è±¡DTOå’Œæ•°æ®å®ä½“å¯¹è±¡ä¸­å¤§é‡ä½¿ç”¨äº†å·¥å…·åŒ…ä¸­çš„`BeanUtil.copyProperties()`, å¤§ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n1. æ•°æ®ä¼ è¾“å¯¹è±¡\n\n```java\n@Data\n@ToString\npublicÂ classÂ DiagramDTOÂ {Â \nÂ Â Â //Â å‰ç«¯ç”Ÿäº§çš„å­—ç¬¦ä¸²idÂ Â \n Â Â privateÂ StringÂ id;Â Â \n Â Â privateÂ StringÂ code;\nÂ Â Â privateÂ StringÂ name;\n}\n```\n\n1. æ•°æ®å®ä½“å¯¹è±¡\n\n```java\n@Data\n@ToString\npublicÂ classÂ DiagramÂ {Â Â \nÂ Â privateÂ IntegerÂ id;Â Â Â \n Â privateÂ StringÂ code;Â \nÂ Â privateÂ StringÂ name;\n}\n```\n\n1. ä¸šåŠ¡é€»è¾‘\n\n```java\npublicÂ classÂ BeanCopyTestÂ {Â Â Â \n\tÂ publicÂ staticÂ voidÂ main(String[]Â args)Â {Â \nÂ Â Â Â Â Â Â //Â å‰ç«¯ä¼ è¾“çš„å¯¹è±¡Â Â Â Â Â Â Â \n\t\t\tÂ DiagramDTOÂ diagramDTOÂ =Â newÂ DiagramDTO();Â Â \nÂ Â Â Â Â Â //Â å¦‚æœå‰ç«¯ä¼ å…¥çš„idäº‹åŒ…å«eçš„ï¼Œå‡çº§åå°±ä¼šæŠ¥é”™Â Â Â Â Â \n\t\tÂ Â Â diagramDTO.setId(\"3em3dgqsgmn0\");Â Â Â Â Â \n\t\tÂ Â Â diagramDTO.setCode(\"d1\");Â Â Â Â Â Â Â \n\t\t\tÂ diagramDTO.setName(\"å›¾è¡¨\");Â Â Â \n\tÂ Â Â Â Â DiagramÂ diagramÂ =Â newÂ Diagram();Â Â \nÂ Â Â Â Â Â //Â å…³é”®ç‚¹ï¼Œæ•°æ®æ‹·è´Â Â Â Â Â Â Â Â \n\t\t\tBeanUtil.copyProperties(diagramDTO,Â diagram);Â Â Â \n Â Â Â Â Â System.out.println(\"æ•°æ®å®ä½“å¯¹è±¡ï¼š\"Â +Â diagram);Â Â Â Â Â \n\tÂ Â Â //è®¾ç½®idä¸ºç©ºï¼Œè‡ªå¢Â Â Â Â Â Â Â Â \n\t\t\tdiagram.setId(null);Â \nÂ Â Â Â Â Â //ä¿å­˜åˆ°æ•°æ®åº“ä¸­Â TODOÂ Â Â Â \n\tÂ Â Â Â //diagramMapper.save(diagram);Â \nÂ Â Â }}\n```\n\n\nå‡çº§å‰ï¼Œ`hutool`æ˜¯5.7.2ç‰ˆæœ¬ä¸‹ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ã€‚\n\n\n![](https://mmbiz.qpic.cn/mmbiz_png/oH5VKTC5sLgticcibSXbXUSYLrUMNovDaTjjibKRMn2hre1iczL2YJiaKBfP6nMRibht3Aj5rABic23bXfGCiaAW0E9slQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\n\n- `BeanUtil.copyProperties`è™½ç„¶å­—æ®µç±»å‹ä¸ä¸€æ ·ï¼Œä½†æ˜¯åšäº†å…¼å®¹å¤„ç†ï¼Œæ‰€ä»¥ä¸šåŠ¡æ²¡æœ‰å½±å“ä¸šåŠ¡é€»è¾‘ã€‚\n\nå‡çº§åï¼Œ`hutool`æ˜¯5.8.8ç‰ˆæœ¬ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![](https://mmbiz.qpic.cn/mmbiz_png/oH5VKTC5sLgticcibSXbXUSYLrUMNovDaTU3PxCE8ZdB1RbGTZeOico3N8u9KV7okT3zWGN5kV5les3lYcX5SAXjg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\n\n- æ‰§è¡ŒæŠ¥é”™ï¼Œå› ä¸ºå‡çº§åçš„ç‰ˆæœ¬ä¿®æ”¹äº†å®ç°ï¼Œå¢åŠ äº†ä¸‹é¢çš„é€»è¾‘ï¼Œå¦‚æœåŒ…å«E, å°±ä¼šæŠ›é”™ï¼Œä»è€Œå½±å“äº†ä¸šåŠ¡é€»è¾‘ï¼ŒåŒæ—¶è¿™ä¸ªidæ˜¯å¦åŒ…å«eåˆæ˜¯éšæœºå› ç´ ï¼Œåˆ°äº†ç”Ÿäº§æ‰å‘ç°ï¼Œå°±æ‚²å‰§äº†ã€‚\n\n![](https://mmbiz.qpic.cn/mmbiz_png/oH5VKTC5sLgticcibSXbXUSYLrUMNovDaTG9TzjlbbByPMyMa7cAztWZJ3hBTRiatE1I4pLotd84fNgwkRIibyKAVw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\n\n\n## åˆ†ææ¢è®¨\n\n\næˆ‘å‘ç°å¤§éƒ¨åˆ†äººå†™ä»£ç éƒ½å–œæ¬¢å·æ‡’ï¼Œåœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œè™½ç„¶`BeanUtil.copyProperties`ç”¨çš„ä¸€æ—¶çˆ½ï¼Œä½†æœ‰æ—¶å€™å¸¦æ¥çš„åæœæ˜¯å¾ˆä¸¥é‡çš„ï¼Œæ‰€ä»¥å¾ˆä¸æ¨èè¿™ç§æ–¹å¼ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ\n\n\næ¯”å¦‚å›¢é˜Ÿä¸­çš„æŸäº›äººå·å·æ”¹äº†æ•°æ®ä¼ è¾“å¯¹è±¡DTOï¼Œæ¯”å¦‚ä¿®æ”¹äº†ç±»å‹ã€åˆ å»äº†æŸä¸ªå­—æ®µã€‚ç”¨`BeanUtil.copyProperties`çš„æ–¹å¼å‹æ ¹æ— æ³•åœ¨ç¼–è¯‘é˜¶æ®µå‘ç°ï¼Œæ›´åˆ«æä¿®æ”¹çš„å½±å“èŒƒå›´äº†ï¼Œè¿™å°±åªèƒ½æŠŠé£é™©æš´éœ²åˆ°ç”Ÿäº§ä¸Šå»äº†ã€‚é‚£æœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹æ³•å‘¢ï¼Ÿ\n\n\n## æ¨èæ–¹æ¡ˆ\n\n1. åŸå§‹çš„`get`ã€`set`æ–¹å¼\n\næˆ‘æ˜¯æ¯”è¾ƒæ¨å´‡è¿™ç§åšæ³•çš„ï¼Œæ¯”å¦‚ç°åœ¨`DiagramDTO`åˆ å»æŸä¸ªå­—æ®µï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼Œå°±ä¼šå¼•èµ·ä½ çš„æ³¨æ„äº†ï¼Œè®©é—®é¢˜æå‰æš´éœ²ï¼Œæ— å¤„éå½¢ã€‚\n\n\n![](https://mmbiz.qpic.cn/mmbiz_png/oH5VKTC5sLgticcibSXbXUSYLrUMNovDaTliaL28982IYstMia7EjVia0KhJvWAwSkD4bjUwWFBnsAXGGvtbQfoOK0Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\n\n\nä½ å¯èƒ½è§‰å¾—ç«™ç€è¯´è¯ä¸è…°ç–¼ï¼Œå­—æ®µå°‘å¥½ï¼Œå¦‚æœå­—æ®µå¾ˆå¤šè¿˜ä¸å¾—å†™æ­»å•Šï¼Œæˆ‘è¿™é‡Œæ¨èä¸€ä¸ªIDEAçš„æ’ä»¶ï¼Œå¯ä»¥å¸®ä½ æ™ºèƒ½ç”Ÿæˆè¿™æ ·çš„ä»£ç ã€‚\n\n\n![](https://mmbiz.qpic.cn/mmbiz_png/oH5VKTC5sLgticcibSXbXUSYLrUMNovDaT3mFLBMO8icetJcjicn4RqCwMuaeqibKoTNxTaJRuZOicXn4OdnYP9TPibsw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\n\n\n![](https://mmbiz.qpic.cn/mmbiz_png/oH5VKTC5sLgticcibSXbXUSYLrUMNovDaTSGKwbEQxgZgfbZQumibSH0yavicrPa9TJB2vxz6UCXN4hHBGv0j5flFA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\n\n\nè¯ä¸å¤šè¯´ï¼Œè‡ªå·±ç©å„¿å»~~\n\n1. ä½¿ç”¨å¼€æºåº“`ModelMapper`\n\n`ModelMapper`æ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿ã€ç®€å•åœ°å°†å¯¹è±¡ä»ä¸€ç§ç±»å‹æ˜ å°„åˆ°å¦ä¸€ç§ç±»å‹ï¼Œåº•å±‚æ˜¯é€šè¿‡åå°„æ¥è‡ªåŠ¨ç¡®å®šå¯¹è±¡ä¹‹é—´çš„æ˜ å°„ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰æ˜ å°„è§„åˆ™ã€‚\n\n\n```java\nÂ privateÂ staticÂ voidÂ testModelMapper()Â {Â Â \nÂ Â Â Â Â Â ModelMapperÂ modelMapperÂ =Â newÂ ModelMapper();Â \nÂ Â Â Â Â Â DiagramDTOÂ diagramDTOÂ =Â newÂ DiagramDTO();Â \nÂ Â Â Â Â Â Â diagramDTO.setId(\"3em3dgqsgmn0\");Â Â Â Â \n\t Â Â Â Â diagramDTO.setCode(\"d1\");Â Â Â Â \n\t Â Â Â Â diagramDTO.setName(\"å›¾è¡¨\");Â Â Â \nÂ Â Â Â Â DiagramÂ diagramÂ =Â modelMapper.map(diagramDTO,Â Diagram.class);Â Â Â \nÂ }\n```\n\n1. ä½¿ç”¨å¼€æºåº“`MapStruct`\n\n`MapStruct`ä¹Ÿæ˜¯Javaä¸­å¦å¤–ä¸€ä¸ªç”¨äºæ˜ å°„å¯¹è±¡å¾ˆæµè¡Œçš„å¼€æºå·¥å…·ã€‚å®ƒæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæˆå¯¹åº”çš„æ˜ å°„ä»£ç ï¼Œç›¸å¯¹äº`ModelMapper`åº•å±‚æ”¾å°„çš„æ–¹æ¡ˆï¼Œæ€§èƒ½æ›´å¥½ã€‚\n\n\n```java\n@MapperpublicÂ \ninterfaceÂ DiagramMapperÂ {Â Â \nÂ Â DiagramMapperÂ INSTANCEÂ =Â Mappers.getMapper(DiagramMapper.class);Â Â Â \nÂ DiagramDTOÂ toDTO(DiagramÂ diagram);Â \nÂ DiagramÂ toEntity(DiagramDTOÂ diagram);\n}\n\nprivateÂ staticÂ voidÂ testMapStruct()Â {Â Â \nÂ Â DiagramDTOÂ diagramDTOÂ =Â newÂ DiagramDTO();\nÂ Â Â Â diagramDTO.setId(\"3em3dgqsgmn0\");Â Â \n Â Â  diagramDTO.setCode(\"d1\");Â Â Â \n   Â diagramDTO.setName(\"å›¾è¡¨\");Â \nÂ Â DiagramÂ diagramÂ =Â DiagramMapper.INSTANCE.toEntity(diagramDTO);\n}\n```\n\n- `DiagramMapper`æ¥å£ä½¿ç”¨äº†`@Mapper`æ³¨è§£ï¼Œç”¨æ¥è¡¨æ˜ä½¿ç”¨`MapStruct`å¤„ç†\n- `MapStruct`ä¸­æ›´å¤šé«˜çº§ç‰¹æ€§å¤§å®¶è‡ªå·±æ¢ç´¢ä¸€ä¸‹ã€‚\n\n## æ€»ç»“\n\n\nå°ç»“ä¸€ä¸‹ï¼Œå¯¹è±¡åœ¨ä¸åŒå±‚ä¹‹é—´è¿›è¡Œè½¬æ¢æ˜ å°„ï¼Œå¾ˆä¸å»ºè®®ä½¿ç”¨`BeanUtil.copyProperties`è¿™ç§æ–¹å¼ï¼Œæ›´åŠ æ¨èä½¿ç”¨åŸç”Ÿçš„`set`, `get`æ–¹å¼ï¼Œä¸å®¹æ˜“å‡ºé”™ã€‚å½“ç„¶è¿™ä¸æ˜¯å°†`BeanUtil.copyProperties`ä¸€æ£’å­æ‰“æ­»ï¼Œæ¯«æ— ç”¨æ­¦ä¹‹åœ°ï¼Œåœ¨ç‰¹å®šåœºæ™¯ï¼Œæ¯”å¦‚æ–¹æ³•å†…éƒ¨å¯¹è±¡çš„è½¬æ¢ç­‰å½±å“å°çš„èŒƒå›´è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚\n\n\nåŸä½œè€…ï¼š [https://blog.csdn.net/weiioy](https://blog.csdn.net/weiioy)\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-05-23",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "hutool-beanutil-error",
        "catalog": [
          "archives"
        ],
        "tags": [
          "BUG",
          "Java",
          "hutool"
        ],
        "summary": "Hutoolæ˜¯ä¸€ä¸ªå°è€Œå…¨çš„Javaå·¥å…·ç±»åº“ï¼Œé€šè¿‡é™æ€æ–¹æ³•å°è£…ï¼Œé™ä½ç›¸å…³APIçš„å­¦ä¹ æˆæœ¬ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œä½¿Javaæ‹¥æœ‰å‡½æ•°å¼è¯­è¨€èˆ¬çš„ä¼˜é›…ï¼Œè®©Javaè¯­è¨€ä¹Ÿå¯ä»¥â€œç”œç”œçš„â€ã€‚ JavaBeanæ˜¯ä¸€ä¸ªæ‹¥æœ‰å¯¹å±æ€§è¿›è¡Œsetå’Œgetæ–¹æ³•çš„ç±»ã€‚å®ƒå¯ä»¥è¢«ç®€å•åœ°å®šä¹‰ä¸ºåŒ…å«setXXXå’ŒgetXXXæ–¹æ³•çš„å¯¹è±¡ã€‚åœ¨Hutoolä¸­ï¼Œåˆ¤å®šBeançš„æ–¹æ³•ä¸ºï¼šæ˜¯å¦å­˜åœ¨åªæœ‰ä¸€ä¸ªå‚æ•°çš„setXXXæ–¹æ³•ã€‚Beanå·¥å…·ç±»ä¸»è¦æ“ä½œsetXXXå’ŒgetXXXæ–¹æ³•ï¼Œå¦‚å°†Beanå¯¹è±¡è½¬ä¸ºMapç­‰ã€‚",
        "sort": "",
        "title": "Hutool 5.8.8  BeanUtil.copyProperties è‡´å‘½å¼‚å¸¸",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "d8051be9-7bd7-4b59-a482-f05b9fb15699"
        }
      ],
      "body": "",
      "realName": "Hutool 5.8.8  BeanUtil.copyProperties è‡´å‘½å¼‚å¸¸",
      "relativePath": "/archives/Hutool 5.8.8  BeanUtil.copyProperties è‡´å‘½å¼‚å¸¸.md"
    },
    {
      "id": "50c530fc-8d3c-4f6b-9956-3be2602e1be8",
      "doc_id": "50c530fc-8d3c-4f6b-9956-3be2602e1be8",
      "title": "50c530fc-8d3c-4f6b-9956-3be2602e1be8",
      "updated": 1696747320000,
      "body_original": "\nåœ¨ 21 ä¸–çºªçš„ä»Šå¤©ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½è¦é¢ä¸´å¤§é‡çš„çŸ¥è¯†å’Œä¿¡æ¯ã€‚æˆ‘ä»¬æ¯ä¸ªäººéƒ½éœ€è¦ä¸æ–­å­¦ä¹ æ–°çŸ¥è¯†ã€æ–°æ€æƒ³å’Œè¿›è¡Œæ–°çš„å®è·µã€‚\n\n\nè¿™æ„å‘³ç€ï¼Œå­¦ä¹ ä¸å†æ˜¯å­¦ç”Ÿé˜¶æ®µæ‰éœ€è¦åšçš„äº‹æƒ…ï¼Œç»ˆèº«æ•™è‚²åº”è¯¥æˆä¸ºæˆ‘ä»¬å·¥ä½œå’Œç”Ÿæ´»çš„æœ‰æœºç»„æˆéƒ¨åˆ†ã€‚\n\n\nåœ¨è‡ªæˆ‘å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šäººéƒ½ä¼šå°è¯•å¯»æ‰¾é«˜æ•ˆçš„å­¦ä¹ æ–¹æ³•ï¼Œä»¥ä¾¿æå‡è‡ªå·±çš„å­¦ä¹ èƒ½åŠ›å’Œå­¦ä¹ æ•ˆç‡ã€‚\n\n\næ¥ä¸‹æ¥æˆ‘åˆ†äº«çš„å­¦ä¹ æ–¹æ³•ï¼Œä¸ä»…æ˜¯æˆ‘è‡ªå·±åˆ‡èº«å®è·µæœ‰æ•ˆï¼Œä¹Ÿæœ‰ç§‘å­¦ä¾æ®ä½œä¸ºæ”¯æ’‘ã€‚\n\n\n## PQ4R é˜…è¯»æ³•\n\n\nPQ4R æ˜¯è‹±æ–‡é¦–å­—æ¯ç¼©å†™ï¼Œä»£è¡¨äº†é˜…è¯»ç†è§£æµç¨‹ä¸­çš„å…­ä¸ªé˜¶æ®µã€‚\n\n- **é¢„è§ˆ Preview**ï¼šåœ¨å¼€å§‹é˜…è¯»ä¹‹å‰é¢„è§ˆä¿¡æ¯ï¼Œä»¥äº†è§£ä¸»é¢˜æ˜¯ä»€ä¹ˆã€‚ç•¥è¯»ææ–™å¹¶æŸ¥çœ‹æ–‡ç« æ ‡é¢˜ã€å‰¯æ ‡é¢˜å’Œä¸€äº›åŠ ç²—é‡ç‚¹æ–‡æœ¬ã€‚\n- **é—®é¢˜ Question**ï¼šé—®è‡ªå·±ä¸è¯¥ä¸»é¢˜ç›¸å…³çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œæˆ‘å¸Œæœ›å­¦åˆ°ä»€ä¹ˆï¼Ÿå…³äºè¿™ä¸ªä¸»é¢˜ï¼Œæˆ‘å·²ç»çŸ¥é“ä»€ä¹ˆï¼Ÿ\n- **é˜…è¯» Read**ï¼šæ¯æ¬¡é˜…è¯»ä¸€æ¡ä¿¡æ¯ï¼Œå¹¶å°è¯•æ‰¾å‡ºé—®é¢˜çš„ç­”æ¡ˆã€‚\n- **åæ€ Reflect**ï¼šä½ å›ç­”æ‰€æœ‰é—®é¢˜äº†å—ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œè¯·è¿”å›åŸæ–‡æŸ¥çœ‹ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚\n- **èƒŒè¯µ Recite**ï¼šç”¨ä½ è‡ªå·±çš„è¯ï¼Œè¯´å‡ºæˆ–å†™ä¸‹ä½ åˆšåˆšé˜…è¯»å†…å®¹çš„ç®€è¦æ‘˜è¦ã€‚\n- **å¤ä¹  Review**ï¼šå†çœ‹ä¸€éææ–™ï¼Œå›ç­”å“ªäº›å°šæœªå›ç­”çš„é—®é¢˜ã€‚\n\n![](https://static.effie.co/blog/2021/07/20210709020705553.png?x-oss-process=image/auto-orient,1/quality,q_90/format,webp)\n\n\n## é—´éš”ç»ƒä¹  Spaced Practice\n\n\né—´éš”ç»ƒä¹ ï¼Œè‹±æ–‡ä¸º Spaced Practice, ä¹Ÿè¢«ç§°ä¸ºåˆ†æ•£å¼ç»ƒä¹  distributed practice. è¿™æ˜¯ä¸€ç§è¢«ç§‘å­¦è¯æ˜å¯Œæœ‰æ•ˆç‡çš„è®°å¿†æ–¹æ³•ã€‚\n\n\nè¿‘å¹´æ¥ï¼Œéšç€ Anki ç­‰è½¯ä»¶çš„æ™®åŠï¼Œé—´éš”ç»ƒä¹ çš„ç†å¿µä¹Ÿé€æ­¥ä¸ºå­¦ä¹ è€…æ‰€ç†Ÿæ‚‰ã€‚\n\n\né—´éš”ç»ƒä¹ åå¯¹å­¦ä¹ è€…å¯¹äºçŸ¥è¯†è¿›è¡Œçªå‡»å¼çš„æ­»è®°ç¡¬èƒŒï¼Œè€Œæ˜¯é¼“åŠ±å­¦ä¹ è€…åœ¨æ›´é•¿çš„æ—¶é—´æ®µå†…è¿›è¡Œå­¦ä¹ ã€‚å½“æˆ‘ä»¬çš„å¤§è„‘å‡ ä¹å¿˜è®°æŸäº‹æ—¶ï¼Œå¤§è„‘ä¼šæ›´åŠ åŠªåŠ›åœ°å›å¿†èµ·è¿™äº›ä¿¡æ¯ã€‚\n\n\né—´éš”å­¦ä¹ æ ¹æ®è®°å¿†è§„å¾‹ï¼Œå°†å­¦ä¹ æŒ‰ç…§ä¸€å®šçš„æ—¶é—´è¿›è¡Œé—´éš”ï¼Œè¿™æ ·å°†ä¼šä¿ƒä½¿æˆ‘ä»¬çš„å¤§è„‘åœ¨çŸ¥è¯†å’Œæƒ³æ³•ä¹‹é—´å»ºç«‹è”ç³»ï¼Œå¹¶ä¸”è½»æ¾å›å¿†çŸ¥è¯†å†…å®¹ã€‚\n\n\né—´éš”ç»ƒä¹ è¦æ±‚å­¦ä¹ è€…ä»¥ä¸‹åˆ—æ—¶é—´è¡¨çš„é—´éš”æ—¶é—´å›é¡¾æˆ‘ä»¬çš„å­¦ä¹ å†…å®¹ï¼šç¬¬ 1 å¤©ï¼šå­¦ä¹ æ‰€å­¦çŸ¥è¯†ã€‚éšåç¬¬ 2 å¤©ã€ç¬¬ 3 å¤©ã€ä¸€å‘¨åã€ä¸¤å‘¨åå„è¿›è¡Œä¸€æ¬¡å›é¡¾ä¸å¤ä¹ ã€‚\n\n\n![](https://static.effie.co/blog/2021/07/20210709020804102-1024x428.png?x-oss-process=image/auto-orient,1/quality,q_90/format,webp)\n\n\n## ä½¿ç”¨è´¹æ›¼æŠ€å·§\n\n\næœ¯è¯­æˆ–è€…æ¦‚å¿µæ˜¯çŸ¥è¯†çš„åŸºæœ¬å•ä½ï¼Œç›¸å½“äºæ„å»ºæˆçŸ¥è¯†å¤§å¦çš„ç –ç“¦ã€‚å¦‚æœå¯¹äºä¸€ä¸ªæœ¯è¯­æˆ–æ¦‚å¿µä¸€çŸ¥åŠè§£ï¼Œé‚£æœ€åè‚¯å®šä¼šå½±å“æˆ‘ä»¬å¯¹äºçŸ¥è¯†æŒæ¡çš„æ·±åº¦å’Œå¹¿åº¦ã€‚\n\n\nè€Œè´¹æ›¼æŠ€å·§æ˜¯ä¸€ç§å­¦ä¹ å„ç§æœ¯è¯­å’Œæ¦‚å¿µçš„æœ‰æ•ˆæ–¹æ³•ã€‚\n\n\nè´¹æ›¼æŠ€å·§çš„**åŸºæœ¬æ€æƒ³**ï¼šå¦‚æœæˆ‘ä»¬æƒ³å¾ˆå¥½åœ°ç†è§£æŸäº‹ï¼Œé‚£ä¹ˆè¯•ç€ç®€å•åœ°è§£é‡Šå®ƒã€‚è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡è‡ªå·±çš„è¯è§£é‡ŠæŸä¸ªæ¦‚å¿µï¼Œè¿™æ ·æˆ‘ä»¬å¯èƒ½ä¼šæ›´ä¸ºå¿«é€Ÿæ›´åŠ æ·±åˆ»åœ°ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚\n\n\nè´¹æ›¼æŠ€å·§çš„**åŸºæœ¬æµç¨‹**æ˜¯ï¼š\n\n\né¦–å…ˆåœ¨ä¸€å¼ çº¸çš„é¡¶éƒ¨å†™ä¸‹ä½ æ­£åœ¨ç ”ç©¶çš„ä¸»é¢˜/æ¦‚å¿µã€‚\n\n\nç„¶åï¼Œç”¨ä½ è‡ªå·±çš„è¯è§£é‡Šè¿™ä¸ªä¸»é¢˜å’Œæ¦‚å¿µï¼Œå°±åƒä½ åœ¨æ­£åœ¨æ•™åˆ«äººä¸€æ ·ã€‚\n\n\néšåï¼ŒæŸ¥çœ‹ä½ æ‰€å†™çš„å†…å®¹å¹¶æ‰¾å‡ºä»»ä½•é”™è¯¯çš„åœ°æ–¹ï¼Œå¹¶ä¸”å›åˆ°ç¬”è®°æˆ–é˜…è¯»ææ–™ä¸­æ‰¾å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚\n\n\næœ€åï¼Œå¦‚æœä½ åœ¨å†™ä½œä¸­æœ‰ä»»ä½•ä½¿ç”¨ä¸“ä¸šæœ¯è¯­çš„åœ°æ–¹ï¼Œè€Œä½ çš„è¯»è€…ä¸æ˜¯ä¸“ä¸šäººå£«çš„è¯ï¼Œæœ€å¥½ä½¿ç”¨ä¸€äº›æ›´ä¸ºç®€å•çš„æœ¯è¯­é‡æ–°è¡¨è¾¾ä½ çš„å†™ä½œå†…å®¹ã€‚\n\n\n## å–„ç”¨æ€ç»´å¯¼å›¾\n\n\nä½¿ç”¨æ€ç»´å¯¼å›¾è®°å½•å’Œæ•´ç†ç¬”è®°ï¼Œä¸ä»…å¯ä»¥æé«˜æˆ‘ä»¬å¯¹äºæ‰€å­¦ä¹ å†…å®¹çš„ç†è§£èƒ½åŠ›ï¼Œå¹¶ä¸”é€šè¿‡æ€ç»´å¯¼å›¾èƒ½å¤Ÿæœ‰æ•ˆåœ°äº†è§£å„ç§æƒ³æ³•ä¹‹é—´çš„å±‚æ¬¡ç»“æ„å…³ç³»ã€‚\n\n\nå¦‚æœä½ æ˜¯è§†è§‰å‹å­¦ä¹ è€…ï¼Œé‚£å¼ºçƒˆå»ºè®®ä½ ä½¿ç”¨æ€ç»´å¯¼å›¾ã€‚æ‰“å¼€æ€ç»´å¯¼å›¾å·¥å…·ï¼Œæ–°å»ºæ–‡ç¨¿ï¼Œåœ¨ä¸­å¿ƒå†™ä¸‹ä½ çš„å­¦ä¹ ä¸»é¢˜ï¼Œç„¶åå»ºç«‹å­èŠ‚ç‚¹ã€‚ä½¿ç”¨æ€ç»´å¯¼å›¾ï¼Œæœ€å¥½é€‰æ‹©åˆé€‚çš„æ€ç»´å¯¼å›¾å·¥å…·ã€‚\n\n\nåœ¨æˆ‘çœ‹æ¥ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„æ€ç»´å¯¼å›¾å·¥å…·ï¼Œå¾€å¾€è¿˜éœ€è¦å¯¼å‡ºä¸ºå›¾ç‰‡ç­‰æ–‡ä»¶ï¼Œå†æ ¹æ®æ€ç»´å¯¼å›¾çš„å†…å®¹è®°å½•ç¬”è®°æˆ–è€…è¿›è¡Œå†™ä½œã€‚\n\n\nåœ¨è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œæ€ç»´å¯¼å›¾å’Œæ–‡æœ¬ç¼–è¾‘å™¨æ˜¯å‰²è£‚çš„ï¼Œä¸åˆ©äºåœ¨è®°ç¬”è®°æˆ–è€…å†™ä½œæ—¶éšæ—¶æŸ¥çœ‹ã€ç¼–è¾‘æ€ç»´å¯¼å›¾ã€‚\n\n\nå› æ­¤ï¼Œæˆ‘é€‰æ‹©äº†ä¸“ä¸šå†™ä½œå·¥å…·Â [Effie](https://www.effie.co/), å…¶å†…ç½®äº†å¤§çº²ä¸€é”®è½¬åŒ–ä¸ºæ€ç»´å¯¼å›¾çš„åŠŸèƒ½ã€‚å¦‚æ­¤ï¼Œæˆ‘ä¾¿å¯ä»¥åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­éšæ—¶ä½¿ç”¨æ€ç»´å¯¼å›¾äº†ã€‚\n\n\n![](https://static.effie.co/blog/2021/05/20210524053542357-1024x796.png?x-oss-process=image/auto-orient,1/quality,q_90/format,webp)\n\n\n## ç¡çœ ä¸å­¦ä¹ ï¼šä¿éšœç¡çœ ï¼Œç¡å‰å­¦ä¹ \n\n\né«˜æ•ˆçš„å­¦ä¹ æ–¹æ³•ï¼Œä¸æ˜¯æ— é™å»¶é•¿å­¦ä¹ æ—¶é—´ï¼Œè€Œæ˜¯å­¦ä¼šåŠ³é€¸ç»“åˆã€‚å¦‚æœä½ æƒ³æœ€å¤§é™åº¦åœ°åˆ©ç”¨æ—¶é—´ï¼Œé‚£ä¹Ÿè¦ä¿éšœæ¯å¤©ç¡çœ  6-8 å°æ—¶ã€‚è¿™æ˜¯å¤§é‡ç§‘å­¦ç ”ç©¶è¯æ˜çš„ç»“æœã€‚\n\n\nä¸è¦å†å»æ£€ç´¢å¦‚ä½•æ¯å¤©åªç¡ 4 ä¸ªå°æ—¶åˆåŒæ—¶ä¿éšœç²¾åŠ›å……æ²›è¿™æ ·çš„é—®é¢˜äº†ã€‚\n\n\næ¯å¤©åªç¡å¦‚æ­¤å°‘çš„æ—¶é—´ï¼Œä¸é€‚ç”¨äºç»å¤§å¤šæ•°äººã€‚å¹¶ä¸”ï¼Œæ¯å¤©åªç¡çœ  4 ä¸ªå°æ—¶æ˜¯æˆåŠŸäººçš„ç‰¹è´¨ï¼Œè¿™æ ·çš„è¯´æ³•åŸºæœ¬ä¸Šå±äºèº«å±…é«˜ä½è€…å¯¹äºæ‰“å·¥äººçš„å¿ƒçµé¸¡æ±¤ã€‚\n\n\nè¶³å¤Ÿçš„ç¡çœ é™¤äº†å¯¹èº«ä½“å¥åº·æœ‰é‡è¦å½±å“å¤–ï¼Œç¡çœ å¯¹å¤§è„‘åŠŸèƒ½ã€è®°å¿†å½¢æˆå’Œå­¦ä¹ ä¹Ÿè‡³å…³é‡è¦ã€‚ç¡çœ ä¼šä½¿å¾—å¤§è„‘è¿›è¡Œä¸€å®šç¨‹åº¦çš„ä¼‘æ¯ï¼Œå¹¶ä¸”ä¼šä¼˜åŒ–å’Œå®Œå–„åœ¨æ¸…é†’çŠ¶æ€æ—¶æ‰€è·å–çš„çŸ¥è¯†å’Œä¿¡æ¯ã€‚\n\n\næ­¤å¤–ï¼Œç¡å‰å­¦ä¹ æ˜¯ä¸€ç§è‰¯å¥½çš„å­¦ä¹ ä¹ æƒ¯ã€‚æ— è®ºæ˜¯å¤ä¹ ç¬”è®°ï¼Œè¿˜æ˜¯å¤ä¹ æŠ½è®¤å¡ï¼Œè¿™éƒ½æœ‰åŠ©äºæé«˜æˆ‘ä»¬çš„è®°å¿†ã€‚ä¸å…¶ç†¬å¤œï¼Œä¸å¦‚åœ¨ç¡å‰å‡ ä¸ªå°æ—¶å­¦ä¹ ï¼Œç„¶ååœ¨æ—©ä¸ŠæŸ¥çœ‹å›é¡¾çŸ¥è¯†ã€‚\n\n\n## è¿åŠ¨ä¸å­¦ä¹ \n\n\nåœ¨å­¦ä¹ æ–¹æ³•çš„åˆ†äº«ä¸­ï¼Œå¾ˆå°‘æœ‰äººä¼šè®¨è®ºè¿åŠ¨å’Œå­¦ä¹ ä¹‹é—´çš„å…³ç³»ã€‚ç©¶å…¶åŸå› ï¼Œå¯èƒ½å¾ˆå¤šäººæ½œæ„è¯†é‡Œè®¤ä¸ºè¿åŠ¨ä¼šå ç”¨å­¦ä¹ æ—¶é—´ã€‚ç„¶è€Œï¼Œäº‹å®ä¸Šï¼Œè¿åŠ¨ä¸å­¦ä¹ ä¹‹é—´å…³ç³»å¯†åˆ‡ã€‚\n\n\nå¾ˆå¤šäººåœ¨è¿›è¡Œé•¿æ—¶æ®µå­¦ä¹ åï¼Œç»å¸¸ä¼šå‡ºç°ç²¾åŠ›ä¸æµã€å­¦ä¹ æ•ˆç‡ä¸‹é™çš„ç°è±¡ã€‚\n\n\nå¦‚æœæ¯å¤©ä¿æŒé€‚å½“çš„é”»ç‚¼ï¼Œä¸ä»…å¯ä»¥å¯¹æŠ—ç–²åŠ³ï¼Œæå‡æˆ‘ä»¬çš„è®°å¿†åŠ›å’Œè®¤çŸ¥èƒ½åŠ›ï¼Œè€Œä¸”ä¼šä¿ƒä½¿å¤§è„‘é‡Šæ”¾è„‘å†…å•¡ç­‰åŒ–åˆç‰©ï¼Œæ”¹å–„æˆ‘ä»¬çš„æƒ…ç»ªå¹¶ä¸”é™ä½æˆ‘ä»¬çš„ç²¾ç¥å‹åŠ›æ°´å¹³ã€‚\n\n\n## æ³¨é‡Š\n\n- æ–‡ç« **è½¬è½½è‡ª Effie Blog**, å·²ç»è·å¾—æˆæƒã€‚\n- **Effie å®˜æ–¹ä»‹ç»**ï¼šæ— è®ºæ˜¯**ä¸¥è‚ƒå†™ä½œ**ï¼Œ**éšæ‰‹è®°å½•**ï¼Œäº¦æˆ–æ˜¯æŠŠé€»è¾‘å®Œå–„æˆæ€ç»´å¯¼å›¾ï¼ŒEffie éƒ½æ˜¯æ‚¨æ˜æ™ºçš„é€‰æ‹©ã€‚\n- **Effie ç®€è¦ä»‹ç»**ï¼šä¸€æ¬¾**æ€å†™åˆä¸€**çš„**ä¸“ä¸šå†™ä½œè½¯ä»¶**ï¼Œæ‹¥æœ‰ Markdown è¯­æ³•æ”¯æŒã€å…¨å¹³å°ã€æç®€æ²‰æµ¸è®¾è®¡ç­‰åŸºæœ¬è¦æ±‚ï¼ŒåŒæ—¶å†…ç½®äº†æ€ç»´å¯¼å›¾ï¼Œå…è®¸ç”¨æˆ·å°†å¤§çº²åˆ—è¡¨**ä¸€é”®è½¬åŒ–ä¸ºæ€ç»´å¯¼å›¾æ¨¡å¼**ã€‚\n- [Effie å®˜ç½‘| æŠŠæ€æƒ³å˜ä¸ºä»·å€¼](https://www.effie.co/)\n- [Effie æµ·å¤–è‹±æ–‡å®˜ç½‘](https://www.effie.pro/)\n- [Effie Blog](https://blog.effie.co/)\n- [Effie æ–°æ‰‹å…¥é—¨å®Œå…¨æŒ‡å—](https://blog.effie.co/effie-%e6%96%b0%e6%89%8b%e5%85%a5%e9%97%a8%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97-%e4%b8%89%e5%88%86%e9%92%9f%e6%8a%8a%e4%bd%a0%e7%9a%84%e6%80%9d%e6%83%b3%e5%8f%98%e4%b8%ba%e4%bb%b7%e5%80%bc/)\n- [Effieï¼šä¸ºæ·±åº¦åˆ›ä½œï¼Œä¹Ÿä¸ºè®°å½•çµæ„Ÿ](https://blog.effie.co/effie%ef%bc%9a%e4%b8%ba%e6%b7%b1%e5%ba%a6%e5%88%9b%e4%bd%9c%ef%bc%8c%e4%b9%9f%e4%b8%ba%e8%ae%b0%e5%bd%95%e7%81%b5%e6%84%9f/)\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-21",
        "type": "Post",
        "category": "å­¦ä¹ æ€è€ƒ",
        "urlname": "efficient-learning-methods-pq4r",
        "catalog": [
          "archives"
        ],
        "tags": [
          "æ–‡å­—",
          "æ€è€ƒ",
          "å­¦ä¹ "
        ],
        "summary": "åœ¨ 21 ä¸–çºªçš„ä»Šå¤©ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½è¦é¢ä¸´å¤§é‡çš„çŸ¥è¯†å’Œä¿¡æ¯ã€‚æˆ‘ä»¬æ¯ä¸ªäººéƒ½éœ€è¦ä¸æ–­å­¦ä¹ æ–°çŸ¥è¯†ã€æ–°æ€æƒ³å’Œè¿›è¡Œæ–°çš„å®è·µã€‚\nè¿™æ„å‘³ç€ï¼Œå­¦ä¹ ä¸å†æ˜¯å­¦ç”Ÿé˜¶æ®µæ‰éœ€è¦åšçš„äº‹æƒ…ï¼Œç»ˆèº«æ•™è‚²åº”è¯¥æˆä¸ºæˆ‘ä»¬å·¥ä½œå’Œç”Ÿæ´»çš„æœ‰æœºç»„æˆéƒ¨åˆ†ã€‚\nåœ¨è‡ªæˆ‘å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šäººéƒ½ä¼šå°è¯•å¯»æ‰¾é«˜æ•ˆçš„å­¦ä¹ æ–¹æ³•ï¼Œä»¥ä¾¿æå‡è‡ªå·±çš„å­¦ä¹ èƒ½åŠ›å’Œå­¦ä¹ æ•ˆç‡ã€‚\næ¥ä¸‹æ¥æˆ‘åˆ†äº«çš„å­¦ä¹ æ–¹æ³•ï¼Œä¸ä»…æ˜¯æˆ‘è‡ªå·±åˆ‡èº«å®è·µæœ‰æ•ˆï¼Œä¹Ÿæœ‰ç§‘å­¦ä¾æ®ä½œä¸ºæ”¯æ’‘ã€‚",
        "sort": "",
        "title": "ä½ æœ‰ä»€ä¹ˆå€¼å¾—åˆ†äº«çš„é«˜æ•ˆå­¦ä¹ æ–¹æ³•ï¼Ÿ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "50c530fc-8d3c-4f6b-9956-3be2602e1be8"
        }
      ],
      "body": "",
      "realName": "ä½ æœ‰ä»€ä¹ˆå€¼å¾—åˆ†äº«çš„é«˜æ•ˆå­¦ä¹ æ–¹æ³•ï¼Ÿ",
      "relativePath": "/archives/ä½ æœ‰ä»€ä¹ˆå€¼å¾—åˆ†äº«çš„é«˜æ•ˆå­¦ä¹ æ–¹æ³•ï¼Ÿ.md"
    },
    {
      "id": "8900fb84-5f49-4f66-a5fa-fd34b7fd832a",
      "doc_id": "8900fb84-5f49-4f66-a5fa-fd34b7fd832a",
      "title": "8900fb84-5f49-4f66-a5fa-fd34b7fd832a",
      "updated": 1696747320000,
      "body_original": "\n## ä»€ä¹ˆæ˜¯ä¸»åŠ¨é˜…è¯»ï¼Ÿ\n\n\n**è¢«åŠ¨é˜…è¯»**çš„å…¸å‹ä»£è¡¨ä¾¿æ˜¯åº”è¯•æ•™è‚²ä¹‹ä¸‹çš„å„ç§å¡«é¸­å¼é˜…è¯»ã€‚\n\n\nå¦‚æœé˜…è¯»è€…åœ¨é˜…è¯»è¿‡ç¨‹ä¸­çš„é˜…è¯»å¿ƒç†å’Œé˜…è¯»è¡Œä¸ºéƒ½æ˜¯è¢«åŠ¨çš„ï¼Œé‚£ä¹ˆå¯¹äºçŸ¥è¯†å’Œä¿¡æ¯çš„æŒæ¡å¿…ç„¶æ˜¯ä½æ•ˆçš„ã€‚\n\n\né«˜æ•ˆé˜…è¯»è€…éƒ½ä¼šä½¿ç”¨ä¸€ç³»åˆ—è¢«ç§°ä¸º**ä¸»åŠ¨é˜…è¯»**çš„é˜…è¯»ç­–ç•¥ã€‚é€šè¿‡ä¸»åŠ¨é˜…è¯»ï¼Œæˆ‘ä»¬æ›´åŠ å…¨é¢ã€æ›´åŠ æ·±å…¥åœ°ç†è§£å’ŒæŒæ¡çŸ¥è¯†ã€‚\n\n\nä¸»åŠ¨é˜…è¯»æ„å‘³ç€é˜…è¯»è€…åœ¨é˜…è¯»æŸäº›å†…å®¹æ—¶ï¼Œç§¯æåœ°ä¸æ–‡æœ¬æˆ–è€…ä½œè€…è¿›è¡Œå¯¹è¯ï¼Œå°è¯•å»ç†è§£ã€è¯„ä¼°ã€è®°å¿†ã€åæ€æ‰€è¯»å†…å®¹ã€‚\n\n\n![](https://static.effie.co/blog/2021/08/20210816143032448-1024x512.png?x-oss-process=image/auto-orient,1/quality,q_90/format,webp)\n\n\nåœ¨ã€Šå¦‚ä½•é˜…è¯»ä¸€æœ¬ä¹¦ã€‹è¿™æœ¬ç»å…¸è‘—ä½œä¸­ï¼Œä½œè€…**åŒºåˆ†äº†åŸºç¡€é˜…è¯»ã€æ£€è§†é˜…è¯»ã€åˆ†æé˜…è¯»ã€ä¸»é¢˜é˜…è¯»å››ç§é˜…è¯»å±‚æ¬¡ã€‚**\n\n\nå…¶ä¸­ï¼ŒåŸºç¡€é˜…è¯»ä»¥å¤–çš„å…¶ä»–ä¸‰ç§é˜…è¯»å±‚æ¬¡éƒ½å±äºä¸»åŠ¨é˜…è¯»ã€‚åœ¨ä½œè€…çœ‹æ¥ï¼Œä¸€ä¸ªå¥½çš„è¯»è€…è‡ªç„¶åº”è¯¥æ˜¯ä¸»åŠ¨é˜…è¯»è€…ã€‚é˜…è¯»çš„è‰ºæœ¯ä¾¿æ˜¯éœ€è¦é€šè¿‡æ‰¹åˆ¤æ€§æ€ç»´ä»¥é€‚å½“çš„é¡ºåºæå‡ºé€‚å½“çš„é—®é¢˜ã€‚\n\n\nå…·ä½“è€Œè¨€ï¼Œä¸»åŠ¨é˜…è¯»çš„åŸºç¡€åŒ…å«å››ä¸ªåŸºç¡€é—®é¢˜ï¼š\n\n1. **æ•´ä½“è€Œè¨€ï¼Œè¿™æœ¬ä¹¦åœ¨è°ˆè®ºä»€ä¹ˆï¼Ÿï¼ˆå…³äºä¸»é¢˜ä¸å…³é”®è®®é¢˜ï¼‰**\n2. **ä½œè€…å…·ä½“è¯´äº†ä»€ä¹ˆï¼Œæ€ä¹ˆè¯´çš„ï¼Ÿï¼ˆå…³äºä½œè€…çš„æƒ³æ³•ã€å£°æ˜ä¸è®ºç‚¹ï¼‰**\n3. **è¿™æœ¬ä¹¦è¯´çš„æ˜¯å¦æœ‰é“ç†ï¼Ÿå…¨éƒ¨æœ‰é“ç†ï¼Œè¿˜æ˜¯éƒ¨åˆ†æœ‰é“ç†ï¼Ÿï¼ˆå¯¹ä¹¦è¿›è¡Œæ‰¹åˆ¤æ€§è¯„ä»·ï¼‰**\n4. **è¿™æœ¬ä¹¦è·Ÿä½ æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿä¸ºä½ æä¾›äº†èµ„è®¯ï¼Ÿå¯å‘äº†ä½ ï¼Ÿ**\n\nå¦‚æœä½ æƒ³æˆä¸ºä¸»åŠ¨é˜…è¯»è€…ï¼Œé‚£åŸºæœ¬è¦æ±‚ä¾¿æ˜¯å‹‡äºæ‰¿æ‹…é˜…è¯»è€…çš„è´£ä»»ï¼Œåœ¨é˜…è¯»è¿‡ç¨‹ä¸­åˆ©ç”¨æ‰¹åˆ¤æ€§æ€ç»´å¯¹è¿™å››ä¸ªåŸºç¡€é—®é¢˜è¿›è¡Œè‡ªæˆ‘æé—®å¹¶è®¤çœŸå›ç­”ã€‚\n\n\nå…¶ä¸­ï¼Œå…³äºæ‰¹åˆ¤æ€§æ€ç»´ä¸é˜…è¯»æ–¹æ³•ï¼Œå…·ä½“å¯ä»¥ç§»æ­¥é˜…è¯»æˆ‘ä»¥å‰çš„åšæ–‡ã€Š[æ‰¹åˆ¤æ€§é˜…è¯»å’Œæ‰¹åˆ¤æ€§å†™ä½œ](https://blog.effie.co/%e6%89%b9%e5%88%a4%e6%80%a7%e9%98%85%e8%af%bb%e5%92%8c%e6%89%b9%e5%88%a4%e6%80%a7%e5%86%99%e4%bd%9c/)ã€‹ã€‚\n\n\n![](https://static.effie.co/blog/2021/08/20210816143128331-1024x537.png?x-oss-process=image/auto-orient,1/quality,q_90/format,webp)\n\n\n## 14 ç§ä¸»åŠ¨é˜…è¯»ç­–ç•¥\n\n\n### ç†è§£ä½œè€…çš„æ„å›¾\n\n\nä½œè€…çš„ç›®æ ‡æ˜¯å‘ŠçŸ¥ã€è®ºè¯æŸä¸ªç†è®ºå’Œè§‚ç‚¹ï¼Œè¿˜æ˜¯æƒ³è¦å®£ä¼ ä»–ä»¬çš„äº§å“æˆ–æœåŠ¡å—ï¼ŸèŠ±å‡ åˆ†é’Ÿè®¤çœŸé˜…è¯»æ–‡æœ¬èµ„æ–™çš„å†…å®¹ä»‹ç»ï¼ˆå‰è¨€ã€æ‘˜è¦ã€è¯´æ˜æ–‡æ¡£ç­‰ï¼‰ï¼Œä»¥äº†è§£ä½œè€…å†™ä½œçš„åŸå› å’Œæ„å›¾ã€‚\n\n\n### è°ƒæ•´é˜…è¯»é€Ÿåº¦\n\n\nä¸è¦ä½¿ç”¨å›ºå®šé€Ÿåº¦é˜…è¯»æ–‡æœ¬å†…å®¹ï¼Œè€Œæ˜¯åº”è¯¥è®©è‡ªå·±çš„é˜…è¯»é€Ÿåº¦é€‚åº”å½“å‰æ­£åœ¨é˜…è¯»çš„å†…å®¹ã€‚\n\n\nè¿™æ„å‘³ç€åœ¨é˜…è¯»ä¸€äº›ä½ å·²ç»ç†Ÿæ‚‰çš„å†…å®¹æ—¶åŠ å¿«é€Ÿåº¦ï¼Œè€Œé‡åˆ°ä¸€äº›æ–°çš„ä¿¡æ¯ã€çŸ¥è¯†æ—¶é™ä½é€Ÿåº¦è¿›è¡Œç»†è¯»ã€‚\n\n\n### æ ‡è®°æ–‡æœ¬\n\n\nå¿…è¦æ—¶ç»™æ®µè½è¿›è¡Œç¼–å·ã€‚åœˆå‡ºé˜…è¯»è¿‡ç¨‹ä¸­æ¯”è¾ƒé‡è¦çš„å•è¯ã€çŸ­è¯­ã€åç§°ã€æ—¥æœŸç­‰é‡è¦ä¿¡æ¯ã€‚åœ¨ä½œè€…çš„è§‚ç‚¹ã€å£°æ˜ç­‰é‡è¦ä¿¡æ¯ä¸‹é¢åˆ’çº¿ã€‚\n\n\n### æ³¨é‡Šå†…å®¹\n\n\nè®°ç¬”è®°æ˜¯ä¸é˜…è¯»å†…å®¹ä¿æŒè”ç³»ã€è¿›è¡Œå¯¹è¯çš„å¥½æ–¹æ³•ã€‚è¯·åœ¨çº¸è´¨é¡µé¢ç©ºç™½å¤„æˆ–è€…ç¼–è¾‘å™¨é¡µé¢éšæ—¶å†™ä¸‹ä½ åœ¨é˜…è¯»æŸäº›å†…å®¹æ—¶çªç„¶æƒ³åˆ°çš„å„ç§æƒ³æ³•ã€‚\n\n\n**æ ‡è®°æ–‡æœ¬åªæ˜¯è¾…åŠ©ï¼Œé‡è¦çš„æ˜¯æ³¨é‡Šå’Œè¯„è®ºã€‚**\n\n\nåœ¨é˜…è¯»è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å°è¯•æ€»ç»“æ–‡æœ¬ã€æå‡ºé—®é¢˜ã€å¯¹æŸä¸ªè§‚ç‚¹è¡¨ç¤ºåŒæ„æˆ–è€…è´¨ç–‘ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å†™ä¸‹ä¸€äº›å…³é”®è¯å¸®åŠ©ä½ è®¨è®ºæˆ–è€…åé¢å›å¿†é‡ç‚¹å†…å®¹ã€‚\n\n\næˆ–è€…ï¼Œä½ å¯ä»¥å°†æ–‡ç« çš„æ ‡é¢˜ã€å‰¯æ ‡é¢˜ã€ç« èŠ‚å’Œæ®µè½æ ‡é¢˜æ›´æ”¹ä¸ºé—®é¢˜ï¼Œå¼•å¯¼è‡ªå·±è¿›è¡Œç§¯ææ€è€ƒã€‚ä¸Šé¢çš„è¿™äº›è¦æ±‚éƒ½æ˜¯è¦æ±‚ä¸»åŠ¨é˜…è¯»è€…å°½é‡ä¸ä½œè€…è¿›è¡Œå¯¹è¯ã€‚\n\n\n### é‡Šä¹‰\n\n\nå½“åœ¨é˜…è¯»è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸€ä¸ªä½ æ„Ÿè§‰æ¯”è¾ƒéš¾ä»¥æŒæ¡çš„æ–°æ¦‚å¿µæ—¶ï¼Œå»ºè®®åœä¸‹æ¥å°è¯•ä½¿ç”¨è‡ªå·±çš„è¯å¯¹è¿™ä¸ªæ¦‚å¿µè¿›è¡Œè§£é‡Šã€‚\n\n\n### æ€»ç»“æ®µè½æ€æƒ³\n\n\nä»”ç»†é˜…è¯»æ¯ä¸ªæ®µè½ï¼Œä½¿ç”¨ä½ è‡ªå·±çš„è¯è¡¨è¾¾æ®µè½çš„ä¸»è¦æ€æƒ³ã€‚ç„¶ååˆ†ææ–‡ç« çš„ä¸»è¦è§‚ç‚¹æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå…·ä½“æ˜¯å¦‚ä½•è®ºè¯çš„ã€‚\n\n\n### ä¹¦å†™ç« èŠ‚æ‘˜è¦\n\n\nä½¿ç”¨ä½ è‡ªå·±çš„è¯å†™å‡ºä¸€ç¯‡æ–‡ç« æˆ–æŸä¸ªç« èŠ‚çš„æ‘˜è¦ã€‚åœ¨æ‘˜è¦ä¸­ä½¿ç”¨å‡ç»ƒçš„è¯­è¨€æ¦‚æ‹¬é˜…è¯»å†…å®¹çš„åŸºæœ¬æ€æƒ³ï¼Œå¹¶ç½—åˆ—å‡ºå…³é”®è¯ã€‚è¿™æ˜¯ä¸€ç§èƒ½æ£€éªŒè‡ªå·±æ˜¯å¦çœŸæ­£ç†è§£æ‰€è¯»å†…å®¹çš„æœ‰æ•ˆæ–¹æ³•ã€‚\n\n\n### å»ºç«‹ä¿¡æ¯æˆ–è€…çŸ¥è¯†å—\n\n\nå°†ä¿¡æ¯æˆ–è€…çŸ¥è¯†åˆ†è§£æˆæ›´å°çš„å—ï¼Œä»¥ä¾¿æ›´ä¸ºè½»æ¾åœ°ä¿ç•™ã€‚æ¯”å¦‚ï¼Œä»¥æ¦‚å¿µæˆ–è€…ç†è®ºä¸ºå•ä½è¿›è¡Œåˆ†è§£æˆçŸ¥è¯†å—ï¼ŒåæœŸå¯ä»¥è¾ƒä¸ºæ–¹ä¾¿åœ°å¯¹è¿™äº›çŸ¥è¯†å—è¿›è¡Œæ’åˆ—ç»„åˆã€‚\n\n\n### è¿æ¥èŠ‚ç‚¹\n\n\nå½“é‡åˆ°æ–°çš„çŸ¥è¯†ï¼Œå°è¯•å°†æ–‡æœ¬å†…å®¹ä¸ä¸ªäººç»éªŒæˆ–è€…å…¶ä»–çŸ¥è¯†å†…å®¹è¿›è¡Œè”ç³»ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯åœ¨é‡Šä¹‰ã€ä¿¡æ¯/çŸ¥è¯†å—çš„åŸºç¡€ä¸Šï¼Œè¿æ¥èŠ‚ç‚¹å¯ä»¥å»ºç«‹çŸ¥è¯†ç½‘ç»œã€‚\n\n\n### ç›´è§‚åœ°ç»„ç»‡ä¿¡æ¯\n\n\nå°†æ–‡æœ¬å†…å®¹å¯è§†åŒ–ï¼Œä»¥ä¾¿æ›´å¥½åœ°æŸ¥çœ‹ã€æ–°å»ºå’Œå‘ç°çŸ¥è¯†ä¹‹é—´çš„è”ç³»ã€‚æ¢è€Œè¨€ä¹‹ï¼ŒçŸ¥è¯†å†…å®¹å›¾è°±åŒ–ã€‚\n\n\nç›®å‰ï¼Œå·²ç»æœ‰ä¸€äº›ç¼–è¾‘å™¨æä¾›äº†çŸ¥è¯†å›¾è°±è¾…åŠ©åŠŸèƒ½ã€‚ä¸è¿‡ï¼Œä»»ä½•çŸ¥è¯†å›¾è°±åªæœ‰é˜…è¯»è€…çš„ä¸»åŠ¨å»ºæ„æ‰æœ‰æ„ä¹‰å’Œä»·å€¼ã€‚\n\n\nåˆ©ç”¨å¤§çº²åˆ—è¡¨ã€æ€ç»´å¯¼å›¾ã€æµç¨‹å›¾ã€æ•°å­—ç™½æ¿ã€å›¾è¡¨ç­‰å·¥å…·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´è§‚åœ°æ¢³ç†æˆ‘ä»¬çš„æƒ³æ³•ã€‚\n\n\n### è·å–å‚è€ƒä¿¡æ¯\n\n\næ¯å½“ä½ æœ‰ç–‘é—®æ—¶ï¼Œè¯·ä½¿ç”¨å­—å…¸æˆ–å…¶ä»–å‚è€ƒèµ„æ–™å·¥å…·ï¼Œä»¥æ­¤ç¡®ä¿ä½ èƒ½å‡†ç¡®ç†è§£æ‰€è¯»æ±‰å­—ã€å•è¯ã€ä¸“ä¸šæœ¯è¯­çš„å«ä¹‰ï¼Œä»¥åŠæŒæ¡ç›¸å…³çš„èƒŒæ™¯çŸ¥è¯†ä¿¡æ¯ã€‚\n\n\n### æ€»ç»“å†…å®¹\n\n\nä¸€æ—¦ä½ è¯»å®Œä¸€æœ¬ä¹¦ï¼Œé‚£æœ€å¥½åä¸‹æ¥å†™ä½ è‡ªå·±çš„æ€»ç»“ã€‚å¦‚æœä½ åœ¨ç½‘ä¸Šå‘å¸ƒä½ çš„é˜…è¯»ä½“éªŒï¼Œä½ è¿˜å¯ä»¥è·å–å…¶ä»–è¯»è€…çš„åé¦ˆã€‚\n\n\né€šè¿‡ä¸ä»–äººè§‚ç‚¹çš„äº¤æ±‡å’Œç¢°æ’ï¼Œæˆ‘ä»¬å¯¹äºé˜…è¯»å†…å®¹çš„ç†è§£å’Œåæ€ä¼šæ›´åŠ æ·±å…¥ã€‚\n\n\n### è¯„ä»·å†…å®¹\n\n\næ¯éš”ä¸€æ®µæ—¶é—´ï¼Œåé€€å‡ æ­¥â€”â€”ä»é˜…è¯»å†…å®¹ä¸­è·³å‡ºæ¥ï¼Œç„¶åæ‰¹åˆ¤æ€§åœ°æ€è€ƒä½ æ­£åœ¨é˜…è¯»çš„å†…å®¹ã€‚æ€è€ƒä¸€ä¸‹ï¼Œé˜…è¯»èµ„æ–™çš„ç»“æ„æ˜¯å¦åˆç†ï¼Ÿè®ºç‚¹æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Ÿä½œè€…æ˜¯å¦æœ‰æ˜æ˜¾æˆ–è€…æ½œåœ¨çš„åè§ï¼Ÿ\n\n\n### é€šè¿‡è¾“å‡ºå¢å¼ºç†è§£\n\n\nå°è¯•å°†è‡ªå·±çš„æ‰€æŒæ¡çš„æ–°çŸ¥æ•™ç»™åˆ«äººï¼ˆè¾“å‡ºï¼‰ã€‚å¤§é‡ç ”ç©¶æ˜ç¡®è¡¨æ˜ï¼Œæ•™å­¦æ˜¯æœ€æœ‰æ•ˆçš„å­¦ä¹ æ–¹å¼ä¹‹ä¸€ã€‚\n\n\nå¦‚æœä½ æ— æ³•è¡¨è¾¾å·²è¯»å†…å®¹ï¼Œé‚£è¯´æ˜ä½ å¯¹è¿™äº›çŸ¥è¯†æŒæ¡å¹¶ä¸ç‰¢é ã€‚ç»™åˆ«äººè®²è§£æ‰€è¯»å†…å®¹ï¼Œæ˜¯ä¸€ç§éå¸¸å¥½çš„æ£€éªŒä»¥åŠå¢å¼ºè‡ªå·±å¯¹äºå·²è¯»å†…å®¹çš„è‡ªæˆ‘å­¦ä¹ æ–¹å¼ã€‚\n\n\nç”šè‡³åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿˜å¯èƒ½æ¿€å‘ä½ å¯¹è¿™äº›å·²è¯»å†…å®¹äº§ç”Ÿæ–°çš„ç†è§£ã€‚\n\n\n![](https://static.effie.co/blog/2021/08/20210817021017232-1024x663.png?x-oss-process=image/auto-orient,1/quality,q_90/format,webp)\n\n\nå­¦ä¹ é‡‘å­—å¡”ï¼šä¸»åŠ¨å­¦ä¹ å’Œæ¶ˆæå­¦ä¹ æ‰€è·å¾—çŸ¥è¯†çš„å†…å®¹ç•™å­˜ç‡å·®åˆ«æ‚¬æ®Š\n\n\nä¸Šè¿°ä¸»åŠ¨é˜…è¯»ç­–ç•¥åŸºæœ¬ä¸Šå±•ç¤ºäº†ä¸»åŠ¨é˜…è¯»çš„å­¦ä¹ æµç¨‹ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ 14 ç§é˜…è¯»ç­–ç•¥é‡Œé¢æœ‰ä¸€äº›æ˜¯ä¸ºå­¦ç”Ÿç­‰ç¾¤ä½“è¿›è¡Œå‡†å¤‡çš„ã€‚\n\n\nå› æ­¤ï¼Œåœ¨è¿›è¡Œé˜…è¯»æ—¶ï¼Œå¹¶æ²¡æœ‰å¿…è¦ä½¿ç”¨æ‰€æœ‰çš„ä¸»åŠ¨é˜…è¯»ç­–ç•¥ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æƒ³å¯¹æŸä¸ªæ–‡æœ¬è¿›è¡Œè®¤çœŸç ”è¯»ï¼Œé‚£è¿™äº›é˜…è¯»ç­–ç•¥åŸºæœ¬ä¸Šéƒ½æ˜¯é€‚ç”¨çš„ã€‚\n\n\n## æ³¨é‡Š\n\n- æ–‡ç« **è½¬è½½è‡ª Effie Blog**, å·²ç»è·å¾—æˆæƒã€‚\n- **Effie å®˜æ–¹ä»‹ç»**ï¼šæ— è®ºæ˜¯**ä¸¥è‚ƒå†™ä½œ**ï¼Œ**éšæ‰‹è®°å½•**ï¼Œäº¦æˆ–æ˜¯æŠŠé€»è¾‘å®Œå–„æˆæ€ç»´å¯¼å›¾ï¼ŒEffie éƒ½æ˜¯æ‚¨æ˜æ™ºçš„é€‰æ‹©ã€‚\n- **Effie ç®€è¦ä»‹ç»**ï¼šä¸€æ¬¾**æ€å†™åˆä¸€**çš„**ä¸“ä¸šå†™ä½œè½¯ä»¶**ï¼Œæ‹¥æœ‰ Markdown è¯­æ³•æ”¯æŒã€å…¨å¹³å°ã€æç®€æ²‰æµ¸è®¾è®¡ç­‰åŸºæœ¬è¦æ±‚ï¼ŒåŒæ—¶å†…ç½®äº†æ€ç»´å¯¼å›¾ï¼Œå…è®¸ç”¨æˆ·å°†å¤§çº²åˆ—è¡¨**ä¸€é”®è½¬åŒ–ä¸ºæ€ç»´å¯¼å›¾æ¨¡å¼**ã€‚\n- [Effie å®˜ç½‘| æŠŠæ€æƒ³å˜ä¸ºä»·å€¼](https://www.effie.co/)\n- [Effie æµ·å¤–è‹±æ–‡å®˜ç½‘](https://www.effie.pro/)\n- [Effie Blog](https://blog.effie.co/)\n- [Effie æ–°æ‰‹å…¥é—¨å®Œå…¨æŒ‡å—](https://blog.effie.co/effie-%e6%96%b0%e6%89%8b%e5%85%a5%e9%97%a8%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97-%e4%b8%89%e5%88%86%e9%92%9f%e6%8a%8a%e4%bd%a0%e7%9a%84%e6%80%9d%e6%83%b3%e5%8f%98%e4%b8%ba%e4%bb%b7%e5%80%bc/)\n- [Effieï¼šä¸ºæ·±åº¦åˆ›ä½œï¼Œä¹Ÿä¸ºè®°å½•çµæ„Ÿ](https://blog.effie.co/effie%ef%bc%9a%e4%b8%ba%e6%b7%b1%e5%ba%a6%e5%88%9b%e4%bd%9c%ef%bc%8c%e4%b9%9f%e4%b8%ba%e8%ae%b0%e5%bd%95%e7%81%b5%e6%84%9f/)\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-25",
        "type": "Post",
        "category": "å­¦ä¹ æ€è€ƒ",
        "urlname": "active-reading-becoming-better-reader",
        "catalog": [
          "archives"
        ],
        "tags": [
          "æ–‡å­—",
          "æ€è€ƒ",
          "å­¦ä¹ "
        ],
        "summary": "ä¸»åŠ¨é˜…è¯»æ˜¯ä¸€ç§ç§¯æã€æ·±å…¥çš„é˜…è¯»æ–¹å¼ï¼Œå®ƒéœ€è¦è¯»è€…åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åˆ©ç”¨å¤šç§ç­–ç•¥ï¼Œå¦‚æé—®ã€æ¦‚æ‹¬ã€ç¬”è®°ã€æ¨ç†ç­‰ï¼Œä¸ä»…ç†è§£æ–‡å­—è¡¨æ„ï¼Œè¿˜è¦åŠ æ·±å¯¹å…¶èƒŒåæ¶µä¹‰çš„ç†è§£å’Œè®°å¿†ï¼ŒåŒæ—¶ï¼Œå°†è‡ªå·±çš„ç»éªŒå’ŒçŸ¥è¯†è¿ç”¨åˆ°é˜…è¯»ä¸­å»ï¼Œä»¥è¾¾åˆ°æ›´å¥½çš„é˜…è¯»æ•ˆæœã€‚ä¸»åŠ¨é˜…è¯»èƒ½å¤Ÿæé«˜æˆ‘ä»¬çš„é˜…è¯»èƒ½åŠ›å’Œæ€ç»´æ°´å¹³ï¼ŒåŸ¹å…»æˆ‘ä»¬æ‰¹åˆ¤æ€§åœ°æ€è€ƒå’Œåˆ†æé—®é¢˜çš„èƒ½åŠ›ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°æŒæ¡çŸ¥è¯†å’Œä¿¡æ¯ã€‚",
        "sort": "",
        "title": "ä¸»åŠ¨é˜…è¯»ï¼šæˆä¸ºæ›´å¥½çš„é˜…è¯»è€…",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "8900fb84-5f49-4f66-a5fa-fd34b7fd832a"
        }
      ],
      "body": "",
      "realName": "ä¸»åŠ¨é˜…è¯»ï¼šæˆä¸ºæ›´å¥½çš„é˜…è¯»è€…",
      "relativePath": "/archives/ä¸»åŠ¨é˜…è¯»ï¼šæˆä¸ºæ›´å¥½çš„é˜…è¯»è€….md"
    },
    {
      "id": "3a77d2b4-f1df-48cc-bdc1-3192e46e674c",
      "doc_id": "3a77d2b4-f1df-48cc-bdc1-3192e46e674c",
      "title": "3a77d2b4-f1df-48cc-bdc1-3192e46e674c",
      "updated": 1696747320000,
      "body_original": "\n[Red Hat å•ç‚¹ç™»å½•](https://www.redhat.com/en/products/middleware)(SSO) â€” æˆ–å…¶å¼€æºç‰ˆæœ¬ Keycloak â€” æ˜¯ Web SSO åŠŸèƒ½çš„é¢†å…ˆäº§å“ä¹‹ä¸€ï¼Œå®ƒåŸºäºæµè¡Œçš„æ ‡å‡†ï¼Œä¾‹å¦‚å®‰å…¨æ–­è¨€æ ‡è®°è¯­è¨€ (SAML) 2.0ã€OpenID Connect å’ŒOAuth 2.0ã€‚Red Hat SSO æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼ç›´æ¥è®¿é—® Keycloakï¼Œæ— è®ºæ˜¯é€šè¿‡ç®€å•çš„ HTML ç™»å½•è¡¨å•ï¼Œè¿˜æ˜¯é€šè¿‡ API è°ƒç”¨ã€‚åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆä¸€ä¸ª JWT ä»¤ç‰Œï¼Œç„¶åå¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚ä¸€åˆ‡éƒ½å°†ä½¿ç”¨ API è°ƒç”¨æ¥å®Œæˆï¼Œå› æ­¤ Keycloak çš„ UI ä¸ä¼šç›´æ¥æš´éœ²ç»™å…¬ä¼—ã€‚\n\n\nè®¾ç½®ç”¨æˆ·\n\n\né¦–å…ˆï¼Œæˆ‘ä»¬å°†åœ¨Keycloakä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„ç”¨æˆ·ï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2019/12/keycloak01-1.png?itok=WywnX4-4)\n\n\nå›¾ 1ï¼šåœ¨ Keycloak ä¸­åˆ›å»ºç”¨æˆ·ã€‚\">\n\n\nå¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼Œä¾‹å¦‚**Username**ã€**First Name**å’Œ**Last Name**ï¼Œå¦‚å›¾ 2 æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2019/12/keycloak02-1.png?itok=6nuYjWAS)\n\n\nå›¾ 2ï¼šè¾“å…¥ç”¨æˆ·ä¿¡æ¯ã€‚\">\n\n\nè®¾ç½®ç”¨æˆ·å¯†ç ï¼Œå¦‚å›¾3æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2019/12/keycloak03-1.png?itok=xhzQFM8t)\n\n\nå›¾ 3ï¼šè®¾ç½®ç”¨æˆ·å¯†ç ã€‚\">\n\n\n# è®¾ç½®å®¢æˆ·ç«¯\n\n\nä¸‹ä¸€æ­¥æ˜¯åœ¨æˆ‘ä»¬çš„é¢†åŸŸä¸­åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„_å®¢æˆ·ç«¯_ï¼Œå¦‚å›¾ 4 æ‰€ç¤ºã€‚Keycloak ä¸­çš„å®¢æˆ·ç«¯ä»£è¡¨ç‰¹å®šç”¨æˆ·å¯ä»¥è®¿é—®çš„èµ„æºï¼Œæ— è®ºæ˜¯ç”¨äºéªŒè¯ç”¨æˆ·èº«ä»½ã€è¯·æ±‚èº«ä»½ä¿¡æ¯è¿˜æ˜¯éªŒè¯è®¿é—®ä»¤ç‰Œã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2019/12/keycloak04-1.png?itok=cKzhT2We)\n\n\nå›¾ 4ï¼šæŸ¥çœ‹æ‚¨ç°æœ‰çš„å®¢æˆ·ã€‚\">\n\n\nå•å‡»**â€œåˆ›å»ºâ€**Â ï¼Œæ‰“å¼€**â€œæ·»åŠ å®¢æˆ·ç«¯â€**å¯¹è¯æ¡†ï¼Œå¦‚å›¾5æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2019/12/keycloak05-1.png?itok=GQ60hiap)\n\n\nå›¾ 5ï¼šåˆ›å»ºæ–°å®¢æˆ·ç«¯ã€‚\">\n\n\nå¡«å†™å®¢æˆ·è¡¨æ ¼ä¸­çš„æ‰€æœ‰å¿…å¡«å­—æ®µã€‚è¯·ç‰¹åˆ«æ³¨æ„**Direct Grant Flow**ï¼ˆå¦‚å›¾ 6 æ‰€ç¤ºï¼‰å¹¶å°†å…¶å€¼è®¾ç½®ä¸º**direct grant**ã€‚æ­¤å¤–ï¼Œå°†**è®¿é—®ç±»å‹**æ›´æ”¹ä¸º**æœºå¯†**ã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2019/12/keycloak06-1.png?itok=azkV9Cm1)\n\n\nå›¾ 6ï¼šè¦†ç›–å®¢æˆ·ç«¯çš„èº«ä»½éªŒè¯æµç¨‹ã€‚\">\n\n\n**æœ€åï¼Œå°†Client Authenticator**å­—æ®µä¸­çš„å®¢æˆ·ç«¯å‡­è¯æ›´æ”¹ä¸º**Client Id å’Œ Secret**ï¼Œå¦‚å›¾ 7 æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2019/12/keycloak07-1.png?itok=3soIf6MC)\n\n\nå›¾ 7ï¼šè®¾ç½®æ–°å®¢æˆ·çš„å‡­æ®ã€‚\">\n\n\n# æµ‹è¯•ä½ çš„æ–°å®¢æˆ·\n\n\nç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ REST API æ¥æµ‹è¯•æˆ‘ä»¬æ–°åˆ›å»ºçš„å®¢æˆ·ç«¯æ¥æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„ç™»å½•ã€‚æˆ‘ä»¬çš„èº«ä»½éªŒè¯ URL æ˜¯\n\n\n\nå¡«å†™å‚æ•°å¹¶ä½¿ç”¨æˆ‘ä»¬çš„ç”¨æˆ·åå’Œå¯†ç è®¾ç½®client_idå’Œclient_secretï¼š\n\n\n\n\n```shell\ncurl -L -X POST 'http://localhost:8080/auth/realms/whatever-realm/protocol/openid-connect/token' \\\n-H 'Content-Type: application/x-www-form-urlencoded' \\\n--data-urlencode 'client_id=clientid-03' \\\n--data-urlencode 'grant_type=password' \\\n--data-urlencode 'client_secret=ec78c6bb-8339-4bed-9b1b-e973d27107dc' \\\n--data-urlencode 'scope=openid' \\\n--data-urlencode 'username=emuhamma' \\\n--data-urlencode 'password=1'\n```\n\n\næˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Postman ç­‰ REST API å·¥å…·æ¥æ¨¡æ‹Ÿ HTTP POST è¯·æ±‚ï¼Œå¦‚å›¾ 8 æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2019/12/keycloak08-1.png?itok=lXBjdXCy)\n\n\nå›¾ 8ï¼šæˆ‘ä»¬æ¨¡æ‹Ÿçš„ HTTP POST è¯·æ±‚ã€‚\">\n\n\nç»“æœå°†æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ JWT ä»¤ç‰Œï¼š\n\n\n```json\n{ \n    \"access_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiAwNjEwLCJpc3MiOiJodHRwO.......wKRTus6PAoHMFlIlYQ75dYiLzzuRMvdXkHl6naLNQ8wYDv4gi7A3eJ163YzXSJf5PmQ\", \n    \"expires_in\": 600, \n    \"refresh_expires_in\": 1800, \n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cC.......IsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoib3BlbmlkIGVtYWlsIHByb2ZpbGUifQ.ePV2aqeDjlg6ih6SA7_x77gT4JYyv7HvK7PLQW-X1mM\", \n    \" token_type\": \"bearer\", \n    \"id_token\": \"eyJhbGciOiJSUz......A_d_LV96VCLBeTJSpqeqpMJYlh4AMJqN6kddtrI4ixZLfwAIj-Qwqn9kzGe-v1-oe80wQXrXzVBG7TJbKm4x5bgCO_B9lnDMrey9 0rvaKKr48K697ug\", \" \n    not-before-policy\": 0, \n    \"session_state\": \"22c8278b-3346-468e-9533-f41f22ed264f\", \n    \"scope\": \"openid email profile\" \n}\n```\n\n\né”™è¯¯çš„ç”¨æˆ·åå’Œå¯†ç ç»„åˆä¼šå¯¼è‡´ HTTP 401 å“åº”ä»£ç å’Œå¦‚ä¸‹å“åº”æ­£æ–‡ï¼š\n\n\n```json\n{\n    â€œerrorâ€ï¼šâ€œinvalid_grantâ€ï¼Œ\n    â€œerror_descriptionâ€ï¼šâ€œæ— æ•ˆçš„ç”¨æˆ·å‡­è¯â€\n}\n```\n\n\nç»™ä½ ã€‚ç°åœ¨æ‚¨å·²ç»é…ç½®äº†ä¸€ä¸ªç™»å½• APIï¼Œå¯ä»¥å¾ˆå¥½åœ°ä¸ Keycloak é…åˆä½¿ç”¨ã€‚ç©å¾—å¼€å¿ƒï¼\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-28",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "api-login-and-jwt-token-generation-using-keycloak",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å¼€å‘",
          "å»ºç«™",
          "Java",
          "keycloak",
          "oauth"
        ],
        "summary": "Red Hat SSO (æˆ–Keycloak)æ˜¯é¢†å…ˆçš„Web SSOäº§å“ä¹‹ä¸€ï¼Œæ”¯æŒSAML 2.0ã€OpenID Connectå’ŒOAuth 2.0ç­‰æ ‡å‡†ï¼Œå¼ºå¤§ä¹‹å¤„åœ¨äºå¯é€šè¿‡å¤šç§æ–¹å¼ç›´æ¥è®¿é—®Keycloakï¼ŒåŒ…æ‹¬APIè°ƒç”¨ç”Ÿæˆå’ŒéªŒè¯JWTä»¤ç‰Œã€‚æ“ä½œä»…é™APIè°ƒç”¨ï¼Œæ— éœ€æš´éœ²Keycloakçš„UIç»™å…¬ä¼—ã€‚",
        "sort": "",
        "title": "ä½¿ç”¨ Keycloak çš„ API ç™»å½•å’Œ JWT ä»¤ç‰Œç”Ÿæˆ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "3a77d2b4-f1df-48cc-bdc1-3192e46e674c"
        }
      ],
      "body": "",
      "realName": "ä½¿ç”¨ Keycloak çš„ API ç™»å½•å’Œ JWT ä»¤ç‰Œç”Ÿæˆ",
      "relativePath": "/archives/ä½¿ç”¨ Keycloak çš„ API ç™»å½•å’Œ JWT ä»¤ç‰Œç”Ÿæˆ.md"
    },
    {
      "id": "e454567c-abfe-4f35-9826-05e8eff97c1f",
      "doc_id": "e454567c-abfe-4f35-9826-05e8eff97c1f",
      "title": "e454567c-abfe-4f35-9826-05e8eff97c1f",
      "updated": 1696747320000,
      "body_original": "\nç‰©è”ç½‘çš„æœªæ¥å‘å±•å°†ä¼šè¶Šæ¥è¶Šå¹¿æ³›å’Œæ·±å…¥ï¼Œæ¶‰åŠåˆ°åŒ…æ‹¬å®¶åº­ã€å·¥ä¸šã€åŒ»ç–—ã€äº¤é€šç­‰å„ä¸ªæ–¹é¢ã€‚éšç€ç‰©è”ç½‘æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œå°†ä¼šç»™äººä»¬å¸¦æ¥æ›´åŠ ä¾¿åˆ©å’Œèˆ’é€‚çš„ç”Ÿæ´»æ–¹å¼ã€‚\n\n\n> ğŸ¥… ç‰©è”ç½‘çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚æ™ºèƒ½å®¶å±…ã€æ™ºæ…§åŸå¸‚ã€æ™ºèƒ½åŒ»ç–—ã€æ™ºèƒ½åˆ¶é€ ç­‰ã€‚æ™ºèƒ½å®¶å±…å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°å®¶ç”µä¹‹é—´çš„äº’è”äº’é€šï¼Œä¾‹å¦‚æ™ºèƒ½é—¨é”ã€æ™ºèƒ½éŸ³å“ã€æ™ºèƒ½å®¶ç”µç­‰ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹æœºAPPæˆ–è€…è¯­éŸ³æ§åˆ¶å®Œæˆå¯¹å®¶ä¸­è®¾å¤‡çš„æ“ä½œã€‚æ™ºæ…§åŸå¸‚å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°åŸå¸‚åŸºç¡€è®¾æ–½ä¹‹é—´çš„äº’è”äº’é€šå’Œæ•°æ®å…±äº«ï¼Œä¾‹å¦‚æ™ºèƒ½äº¤é€šã€æ™ºèƒ½åœè½¦ã€æ™ºèƒ½ç…§æ˜ç­‰ï¼Œå®ç°åŸå¸‚çš„æ™ºèƒ½åŒ–ç®¡ç†å’Œä¼˜åŒ–ã€‚æ™ºèƒ½åŒ»ç–—å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°åŒ»ç–—è®¾å¤‡ä¹‹é—´çš„äº’è”äº’é€šå’Œæ•°æ®å…±äº«ï¼Œä¾‹å¦‚æ™ºèƒ½å¥åº·ç›‘æµ‹è®¾å¤‡ã€æ™ºèƒ½æ‰‹ç¯ã€æ™ºèƒ½åº·å¤ä»ªç­‰ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æé«˜åŒ»ç–—è®¾å¤‡çš„ä½¿ç”¨æ•ˆç‡å’ŒåŒ»ç–—æœåŠ¡çš„è´¨é‡ã€‚æ™ºèƒ½åˆ¶é€ å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°å·¥ä¸šè®¾å¤‡ä¹‹é—´çš„äº’è”äº’é€šå’Œæ•°æ®å…±äº«ï¼Œä¾‹å¦‚æ™ºèƒ½æœºåºŠã€æ™ºèƒ½ç‰©æµã€æ™ºèƒ½è´¨æ£€ç­‰ï¼Œå¯ä»¥æé«˜ç”Ÿäº§çº¿çš„è‡ªåŠ¨åŒ–ç¨‹åº¦å’Œç”Ÿäº§æ•ˆç‡ã€‚\n\n\næ€»ä¹‹ï¼Œç‰©è”ç½‘æŠ€æœ¯çš„æœªæ¥å°†ä¼šæ›´åŠ å¹¿é˜”å’Œæ·±å…¥ï¼Œå®ƒå°†ä¼šå¼•é¢†äººä»¬è¿›å…¥ä¸€ä¸ªæ™ºèƒ½åŒ–çš„ä¸–ç•Œï¼Œä¸ºäººä»¬å¸¦æ¥æ›´åŠ ä¾¿åˆ©å’Œèˆ’é€‚çš„ç”Ÿæ´»æ–¹å¼ï¼Œä¹Ÿå°†ä¼šå¯¹ç¤¾ä¼šç»æµå‘å±•å’Œç”Ÿäº§åŠ›çš„æå‡èµ·åˆ°é‡è¦çš„æ¨åŠ¨ä½œç”¨ã€‚\n\n\n### ç‰©è”ç½‘å¼€å‘\n\n\n   ç‰©è”ç½‘å¼€å‘æ¿å—åŒ…æ‹¬ï¼šç¡¬ä»¶å¼€å‘ã€é€šè®¯åè®®ã€åå°å¹³å°ã€å‰ç«¯åº”ç”¨ç­‰ã€‚ç¡¬ä»¶å¼€å‘åŒ…æ‹¬ä¼ æ„Ÿå™¨ã€åµŒå…¥å¼ç³»ç»Ÿã€æ— çº¿é€šä¿¡æ¨¡å—ç­‰ï¼›é€šè®¯åè®®åŒ…æ‹¬è“ç‰™ã€Wi-Fiã€ZigBeeã€LoRaç­‰ï¼›åå°å¹³å°åŒ…æ‹¬äº‘å¹³å°ã€æ•°æ®ä¸­å¿ƒç­‰ï¼›å‰ç«¯åº”ç”¨åŒ…æ‹¬æ‰‹æœºAPPã€æ™ºèƒ½å®¶å±…è®¾å¤‡ã€ç‰©æµè¿½è¸ªç­‰ã€‚\n\n\nJavaæ˜¯ç›®å‰åº”ç”¨æ¯”è¾ƒå¹¿æ³›çš„å¼€å‘è¯­è¨€ä¹‹ä¸€ï¼Œå®ƒä¸ä»…å¯ä»¥åœ¨ä¼ ç»Ÿçš„è½¯ä»¶å¼€å‘é¢†åŸŸä¸­å‘æŒ¥é‡è¦ä½œç”¨ï¼ŒåŒæ—¶è¿˜èƒ½åœ¨ç‰©è”ç½‘é¢†åŸŸä¸­æœ‰æ‰€ä½œä¸ºã€‚Javaæ‰€æä¾›çš„å¤šæ ·åŒ–çš„æŠ€æœ¯å¯ä»¥å®ç°ç‰©è”ç½‘æŠ€æœ¯çš„å…¨é¢åº”ç”¨ä¸å‘å±•ã€‚\n\n\nä¾‹å¦‚ï¼Œåœ¨ç‰©è”ç½‘åº”ç”¨é¢†åŸŸä¸­ï¼ŒJava EEæŠ€æœ¯å¯ä»¥ä¸ºä¼ æ„Ÿå™¨å’Œè®¾å¤‡çš„æ•°æ®ä¼ è¾“ã€å¤„ç†ã€å­˜å‚¨åŠåº”ç”¨æä¾›æœåŠ¡å™¨ç«¯çš„æ”¯æŒï¼Œä»¥ä¿è¯ç‰©è”ç½‘ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ•ˆç‡ã€‚Java MEæŠ€æœ¯åˆ™å¯ä»¥ä¸“é—¨é’ˆå¯¹åµŒå…¥å¼è®¾å¤‡è¿›è¡Œä¼˜åŒ–ï¼Œå°¤å…¶åœ¨è½»é‡çº§è®¾å¤‡é¢†åŸŸä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚è€ŒJava SEæŠ€æœ¯åˆ™å¯ä»¥ç”¨äºç‰©è”ç½‘é¢†åŸŸä¸­çš„é€šä¿¡ç®¡ç†ï¼Œä½¿å¾—æ•°æ®çš„ä¼ è¾“å˜å¾—æ›´ä¸ºå®‰å…¨ä¸é«˜æ•ˆã€‚\n\n\nåŒæ—¶ï¼ŒJavaè¿˜å¯ä»¥é€šè¿‡å®¹å™¨åŒ–éƒ¨ç½²ã€æœåŠ¡æ²»ç†ç­‰æŠ€æœ¯æ¥ä¸ºç‰©è”ç½‘æä¾›æ›´å®Œå–„çš„æ”¯æŒã€‚å®¹å™¨åŒ–éƒ¨ç½²å¯ä»¥å°†ç‰©è”ç½‘ç³»ç»Ÿè¿›è¡Œæ¨¡å—åŒ–å¤„ç†ï¼Œä»è€Œä¿è¯ç³»ç»Ÿçš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚è€ŒæœåŠ¡æ²»ç†åˆ™å¯ä»¥ä¸ºç‰©è”ç½‘ç³»ç»Ÿæä¾›æ›´åŠ è§„èŒƒåŒ–çš„æœåŠ¡ç®¡ç†ï¼Œä»è€Œèƒ½å¤Ÿæ›´å¥½åœ°ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚\n\n\næ¥å…¥ç¬¬ä¸‰æ–¹äº‘å¹³å°ï¼Œå¦‚AWSã€Azureç­‰ï¼Œåˆ™å¯ä»¥è®©Javaæ›´å¥½åœ°å®ç°ç‰©è”ç½‘ä¸­çš„äº‘ç«¯è®¡ç®—ã€æ•°æ®å­˜å‚¨å’Œåˆ†æç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜èƒ½å¤Ÿæä¾›æ›´åŠ é«˜æ•ˆå’Œå¯é çš„æœåŠ¡ã€‚åŒæ—¶ï¼ŒJavaçš„å¤šçº¿ç¨‹æŠ€æœ¯ä¹Ÿå¯ä»¥å®ç°ç‰©è”ç½‘ä¸­çš„å³æ—¶é€šä¿¡å’Œå®æ—¶æ•°æ®ä¼ è¾“ï¼Œä»è€Œèƒ½å¤Ÿæ›´åŠ å¿«é€Ÿåœ°è¿›è¡Œæ•°æ®åŒæ­¥å’Œå¤„ç†ã€‚\n\n\næ€»ä¹‹ï¼ŒJavaä¸­ä¼—å¤šçš„æŠ€æœ¯å¯ä»¥ä½¿ç‰©è”ç½‘ç³»ç»Ÿæ›´åŠ æ™ºèƒ½åŒ–ã€é«˜æ•ˆåŒ–ã€å¯æ‰©å±•ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å®ç°æ›´å¥½çš„æ•°æ®ç®¡ç†ã€å­˜å‚¨å’Œåˆ†æç­‰åŠŸèƒ½ã€‚å› æ­¤ï¼ŒJavaåœ¨ç‰©è”ç½‘é¢†åŸŸä¸­å…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯å’Œå‘å±•ç©ºé—´ã€‚\n\n\nJavaåœ¨iotä¸­æŠ€æœ¯ä¸­å¸¸ç”¨MQTTåè®®è¿›è¡Œäº¤äº’ï¼Œé™¤äº†MQTTä¹‹å¤–ï¼ŒJavaåœ¨IoTä¸­è¿˜æœ‰è®¸å¤šå…¶ä»–çŸ¥åçš„æŠ€æœ¯æ ˆå’Œæ¡†æ¶ã€‚å…¶ä¸­ä¸€ä¸ªé‡è¦çš„æŠ€æœ¯æ˜¯CoAPï¼ˆConstrained Application Protocolï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§è½»é‡çº§çš„Webåè®®ï¼Œç”¨äºå°†èµ„æºæš´éœ²ç»™IoTè®¾å¤‡ï¼Œå¹¶ä¸”å¯ä»¥è´Ÿè´£è®¾å¤‡çš„å‘ç°å’Œç®¡ç†ã€‚æ­¤å¤–ï¼ŒJavaè¿˜æœ‰å¾ˆå¤šåŸºäºRESTfulæ¶æ„çš„æ¡†æ¶ï¼Œå¦‚Jerseyå’ŒSpringï¼Œå¯ä»¥ç”¨äºå¿«é€Ÿæ„å»ºå¯æ‰©å±•çš„Webåº”ç”¨ç¨‹åºï¼ŒåŒæ—¶æä¾›ä¸IoTè®¾å¤‡äº¤äº’çš„APIã€‚è¿˜æœ‰ä¸€ä¸ªåä¸ºApache Camelçš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç§ç”¨äºæ•°æ®ä¼ è¾“å’Œè½¬æ¢çš„è§„åˆ™å¼•æ“ï¼Œå¯ä»¥å¾ˆå¥½åœ°ç”¨äºIoTè®¾å¤‡ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’å’Œæ•°æ®äº¤æ¢ã€‚æ€»ä¹‹ï¼ŒJavaåœ¨IoTä¸­æŠ€æœ¯æ ˆéå¸¸ä¸°å¯Œï¼ŒåŒ…æ‹¬ä¸åŒçš„æ¡†æ¶å’Œåè®®ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºæœ€é€‚åˆä»–ä»¬éœ€æ±‚çš„åº”ç”¨ç¨‹åºã€‚\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-27",
        "type": "Post",
        "category": "å­¦ä¹ æ€è€ƒ",
        "urlname": "iot-prospect-for-java",
        "catalog": [
          "archives"
        ],
        "tags": [
          "æ€è€ƒ",
          "ç‰©è”ç½‘"
        ],
        "summary": "ç‰©è”ç½‘çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚æ™ºèƒ½å®¶å±…ã€æ™ºæ…§åŸå¸‚ã€æ™ºèƒ½åŒ»ç–—ã€æ™ºèƒ½åˆ¶é€ ç­‰ã€‚æ™ºèƒ½å®¶å±…å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°å®¶ç”µä¹‹é—´çš„äº’è”äº’é€šï¼Œä¾‹å¦‚æ™ºèƒ½é—¨é”ã€æ™ºèƒ½éŸ³å“ã€æ™ºèƒ½å®¶ç”µç­‰ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹æœºAPPæˆ–è€…è¯­éŸ³æ§åˆ¶å®Œæˆå¯¹å®¶ä¸­è®¾å¤‡çš„æ“ä½œã€‚æ™ºæ…§åŸå¸‚å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°åŸå¸‚åŸºç¡€è®¾æ–½ä¹‹é—´çš„äº’è”äº’é€šå’Œæ•°æ®å…±äº«ï¼Œä¾‹å¦‚æ™ºèƒ½äº¤é€šã€æ™ºèƒ½åœè½¦ã€æ™ºèƒ½ç…§æ˜ç­‰ï¼Œå®ç°åŸå¸‚çš„æ™ºèƒ½åŒ–ç®¡ç†å’Œä¼˜åŒ–ã€‚æ™ºèƒ½åŒ»ç–—å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°åŒ»ç–—è®¾å¤‡ä¹‹é—´çš„äº’è”äº’é€šå’Œæ•°æ®å…±äº«ï¼Œä¾‹å¦‚æ™ºèƒ½å¥åº·ç›‘æµ‹è®¾å¤‡ã€æ™ºèƒ½æ‰‹ç¯ã€æ™ºèƒ½åº·å¤ä»ªç­‰ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æé«˜åŒ»ç–—è®¾å¤‡çš„ä½¿ç”¨æ•ˆç‡å’ŒåŒ»ç–—æœåŠ¡çš„è´¨é‡ã€‚æ™ºèƒ½åˆ¶é€ å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°å·¥ä¸šè®¾å¤‡ä¹‹é—´çš„äº’è”äº’é€šå’Œæ•°æ®å…±äº«ï¼Œä¾‹å¦‚æ™ºèƒ½æœºåºŠã€æ™ºèƒ½ç‰©æµã€æ™ºèƒ½è´¨æ£€ç­‰ï¼Œå¯ä»¥æé«˜ç”Ÿäº§çº¿çš„è‡ªåŠ¨åŒ–ç¨‹åº¦å’Œç”Ÿäº§æ•ˆç‡ã€‚",
        "sort": "",
        "title": "ç‰©è”ç½‘å‘å±•åŠå‰æ™¯å¦‚ä½•ï¼Ÿç‰©è”ç½‘å¼€å‘æœ‰å“ªäº›æ¿å—ï¼Ÿjava å¦‚ä½•é©±åŠ¨ä¸‡ç‰©äº’è”ï¼Ÿ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "e454567c-abfe-4f35-9826-05e8eff97c1f"
        }
      ],
      "body": "",
      "realName": "ç‰©è”ç½‘å‘å±•åŠå‰æ™¯å¦‚ä½•ï¼Ÿç‰©è”ç½‘å¼€å‘æœ‰å“ªäº›æ¿å—ï¼Ÿjava å¦‚ä½•é©±åŠ¨ä¸‡ç‰©äº’è”ï¼Ÿ",
      "relativePath": "/archives/ç‰©è”ç½‘å‘å±•åŠå‰æ™¯å¦‚ä½•ï¼Ÿç‰©è”ç½‘å¼€å‘æœ‰å“ªäº›æ¿å—ï¼Ÿjava å¦‚ä½•é©±åŠ¨ä¸‡ç‰©äº’è”ï¼Ÿ.md"
    },
    {
      "id": "4f23b21c-584b-4922-a7dc-1fa3e68e609f",
      "doc_id": "4f23b21c-584b-4922-a7dc-1fa3e68e609f",
      "title": "4f23b21c-584b-4922-a7dc-1fa3e68e609f",
      "updated": 1696747320000,
      "body_original": "\nAI æŠ€æœ¯çš„è¿…é€Ÿå‘å±•å’Œæ™®åŠï¼Œä¸ºäººç±»çš„ç”Ÿæ´»å¸¦æ¥äº†å¾ˆå¤šä¾¿åˆ©ã€‚åœ¨å†™ä½œé¢†åŸŸï¼Œä¹Ÿå‡ºç°äº†ä¸å°‘åŸºäºäººå·¥æ™ºèƒ½æŠ€æœ¯çš„å†™ä½œå·¥å…·ã€‚å…¶ä¸­æœ€è¿‘æ¨å‡ºçš„ä¸€æ¬¾åŸºäºchatGPTæŠ€æœ¯çš„å†™ä½œç¥å™¨Writelyï¼Œå¼•èµ·äº†å¹¿æ³›å…³æ³¨ã€‚\n\n\nWritelyå¯ä»¥è¯´æ˜¯ä¸€æ¬¾éå¸¸ä¼˜ç§€çš„å†™ä½œå·¥å…·ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ–‡ç« å†…å®¹ï¼Œå¹¶è¿›è¡Œè¯­æ³•çº é”™ã€‚è€Œä¸”ï¼Œå®ƒæä¾›çš„å¤šç§æ¨¡æ¿å’Œä¸»é¢˜ï¼Œä½¿å¾—å†™ä½œæ›´åŠ é«˜æ•ˆå®ç”¨ã€‚\n\n\nè¿™æ¬¾å·¥å…·çš„ä¼˜åŠ¿ä¸ä»…ä»…åœ¨äºè‡ªåŠ¨ç”Ÿæˆæ–‡ç« å†…å®¹ï¼Œè€Œä¸”åœ¨äºç”Ÿæˆçš„å†…å®¹è´¨é‡éå¸¸é«˜ã€‚å®ƒå¯ä»¥æ ¹æ®ä½ çš„å†™ä½œç›®çš„å’Œæ–‡ç« ç±»å‹ï¼Œå»è‡ªåŠ¨åŒ¹é…é€‚åˆçš„æ¨¡æ¿å’Œä¸»é¢˜ï¼Œä»è€Œä¸ºä½ æä¾›æ›´åŠ å…·æœ‰é’ˆå¯¹æ€§çš„æ–‡ç« å†…å®¹ã€‚åŒæ—¶ï¼Œè¿™æ¬¾å·¥å…·è¿˜å¯ä»¥è¿›è¡Œè¯­æ³•çº é”™ï¼Œå¹¶æä¾›ä¼˜åŒ–å»ºè®®ï¼Œä½¿æ–‡ç« çš„è¡¨è¾¾æ›´åŠ å‡†ç¡®æ¸…æ™°ã€‚\n\n\nWritelyçš„é—®ä¸–ï¼Œæ—¢æ˜¯æŠ€æœ¯çš„ä¸€æ¬¡å‡çº§ï¼Œä¹Ÿæ˜¯å†™ä½œå·¥å…·åˆ›æ–°çš„ä¸€æ¬¡å°è¯•ã€‚å®ƒä¸ºåˆå­¦è€…å’Œä¸“ä¸šå†™ä½œè€…éƒ½æä¾›äº†ä¸€ç§å…¨æ–°çš„å†™ä½œæ–¹å¼ï¼Œä½¿å¾—å†™ä½œå˜å¾—æ›´åŠ è½»æ¾é«˜æ•ˆã€‚å°¤å…¶æ˜¯å¯¹äºä¸€äº›éœ€è¦å¤§é‡å†™ä½œçš„èŒä¸šäººå£«ï¼Œä½¿ç”¨Writelyå·¥å…·å¯ä»¥å¤§å¤§æé«˜æ•ˆç‡ï¼Œé™ä½å·¥ä½œé‡ã€‚\n\n\né™¤äº†å¯¹å†™ä½œé¢†åŸŸçš„å½±å“å¤–ï¼ŒWritelyä¹Ÿé¢„ç¤ºç€æœªæ¥AIæŠ€æœ¯å°†åœ¨æ›´å¤šé¢†åŸŸæœ‰æ‰€åº”ç”¨ã€‚å¯ä»¥é¢„è§ï¼Œåœ¨æœªæ¥ï¼Œäººå·¥æ™ºèƒ½å°†è¶Šæ¥è¶Šå¤šåœ°æ¸—é€åˆ°æˆ‘ä»¬çš„ç”Ÿæ´»å’Œå·¥ä½œä¸­ï¼Œä¸ºæˆ‘ä»¬å¸¦æ¥æ›´å¤šä¾¿åˆ©å’Œå¯èƒ½æ€§ã€‚\n\n\næ€»ä¹‹ï¼ŒWritelyæ˜¯ä¸€æ¬¾éå¸¸ä¼˜ç§€çš„åŸºäºchatGPTæŠ€æœ¯çš„å†™ä½œå·¥å…·ï¼Œå®ƒä¸ºå†™ä½œäººå£«æä¾›äº†ä¸€ç§å…¨æ–°çš„å†™ä½œæ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿé¢„ç¤ºç€æœªæ¥AIæŠ€æœ¯çš„ä¸æ–­å‘å±•å’Œæ™®åŠã€‚\n\n\n> ğŸ’¡ ä»¥ä¸Šå†…å®¹ä½¿ç”¨ï¼šWritelyè‡ªåŠ¨ç”Ÿæˆ\n\n\n## ç‰¹æ€§\n\n\n1.ğŸ”¥Â åŸºäº Open AI GPT æ¨¡å‹ï¼Œå¸¦æ¥äº†å…¨æ–°çš„æ™ºèƒ½å†™ä½œä½“éªŒã€‚\n\n\n2.âœï¸Â æ”¯æŒåœ¨äº’è”ç½‘ä¸Šçš„ä»»ä½•ç¼–è¾‘å™¨ç½‘é¡µä¸Šè¿›è¡Œå†™ä½œè¾…åŠ©ï¼Œæœ‰æ•ˆæé«˜ç”¨æˆ·çš„å†™ä½œæ•ˆç‡å’Œè´¨é‡ã€‚\n\n\n3.ğŸ“–Â è¯¥äº§å“å¯ä»¥æ‰§è¡ŒæŸ¥è¯¢ç¿»è¯‘å’Œé˜…è¯»è¾…åŠ©åŠŸèƒ½ï¼Œå¤§å¤§å‡å°‘ç”¨æˆ·çš„é˜…è¯»æ—¶é—´å¹¶æé«˜ç†è§£èƒ½åŠ›ã€‚\n\n\n## ä½¿ç”¨æ–¹æ³•\n\n\n### å®‰è£…\n\n\nChrome æ’ä»¶ï¼š[](https://chrome.google.com/webstore/detail/writely/eocenplmfgoaibmmohkhhocnlkpaecgn)\n\n\n![](https://camo.githubusercontent.com/8a0f1cbc977222a795118f3a124cc31fbadb75ba71c444ae8c9851e98e436d0f/68747470733a2f2f696d672e736869656c64732e696f2f6368726f6d652d7765622d73746f72652f762f656f63656e706c6d66676f6169626d6d6f686b68686f636e6c6b70616563676e)\n\n\nFirefox æ‰©å±•ï¼š\n\n\n![](https://camo.githubusercontent.com/267163d02f6bd288e0175f2c81f50e8f015f9f982ea1cf8b19d25419ded08dac/68747470733a2f2f696d672e736869656c64732e696f2f616d6f2f762f77726974656c79)\n\n\n### é…ç½®\n\n1. è·å– Open AI API Keyã€‚ å¦‚æœæ‚¨æ²¡æœ‰ï¼Œè¯·åœ¨Â [https://platform.openai.com/account/api-keys](https://platform.openai.com/account/api-keys)Â ä¸Šè¿›è¡Œç”³è¯·ã€‚\n2. å•å‡»æ’ä»¶å›¾æ ‡ï¼Œç„¶åå•å‡»â€œè®¾ç½®â€å›¾æ ‡ã€‚\n\n![](https://user-images.githubusercontent.com/13167934/223933756-b001d01a-899c-42e5-be14-753357a1bba5.png)\n\n1. è¿›è¡Œé…ç½®ã€‚\n\n![](https://user-images.githubusercontent.com/13167934/224465348-f2e0aaf8-ce7b-48d2-9637-be2a205f317f.png)\n\n1. å°†é¼ æ ‡æ»‘åŠ¨åˆ°ä»»ä½•ç½‘é¡µä¸Šçš„å•è¯ä¸Šï¼Œä¸€ä¸ªâ€œWâ€å›¾æ ‡å°†å‡ºç°åœ¨é¼ æ ‡é™„è¿‘ï¼Œå•å‡»ä»¥ä½¿ç”¨ã€‚\n\n![](https://user-images.githubusercontent.com/13167934/224236822-eb1cc963-77e5-4820-aa6d-63088989c0cf.gif)\n\n\nGitHubåœ°å€ : \n\n\n[bookmark](https://github.com/listener-He/writely)\n\n\nåŸä½œè€…å¼€æºåœ°å€ï¼š\n\n\n[bookmark](https://github.com/anc95/writely)\n\n\n## å¦‚æµè§ˆå™¨æŸ¥è¯¢æ— æ³•å®‰è£…ä»è¿™ä¸‹è½½\n\n\n[è°·æ­Œæµè§ˆå™¨æ’ä»¶ä¸‹è½½åœ°å€](https://ghproxy.com/https://github.com/anc95/writely/releases/download/v0.0.16/writely-chrome-0.0.16.zip)\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-24T00:00:00.000+08:00",
        "type": "Post",
        "category": "åˆ›ä½œåˆ†äº«",
        "urlname": "notion-ai-writely",
        "catalog": [
          "archives"
        ],
        "tags": [
          "æ–‡å­—",
          "å·¥å…·",
          "chatgpt",
          "notion"
        ],
        "summary": "ä½œä¸ºNiotionAiçš„é‡åº¦ä¾èµ–è€…ï¼Œæœ€è¿‘è§‚å¯Ÿåˆ°ä¸€ä¸ªæ¯”NotionAIæ›´å¼ºå¤§è€Œä¸”è¿˜å…è´¹çš„æ’ä»¶ã€‚ä¸€æ¬¾åŸºäºchatGPTæŠ€æœ¯çš„å†™ä½œç¥å™¨Writelyã€‚å€ŸåŠ©è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ï¼ŒWritelyå¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€æ¨èå†…å®¹ï¼Œå¹¶è¿›è¡Œè¯­æ³•çº é”™ä¼˜åŒ–ã€‚åŒæ—¶æä¾›å¤šç§æ¨¡æ¿å’Œä¸»é¢˜ï¼Œè®©å†™ä½œæ›´åŠ é«˜æ•ˆå®ç”¨ã€‚è¯¥å·¥å…·é€‚åˆåˆå­¦è€…å’Œä¸“ä¸šå†™ä½œè€…ä½¿ç”¨",
        "sort": "",
        "title": "Notion AIå¹³æ›¿ Writely åŸºäºchatGPTå…è´¹å®ç°çš„å†™ä½œç¥å™¨",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "4f23b21c-584b-4922-a7dc-1fa3e68e609f"
        }
      ],
      "body": "",
      "realName": "Notion AIå¹³æ›¿ Writely åŸºäºchatGPTå…è´¹å®ç°çš„å†™ä½œç¥å™¨",
      "relativePath": "/archives/Notion AIå¹³æ›¿ Writely åŸºäºchatGPTå…è´¹å®ç°çš„å†™ä½œç¥å™¨.md"
    },
    {
      "id": "921e862a-78e5-4248-97a1-0fc04c2c558b",
      "doc_id": "921e862a-78e5-4248-97a1-0fc04c2c558b",
      "title": "921e862a-78e5-4248-97a1-0fc04c2c558b",
      "updated": 1696747320000,
      "body_original": "\n## Stringå¯¹è±¡\n\n\n### å¸¸é‡æ± \n\n\n**String å¯¹è±¡çš„ä¸¤ç§åˆ›å»ºæ–¹å¼ï¼š**\n\n\n```java\nString str1 = \"abcd\";//å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æœ‰æ²¡æœ‰\"abcd\"ï¼Œå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªï¼Œç„¶å str1 æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥å°† str1 æŒ‡å‘\"abcd\"\"ï¼›\nString str2 = new String(\"abcd\");//å †ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡\nString str3 = new String(\"abcd\");//å †ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡\nSystem.out.println(str1==str2);//false\nSystem.out.println(str2==str3);//falseCopy to clipboardErrorCopied\n\n```\n\n\nè¿™ä¸¤ç§ä¸åŒçš„åˆ›å»ºæ–¹æ³•æ˜¯æœ‰å·®åˆ«çš„ã€‚\n\n- ç¬¬ä¸€ç§æ–¹å¼æ˜¯åœ¨å¸¸é‡æ± ä¸­æ‹¿å¯¹è±¡ï¼›\n- ç¬¬äºŒç§æ–¹å¼æ˜¯ç›´æ¥åœ¨å †å†…å­˜ç©ºé—´åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚\n\nè®°ä½ä¸€ç‚¹ï¼š**åªè¦ä½¿ç”¨ new æ–¹æ³•ï¼Œä¾¿éœ€è¦åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚**\n\n\nå†ç»™å¤§å®¶ä¸€ä¸ªå›¾åº”è¯¥æ›´å®¹æ˜“ç†è§£ï¼Œå›¾ç‰‡æ¥æºï¼š[https://www.journaldev.com/797/what-is-java-string-poolï¼š](https://www.journaldev.com/797/what-is-java-string-pool%EF%BC%9A)\n\n\n![](https://blog-file.hehouhui.cn/202203222203380.png)\n\n\n**String ç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼š**\n\n- ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„ String å¯¹è±¡ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚\n- å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„ String å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ String æä¾›çš„ intern æ–¹æ³•ã€‚String.intern() æ˜¯ä¸€ä¸ª Native æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šå¦‚æœè¿è¡Œæ—¶å¸¸é‡æ± ä¸­å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤ String å¯¹è±¡å†…å®¹çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›å¸¸é‡æ± ä¸­è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›å¦‚æœæ²¡æœ‰ï¼ŒJDK1.7ä¹‹å‰ï¼ˆä¸åŒ…å«1.7ï¼‰çš„å¤„ç†æ–¹å¼æ˜¯åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸æ­¤ String å†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›å¸¸é‡æ± ä¸­åˆ›å»ºçš„å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼ŒJDK1.7ä»¥åŠä¹‹åçš„å¤„ç†æ–¹å¼æ˜¯åœ¨å¸¸é‡æ± ä¸­è®°å½•æ­¤å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼Œå¹¶è¿”å›è¯¥å¼•ç”¨ã€‚\n\n```java\n          String s1 = new String(\"è®¡ç®—æœº\");\n          String s2 = s1.intern();\n          String s3 = \"è®¡ç®—æœº\";\n          System.out.println(s2);//è®¡ç®—æœº\n          System.out.println(s1 == s2);//falseï¼Œå› ä¸ºä¸€ä¸ªæ˜¯å †å†…å­˜ä¸­çš„ String å¯¹è±¡ä¸€ä¸ªæ˜¯å¸¸é‡æ± ä¸­çš„ String å¯¹è±¡ï¼Œ\n          System.out.println(s3 == s2);//trueï¼Œå› ä¸ºä¸¤ä¸ªéƒ½æ˜¯å¸¸é‡æ± ä¸­çš„ String å¯¹è±¡Copy to clipboardErrorCopied\n\n```\n\n\n**å­—ç¬¦ä¸²æ‹¼æ¥:**\n\n\n```java\n          String str1 = \"str\";\n          String str2 = \"ing\";\n\n          String str3 = \"str\" + \"ing\";//å¸¸é‡æ± ä¸­çš„å¯¹è±¡\n          String str4 = str1 + str2; //åœ¨å †ä¸Šåˆ›å»ºçš„æ–°çš„å¯¹è±¡\n          String str5 = \"string\";//å¸¸é‡æ± ä¸­çš„å¯¹è±¡\n          System.out.println(str3 == str4);//false\n          System.out.println(str3 == str5);//true\n          System.out.println(str4 == str5);//falseCopy to clipboardErrorCopied\n\n```\n\n\n![](https://blog-file.hehouhui.cn/202203222203646.png)\n\n\nå°½é‡é¿å…å¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå› ä¸ºè¿™æ ·ä¼šé‡æ–°åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœéœ€è¦æ”¹å˜å­—ç¬¦ä¸²çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ StringBuilder æˆ–è€… StringBufferã€‚\n\n\n### new String(\"test\"); åˆ›å»ºå‡ ä¸ªå¯¹è±¡?\n\n\n**. å°†åˆ›å»º 1 æˆ– 2 ä¸ªå­—ç¬¦ä¸²ã€‚å¦‚æœæ± ä¸­å·²å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡â€œabcâ€ï¼Œåˆ™åªä¼šåœ¨å †ç©ºé—´åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡â€œabcâ€ã€‚å¦‚æœæ± ä¸­æ²¡æœ‰å­—ç¬¦ä¸²å¸¸é‡â€œabcâ€ï¼Œé‚£ä¹ˆå®ƒå°†é¦–å…ˆåœ¨æ± ä¸­åˆ›å»ºï¼Œç„¶ååœ¨å †ç©ºé—´ä¸­åˆ›å»ºï¼Œå› æ­¤å°†åˆ›å»ºæ€»å…± 2 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚**\n\n\n**éªŒè¯ï¼š**\n\n\n```java\n        String s1 = new String(\"abc\");// å †å†…å­˜çš„åœ°å€å€¼\n        String s2 = \"abc\";\n        System.out.println(s1 == s2);// è¾“å‡º false,å› ä¸ºä¸€ä¸ªæ˜¯å †å†…å­˜ï¼Œä¸€ä¸ªæ˜¯å¸¸é‡æ± çš„å†…å­˜ï¼Œæ•…ä¸¤è€…æ˜¯ä¸åŒçš„ã€‚\n        System.out.println(s1.equals(s2));// è¾“å‡º trueCopy to clipboardErrorCopied\n\n```\n\n\n**ç»“æœï¼š**\n\n\n```text\nfalse\ntrue\n\n```\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-01-22",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "45",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java"
        ],
        "summary": "Stringå¯¹è±¡å¸¸é‡æ± String å¯¹è±¡çš„ä¸¤ç§åˆ›å»ºæ–¹å¼ï¼šString str1 = \"abcd\";//å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æœ‰æ²¡æœ‰\"abcd\"ï¼Œå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­",
        "sort": "",
        "title": "JavaåŸºç¡€-String",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "921e862a-78e5-4248-97a1-0fc04c2c558b"
        }
      ],
      "body": "",
      "realName": "JavaåŸºç¡€-String",
      "relativePath": "/archives/JavaåŸºç¡€-String.md"
    },
    {
      "id": "f9af0c25-a672-4cac-bc8e-43bb190216fb",
      "doc_id": "f9af0c25-a672-4cac-bc8e-43bb190216fb",
      "title": "f9af0c25-a672-4cac-bc8e-43bb190216fb",
      "updated": 1696747320000,
      "body_original": "\n## å¯¹è±¡ï¼Œç±»\n\n\n### ç±»åŠ è½½\n\n\nä¸€ä¸ªç±»çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼š\n\n\n![](https://blog-file.hehouhui.cn/202203222121164.png)\n\n\nClass æ–‡ä»¶éœ€è¦åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ä¹‹åæ‰èƒ½è¿è¡Œå’Œä½¿ç”¨ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºæ˜¯å¦‚ä½•åŠ è½½è¿™äº› Class æ–‡ä»¶å‘¢ï¼Ÿ\n\n\nç³»ç»ŸåŠ è½½ Class ç±»å‹çš„æ–‡ä»¶ä¸»è¦ä¸‰æ­¥:**åŠ è½½->è¿æ¥->åˆå§‹åŒ–**ã€‚è¿æ¥è¿‡ç¨‹åˆå¯åˆ†ä¸ºä¸‰æ­¥:**éªŒè¯->å‡†å¤‡->è§£æ**ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203871.png)\n\n\n### åŠ è½½\n\n\nç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œä¸»è¦å®Œæˆä¸‹é¢3ä»¶äº‹æƒ…ï¼š\n\n1. é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ\n2. å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„\n3. åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡,ä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£\n\nè™šæ‹Ÿæœºè§„èŒƒä¸Šé¢è¿™3ç‚¹å¹¶ä¸å…·ä½“ï¼Œå› æ­¤æ˜¯éå¸¸çµæ´»çš„ã€‚æ¯”å¦‚ï¼š\"é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ\" å¹¶æ²¡æœ‰æŒ‡æ˜å…·ä½“ä»å“ªé‡Œè·å–ã€æ€æ ·è·å–ã€‚æ¯”å¦‚ï¼šæ¯”è¾ƒå¸¸è§çš„å°±æ˜¯ä» ZIP åŒ…ä¸­è¯»å–ï¼ˆæ—¥åå‡ºç°çš„JARã€EARã€WARæ ¼å¼çš„åŸºç¡€ï¼‰ã€å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼ˆå…¸å‹åº”ç”¨å°±æ˜¯JSPï¼‰ç­‰ç­‰ã€‚\n\n\n**ä¸€ä¸ªéæ•°ç»„ç±»çš„åŠ è½½é˜¶æ®µï¼ˆåŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬å¯ä»¥å»å®Œæˆè¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»æ§åˆ¶å­—èŠ‚æµçš„è·å–æ–¹å¼ï¼ˆé‡å†™ä¸€ä¸ªç±»åŠ è½½å™¨çš„** **`loadClass()`** **æ–¹æ³•ï¼‰ã€‚æ•°ç»„ç±»å‹ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºï¼Œå®ƒç”± Java è™šæ‹Ÿæœºç›´æ¥åˆ›å»ºã€‚**\n\n\nç±»åŠ è½½å™¨ã€åŒäº²å§”æ´¾æ¨¡å‹ä¹Ÿæ˜¯éå¸¸é‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œè¿™éƒ¨åˆ†å†…å®¹ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­å•ç‹¬ä»‹ç»åˆ°ã€‚\n\n\nåŠ è½½é˜¶æ®µå’Œè¿æ¥é˜¶æ®µçš„éƒ¨åˆ†å†…å®¹æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªç»“æŸï¼Œè¿æ¥é˜¶æ®µå¯èƒ½å°±å·²ç»å¼€å§‹äº†ã€‚\n\n\n### éªŒè¯\n\n\n![](https://blog-file.hehouhui.cn/202203222203084.png)\n\n\n### å‡†å¤‡\n\n\n**å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µ**ï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ã€‚å¯¹äºè¯¥é˜¶æ®µæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š\n\n1. è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆstaticï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨ Java å †ä¸­ã€‚\n2. è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼\"é€šå¸¸æƒ…å†µ\"ä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆå¦‚0ã€0Lã€nullã€falseç­‰ï¼‰ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†`public static int value=111` ï¼Œé‚£ä¹ˆ value å˜é‡åœ¨å‡†å¤‡é˜¶æ®µçš„åˆå§‹å€¼å°±æ˜¯ 0 è€Œä¸æ˜¯111ï¼ˆåˆå§‹åŒ–é˜¶æ®µæ‰ä¼šèµ‹å€¼ï¼‰ã€‚ç‰¹æ®Šæƒ…å†µï¼šæ¯”å¦‚ç»™ value å˜é‡åŠ ä¸Šäº† fianl å…³é”®å­—`public static final int value=111` ï¼Œé‚£ä¹ˆå‡†å¤‡é˜¶æ®µ value çš„å€¼å°±è¢«èµ‹å€¼ä¸º 111ã€‚\n\n**åŸºæœ¬æ•°æ®ç±»å‹çš„é›¶å€¼ï¼š**\n\n\n![](https://blog-file.hehouhui.cn/202203222203304.png)\n\n\n### è§£æ\n\n\nè§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚\n\n\nç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚**ç›´æ¥å¼•ç”¨**å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚åœ¨ç¨‹åºå®é™…è¿è¡Œæ—¶ï¼Œåªæœ‰ç¬¦å·å¼•ç”¨æ˜¯ä¸å¤Ÿçš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼šåœ¨ç¨‹åºæ‰§è¡Œæ–¹æ³•æ—¶ï¼Œç³»ç»Ÿéœ€è¦æ˜ç¡®çŸ¥é“è¿™ä¸ªæ–¹æ³•æ‰€åœ¨çš„ä½ç½®ã€‚Java è™šæ‹Ÿæœºä¸ºæ¯ä¸ªç±»éƒ½å‡†å¤‡äº†ä¸€å¼ æ–¹æ³•è¡¨æ¥å­˜æ”¾ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ã€‚å½“éœ€è¦è°ƒç”¨ä¸€ä¸ªç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œåªè¦çŸ¥é“è¿™ä¸ªæ–¹æ³•åœ¨æ–¹å‘è¡¨ä¸­çš„åç§»é‡å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•äº†ã€‚é€šè¿‡è§£ææ“ä½œç¬¦å·å¼•ç”¨å°±å¯ä»¥ç›´æ¥è½¬å˜ä¸ºç›®æ ‡æ–¹æ³•åœ¨ç±»ä¸­æ–¹æ³•è¡¨çš„ä½ç½®ï¼Œä»è€Œä½¿å¾—æ–¹æ³•å¯ä»¥è¢«è°ƒç”¨ã€‚\n\n\nç»¼ä¸Šï¼Œè§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°ç±»æˆ–è€…å­—æ®µã€æ–¹æ³•åœ¨å†…å­˜ä¸­çš„æŒ‡é’ˆæˆ–è€…åç§»é‡ã€‚\n\n\n### åˆå§‹åŒ–\n\n\nåˆå§‹åŒ–æ˜¯ç±»åŠ è½½çš„æœ€åä¸€æ­¥ï¼Œä¹Ÿæ˜¯çœŸæ­£æ‰§è¡Œç±»ä¸­å®šä¹‰çš„ Java ç¨‹åºä»£ç (å­—èŠ‚ç )ï¼Œåˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•  `()`æ–¹æ³•çš„è¿‡ç¨‹ã€‚\n\n\nå¯¹äº`ï¼ˆï¼‰` æ–¹æ³•çš„è°ƒç”¨ï¼Œè™šæ‹Ÿæœºä¼šè‡ªå·±ç¡®ä¿å…¶åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å®‰å…¨æ€§ã€‚å› ä¸º `ï¼ˆï¼‰` æ–¹æ³•æ˜¯å¸¦é”çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡Œç±»åˆå§‹åŒ–çš„è¯å¯èƒ½ä¼šå¼•èµ·æ­»é”ï¼Œå¹¶ä¸”è¿™ç§æ­»é”å¾ˆéš¾è¢«å‘ç°ã€‚\n\n\nå¯¹äºåˆå§‹åŒ–é˜¶æ®µï¼Œè™šæ‹Ÿæœºä¸¥æ ¼è§„èŒƒäº†æœ‰ä¸”åªæœ‰5ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–(åªæœ‰ä¸»åŠ¨å»ä½¿ç”¨ç±»æ‰ä¼šåˆå§‹åŒ–ç±»)ï¼š\n\n1. å½“é‡åˆ° new ã€ getstaticã€putstaticæˆ–invokestatic è¿™4æ¡ç›´æ¥ç æŒ‡ä»¤æ—¶ï¼Œæ¯”å¦‚ new ä¸€ä¸ªç±»ï¼Œè¯»å–ä¸€ä¸ªé™æ€å­—æ®µ(æœªè¢« final ä¿®é¥°)ã€æˆ–è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•æ—¶ã€‚\n\t- å½“jvmæ‰§è¡ŒnewæŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³å½“ç¨‹åºåˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡ã€‚\n\t- å½“jvmæ‰§è¡ŒgetstaticæŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³ç¨‹åºè®¿é—®ç±»çš„é™æ€å˜é‡(ä¸æ˜¯é™æ€å¸¸é‡ï¼Œå¸¸é‡ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± )ã€‚\n\t- å½“jvmæ‰§è¡ŒputstaticæŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³ç¨‹åºç»™ç±»çš„é™æ€å˜é‡èµ‹å€¼ã€‚\n\t- å½“jvmæ‰§è¡ŒinvokestaticæŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³ç¨‹åºè°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ã€‚\n2. ä½¿ç”¨ `java.lang.reflect` åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨æ—¶å¦‚Class.forname(\"...\"),newInstance()ç­‰ç­‰ã€‚ ï¼Œå¦‚æœç±»æ²¡åˆå§‹åŒ–ï¼Œéœ€è¦è§¦å‘å…¶åˆå§‹åŒ–ã€‚\n3. åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œå¦‚æœå…¶çˆ¶ç±»è¿˜æœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆè§¦å‘è¯¥çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚\n4. å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦å®šä¹‰ä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±» (åŒ…å« main æ–¹æ³•çš„é‚£ä¸ªç±»)ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªç±»ã€‚\n5. MethodHandleå’ŒVarHandleå¯ä»¥çœ‹ä½œæ˜¯è½»é‡çº§çš„åå°„è°ƒç”¨æœºåˆ¶ï¼Œè€Œè¦æƒ³ä½¿ç”¨è¿™2ä¸ªè°ƒç”¨ï¼Œ å°±å¿…é¡»å…ˆä½¿ç”¨findStaticVarHandleæ¥åˆå§‹åŒ–è¦è°ƒç”¨çš„ç±»ã€‚\n6. **ã€Œè¡¥å……ï¼Œæ¥è‡ª**[**issue745**](https://github.com/Snailclimb/JavaGuide/issues/745)**ã€** å½“ä¸€ä¸ªæ¥å£ä¸­å®šä¹‰äº†JDK8æ–°åŠ å…¥çš„é»˜è®¤æ–¹æ³•ï¼ˆè¢«defaultå…³é”®å­—ä¿®é¥°çš„æ¥å£æ–¹æ³•ï¼‰æ—¶ï¼Œå¦‚æœæœ‰è¿™ä¸ªæ¥å£çš„å®ç°ç±»å‘ç”Ÿäº†åˆå§‹åŒ–ï¼Œé‚£è¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚\n\n### å¸è½½\n\n\n> å¸è½½è¿™éƒ¨åˆ†å†…å®¹æ¥è‡ª issue#662ç”± guang19 è¡¥å……å®Œå–„ã€‚\n\n\nå¸è½½ç±»å³è¯¥ç±»çš„Classå¯¹è±¡è¢«GCã€‚\n\n\nå¸è½½ç±»éœ€è¦æ»¡è¶³3ä¸ªè¦æ±‚:\n\n1. è¯¥ç±»çš„æ‰€æœ‰çš„å®ä¾‹å¯¹è±¡éƒ½å·²è¢«GCï¼Œä¹Ÿå°±æ˜¯è¯´å †ä¸å­˜åœ¨è¯¥ç±»çš„å®ä¾‹å¯¹è±¡ã€‚\n2. è¯¥ç±»æ²¡æœ‰åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨\n3. è¯¥ç±»çš„ç±»åŠ è½½å™¨çš„å®ä¾‹å·²è¢«GC\n\næ‰€ä»¥ï¼Œåœ¨JVMç”Ÿå‘½å‘¨æœŸç±»ï¼Œç”±jvmè‡ªå¸¦çš„ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯ä¸ä¼šè¢«å¸è½½çš„ã€‚ä½†æ˜¯ç”±æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¯èƒ½è¢«å¸è½½çš„ã€‚\n\n\nåªè¦æƒ³é€šä¸€ç‚¹å°±å¥½äº†ï¼Œjdkè‡ªå¸¦çš„BootstrapClassLoader,ExtClassLoader,AppClassLoaderè´Ÿè´£åŠ è½½jdkæä¾›çš„ç±»ï¼Œæ‰€ä»¥å®ƒä»¬(ç±»åŠ è½½å™¨çš„å®ä¾‹)è‚¯å®šä¸ä¼šè¢«å›æ”¶ã€‚è€Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨çš„å®ä¾‹æ˜¯å¯ä»¥è¢«å›æ”¶çš„ï¼Œæ‰€ä»¥ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¯ä»¥è¢«å¸è½½æ‰çš„ã€‚\n\n\n### å¯¹è±¡çš„åˆ›å»º\n\n\nä¸‹å›¾ä¾¿æ˜¯ Java å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œæˆ‘å»ºè®®æœ€å¥½æ˜¯èƒ½é»˜å†™å‡ºæ¥ï¼Œå¹¶ä¸”è¦æŒæ¡æ¯ä¸€æ­¥åœ¨åšä»€ä¹ˆã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203447.png)\n\n\n### ç±»åŠ è½½æ£€æŸ¥\n\n\n> è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡ new æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚\n\n\n### åˆ†é…å†…å­˜\n\n\n> åœ¨ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåä¾¿å¯ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä» Java å †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚åˆ†é…æ–¹å¼æœ‰ â€œæŒ‡é’ˆç¢°æ’â€ å’Œ â€œç©ºé—²åˆ—è¡¨â€ ä¸¤ç§ï¼Œé€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”± Java å †æ˜¯å¦è§„æ•´å†³å®šï¼Œè€Œ Java å †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®šã€‚\n\n\n**å†…å­˜åˆ†é…çš„ä¸¤ç§æ–¹å¼ï¼šï¼ˆè¡¥å……å†…å®¹ï¼Œéœ€è¦æŒæ¡ï¼‰**\n\n\né€‰æ‹©ä»¥ä¸Šä¸¤ç§æ–¹å¼ä¸­çš„å“ªä¸€ç§ï¼Œå–å†³äº Java å †å†…å­˜æ˜¯å¦è§„æ•´ã€‚è€Œ Java å †å†…å­˜æ˜¯å¦è§„æ•´ï¼Œå–å†³äº GC æ”¶é›†å™¨çš„ç®—æ³•æ˜¯\"æ ‡è®°-æ¸…é™¤\"ï¼Œè¿˜æ˜¯\"æ ‡è®°-æ•´ç†\"ï¼ˆä¹Ÿç§°ä½œ\"æ ‡è®°-å‹ç¼©\"ï¼‰ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¤åˆ¶ç®—æ³•å†…å­˜ä¹Ÿæ˜¯è§„æ•´çš„\n\n\n![](https://blog-file.hehouhui.cn/202203222203619.png)\n\n\n**å†…å­˜åˆ†é…å¹¶å‘é—®é¢˜ï¼ˆè¡¥å……å†…å®¹ï¼Œéœ€è¦æŒæ¡ï¼‰**\n\n\nåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆ›å»ºå¯¹è±¡æ˜¯å¾ˆé¢‘ç¹çš„äº‹æƒ…ï¼Œä½œä¸ºè™šæ‹Ÿæœºæ¥è¯´ï¼Œå¿…é¡»è¦ä¿è¯çº¿ç¨‹æ˜¯å®‰å…¨çš„ï¼Œé€šå¸¸æ¥è®²ï¼Œè™šæ‹Ÿæœºé‡‡ç”¨ä¸¤ç§æ–¹å¼æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š\n\n- **CAS+å¤±è´¥é‡è¯•ï¼š** CAS æ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ã€‚æ‰€è°“ä¹è§‚é”å°±æ˜¯ï¼Œæ¯æ¬¡ä¸åŠ é”è€Œæ˜¯å‡è®¾æ²¡æœ‰å†²çªè€Œå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚**è™šæ‹Ÿæœºé‡‡ç”¨ CAS é…ä¸Šå¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ã€‚**\n- **TLABï¼š** ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹é¢„å…ˆåœ¨ Eden åŒºåˆ†é…ä¸€å—å„¿å†…å­˜ï¼ŒJVM åœ¨ç»™çº¿ç¨‹ä¸­çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œé¦–å…ˆåœ¨ TLAB åˆ†é…ï¼Œå½“å¯¹è±¡å¤§äº TLAB ä¸­çš„å‰©ä½™å†…å­˜æˆ– TLAB çš„å†…å­˜å·²ç”¨å°½æ—¶ï¼Œå†é‡‡ç”¨ä¸Šè¿°çš„ CAS è¿›è¡Œå†…å­˜åˆ†é…\n\n### åˆå§‹åŒ–é›¶å€¼\n\n\n> å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œè¿™ä¸€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚\n\n\n### è®¾ç½®å¯¹è±¡å¤´\n\n\n> åˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚ å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚\n\n\n### æ‰§è¡Œinitæ–¹æ³•\n\n\nåœ¨ä¸Šé¢å·¥ä½œéƒ½å®Œæˆä¹‹åï¼Œä»è™šæ‹Ÿæœºçš„è§†è§’æ¥çœ‹ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼Œä½†ä» Java ç¨‹åºçš„è§†è§’æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹ï¼Œ`æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ` æ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨äº§ç”Ÿå‡ºæ¥ã€‚\n\n\n### å¯¹è±¡çš„å†…å­˜åŒºåŸŸ\n\n\nåœ¨ Hotspot è™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º 3 å—åŒºåŸŸï¼š**å¯¹è±¡å¤´**ã€**å®ä¾‹æ•°æ®**å’Œ**å¯¹é½å¡«å……**ã€‚\n\n\n**Hotspot è™šæ‹Ÿæœºçš„å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯**ï¼Œ**ç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®**ï¼ˆå“ˆå¸Œç ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ç­‰ç­‰ï¼‰ï¼Œ**å¦ä¸€éƒ¨åˆ†æ˜¯ç±»å‹æŒ‡é’ˆ**ï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯é‚£ä¸ªç±»çš„å®ä¾‹ã€‚\n\n\n**å®ä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯**ï¼Œä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ã€‚\n\n\n**å¯¹é½å¡«å……éƒ¨åˆ†ä¸æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å«ä¹‰ï¼Œä»…ä»…èµ·å ä½ä½œç”¨ã€‚** å› ä¸º Hotspot è™šæ‹Ÿæœºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ã€‚è€Œå¯¹è±¡å¤´éƒ¨åˆ†æ­£å¥½æ˜¯ 8 å­—èŠ‚çš„å€æ•°ï¼ˆ1 å€æˆ– 2 å€ï¼‰ï¼Œå› æ­¤ï¼Œå½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½æ—¶ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚\n\n\n### å¯¹è±¡çš„è®¿é—®å®šä½\n\n\nå»ºç«‹å¯¹è±¡å°±æ˜¯ä¸ºäº†ä½¿ç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬çš„ Java ç¨‹åºé€šè¿‡æ ˆä¸Šçš„ reference æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚å¯¹è±¡çš„è®¿é—®æ–¹å¼ç”±è™šæ‹Ÿæœºå®ç°è€Œå®šï¼Œç›®å‰ä¸»æµçš„è®¿é—®æ–¹å¼æœ‰**â‘ ä½¿ç”¨å¥æŸ„**å’Œ**â‘¡ç›´æ¥æŒ‡é’ˆ**ä¸¤ç§ï¼š\n\n1. **å¥æŸ„ï¼š** å¦‚æœä½¿ç”¨å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆ Java å †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ï¼›\n\n\t![](https://blog-file.hehouhui.cn/202203222203076.png)\n\n2. **ç›´æ¥æŒ‡é’ˆï¼š** å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œé‚£ä¹ˆ Java å †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œ reference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚\n\n![](https://blog-file.hehouhui.cn/202203222155695.png)\n\n\n**è¿™ä¸¤ç§å¯¹è±¡è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ¿ã€‚ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚**\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-01-26",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "43",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java"
        ],
        "summary": "å¯¹è±¡ï¼Œç±»ç±»åŠ è½½ä¸€ä¸ªç±»çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼šClass æ–‡ä»¶éœ€è¦åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ä¹‹åæ‰èƒ½è¿è¡Œå’Œä½¿ç”¨ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºæ˜¯å¦‚ä½•åŠ è½½è¿™äº› Class æ–‡ä»¶å‘¢ï¼Ÿç³»ç»ŸåŠ è½½ Class ç±»å‹çš„æ–‡ä»¶ä¸»è¦ä¸‰æ­¥:åŠ è½½->è¿æ¥",
        "sort": "",
        "title": "JavaåŸºç¡€-class",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "f9af0c25-a672-4cac-bc8e-43bb190216fb"
        }
      ],
      "body": "",
      "realName": "JavaåŸºç¡€-class",
      "relativePath": "/archives/JavaåŸºç¡€-class.md"
    },
    {
      "id": "54c4aad1-0a7a-4a4b-9906-1f54a3810362",
      "doc_id": "54c4aad1-0a7a-4a4b-9906-1f54a3810362",
      "title": "54c4aad1-0a7a-4a4b-9906-1f54a3810362",
      "updated": 1696747320000,
      "body_original": "\n## çº¿ç¨‹\n\n\n**çº¿ç¨‹**ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€å—å†…å­˜ç©ºé—´å’Œä¸€ç»„ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚\n\n\n**ç¨‹åº**æ˜¯å«æœ‰æŒ‡ä»¤å’Œæ•°æ®çš„æ–‡ä»¶ï¼Œè¢«å­˜å‚¨åœ¨ç£ç›˜æˆ–å…¶ä»–çš„æ•°æ®å­˜å‚¨è®¾å¤‡ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ç¨‹åºæ˜¯é™æ€çš„ä»£ç ã€‚\n\n\n**è¿›ç¨‹**æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œå› æ­¤è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªæ‰§è¡Œä¸­çš„ç¨‹åºï¼Œå®ƒåœ¨è®¡ç®—æœºä¸­ä¸€ä¸ªæŒ‡ä»¤æ¥ç€ä¸€ä¸ªæŒ‡ä»¤åœ°æ‰§è¡Œç€ï¼ŒåŒæ—¶ï¼Œæ¯ä¸ªè¿›ç¨‹è¿˜å æœ‰æŸäº›ç³»ç»Ÿèµ„æºå¦‚ CPU æ—¶é—´ï¼Œå†…å­˜ç©ºé—´ï¼Œæ–‡ä»¶ï¼Œè¾“å…¥è¾“å‡ºè®¾å¤‡çš„ä½¿ç”¨æƒç­‰ç­‰ã€‚æ¢å¥è¯è¯´ï¼Œå½“ç¨‹åºåœ¨æ‰§è¡Œæ—¶ï¼Œå°†ä¼šè¢«æ“ä½œç³»ç»Ÿè½½å…¥å†…å­˜ä¸­ã€‚ çº¿ç¨‹æ˜¯è¿›ç¨‹åˆ’åˆ†æˆçš„æ›´å°çš„è¿è¡Œå•ä½ã€‚çº¿ç¨‹å’Œè¿›ç¨‹æœ€å¤§çš„ä¸åŒåœ¨äºåŸºæœ¬ä¸Šå„è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œå„çº¿ç¨‹åˆ™ä¸ä¸€å®šï¼Œå› ä¸ºåŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹ææœ‰å¯èƒ½ä¼šç›¸äº’å½±å“ã€‚ä»å¦ä¸€è§’åº¦æ¥è¯´ï¼Œè¿›ç¨‹å±äºæ“ä½œç³»ç»Ÿçš„èŒƒç•´ï¼Œä¸»è¦æ˜¯åŒä¸€æ®µæ—¶é—´å†…ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œä¸€ä¸ªä»¥ä¸Šçš„ç¨‹åºï¼Œè€Œçº¿ç¨‹åˆ™æ˜¯åœ¨åŒä¸€ç¨‹åºå†…å‡ ä¹åŒæ—¶æ‰§è¡Œä¸€ä¸ªä»¥ä¸Šçš„ç¨‹åºæ®µã€‚\n\n\n### çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ\n\n\nJava çº¿ç¨‹åœ¨è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­çš„æŒ‡å®šæ—¶åˆ»åªå¯èƒ½å¤„äºä¸‹é¢ 6 ç§ä¸åŒçŠ¶æ€çš„å…¶ä¸­ä¸€ä¸ªçŠ¶æ€ï¼ˆå›¾æºã€ŠJava å¹¶å‘ç¼–ç¨‹è‰ºæœ¯ã€‹4.1.4 èŠ‚ï¼‰ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203748.png)\n\n\nçº¿ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸä¸­å¹¶ä¸æ˜¯å›ºå®šå¤„äºæŸä¸€ä¸ªçŠ¶æ€è€Œæ˜¯éšç€ä»£ç çš„æ‰§è¡Œåœ¨ä¸åŒçŠ¶æ€ä¹‹é—´åˆ‡æ¢ã€‚Java çº¿ç¨‹çŠ¶æ€å˜è¿å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå›¾æºã€ŠJava å¹¶å‘ç¼–ç¨‹è‰ºæœ¯ã€‹4.1.4 èŠ‚ï¼‰ï¼š\n\n\n![](https://blog-file.hehouhui.cn/202203222203017.png)\n\n\n> è®¢æ­£(æ¥è‡ªissue736)ï¼šåŸå›¾ä¸­ waitåˆ° runnableçŠ¶æ€çš„è½¬æ¢ä¸­ï¼Œjoinå®é™…ä¸Šæ˜¯Threadç±»çš„æ–¹æ³•ï¼Œä½†è¿™é‡Œå†™æˆäº†Objectã€‚\n\n\nç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šçº¿ç¨‹åˆ›å»ºä¹‹åå®ƒå°†å¤„äº **NEWï¼ˆæ–°å»ºï¼‰** çŠ¶æ€ï¼Œè°ƒç”¨ `start()` æ–¹æ³•åå¼€å§‹è¿è¡Œï¼Œçº¿ç¨‹è¿™æ—¶å€™å¤„äº **READYï¼ˆå¯è¿è¡Œï¼‰** çŠ¶æ€ã€‚å¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹è·å¾—äº† CPU æ—¶é—´ç‰‡ï¼ˆtimesliceï¼‰åå°±å¤„äº **RUNNINGï¼ˆè¿è¡Œï¼‰** çŠ¶æ€ã€‚\n\n\n> æ“ä½œç³»ç»Ÿéšè— Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­çš„ READY å’Œ RUNNING çŠ¶æ€ï¼Œå®ƒåªèƒ½çœ‹åˆ° RUNNABLE çŠ¶æ€ï¼ˆå›¾æºï¼šHowToDoInJavaï¼šJava Thread Life Cycle and Thread Statesï¼‰ï¼Œæ‰€ä»¥ Java ç³»ç»Ÿä¸€èˆ¬å°†è¿™ä¸¤ä¸ªçŠ¶æ€ç»Ÿç§°ä¸º RUNNABLEï¼ˆè¿è¡Œä¸­ï¼‰ çŠ¶æ€ ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203261.png)\n\n\nå½“çº¿ç¨‹æ‰§è¡Œ `wait()`æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹è¿›å…¥ **WAITINGï¼ˆç­‰å¾…ï¼‰** çŠ¶æ€ã€‚è¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹éœ€è¦ä¾é å…¶ä»–çº¿ç¨‹çš„é€šçŸ¥æ‰èƒ½å¤Ÿè¿”å›åˆ°è¿è¡ŒçŠ¶æ€ï¼Œè€Œ **TIME_WAITING(è¶…æ—¶ç­‰å¾…)** çŠ¶æ€ç›¸å½“äºåœ¨ç­‰å¾…çŠ¶æ€çš„åŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶é™åˆ¶ï¼Œæ¯”å¦‚é€šè¿‡ `sleepï¼ˆlong millisï¼‰`æ–¹æ³•æˆ– `waitï¼ˆlong millisï¼‰`æ–¹æ³•å¯ä»¥å°† Java çº¿ç¨‹ç½®äº TIMED WAITING çŠ¶æ€ã€‚å½“è¶…æ—¶æ—¶é—´åˆ°è¾¾å Java çº¿ç¨‹å°†ä¼šè¿”å›åˆ° RUNNABLE çŠ¶æ€ã€‚å½“çº¿ç¨‹è°ƒç”¨åŒæ­¥æ–¹æ³•æ—¶ï¼Œåœ¨æ²¡æœ‰è·å–åˆ°é”çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å°†ä¼šè¿›å…¥åˆ° **BLOCKEDï¼ˆé˜»å¡ï¼‰** çŠ¶æ€ã€‚çº¿ç¨‹åœ¨æ‰§è¡Œ Runnable çš„`run()`æ–¹æ³•ä¹‹åå°†ä¼šè¿›å…¥åˆ° **TERMINATEDï¼ˆç»ˆæ­¢ï¼‰** çŠ¶æ€ã€‚\n\n\n## åå°„\n\n\nAVA åå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º java è¯­è¨€çš„åå°„æœºåˆ¶ã€‚\n\n\n### é™æ€ç¼–è¯‘å’ŒåŠ¨æ€ç¼–è¯‘\n\n- **é™æ€ç¼–è¯‘ï¼š** åœ¨ç¼–è¯‘æ—¶ç¡®å®šç±»å‹ï¼Œç»‘å®šå¯¹è±¡\n- **åŠ¨æ€ç¼–è¯‘ï¼š** è¿è¡Œæ—¶ç¡®å®šç±»å‹ï¼Œç»‘å®šå¯¹è±¡\n\n### ä¼˜ç¼ºç‚¹\n\n- **ä¼˜ç‚¹ï¼š** è¿è¡ŒæœŸç±»å‹çš„åˆ¤æ–­ï¼ŒåŠ¨æ€åŠ è½½ç±»ï¼Œæé«˜ä»£ç çµæ´»åº¦ã€‚\n- **ç¼ºç‚¹ï¼š** 1,æ€§èƒ½ç“¶é¢ˆï¼šåå°„ç›¸å½“äºä¸€ç³»åˆ—è§£é‡Šæ“ä½œï¼Œé€šçŸ¥ JVM è¦åšçš„äº‹æƒ…ï¼Œæ€§èƒ½æ¯”ç›´æ¥çš„ java ä»£ç è¦æ…¢å¾ˆå¤šã€‚2,å®‰å…¨é—®é¢˜ï¼Œè®©æˆ‘ä»¬å¯ä»¥åŠ¨æ€æ“ä½œæ”¹å˜ç±»çš„å±æ€§åŒæ—¶ä¹Ÿå¢åŠ äº†ç±»çš„å®‰å…¨éšæ‚£ã€‚\n\n### åº”ç”¨åœºæ™¯\n\n\n**åå°„æ˜¯æ¡†æ¶è®¾è®¡çš„çµé­‚ã€‚**\n\n\nåœ¨æˆ‘ä»¬å¹³æ—¶çš„é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬ä¸Šå¾ˆå°‘ä¼šç›´æ¥ä½¿ç”¨åˆ°åå°„æœºåˆ¶ï¼Œä½†è¿™ä¸èƒ½è¯´æ˜åå°„æœºåˆ¶æ²¡æœ‰ç”¨ï¼Œå®é™…ä¸Šæœ‰å¾ˆå¤šè®¾è®¡ã€å¼€å‘éƒ½ä¸åå°„æœºåˆ¶æœ‰å…³ï¼Œä¾‹å¦‚æ¨¡å—åŒ–çš„å¼€å‘ï¼Œé€šè¿‡åå°„å»è°ƒç”¨å¯¹åº”çš„å­—èŠ‚ç ï¼›åŠ¨æ€ä»£ç†è®¾è®¡æ¨¡å¼ä¹Ÿé‡‡ç”¨äº†åå°„æœºåˆ¶ï¼Œè¿˜æœ‰æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ Springï¼Hibernate ç­‰æ¡†æ¶ä¹Ÿå¤§é‡ä½¿ç”¨åˆ°äº†åå°„æœºåˆ¶ã€‚\n\n\nä¸¾ä¾‹ï¼š\n\n1. æˆ‘ä»¬åœ¨ä½¿ç”¨ JDBC è¿æ¥æ•°æ®åº“æ—¶ä½¿ç”¨ `Class.forName()`é€šè¿‡åå°„åŠ è½½æ•°æ®åº“çš„é©±åŠ¨ç¨‹åºï¼›\n2. Spring æ¡†æ¶çš„ IOCï¼ˆåŠ¨æ€åŠ è½½ç®¡ç† Beanï¼‰åˆ›å»ºå¯¹è±¡ä»¥åŠ AOPï¼ˆåŠ¨æ€ä»£ç†ï¼‰åŠŸèƒ½éƒ½å’Œåå°„æœ‰è”ç³»ï¼›\n3. åŠ¨æ€é…ç½®å®ä¾‹çš„å±æ€§ï¼›\n4. ......\n\n## å¼‚å¸¸\n\n\n**ç»“æ„å›¾**\n\n\n![](https://blog-file.hehouhui.cn/202203222203465.png)\n\n\nåœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„å¼‚å¸¸éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆ `java.lang` åŒ…ä¸­çš„ `Throwable` ç±»ã€‚`Throwable` ç±»æœ‰ä¸¤ä¸ªé‡è¦çš„å­ç±» `Exception`ï¼ˆå¼‚å¸¸ï¼‰å’Œ `Error`ï¼ˆé”™è¯¯ï¼‰ã€‚`Exception` èƒ½è¢«ç¨‹åºæœ¬èº«å¤„ç†(`try-catch`)ï¼Œ `Error` æ˜¯æ— æ³•å¤„ç†çš„(åªèƒ½å°½é‡é¿å…)ã€‚\n\n\n`Exception` å’Œ `Error` äºŒè€…éƒ½æ˜¯ Java å¼‚å¸¸å¤„ç†çš„é‡è¦å­ç±»ï¼Œå„è‡ªéƒ½åŒ…å«å¤§é‡å­ç±»ã€‚\n\n- **`Exception`** :ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡ `catch` æ¥è¿›è¡Œæ•è·ã€‚`Exception` åˆå¯ä»¥åˆ†ä¸º å—æ£€æŸ¥å¼‚å¸¸(å¿…é¡»å¤„ç†) å’Œ ä¸å—æ£€æŸ¥å¼‚å¸¸(å¯ä»¥ä¸å¤„ç†)ã€‚\n- **`Error`** ï¼š`Error` å±äºç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ ï¼Œæˆ‘ä»¬æ²¡åŠæ³•é€šè¿‡ `catch` æ¥è¿›è¡Œæ•è· ã€‚ä¾‹å¦‚ï¼ŒJava è™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼ˆ`Virtual MachineError`ï¼‰ã€è™šæ‹Ÿæœºå†…å­˜ä¸å¤Ÿé”™è¯¯(`OutOfMemoryError`)ã€ç±»å®šä¹‰é”™è¯¯ï¼ˆ`NoClassDefFoundError`ï¼‰ç­‰ ã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJava è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸€èˆ¬ä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢ã€‚\n\n### å—æ£€æŸ¥å¼‚å¸¸\n\n\nJava ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå—æ£€æŸ¥å¼‚å¸¸æ²¡æœ‰è¢« `catch`/`throw` å¤„ç†çš„è¯ï¼Œå°±æ²¡åŠæ³•é€šè¿‡ç¼–è¯‘ ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µ IO æ“ä½œçš„ä»£ç ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203783.png)\n\n\né™¤äº†`RuntimeException`åŠå…¶å­ç±»ä»¥å¤–ï¼Œå…¶ä»–çš„`Exception`ç±»åŠå…¶å­ç±»éƒ½å±äºå—æ£€æŸ¥å¼‚å¸¸ ã€‚å¸¸è§çš„å—æ£€æŸ¥å¼‚å¸¸æœ‰ï¼š IO ç›¸å…³çš„å¼‚å¸¸ã€`ClassNotFoundException` ã€`SQLException`...ã€‚\n\n\n### ä¸å—æ£€æŸ¥å¼‚å¸¸\n\n\nJava ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ ï¼Œæˆ‘ä»¬å³ä½¿ä¸å¤„ç†ä¸å—æ£€æŸ¥å¼‚å¸¸ä¹Ÿå¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ã€‚\n\n\n`RuntimeException` åŠå…¶å­ç±»éƒ½ç»Ÿç§°ä¸ºéå—æ£€æŸ¥å¼‚å¸¸ï¼Œä¾‹å¦‚ï¼š`NullPointExecrption`ã€`NumberFormatException`ï¼ˆå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼‰ã€`ArrayIndexOutOfBoundsException`ï¼ˆæ•°ç»„è¶Šç•Œï¼‰ã€`ClassCastException`ï¼ˆç±»å‹è½¬æ¢é”™è¯¯ï¼‰ã€`ArithmeticException`ï¼ˆç®—æœ¯é”™è¯¯ï¼‰ç­‰ã€‚\n\n\n## IO\n\n\n### IO æµåˆ†ä¸ºå‡ ç§\n\n- æŒ‰ç…§æµçš„æµå‘åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµï¼›\n- æŒ‰ç…§æ“ä½œå•å…ƒåˆ’åˆ†ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµï¼›\n- æŒ‰ç…§æµçš„è§’è‰²åˆ’åˆ†ä¸ºèŠ‚ç‚¹æµå’Œå¤„ç†æµã€‚\n\nJava Io æµå…±æ¶‰åŠ 40 å¤šä¸ªç±»ï¼Œè¿™äº›ç±»çœ‹ä¸Šå»å¾ˆæ‚ä¹±ï¼Œä½†å®é™…ä¸Šå¾ˆæœ‰è§„åˆ™ï¼Œè€Œä¸”å½¼æ­¤ä¹‹é—´å­˜åœ¨éå¸¸ç´§å¯†çš„è”ç³»ï¼Œ Java I0 æµçš„ 40 å¤šä¸ªç±»éƒ½æ˜¯ä»å¦‚ä¸‹ 4 ä¸ªæŠ½è±¡ç±»åŸºç±»ä¸­æ´¾ç”Ÿå‡ºæ¥çš„ã€‚\n\n- InputStream/Reader: æ‰€æœ‰çš„è¾“å…¥æµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å…¥æµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å…¥æµã€‚\n- OutputStream/Writer: æ‰€æœ‰è¾“å‡ºæµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å‡ºæµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å‡ºæµã€‚\n\næŒ‰æ“ä½œæ–¹å¼åˆ†ç±»ç»“æ„å›¾ï¼š\n\n\n![](https://blog-file.hehouhui.cn/202203222203257.jpeg)\n\n\næŒ‰æ“ä½œå¯¹è±¡åˆ†ç±»ç»“æ„å›¾ï¼š\n\n\n![](https://blog-file.hehouhui.cn/202203222203094.jpeg)\n\n\n### ä¸ºä»€ä¹ˆè¦å­—ç¬¦æµ\n\n\né—®é¢˜æœ¬è´¨æƒ³é—®ï¼š**ä¸ç®¡æ˜¯æ–‡ä»¶è¯»å†™è¿˜æ˜¯ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œé‚£ä¸ºä»€ä¹ˆ I/O æµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œå‘¢ï¼Ÿ**\n\n\nå›ç­”ï¼šå­—ç¬¦æµæ˜¯ç”± Java è™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™ä¸ªè¿‡ç¨‹è¿˜ç®—æ˜¯éå¸¸è€—æ—¶ï¼Œå¹¶ä¸”ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“ç¼–ç ç±»å‹å°±å¾ˆå®¹æ˜“å‡ºç°ä¹±ç é—®é¢˜ã€‚æ‰€ä»¥ï¼Œ I/O æµå°±å¹²è„†æä¾›äº†ä¸€ä¸ªç›´æ¥æ“ä½œå­—ç¬¦çš„æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¹³æ—¶å¯¹å­—ç¬¦è¿›è¡Œæµæ“ä½œã€‚å¦‚æœéŸ³é¢‘æ–‡ä»¶ã€å›¾ç‰‡ç­‰åª’ä½“æ–‡ä»¶ç”¨å­—èŠ‚æµæ¯”è¾ƒå¥½ï¼Œå¦‚æœæ¶‰åŠåˆ°å­—ç¬¦çš„è¯ä½¿ç”¨å­—ç¬¦æµæ¯”è¾ƒå¥½ã€‚\n\n\n### BIO,NIO,AIO\n\n- **BIO (Blocking I/O):** åŒæ­¥é˜»å¡ I/O æ¨¡å¼ï¼Œæ•°æ®çš„è¯»å–å†™å…¥å¿…é¡»é˜»å¡åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ç­‰å¾…å…¶å®Œæˆã€‚åœ¨æ´»åŠ¨è¿æ¥æ•°ä¸æ˜¯ç‰¹åˆ«é«˜ï¼ˆå°äºå•æœº 1000ï¼‰çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ¨¡å‹æ˜¯æ¯”è¾ƒä¸é”™çš„ï¼Œå¯ä»¥è®©æ¯ä¸€ä¸ªè¿æ¥ä¸“æ³¨äºè‡ªå·±çš„ I/O å¹¶ä¸”ç¼–ç¨‹æ¨¡å‹ç®€å•ï¼Œä¹Ÿä¸ç”¨è¿‡å¤šè€ƒè™‘ç³»ç»Ÿçš„è¿‡è½½ã€é™æµç­‰é—®é¢˜ã€‚çº¿ç¨‹æ± æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤©ç„¶çš„æ¼æ–—ï¼Œå¯ä»¥ç¼“å†²ä¸€äº›ç³»ç»Ÿå¤„ç†ä¸äº†çš„è¿æ¥æˆ–è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œå½“é¢å¯¹åä¸‡ç”šè‡³ç™¾ä¸‡çº§è¿æ¥çš„æ—¶å€™ï¼Œä¼ ç»Ÿçš„ BIO æ¨¡å‹æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´é«˜æ•ˆçš„ I/O å¤„ç†æ¨¡å‹æ¥åº”å¯¹æ›´é«˜çš„å¹¶å‘é‡ã€‚\n- **NIO (Non-blocking/New I/O):** NIO æ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„ I/O æ¨¡å‹ï¼Œåœ¨ Java 1.4 ä¸­å¼•å…¥äº† NIO æ¡†æ¶ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel , Selectorï¼ŒBuffer ç­‰æŠ½è±¡ã€‚NIO ä¸­çš„ N å¯ä»¥ç†è§£ä¸º Non-blockingï¼Œä¸å•çº¯æ˜¯ Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„ I/O æ“ä½œæ–¹æ³•ã€‚ NIO æä¾›äº†ä¸ä¼ ç»Ÿ BIO æ¨¡å‹ä¸­çš„ `Socket` å’Œ `ServerSocket` ç›¸å¯¹åº”çš„ `SocketChannel` å’Œ `ServerSocketChannel` ä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°,ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éé˜»å¡æ¨¡å¼æ­£å¥½ä¸ä¹‹ç›¸åã€‚å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡ I/O æ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘\n- **AIO (Asynchronous I/O):** AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚åœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„ IO æ¨¡å‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚AIO æ˜¯å¼‚æ­¥ IO çš„ç¼©å†™ï¼Œè™½ç„¶ NIO åœ¨ç½‘ç»œæ“ä½œä¸­ï¼Œæä¾›äº†éé˜»å¡çš„æ–¹æ³•ï¼Œä½†æ˜¯ NIO çš„ IO è¡Œä¸ºè¿˜æ˜¯åŒæ­¥çš„ã€‚å¯¹äº NIO æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡çº¿ç¨‹æ˜¯åœ¨ IO æ“ä½œå‡†å¤‡å¥½æ—¶ï¼Œå¾—åˆ°é€šçŸ¥ï¼Œæ¥ç€å°±ç”±è¿™ä¸ªçº¿ç¨‹è‡ªè¡Œè¿›è¡Œ IO æ“ä½œï¼ŒIO æ“ä½œæœ¬èº«æ˜¯åŒæ­¥çš„ã€‚æŸ¥é˜…ç½‘ä¸Šç›¸å…³èµ„æ–™ï¼Œæˆ‘å‘ç°å°±ç›®å‰æ¥è¯´ AIO çš„åº”ç”¨è¿˜ä¸æ˜¯å¾ˆå¹¿æ³›ï¼ŒNetty ä¹‹å‰ä¹Ÿå°è¯•ä½¿ç”¨è¿‡ AIOï¼Œä¸è¿‡åˆæ”¾å¼ƒäº†ã€‚\n\n## å¹¶å‘\n\n\n### synchronized\n\n\n### \n\n\n**`synchronized`** **å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œ****`synchronized`****å…³é”®å­—å¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚**\n\n\nå¦å¤–ï¼Œåœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ`synchronized` å±äº **é‡é‡çº§é”**ï¼Œæ•ˆç‡ä½ä¸‹ã€‚\n\n\n**ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ**\n\n\nå› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ `Mutex Lock` æ¥å®ç°çš„ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚\n\n\nåº†å¹¸çš„æ˜¯åœ¨ Java 6 ä¹‹å Java å®˜æ–¹å¯¹ä» JVM å±‚é¢å¯¹ `synchronized` è¾ƒå¤§ä¼˜åŒ–ï¼Œæ‰€ä»¥ç°åœ¨çš„ `synchronized` é”æ•ˆç‡ä¹Ÿä¼˜åŒ–å¾—å¾ˆä¸é”™äº†ã€‚JDK1.6 å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚\n\n\næ‰€ä»¥ï¼Œä½ ä¼šå‘ç°ç›®å‰çš„è¯ï¼Œä¸è®ºæ˜¯å„ç§å¼€æºæ¡†æ¶è¿˜æ˜¯ JDK æºç éƒ½å¤§é‡ä½¿ç”¨äº† `synchronized` å…³é”®å­—ã€‚\n\n\n### ä½¿ç”¨æ–¹å¼\n\n\n**synchronized å…³é”®å­—æœ€ä¸»è¦çš„ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š**\n\n\n**1.ä¿®é¥°å®ä¾‹æ–¹æ³•:** ä½œç”¨äºå½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— **å½“å‰å¯¹è±¡å®ä¾‹çš„é”**\n\n\n```text\nsynchronized void method() {\n  //ä¸šåŠ¡ä»£ç \n}Copy to clipboardErrorCopied\n\n```\n\n\n**2.ä¿®é¥°é™æ€æ–¹æ³•:** ä¹Ÿå°±æ˜¯ç»™å½“å‰ç±»åŠ é”ï¼Œä¼šä½œç”¨äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— **å½“å‰ class çš„é”**ã€‚å› ä¸ºé™æ€æˆå‘˜ä¸å±äºä»»ä½•ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯ç±»æˆå‘˜ï¼ˆ _static è¡¨æ˜è¿™æ˜¯è¯¥ç±»çš„ä¸€ä¸ªé™æ€èµ„æºï¼Œä¸ç®¡ new äº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œåªæœ‰ä¸€ä»½_ï¼‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹ A è°ƒç”¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„éé™æ€ `synchronized` æ–¹æ³•ï¼Œè€Œçº¿ç¨‹ B éœ€è¦è°ƒç”¨è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±ç±»çš„é™æ€ `synchronized` æ–¹æ³•ï¼Œæ˜¯å…è®¸çš„ï¼Œä¸ä¼šå‘ç”Ÿäº’æ–¥ç°è±¡ï¼Œ**å› ä¸ºè®¿é—®é™æ€** **`synchronized`** **æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰ç±»çš„é”ï¼Œè€Œè®¿é—®éé™æ€** **`synchronized`** **æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡é”**ã€‚\n\n\n```text\nsynchronized void staic method() {\n  //ä¸šåŠ¡ä»£ç \n}Copy to clipboardErrorCopied\n\n```\n\n\n**3.ä¿®é¥°ä»£ç å—** ï¼šæŒ‡å®šåŠ é”å¯¹è±¡ï¼Œå¯¹ç»™å®šå¯¹è±¡/ç±»åŠ é”ã€‚`synchronized(this|object)` è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾—**ç»™å®šå¯¹è±¡çš„é”**ã€‚`synchronized(ç±».class)` è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— **å½“å‰ class çš„é”**\n\n\n```text\nsynchronized(this) {\n  //ä¸šåŠ¡ä»£ç \n}Copy to clipboardErrorCopied\n\n```\n\n\n**æ€»ç»“ï¼š**\n\n- `synchronized` å…³é”®å­—åŠ åˆ° `static` é™æ€æ–¹æ³•å’Œ `synchronized(class)` ä»£ç å—ä¸Šéƒ½æ˜¯æ˜¯ç»™ Class ç±»ä¸Šé”ã€‚\n- `synchronized` å…³é”®å­—åŠ åˆ°å®ä¾‹æ–¹æ³•ä¸Šæ˜¯ç»™å¯¹è±¡å®ä¾‹ä¸Šé”ã€‚\n- å°½é‡ä¸è¦ä½¿ç”¨ `synchronized(String a)` å› ä¸º JVM ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å…·æœ‰ç¼“å­˜åŠŸèƒ½ï¼\n\nä¸‹é¢æˆ‘ä»¥ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ä¸ºä¾‹è®²è§£ä¸€ä¸‹ `synchronized` å…³é”®å­—çš„å…·ä½“ä½¿ç”¨ã€‚\n\n\né¢è¯•ä¸­é¢è¯•å®˜ç»å¸¸ä¼šè¯´ï¼šâ€œå•ä¾‹æ¨¡å¼äº†è§£å—ï¼Ÿæ¥ç»™æˆ‘æ‰‹å†™ä¸€ä¸‹ï¼ç»™æˆ‘è§£é‡Šä¸€ä¸‹åŒé‡æ£€éªŒé”æ–¹å¼å®ç°å•ä¾‹æ¨¡å¼çš„åŸç†å‘—ï¼â€\n\n\n**åŒé‡æ ¡éªŒé”å®ç°å¯¹è±¡å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰**\n\n\n```text\npublic class Singleton {\n\n    private volatile static Singleton uniqueInstance;\n\n    private Singleton() {\n    }\n\n    public  static Singleton getUniqueInstance() {\n       //å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç \n        if (uniqueInstance == null) {\n            //ç±»å¯¹è±¡åŠ é”\n            synchronized (Singleton.class) {\n                if (uniqueInstance == null) {\n                    uniqueInstance = new Singleton();\n                }\n            }\n        }\n        return uniqueInstance;\n    }\n}Copy to clipboardErrorCopied\n\n```\n\n\nå¦å¤–ï¼Œéœ€è¦æ³¨æ„ `uniqueInstance` é‡‡ç”¨ `volatile` å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦ã€‚\n\n\n`uniqueInstance` é‡‡ç”¨ `volatile` å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ `uniqueInstance = new Singleton();` è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š\n\n1. ä¸º `uniqueInstance` åˆ†é…å†…å­˜ç©ºé—´\n2. åˆå§‹åŒ– `uniqueInstance`\n3. å°† `uniqueInstance` æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€\n\nä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1->3->2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ `getUniqueInstance`() åå‘ç° `uniqueInstance` ä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å› `uniqueInstance`ï¼Œä½†æ­¤æ—¶ `uniqueInstance` è¿˜æœªè¢«åˆå§‹åŒ–ã€‚\n\n\nä½¿ç”¨ `volatile` å¯ä»¥ç¦æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚\n\n\n### åº•å±‚åŸç†\n\n\n**synchronized å…³é”®å­—åº•å±‚åŸç†å±äº JVM å±‚é¢ã€‚**\n\n\n**`ä»£ç å—`**\n\n\n```text\npublic class SynchronizedDemo {\n    public void method() {\n        synchronized (this) {\n            System.out.println(\"synchronized ä»£ç å—\");\n        }\n    }\n}\n\n```\n\n\né€šè¿‡ JDK è‡ªå¸¦çš„ `javap` å‘½ä»¤æŸ¥çœ‹ `SynchronizedDemo` ç±»çš„ç›¸å…³å­—èŠ‚ç ä¿¡æ¯ï¼šé¦–å…ˆåˆ‡æ¢åˆ°ç±»çš„å¯¹åº”ç›®å½•æ‰§è¡Œ `javac SynchronizedDemo.java` å‘½ä»¤ç”Ÿæˆç¼–è¯‘åçš„ .class æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ`javap -c -s -v -l SynchronizedDemo.class`ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203508.png)\n\n\nä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š\n\n\n**`synchronized`** **åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯** **`monitorenter`** **å’Œ** **`monitorexit`** **æŒ‡ä»¤ï¼Œå…¶ä¸­** **`monitorenter`** **æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œ****`monitorexit`** **æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚**\n\n\nå½“æ‰§è¡Œ `monitorenter` æŒ‡ä»¤æ—¶ï¼Œçº¿ç¨‹è¯•å›¾è·å–é”ä¹Ÿå°±æ˜¯è·å– **å¯¹è±¡ç›‘è§†å™¨** **`monitor`** çš„æŒæœ‰æƒã€‚\n\n\n> åœ¨ Java è™šæ‹Ÿæœº(HotSpot)ä¸­ï¼ŒMonitor æ˜¯åŸºäº C++å®ç°çš„ï¼Œç”±ObjectMonitorå®ç°çš„ã€‚æ¯ä¸ªå¯¹è±¡ä¸­éƒ½å†…ç½®äº†ä¸€ä¸ª ObjectMonitorå¯¹è±¡ã€‚\n\n\n\tå¦å¤–ï¼Œ**`wait/notify`****ç­‰æ–¹æ³•ä¹Ÿä¾èµ–äº****`monitor`****å¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåªæœ‰åœ¨åŒæ­¥çš„å—æˆ–è€…æ–¹æ³•ä¸­æ‰èƒ½è°ƒç”¨****`wait/notify`****ç­‰æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡º****`java.lang.IllegalMonitorStateException`****çš„å¼‚å¸¸çš„åŸå› ã€‚**\n\n\nåœ¨æ‰§è¡Œ`monitorenter`æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡çš„é”ï¼Œå¦‚æœé”çš„è®¡æ•°å™¨ä¸º 0 åˆ™è¡¨ç¤ºé”å¯ä»¥è¢«è·å–ï¼Œè·å–åå°†é”è®¡æ•°å™¨è®¾ä¸º 1 ä¹Ÿå°±æ˜¯åŠ  1ã€‚\n\n\nåœ¨æ‰§è¡Œ `monitorexit` æŒ‡ä»¤åï¼Œå°†é”è®¡æ•°å™¨è®¾ä¸º 0ï¼Œè¡¨æ˜é”è¢«é‡Šæ”¾ã€‚å¦‚æœè·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£å½“å‰çº¿ç¨‹å°±è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°é”è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚\n\n\n**ä¿®é¥°æ–¹æ³•**\n\n\n```text\npublic class SynchronizedDemo2 {\n    public synchronized void method() {\n        System.out.println(\"synchronized æ–¹æ³•\");\n    }\n}\nCopy to clipboardErrorCopied\n\n```\n\n\n![](https://blog-file.hehouhui.cn/202203222128189.png)\n\n\n`synchronized` ä¿®é¥°çš„æ–¹æ³•å¹¶æ²¡æœ‰ `monitorenter` æŒ‡ä»¤å’Œ `monitorexit` æŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„ç¡®å®æ˜¯ `ACC_SYNCHRONIZED` æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€‚JVM é€šè¿‡è¯¥ `ACC_SYNCHRONIZED` è®¿é—®æ ‡å¿—æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚\n\n\n### é”\n\n\n### ä¹è§‚é”å’Œæ‚²è§‚é”\n\n\n> ä¹è§‚é”å¯¹åº”äºç”Ÿæ´»ä¸­ä¹è§‚çš„äººæ€»æ˜¯æƒ³ç€äº‹æƒ…å¾€å¥½çš„æ–¹å‘å‘å±•ï¼Œæ‚²è§‚é”å¯¹åº”äºç”Ÿæ´»ä¸­æ‚²è§‚çš„äººæ€»æ˜¯æƒ³ç€äº‹æƒ…å¾€åçš„æ–¹å‘å‘å±•ã€‚è¿™ä¸¤ç§äººå„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸èƒ½ä¸ä»¥åœºæ™¯è€Œå®šè¯´ä¸€ç§äººå¥½äºå¦å¤–ä¸€ç§äººã€‚\n\n\n**æ‚²è§‚é”**\n\n\n> æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚Javaä¸­synchronizedå’ŒReentrantLockç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚\n\n\n**ä¹è§‚é”**\n\n\n> æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®ç°ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äºwrite_conditionæœºåˆ¶ï¼Œå…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚åœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CASå®ç°çš„ã€‚\n\n\n### ä½¿ç”¨åœºæ™¯\n\n\nä»ä¸Šé¢å¯¹ä¸¤ç§é”çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ä¸¤ç§é”å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸å¯è®¤ä¸ºä¸€ç§å¥½äºå¦ä¸€ç§ï¼Œåƒ**ä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼‰**ï¼Œå³å†²çªçœŸçš„å¾ˆå°‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™æ ·å¯ä»¥çœå»äº†é”çš„å¼€é”€ï¼ŒåŠ å¤§äº†ç³»ç»Ÿçš„æ•´ä¸ªååé‡ã€‚ä½†å¦‚æœæ˜¯å¤šå†™çš„æƒ…å†µï¼Œä¸€èˆ¬ä¼šç»å¸¸äº§ç”Ÿå†²çªï¼Œè¿™å°±ä¼šå¯¼è‡´ä¸Šå±‚åº”ç”¨ä¼šä¸æ–­çš„è¿›è¡Œretryï¼Œè¿™æ ·åå€’æ˜¯é™ä½äº†æ€§èƒ½ï¼Œæ‰€ä»¥**ä¸€èˆ¬å¤šå†™çš„åœºæ™¯ä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚**\n\n\n### ä¹è§‚é”\n\n\n### ç‰ˆæœ¬å·æœºåˆ¶\n\n\nä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å·versionå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œversionå€¼ä¼šåŠ ä¸€ã€‚å½“çº¿ç¨‹Aè¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å–versionå€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„versionå€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„versionå€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚\n\n\n**ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š** å‡è®¾æ•°æ®åº“ä¸­å¸æˆ·ä¿¡æ¯è¡¨ä¸­æœ‰ä¸€ä¸ª version å­—æ®µï¼Œå½“å‰å€¼ä¸º 1 ï¼›è€Œå½“å‰å¸æˆ·ä½™é¢å­—æ®µï¼ˆ balance ï¼‰ä¸º $100 ã€‚\n\n1. æ“ä½œå‘˜ A æ­¤æ—¶å°†å…¶è¯»å‡ºï¼ˆ version=1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ $50ï¼ˆ $100-$50 ï¼‰ã€‚\n2. åœ¨æ“ä½œå‘˜ A æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæ“ä½œå‘˜B ä¹Ÿè¯»å…¥æ­¤ç”¨æˆ·ä¿¡æ¯ï¼ˆ version=1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ $20 ï¼ˆ $100-$20 ï¼‰ã€‚\n3. æ“ä½œå‘˜ A å®Œæˆäº†ä¿®æ”¹å·¥ä½œï¼Œå°†æ•°æ®ç‰ˆæœ¬å·ï¼ˆ version=1 ï¼‰ï¼Œè¿åŒå¸æˆ·æ‰£é™¤åä½™é¢ï¼ˆ balance=$50 ï¼‰ï¼Œæäº¤è‡³æ•°æ®åº“æ›´æ–°ï¼Œæ­¤æ—¶ç”±äºæäº¤æ•°æ®ç‰ˆæœ¬ç­‰äºæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ï¼Œæ•°æ®è¢«æ›´æ–°ï¼Œæ•°æ®åº“è®°å½• version æ›´æ–°ä¸º 2 ã€‚\n4. æ“ä½œå‘˜ B å®Œæˆäº†æ“ä½œï¼Œä¹Ÿå°†ç‰ˆæœ¬å·ï¼ˆ version=1 ï¼‰è¯•å›¾å‘æ•°æ®åº“æäº¤æ•°æ®ï¼ˆ balance=$80 ï¼‰ï¼Œä½†æ­¤æ—¶æ¯”å¯¹æ•°æ®åº“è®°å½•ç‰ˆæœ¬æ—¶å‘ç°ï¼Œæ“ä½œå‘˜ B æäº¤çš„æ•°æ®ç‰ˆæœ¬å·ä¸º 1 ï¼Œæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ä¹Ÿä¸º 2 ï¼Œä¸æ»¡è¶³ â€œ æäº¤ç‰ˆæœ¬å¿…é¡»ç­‰äºå½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–° â€œ çš„ä¹è§‚é”ç­–ç•¥ï¼Œå› æ­¤ï¼Œæ“ä½œå‘˜ B çš„æäº¤è¢«é©³å›ã€‚\n\nè¿™æ ·ï¼Œå°±é¿å…äº†æ“ä½œå‘˜ B ç”¨åŸºäº version=1 çš„æ—§æ•°æ®ä¿®æ”¹çš„ç»“æœè¦†ç›–æ“ä½œå‘˜A çš„æ“ä½œç»“æœçš„å¯èƒ½\n\n\n### CASç®—æ³•\n\n\nå³**compare and swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰**ï¼Œæ˜¯ä¸€ç§æœ‰åçš„**æ— é”ç®—æ³•**ã€‚æ— é”ç¼–ç¨‹ï¼Œå³ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡çš„æƒ…å†µä¸‹å®ç°å˜é‡çš„åŒæ­¥ï¼Œæ‰€ä»¥ä¹Ÿå«éé˜»å¡åŒæ­¥ï¼ˆNon-blocking Synchronizationï¼‰ã€‚**CASç®—æ³•**æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°\n\n- éœ€è¦è¯»å†™çš„å†…å­˜å€¼ V\n- è¿›è¡Œæ¯”è¾ƒçš„å€¼ A\n- æ‹Ÿå†™å…¥çš„æ–°å€¼ B\n\nå½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº Aæ—¶ï¼ŒCASé€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼Bæ¥æ›´æ–°Vçš„å€¼ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼ˆæ¯”è¾ƒå’Œæ›¿æ¢æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ª**è‡ªæ—‹æ“ä½œ**ï¼Œå³**ä¸æ–­çš„é‡è¯•**ã€‚\n\n\nå…³äºè‡ªæ—‹é”ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œéå¸¸ä¸é”™ï¼š[ã€Š é¢è¯•å¿…å¤‡ä¹‹æ·±å…¥ç†è§£è‡ªæ—‹é”ã€‹](https://blog.csdn.net/qq_34337272/article/details/81252853)\n\n\n### ç¼ºç‚¹\n\n\n> ABA é—®é¢˜æ˜¯ä¹è§‚é”ä¸€ä¸ªå¸¸è§çš„é—®é¢˜\n\n\n### ABA é—®é¢˜\n\n\nå¦‚æœä¸€ä¸ªå˜é‡Våˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯Aå€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯Aå€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å›Aï¼Œé‚£CASæ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸ºCASæ“ä½œçš„ **\"ABA\"é—®é¢˜ã€‚**\n\n\nJDK 1.5 ä»¥åçš„ `AtomicStampedReference ç±»`å°±æä¾›äº†æ­¤ç§èƒ½åŠ›ï¼Œå…¶ä¸­çš„ `compareAndSet æ–¹æ³•`å°±æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚\n\n\n### å¼€é”€å¤§\n\n\n**è‡ªæ—‹CASï¼ˆä¹Ÿå°±æ˜¯ä¸æˆåŠŸå°±ä¸€ç›´å¾ªç¯æ‰§è¡Œç›´åˆ°æˆåŠŸï¼‰å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚** å¦‚æœJVMèƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„pauseæŒ‡ä»¤é‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ï¼ŒpauseæŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œç¬¬ä¸€å®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼ˆde-pipelineï¼‰,ä½¿CPUä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ã€‚ç¬¬äºŒå®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªï¼ˆmemory order violationï¼‰è€Œå¼•èµ·CPUæµæ°´çº¿è¢«æ¸…ç©ºï¼ˆCPU pipeline flushï¼‰ï¼Œä»è€Œæé«˜CPUçš„æ‰§è¡Œæ•ˆç‡ã€‚\n\n\n### åªèƒ½ä¸€ä¸ªå˜é‡åŸå­æ“ä½œ\n\n\nCAS åªå¯¹å•ä¸ªå…±äº«å˜é‡æœ‰æ•ˆï¼Œå½“æ“ä½œæ¶‰åŠè·¨å¤šä¸ªå…±äº«å˜é‡æ—¶ CAS æ— æ•ˆã€‚ä½†æ˜¯ä» JDK 1.5å¼€å§‹ï¼Œæä¾›äº†`AtomicReferenceç±»`æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œ.æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é”æˆ–è€…åˆ©ç”¨`AtomicReferenceç±»`æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚\n\n\nCASä¸`synchronized`çš„ä½¿ç”¨æƒ…æ™¯\n\n\n> ç®€å•çš„æ¥è¯´CASé€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼Œå†²çªä¸€èˆ¬è¾ƒå°‘ï¼‰ï¼Œsynchronizedé€‚ç”¨äºå†™æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼ˆå¤šå†™åœºæ™¯ï¼Œå†²çªä¸€èˆ¬è¾ƒå¤šï¼‰\n\n1. å¯¹äºèµ„æºç«äº‰è¾ƒå°‘ï¼ˆçº¿ç¨‹å†²çªè¾ƒè½»ï¼‰çš„æƒ…å†µï¼Œä½¿ç”¨`synchronized`åŒæ­¥é”è¿›è¡Œçº¿ç¨‹é˜»å¡å’Œå”¤é†’åˆ‡æ¢ä»¥åŠç”¨æˆ·æ€å†…æ ¸æ€é—´çš„åˆ‡æ¢æ“ä½œé¢å¤–æµªè´¹æ¶ˆè€—cpuèµ„æºï¼›è€ŒCASåŸºäºç¡¬ä»¶å®ç°ï¼Œä¸éœ€è¦è¿›å…¥å†…æ ¸ï¼Œä¸éœ€è¦åˆ‡æ¢çº¿ç¨‹ï¼Œæ“ä½œè‡ªæ—‹å‡ ç‡è¾ƒå°‘ï¼Œå› æ­¤å¯ä»¥è·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚\n2. å¯¹äºèµ„æºç«äº‰ä¸¥é‡ï¼ˆçº¿ç¨‹å†²çªä¸¥é‡ï¼‰çš„æƒ…å†µï¼ŒCASè‡ªæ—‹çš„æ¦‚ç‡ä¼šæ¯”è¾ƒå¤§ï¼Œä»è€Œæµªè´¹æ›´å¤šçš„CPUèµ„æºï¼Œæ•ˆç‡ä½äºsynchronizedã€‚\n\nè¡¥å……ï¼š Javaå¹¶å‘ç¼–ç¨‹è¿™ä¸ªé¢†åŸŸä¸­`synchronized`å…³é”®å­—ä¸€ç›´éƒ½æ˜¯å…ƒè€çº§çš„è§’è‰²ï¼Œå¾ˆä¹…ä¹‹å‰å¾ˆå¤šäººéƒ½ä¼šç§°å®ƒä¸º **â€œé‡é‡çº§é”â€** ã€‚ä½†æ˜¯ï¼Œåœ¨JavaSE 1.6ä¹‹åè¿›è¡Œäº†ä¸»è¦åŒ…æ‹¬ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—è€Œå¼•å…¥çš„ **åå‘é”** å’Œ **è½»é‡çº§é”** ä»¥åŠå…¶å®ƒ**å„ç§ä¼˜åŒ–**ä¹‹åå˜å¾—åœ¨æŸäº›æƒ…å†µä¸‹å¹¶ä¸æ˜¯é‚£ä¹ˆé‡äº†ã€‚`synchronized`çš„åº•å±‚å®ç°ä¸»è¦ä¾é  **Lock-Free** çš„é˜Ÿåˆ—ï¼ŒåŸºæœ¬æ€è·¯æ˜¯ **è‡ªæ—‹åé˜»å¡**ï¼Œ**ç«äº‰åˆ‡æ¢åç»§ç»­ç«äº‰é”**ï¼Œ**ç¨å¾®ç‰ºç‰²äº†å…¬å¹³æ€§ï¼Œä½†è·å¾—äº†é«˜ååé‡**ã€‚åœ¨çº¿ç¨‹å†²çªè¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è·å¾—å’ŒCASç±»ä¼¼çš„æ€§èƒ½ï¼›è€Œçº¿ç¨‹å†²çªä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½è¿œé«˜äºCASã€‚\n\n\n### æ­»é”\n\n\nçº¿ç¨‹æ­»é”æè¿°çš„æ˜¯è¿™æ ·ä¸€ç§æƒ…å†µï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«é˜»å¡ï¼Œå®ƒä»¬ä¸­çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨éƒ½åœ¨ç­‰å¾…æŸä¸ªèµ„æºè¢«é‡Šæ”¾ã€‚ç”±äºçº¿ç¨‹è¢«æ— é™æœŸåœ°é˜»å¡ï¼Œå› æ­¤ç¨‹åºä¸å¯èƒ½æ­£å¸¸ç»ˆæ­¢ã€‚\n\n\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¿ç¨‹ A æŒæœ‰èµ„æº 2ï¼Œçº¿ç¨‹ B æŒæœ‰èµ„æº 1ï¼Œä»–ä»¬åŒæ—¶éƒ½æƒ³ç”³è¯·å¯¹æ–¹çš„èµ„æºï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šäº’ç›¸ç­‰å¾…è€Œè¿›å…¥æ­»é”çŠ¶æ€ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203695.png)\n\n\nçº¿ç¨‹ A é€šè¿‡ synchronized (resource1) è·å¾— resource1 çš„ç›‘è§†å™¨é”ï¼Œç„¶åé€šè¿‡`Thread.sleep(1000);`è®©çº¿ç¨‹ A ä¼‘çœ  1s ä¸ºçš„æ˜¯è®©çº¿ç¨‹ B å¾—åˆ°æ‰§è¡Œç„¶åè·å–åˆ° resource2 çš„ç›‘è§†å™¨é”ã€‚çº¿ç¨‹ A å’Œçº¿ç¨‹ B ä¼‘çœ ç»“æŸäº†éƒ½å¼€å§‹ä¼å›¾è¯·æ±‚è·å–å¯¹æ–¹çš„èµ„æºï¼Œç„¶åè¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šé™·å…¥äº’ç›¸ç­‰å¾…çš„çŠ¶æ€ï¼Œè¿™ä¹Ÿå°±äº§ç”Ÿäº†æ­»é”ã€‚ä¸Šé¢çš„ä¾‹å­ç¬¦åˆäº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ã€‚\n\n\nå­¦è¿‡æ“ä½œç³»ç»Ÿçš„æœ‹å‹éƒ½çŸ¥é“äº§ç”Ÿæ­»é”å¿…é¡»å…·å¤‡ä»¥ä¸‹`å››ä¸ªæ¡ä»¶`ï¼š\n\n1. äº’æ–¥æ¡ä»¶ï¼šè¯¥èµ„æºä»»æ„ä¸€ä¸ªæ—¶åˆ»åªç”±ä¸€ä¸ªçº¿ç¨‹å ç”¨ã€‚\n2. è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚\n3. ä¸å‰¥å¤ºæ¡ä»¶:çº¿ç¨‹å·²è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¼ºè¡Œå‰¥å¤ºï¼Œåªæœ‰è‡ªå·±ä½¿ç”¨å®Œæ¯•åæ‰é‡Šæ”¾èµ„æºã€‚\n4. å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚\n\n### å¦‚ä½•é¿å…æ­»é”\n\n\næˆ‘ä¸Šé¢è¯´äº†äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼Œä¸ºäº†é¿å…æ­»é”ï¼Œæˆ‘ä»¬åªè¦ç ´åäº§ç”Ÿæ­»é”çš„å››ä¸ªæ¡ä»¶ä¸­çš„å…¶ä¸­ä¸€ä¸ªå°±å¯ä»¥äº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥æŒ¨ä¸ªåˆ†æä¸€ä¸‹ï¼š\n\n1. **ç ´åäº’æ–¥æ¡ä»¶** ï¼šè¿™ä¸ªæ¡ä»¶æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç ´åï¼Œå› ä¸ºæˆ‘ä»¬ç”¨é”æœ¬æ¥å°±æ˜¯æƒ³è®©ä»–ä»¬äº’æ–¥çš„ï¼ˆä¸´ç•Œèµ„æºéœ€è¦äº’æ–¥è®¿é—®ï¼‰ã€‚\n2. **ç ´åè¯·æ±‚ä¸ä¿æŒæ¡ä»¶** ï¼šä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰çš„èµ„æºã€‚\n3. **ç ´åä¸å‰¥å¤ºæ¡ä»¶** ï¼šå ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æºã€‚\n4. **ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶** ï¼šé æŒ‰åºç”³è¯·èµ„æºæ¥é¢„é˜²ã€‚æŒ‰æŸä¸€é¡ºåºç”³è¯·èµ„æºï¼Œé‡Šæ”¾èµ„æºåˆ™ååºé‡Šæ”¾ã€‚ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ã€‚\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-02-25",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "22",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java",
          "å¼‚æ­¥ç¼–ç¨‹",
          "å¤šçº¿ç¨‹"
        ],
        "summary": "çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€å—å†…å­˜ç©ºé—´å’Œä¸€ç»„ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚",
        "sort": "",
        "title": "JavaåŸºç¡€-çº¿ç¨‹&å¹¶å‘",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "54c4aad1-0a7a-4a4b-9906-1f54a3810362"
        }
      ],
      "body": "",
      "realName": "JavaåŸºç¡€-çº¿ç¨‹&å¹¶å‘",
      "relativePath": "/archives/JavaåŸºç¡€-çº¿ç¨‹&å¹¶å‘.md"
    },
    {
      "id": "ba68c9c4-7d5d-4640-80d9-c123616ea287",
      "doc_id": "ba68c9c4-7d5d-4640-80d9-c123616ea287",
      "title": "ba68c9c4-7d5d-4640-80d9-c123616ea287",
      "updated": 1696747320000,
      "body_original": "\n## List\n\n\n### ArrayList\n\n\n`ArrayList` çš„åº•å±‚æ˜¯æ•°ç»„é˜Ÿåˆ—ï¼Œç›¸å½“äºåŠ¨æ€æ•°ç»„ã€‚ä¸ Java ä¸­çš„æ•°ç»„ç›¸æ¯”ï¼Œå®ƒçš„å®¹é‡èƒ½åŠ¨æ€å¢é•¿ã€‚åœ¨æ·»åŠ å¤§é‡å…ƒç´ å‰ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨`ensureCapacity`æ“ä½œæ¥å¢åŠ  `ArrayList` å®ä¾‹çš„å®¹é‡ã€‚è¿™å¯ä»¥å‡å°‘é€’å¢å¼å†åˆ†é…çš„æ•°é‡ã€‚\n\n\n`ArrayList`ç»§æ‰¿äº **`AbstractList`** ï¼Œå®ç°äº† **`List`**, **`RandomAccess`**, **`Cloneable`**, **`java.io.Serializable`** è¿™äº›æ¥å£ã€‚\n\n\n```java\npublic class ArrayList<E> extends AbstractList<E>\n        implements List<E>, RandomAccess, Cloneable, java.io.Serializable{\n\n  }\n\n```\n\n- `RandomAccess` æ˜¯ä¸€ä¸ªæ ‡å¿—æ¥å£ï¼Œè¡¨æ˜å®ç°è¿™ä¸ªè¿™ä¸ªæ¥å£çš„ List é›†åˆæ˜¯æ”¯æŒ**å¿«é€Ÿéšæœºè®¿é—®**çš„ã€‚åœ¨ `ArrayList` ä¸­ï¼Œæˆ‘ä»¬å³å¯ä»¥é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡ï¼Œè¿™å°±æ˜¯å¿«é€Ÿéšæœºè®¿é—®ã€‚\n- `ArrayList` å®ç°äº† **`Cloneable`** **æ¥å£** ï¼Œå³è¦†ç›–äº†å‡½æ•°`clone()`ï¼Œèƒ½è¢«å…‹éš†ã€‚\n- `ArrayList` å®ç°äº† `java.io.Serializable` æ¥å£ï¼Œè¿™æ„å‘³ç€`ArrayList`æ”¯æŒåºåˆ—åŒ–ï¼Œèƒ½é€šè¿‡åºåˆ—åŒ–å»ä¼ è¾“ã€‚\n\n### ä¸Vectorçš„åŒºåˆ«\n\n1. `ArrayList` æ˜¯ `List` çš„ä¸»è¦å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨ `Object[ ]`å­˜å‚¨ï¼Œé€‚ç”¨äºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œï¼Œçº¿ç¨‹ä¸å®‰å…¨ ï¼›\n2. `Vector` æ˜¯ `List` çš„å¤è€å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨ `Object[ ]`å­˜å‚¨ï¼Œçº¿ç¨‹å®‰å…¨çš„ã€‚\n\n### ä¸LinkedListåŒºåˆ«\n\n1. **æ˜¯å¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š** `ArrayList` å’Œ `LinkedList` éƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›\n2. **åº•å±‚æ•°æ®ç»“æ„ï¼š** `Arraylist` åº•å±‚ä½¿ç”¨çš„æ˜¯ **`Object`** **æ•°ç»„**ï¼›`LinkedList` åº•å±‚ä½¿ç”¨çš„æ˜¯ **åŒå‘é“¾è¡¨** æ•°æ®ç»“æ„ï¼ˆJDK1.6 ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7 å–æ¶ˆäº†å¾ªç¯ã€‚æ³¨æ„åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨çš„åŒºåˆ«ï¼Œä¸‹é¢æœ‰ä»‹ç»åˆ°ï¼ï¼‰\n3. **æ’å…¥å’Œåˆ é™¤æ˜¯å¦å—å…ƒç´ ä½ç½®çš„å½±å“ï¼š** â‘  **`ArrayList`** **é‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å—å…ƒç´ ä½ç½®çš„å½±å“ã€‚** æ¯”å¦‚ï¼šæ‰§è¡Œ`add(E e)`æ–¹æ³•çš„æ—¶å€™ï¼Œ `ArrayList` ä¼šé»˜è®¤åœ¨å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ï¼Œè¿™ç§æƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚ä½†æ˜¯å¦‚æœè¦åœ¨æŒ‡å®šä½ç½® i æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ`add(int index, E element)`ï¼‰æ—¶é—´å¤æ‚åº¦å°±ä¸º O(n-i)ã€‚å› ä¸ºåœ¨è¿›è¡Œä¸Šè¿°æ“ä½œçš„æ—¶å€™é›†åˆä¸­ç¬¬ i å’Œç¬¬ i ä¸ªå…ƒç´ ä¹‹åçš„(n-i)ä¸ªå…ƒç´ éƒ½è¦æ‰§è¡Œå‘åä½/å‘å‰ç§»ä¸€ä½çš„æ“ä½œã€‚ â‘¡ **`LinkedList`** **é‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œæ‰€ä»¥å¯¹äº****`add(E e)`****æ–¹æ³•çš„æ’å…¥ï¼Œåˆ é™¤å…ƒç´ æ—¶é—´å¤æ‚åº¦ä¸å—å…ƒç´ ä½ç½®çš„å½±å“ï¼Œè¿‘ä¼¼ O(1)ï¼Œå¦‚æœæ˜¯è¦åœ¨æŒ‡å®šä½ç½®****`i`****æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ****`(add(int index, E element)`****ï¼‰ æ—¶é—´å¤æ‚åº¦è¿‘ä¼¼ä¸º****`o(n))`****å› ä¸ºéœ€è¦å…ˆç§»åŠ¨åˆ°æŒ‡å®šä½ç½®å†æ’å…¥ã€‚**\n4. **æ˜¯å¦æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼š** `LinkedList` ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ï¼Œè€Œ `ArrayList` æ”¯æŒã€‚å¿«é€Ÿéšæœºè®¿é—®å°±æ˜¯é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡(å¯¹åº”äº`get(int index)`æ–¹æ³•)ã€‚\n5. **å†…å­˜ç©ºé—´å ç”¨ï¼š** `ArrayList` çš„ç©º é—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨ list åˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€Œ `LinkedList` çš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—æ¯” `ArrayList` æ›´å¤šçš„ç©ºé—´ï¼ˆå› ä¸ºè¦å­˜æ”¾ç›´æ¥åç»§å’Œç›´æ¥å‰é©±ä»¥åŠæ•°æ®ï¼‰ã€‚\n\n### æ‰©å®¹æœºåˆ¶\n\n\n**JDK8ï¼‰ArrayList æœ‰ä¸‰ç§æ–¹å¼æ¥åˆå§‹åŒ–ï¼Œæ„é€ æ–¹æ³•æºç å¦‚ä¸‹ï¼š**\n\n\n```java\n   /**\n     * é»˜è®¤åˆå§‹å®¹é‡å¤§å°\n     */\n    private static final int DEFAULT_CAPACITY = 10;\n\n\n    private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};\n\n    /**\n     *é»˜è®¤æ„é€ å‡½æ•°ï¼Œä½¿ç”¨åˆå§‹å®¹é‡10æ„é€ ä¸€ä¸ªç©ºåˆ—è¡¨(æ— å‚æ•°æ„é€ )\n     */\n    public ArrayList() {\n        this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;\n    }\n\n    /**\n     * å¸¦åˆå§‹å®¹é‡å‚æ•°çš„æ„é€ å‡½æ•°ã€‚ï¼ˆç”¨æˆ·è‡ªå·±æŒ‡å®šå®¹é‡ï¼‰\n     */\n    public ArrayList(int initialCapacity) {\n        if (initialCapacity > 0) {//åˆå§‹å®¹é‡å¤§äº0\n            //åˆ›å»ºinitialCapacityå¤§å°çš„æ•°ç»„\n            this.elementData = new Object[initialCapacity];\n        } else if (initialCapacity == 0) {//åˆå§‹å®¹é‡ç­‰äº0\n            //åˆ›å»ºç©ºæ•°ç»„\n            this.elementData = EMPTY_ELEMENTDATA;\n        } else {//åˆå§‹å®¹é‡å°äº0ï¼ŒæŠ›å‡ºå¼‚å¸¸\n            throw new IllegalArgumentException(\"Illegal Capacity: \"+\n                                               initialCapacity);\n        }\n    }\n\n\n   /**\n    *æ„é€ åŒ…å«æŒ‡å®šcollectionå…ƒç´ çš„åˆ—è¡¨ï¼Œè¿™äº›å…ƒç´ åˆ©ç”¨è¯¥é›†åˆçš„è¿­ä»£å™¨æŒ‰é¡ºåºè¿”å›\n    *å¦‚æœæŒ‡å®šçš„é›†åˆä¸ºnullï¼Œthrows NullPointerExceptionã€‚\n    */\n     public ArrayList(Collection<? extends E> c) {\n        elementData = c.toArray();\n        if ((size = elementData.length) != 0) {\n            // c.toArray might (incorrectly) not return Object[] (see 6260652)\n            if (elementData.getClass() != Object[].class)\n                elementData = Arrays.copyOf(elementData, size, Object[].class);\n        } else {\n            // replace with empty array.\n            this.elementData = EMPTY_ELEMENTDATA;\n        }\n    }\n```\n\n\nç»†å¿ƒçš„åŒå­¦ä¸€å®šä¼šå‘ç° ï¼š**ä»¥æ— å‚æ•°æ„é€ æ–¹æ³•åˆ›å»º ArrayList æ—¶ï¼Œå®é™…ä¸Šåˆå§‹åŒ–èµ‹å€¼çš„æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ã€‚å½“çœŸæ­£å¯¹æ•°ç»„è¿›è¡Œæ·»åŠ å…ƒç´ æ“ä½œæ—¶ï¼Œæ‰çœŸæ­£åˆ†é…å®¹é‡ã€‚å³å‘æ•°ç»„ä¸­æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæ•°ç»„å®¹é‡æ‰©ä¸º 10ã€‚** ä¸‹é¢åœ¨æˆ‘ä»¬åˆ†æ ArrayList æ‰©å®¹æ—¶ä¼šè®²åˆ°è¿™ä¸€ç‚¹å†…å®¹ï¼\n\n\n> è¡¥å……ï¼šJDK7 newæ— å‚æ„é€ çš„ArrayListå¯¹è±¡æ—¶ï¼Œç›´æ¥åˆ›å»ºäº†é•¿åº¦æ˜¯10çš„Object[]æ•°ç»„elementData ã€‚jdk7ä¸­çš„ArrayListçš„å¯¹è±¡çš„åˆ›å»ºç±»ä¼¼äºå•ä¾‹çš„é¥¿æ±‰å¼ï¼Œè€Œjdk8ä¸­çš„ArrayListçš„å¯¹è±¡çš„åˆ›å»ºç±»ä¼¼äºå•ä¾‹çš„æ‡’æ±‰å¼ã€‚JDK8çš„å†…å­˜ä¼˜åŒ–ä¹Ÿå€¼å¾—æˆ‘ä»¬åœ¨å¹³æ—¶å¼€å‘ä¸­å­¦ä¹ ã€‚\n\n- å½“æˆ‘ä»¬è¦ add è¿›ç¬¬ 1 ä¸ªå…ƒç´ åˆ° ArrayList æ—¶ï¼ŒelementData.length ä¸º 0 ï¼ˆå› ä¸ºè¿˜æ˜¯ä¸€ä¸ªç©ºçš„ listï¼‰ï¼Œå› ä¸ºæ‰§è¡Œäº† `ensureCapacityInternal()` æ–¹æ³• ï¼Œæ‰€ä»¥ minCapacity æ­¤æ—¶ä¸º 10ã€‚æ­¤æ—¶ï¼Œ`minCapacity - elementData.length > 0`æˆç«‹ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ `grow(minCapacity)` æ–¹æ³•ã€‚\n- å½“ add ç¬¬ 2 ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacity ä¸º 2ï¼Œæ­¤æ—¶ e lementData.length(å®¹é‡)åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ åæ‰©å®¹æˆ 10 äº†ã€‚æ­¤æ—¶ï¼Œ`minCapacity - elementData.length > 0` ä¸æˆç«‹ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ ï¼ˆæ‰§è¡Œï¼‰`grow(minCapacity)` æ–¹æ³•ã€‚\n- æ·»åŠ ç¬¬ 3ã€4Â·Â·Â·åˆ°ç¬¬ 10 ä¸ªå…ƒç´ æ—¶ï¼Œä¾ç„¶ä¸ä¼šæ‰§è¡Œ grow æ–¹æ³•ï¼Œæ•°ç»„å®¹é‡éƒ½ä¸º 10ã€‚\n\nç›´åˆ°æ·»åŠ ç¬¬ 11 ä¸ªå…ƒç´ ï¼ŒminCapacity(ä¸º 11)æ¯” elementData.lengthï¼ˆä¸º 10ï¼‰è¦å¤§ã€‚è¿›å…¥ grow æ–¹æ³•è¿›è¡Œæ‰©å®¹ã€‚\n\n\n**grow()æ–¹æ³•**\n\n\n**int newCapacity = oldCapacity + (oldCapacity >> 1),æ‰€ä»¥ ArrayList æ¯æ¬¡æ‰©å®¹ä¹‹åå®¹é‡éƒ½ä¼šå˜ä¸ºåŸæ¥çš„ 1.5 å€å·¦å³ï¼ˆoldCapacity ä¸ºå¶æ•°å°±æ˜¯ 1.5 å€ï¼Œå¦åˆ™æ˜¯ 1.5 å€å·¦å³ï¼‰ï¼** å¥‡å¶ä¸åŒï¼Œæ¯”å¦‚ ï¼š10+10/2 = 15, 33+33/2=49ã€‚å¦‚æœæ˜¯å¥‡æ•°çš„è¯ä¼šä¸¢æ‰å°æ•°.\n\n\n> \">>\"ï¼ˆç§»ä½è¿ç®—ç¬¦ï¼‰ï¼š>>1 å³ç§»ä¸€ä½ç›¸å½“äºé™¤ 2ï¼Œå³ç§» n ä½ç›¸å½“äºé™¤ä»¥ 2 çš„ n æ¬¡æ–¹ã€‚è¿™é‡Œ oldCapacity æ˜æ˜¾å³ç§»äº† 1 ä½æ‰€ä»¥ç›¸å½“äº oldCapacity /2ã€‚å¯¹äºå¤§æ•°æ®çš„ 2 è¿›åˆ¶è¿ç®—,ä½ç§»è¿ç®—ç¬¦æ¯”é‚£äº›æ™®é€šè¿ç®—ç¬¦çš„è¿ç®—è¦å¿«å¾ˆå¤š,å› ä¸ºç¨‹åºä»…ä»…ç§»åŠ¨ä¸€ä¸‹è€Œå·²,ä¸å»è®¡ç®—,è¿™æ ·æé«˜äº†æ•ˆç‡,èŠ‚çœäº†èµ„æº\n\n\n**æˆ‘ä»¬å†æ¥é€šè¿‡ä¾‹å­æ¢ç©¶ä¸€ä¸‹****`grow()`** **æ–¹æ³• ï¼š**\n\n- å½“ add ç¬¬ 1 ä¸ªå…ƒç´ æ—¶ï¼ŒoldCapacity ä¸º 0ï¼Œç»æ¯”è¾ƒåç¬¬ä¸€ä¸ª if åˆ¤æ–­æˆç«‹ï¼ŒnewCapacity = minCapacity(ä¸º 10)ã€‚ä½†æ˜¯ç¬¬äºŒä¸ª if åˆ¤æ–­ä¸ä¼šæˆç«‹ï¼Œå³ newCapacity ä¸æ¯” MAX_ARRAY_SIZE å¤§ï¼Œåˆ™ä¸ä¼šè¿›å…¥ `hugeCapacity` æ–¹æ³•ã€‚æ•°ç»„å®¹é‡ä¸º 10ï¼Œadd æ–¹æ³•ä¸­ return true,size å¢ä¸º 1ã€‚\n- å½“ add ç¬¬ 11 ä¸ªå…ƒç´ è¿›å…¥ grow æ–¹æ³•æ—¶ï¼ŒnewCapacity ä¸º 15ï¼Œæ¯” minCapacityï¼ˆä¸º 11ï¼‰å¤§ï¼Œç¬¬ä¸€ä¸ª if åˆ¤æ–­ä¸æˆç«‹ã€‚æ–°å®¹é‡æ²¡æœ‰å¤§äºæ•°ç»„æœ€å¤§ sizeï¼Œä¸ä¼šè¿›å…¥ hugeCapacity æ–¹æ³•ã€‚æ•°ç»„å®¹é‡æ‰©ä¸º 15ï¼Œadd æ–¹æ³•ä¸­ return true,size å¢ä¸º 11ã€‚\n- ä»¥æ­¤ç±»æ¨Â·Â·Â·Â·Â·Â·\n\n**è¿™é‡Œè¡¥å……ä¸€ç‚¹æ¯”è¾ƒé‡è¦ï¼Œä½†æ˜¯å®¹æ˜“è¢«å¿½è§†æ‰çš„çŸ¥è¯†ç‚¹ï¼š**\n\n- java ä¸­çš„ `length`å±æ€§æ˜¯é’ˆå¯¹æ•°ç»„è¯´çš„,æ¯”å¦‚è¯´ä½ å£°æ˜äº†ä¸€ä¸ªæ•°ç»„,æƒ³çŸ¥é“è¿™ä¸ªæ•°ç»„çš„é•¿åº¦åˆ™ç”¨åˆ°äº† length è¿™ä¸ªå±æ€§.\n- java ä¸­çš„ `length()` æ–¹æ³•æ˜¯é’ˆå¯¹å­—ç¬¦ä¸²è¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦åˆ™ç”¨åˆ° `length()` è¿™ä¸ªæ–¹æ³•.\n- java ä¸­çš„ `size()` æ–¹æ³•æ˜¯é’ˆå¯¹æ³›å‹é›†åˆè¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªæ³›å‹æœ‰å¤šå°‘ä¸ªå…ƒç´ ,å°±è°ƒç”¨æ­¤æ–¹æ³•æ¥æŸ¥çœ‹!\n\n### LinkedList\n\n\n> LinkedListæ˜¯ä¸€ä¸ªå®ç°äº†Listæ¥å£å’ŒDequeæ¥å£çš„åŒç«¯é“¾è¡¨ã€‚ LinkedListåº•å±‚çš„é“¾è¡¨ç»“æ„ä½¿å®ƒæ”¯æŒé«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œå¦å¤–å®ƒå®ç°äº†Dequeæ¥å£ï¼Œä½¿å¾—LinkedListç±»ä¹Ÿå…·æœ‰é˜Ÿåˆ—çš„ç‰¹æ€§; LinkedListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœæƒ³ä½¿LinkedListå˜æˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥è°ƒç”¨é™æ€ç±»Collectionsç±»ä¸­çš„synchronizedListæ–¹æ³•ï¼š\n\n\n**å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š**\n\n\n![](https://blog-file.hehouhui.cn/202203222157254.png)\n\n\nçœ‹å®Œäº†å›¾ä¹‹åï¼Œæˆ‘ä»¬å†çœ‹LinkedListç±»ä¸­çš„ä¸€ä¸ª\n\n\n**å†…éƒ¨ç§æœ‰ç±»Node**\n\n\nå°±å¾ˆå¥½ç†è§£äº†ï¼š\n\n\n```java\nprivate static class Node<E> {\n        E item;//èŠ‚ç‚¹å€¼\n        Node<E> next;//åç»§èŠ‚ç‚¹\n        Node<E> prev;//å‰é©±èŠ‚ç‚¹\n\n        Node(Node<E> prev, E element, Node<E> next) {\n            this.item = element;\n            this.next = next;\n            this.prev = prev;\n        }\n    }\n\n```\n\n\nè¿™ä¸ªç±»å°±ä»£è¡¨åŒç«¯é“¾è¡¨çš„èŠ‚ç‚¹Nodeã€‚è¿™ä¸ªç±»æœ‰ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯å‰é©±èŠ‚ç‚¹ï¼Œæœ¬èŠ‚ç‚¹çš„å€¼ï¼Œåç»§ç»“ç‚¹ã€‚\n\n\n## HashMap\n\n\nHashMap ä¸»è¦ç”¨æ¥å­˜æ”¾é”®å€¼å¯¹ï¼Œå®ƒåŸºäºå“ˆå¸Œè¡¨çš„Mapæ¥å£å®ç°ï¼Œæ˜¯å¸¸ç”¨çš„Javaé›†åˆä¹‹ä¸€ã€‚\n\n\nJDK1.8 ä¹‹å‰ HashMap ç”± æ•°ç»„+é“¾è¡¨ ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰.JDK1.8 ä»¥ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ `treeifyBin`æ–¹æ³•ã€‚\n\n\n### åº•å±‚ç»“æ„\n\n\n### 1.8å‰\n\n\nJDK1.8 ä¹‹å‰ HashMap åº•å±‚æ˜¯ **æ•°ç»„å’Œé“¾è¡¨** ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ä¹Ÿå°±æ˜¯ **é“¾è¡¨æ•£åˆ—**ã€‚**HashMap é€šè¿‡ key çš„ hashCode ç»è¿‡æ‰°åŠ¨å‡½æ•°å¤„ç†è¿‡åå¾—åˆ° hash å€¼ï¼Œç„¶åé€šè¿‡** **`(n - 1) & hash`** **åˆ¤æ–­å½“å‰å…ƒç´ å­˜æ”¾çš„ä½ç½®ï¼ˆè¿™é‡Œçš„ n æŒ‡çš„æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ï¼Œå¦‚æœå½“å‰ä½ç½®å­˜åœ¨å…ƒç´ çš„è¯ï¼Œå°±åˆ¤æ–­è¯¥å…ƒç´ ä¸è¦å­˜å…¥çš„å…ƒç´ çš„ hash å€¼ä»¥åŠ key æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒçš„è¯ï¼Œç›´æ¥è¦†ç›–ï¼Œä¸ç›¸åŒå°±é€šè¿‡æ‹‰é“¾æ³•è§£å†³å†²çªã€‚**\n\n\n**æ‰€è°“æ‰°åŠ¨å‡½æ•°æŒ‡çš„å°±æ˜¯ HashMap çš„ hash æ–¹æ³•ã€‚ä½¿ç”¨ hash æ–¹æ³•ä¹Ÿå°±æ˜¯æ‰°åŠ¨å‡½æ•°æ˜¯ä¸ºäº†é˜²æ­¢ä¸€äº›å®ç°æ¯”è¾ƒå·®çš„ hashCode() æ–¹æ³• æ¢å¥è¯è¯´ä½¿ç”¨æ‰°åŠ¨å‡½æ•°ä¹‹åå¯ä»¥å‡å°‘ç¢°æ’ã€‚**\n\n\nJDK 1.8 çš„ hashæ–¹æ³• ç›¸æ¯”äº JDK 1.7 hash æ–¹æ³•æ›´åŠ ç®€åŒ–ï¼Œä½†æ˜¯åŸç†ä¸å˜ã€‚\n\n\n```java\n    static final int hash(Object key) {\n      int h;\n      // key.hashCode()ï¼šè¿”å›æ•£åˆ—å€¼ä¹Ÿå°±æ˜¯hashcode\n      // ^ ï¼šæŒ‰ä½å¼‚æˆ–\n      // >>>:æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½\n      return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);\n  }\n\n```\n\n\nå¯¹æ¯”ä¸€ä¸‹ JDK1.7çš„ HashMap çš„ hash æ–¹æ³•æºç .\n\n\n```java\nstatic int hash(int h) {\n    // This function ensures that hashCodes that differ only by\n    // constant multiples at each bit position have a bounded\n    // number of collisions (approximately 8 at default load factor).\n\n    h ^= (h >>> 20) ^ (h >>> 12);\n    return h ^ (h >>> 7) ^ (h >>> 4);\n}\n\n```\n\n\nç›¸æ¯”äº JDK1.8 çš„ hash æ–¹æ³• ï¼ŒJDK 1.7 çš„ hash æ–¹æ³•çš„æ€§èƒ½ä¼šç¨å·®ä¸€ç‚¹ç‚¹ï¼Œå› ä¸ºæ¯•ç«Ÿæ‰°åŠ¨äº† 4 æ¬¡ã€‚\n\n\næ‰€è°“ **â€œæ‹‰é“¾æ³•â€** å°±æ˜¯ï¼šå°†é“¾è¡¨å’Œæ•°ç»„ç›¸ç»“åˆã€‚ä¹Ÿå°±æ˜¯è¯´åˆ›å»ºä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€æ ¼å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚è‹¥é‡åˆ°å“ˆå¸Œå†²çªï¼Œåˆ™å°†å†²çªçš„å€¼åŠ åˆ°é“¾è¡¨ä¸­å³å¯ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203869.png)\n\n\n### 1.8å\n\n\nç›¸æ¯”äºä¹‹å‰çš„ç‰ˆæœ¬ï¼Œjdk1.8åœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203079.jpg)\n\n\n**ç±»çš„å±æ€§ï¼š**\n\n\n```java\npublic class HashMap<K,V> extends AbstractMap<K,V> implements Map<K,V>, Cloneable, Serializable {\n    // åºåˆ—å·\n    private static final long serialVersionUID = 362498820763181265L;\n    // é»˜è®¤çš„åˆå§‹å®¹é‡æ˜¯16\n    static final int DEFAULT_INITIAL_CAPACITY = 1 << 4;\n    // æœ€å¤§å®¹é‡\n    static final int MAXIMUM_CAPACITY = 1 << 30;\n    // é»˜è®¤çš„å¡«å……å› å­\n    static final float DEFAULT_LOAD_FACTOR = 0.75f;\n    // å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å¤§äºè¿™ä¸ªå€¼æ—¶ä¼šè½¬æˆçº¢é»‘æ ‘\n    static final int TREEIFY_THRESHOLD = 8;\n    // å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å°äºè¿™ä¸ªå€¼æ—¶æ ‘è½¬é“¾è¡¨\n    static final int UNTREEIFY_THRESHOLD = 6;\n    // æ¡¶ä¸­ç»“æ„è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹åº”çš„tableçš„æœ€å°å¤§å°\n    static final int MIN_TREEIFY_CAPACITY = 64;\n    // å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼Œæ€»æ˜¯2çš„å¹‚æ¬¡å€\n    transient Node<k,v>[] table;\n    // å­˜æ”¾å…·ä½“å…ƒç´ çš„é›†\n    transient Set<map.entry<k,v>> entrySet;\n    // å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œæ³¨æ„è¿™ä¸ªä¸ç­‰äºæ•°ç»„çš„é•¿åº¦ã€‚\n    transient int size;\n    // æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹mapç»“æ„çš„è®¡æ•°å™¨\n    transient int modCount;\n    // ä¸´ç•Œå€¼ å½“å®é™…å¤§å°(å®¹é‡*å¡«å……å› å­)è¶…è¿‡ä¸´ç•Œå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹\n    int threshold;\n    // åŠ è½½å› å­\n    final float loadFactor;\n}\n\n```\n\n- **loadFactoråŠ è½½å› å­**\n\n\tloadFactoråŠ è½½å› å­æ˜¯æ§åˆ¶æ•°ç»„å­˜æ”¾æ•°æ®çš„ç–å¯†ç¨‹åº¦ï¼ŒloadFactorè¶Šè¶‹è¿‘äº1ï¼Œé‚£ä¹ˆ æ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ä¹Ÿå°±è¶Šå¤šï¼Œä¹Ÿå°±è¶Šå¯†ï¼Œä¹Ÿå°±æ˜¯ä¼šè®©é“¾è¡¨çš„é•¿åº¦å¢åŠ ï¼ŒloadFactorè¶Šå°ï¼Œä¹Ÿå°±æ˜¯è¶‹è¿‘äº0ï¼Œæ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ä¹Ÿå°±è¶Šå°‘ï¼Œä¹Ÿå°±è¶Šç¨€ç–ã€‚\n\n\n\t**loadFactorå¤ªå¤§å¯¼è‡´æŸ¥æ‰¾å…ƒç´ æ•ˆç‡ä½ï¼Œå¤ªå°å¯¼è‡´æ•°ç»„çš„åˆ©ç”¨ç‡ä½ï¼Œå­˜æ”¾çš„æ•°æ®ä¼šå¾ˆåˆ†æ•£ã€‚loadFactorçš„é»˜è®¤å€¼ä¸º0.75fæ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¸´ç•Œå€¼**ã€‚\n\n\n\tç»™å®šçš„é»˜è®¤å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚Map åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­çš„å¾€é‡Œé¢å­˜æ”¾æ•°æ®ï¼Œå½“æ•°é‡è¾¾åˆ°äº† 16 * 0.75 = 12 å°±éœ€è¦å°†å½“å‰ 16 çš„å®¹é‡è¿›è¡Œæ‰©å®¹ï¼Œè€Œæ‰©å®¹è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° rehashã€å¤åˆ¶æ•°æ®ç­‰æ“ä½œï¼Œæ‰€ä»¥éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚\n\n- **threshold**\n\n\t_threshold = capacity \\_ _loadFactor_*ï¼Œ**å½“Size>=threshold**çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘å¯¹æ•°ç»„çš„æ‰©å¢äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªçš„æ„æ€å°±æ˜¯ **è¡¡é‡æ•°ç»„æ˜¯å¦éœ€è¦æ‰©å¢çš„ä¸€ä¸ªæ ‡å‡†**ã€‚\n\n\n### putæ–¹æ³•ï¼ˆæ‰©å®¹ï¼‰\n\n\nHashMapåªæä¾›äº†putç”¨äºæ·»åŠ å…ƒç´ ï¼ŒputValæ–¹æ³•åªæ˜¯ç»™putæ–¹æ³•è°ƒç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶æ²¡æœ‰æä¾›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚\n\n\n**å¯¹putValæ–¹æ³•æ·»åŠ å…ƒç´ çš„åˆ†æå¦‚ä¸‹ï¼š**\n\n- â‘ å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æ²¡æœ‰å…ƒç´  å°±ç›´æ¥æ’å…¥ã€‚\n- â‘¡å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æœ‰å…ƒç´ å°±å’Œè¦æ’å…¥çš„keyæ¯”è¾ƒï¼Œå¦‚æœkeyç›¸åŒå°±ç›´æ¥è¦†ç›–ï¼Œå¦‚æœkeyä¸ç›¸åŒï¼Œå°±åˆ¤æ–­pæ˜¯å¦æ˜¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨`e = ((TreeNode)p).putTreeVal(this, tab, hash, key, value)`å°†å…ƒç´ æ·»åŠ è¿›å…¥ã€‚å¦‚æœä¸æ˜¯å°±éå†é“¾è¡¨æ’å…¥(æ’å…¥çš„æ˜¯é“¾è¡¨å°¾éƒ¨)ã€‚\n\nps:ä¸‹å›¾æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œæ¥è‡ª [issue#608](https://github.com/Snailclimb/JavaGuide/issues/608)æŒ‡å‡ºï¼šç›´æ¥è¦†ç›–ä¹‹ååº”è¯¥å°±ä¼š returnï¼Œä¸ä¼šæœ‰åç»­æ“ä½œã€‚å‚è€ƒ JDK8 HashMap.java 658 è¡Œã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203154.png)\n\n\n**æˆ‘ä»¬å†æ¥å¯¹æ¯”ä¸€ä¸‹ JDK1.7 putæ–¹æ³•çš„ä»£ç **\n\n\n**å¯¹äºputæ–¹æ³•çš„åˆ†æå¦‚ä¸‹ï¼š**\n\n- â‘ å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æ²¡æœ‰å…ƒç´  å°±ç›´æ¥æ’å…¥ã€‚\n- â‘¡å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æœ‰å…ƒç´ ï¼Œéå†ä»¥è¿™ä¸ªå…ƒç´ ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ï¼Œä¾æ¬¡å’Œæ’å…¥çš„keyæ¯”è¾ƒï¼Œå¦‚æœkeyç›¸åŒå°±ç›´æ¥è¦†ç›–ï¼Œä¸åŒå°±é‡‡ç”¨å¤´æ’æ³•æ’å…¥å…ƒç´ ã€‚\n\n### resizeæ–¹æ³•\n\n\nè¿›è¡Œæ‰©å®¹ï¼Œä¼šä¼´éšç€ä¸€æ¬¡é‡æ–°hashåˆ†é…ï¼Œå¹¶ä¸”ä¼šéå†hashè¡¨ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ã€‚åœ¨ç¼–å†™ç¨‹åºä¸­ï¼Œè¦å°½é‡é¿å…resizeã€‚\n\n- LinkedListçš„åº•å±‚ç»“æ„æ˜¯åŒç«¯é“¾è¡¨ï¼Œæ”¯æŒé«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼ŒåŒæ—¶å®ç°äº†Dequeæ¥å£ï¼Œä¹Ÿå…·æœ‰é˜Ÿåˆ—çš„ç‰¹æ€§ã€‚\n- HashMapä¸»è¦ç”¨æ¥å­˜æ”¾é”®å€¼å¯¹ï¼ŒåŸºäºå“ˆå¸Œè¡¨çš„Mapæ¥å£å®ç°ï¼Œæ˜¯å¸¸ç”¨çš„Javaé›†åˆä¹‹ä¸€ã€‚JDK1.8ä¹‹å‰çš„HashMapç”±æ•°ç»„+é“¾è¡¨ç»„æˆï¼Œæ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ã€‚JDK1.8ä»¥åï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚\n- åœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œä¼šä¼´éšç€ä¸€æ¬¡é‡æ–°hashåˆ†é…ï¼Œå¹¶ä¸”ä¼šéå†hashè¡¨ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ï¼Œè¦å°½é‡é¿å…resizeã€‚\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-03-08",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "44",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java",
          "æ•°æ®ç»“æ„"
        ],
        "summary": "è¿™ç¯‡æ–‡ç« è®²è§£äº†Javaé›†åˆä¸­çš„ArrayListï¼Œå®ƒæ˜¯ä¸€ç§åŠ¨æ€æ•°ç»„ï¼Œå¯ä»¥å¿«é€Ÿéšæœºè®¿é—®ã€‚ç›¸æ¯”äºVectorï¼ŒArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯LinkedListåˆ™ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ã€‚æ­¤å¤–ï¼ŒArrayListå®ç°äº†å¤šä¸ªæ¥å£ï¼ŒåŒ…æ‹¬Listã€RandomAccessã€Cloneableå’ŒSerializableã€‚å› æ­¤ï¼ŒArrayListåœ¨å®é™…åº”ç”¨ä¸­éå¸¸å¸¸è§ã€‚\né™¤äº†ArrayListï¼Œæ–‡ç« è¿˜ä»‹ç»äº†Javaä¸­çš„å…¶ä»–é›†åˆç±»å‹ï¼Œå¦‚LinkedListå’ŒHashMapã€‚LinkedListæ˜¯ä¸€ç§åŒå‘é“¾è¡¨ï¼Œå¯ä»¥åœ¨ä»»æ„ä½ç½®è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œä½†æ˜¯ä¸æ”¯æŒéšæœºè®¿é—®ã€‚è€ŒHashMapæ˜¯ä¸€ç§åŸºäºå“ˆå¸Œè¡¨å®ç°çš„Mapï¼Œå¯ä»¥ç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚HashMapä½¿ç”¨æ•°ç»„å’Œé“¾è¡¨ç»“åˆçš„æ–¹å¼ï¼Œæ¥è§£å†³å“ˆå¸Œå†²çªçš„é—®é¢˜ï¼ŒJDK1.8ä¹‹åè¿˜å¼•å…¥äº†çº¢é»‘æ ‘æ¥ä¼˜åŒ–æ€§èƒ½ã€‚\næ–‡ç« è¿˜ä»‹ç»äº†ä¸€äº›Javaé›†åˆä¸­çš„åº•å±‚å®ç°ç»†èŠ‚ï¼Œä¾‹å¦‚HashMapä¸­çš„æ‰°åŠ¨å‡½æ•°ã€loadFactoråŠ è½½å› å­ã€thresholdä¸´ç•Œå€¼ç­‰ã€‚è¿™äº›ç»†èŠ‚å¯¹äºç†è§£é›†åˆçš„å·¥ä½œåŸç†éå¸¸é‡è¦ï¼Œä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨Javaé›†åˆã€‚\næ€»ä¹‹ï¼ŒJavaé›†åˆæ˜¯Javaç¼–ç¨‹ä¸­éå¸¸å¸¸ç”¨çš„ä¸€éƒ¨åˆ†ï¼ŒæŒæ¡å¥½é›†åˆçš„ä½¿ç”¨æ–¹æ³•å’Œåº•å±‚å®ç°ç»†èŠ‚ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼–å†™æ›´é«˜æ•ˆã€æ›´æ˜“ç»´æŠ¤çš„Javaä»£ç ã€‚",
        "sort": "",
        "title": "JavaåŸºç¡€-é›†åˆ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "ba68c9c4-7d5d-4640-80d9-c123616ea287"
        }
      ],
      "body": "",
      "realName": "JavaåŸºç¡€-é›†åˆ",
      "relativePath": "/archives/JavaåŸºç¡€-é›†åˆ.md"
    },
    {
      "id": "387ccffe-e894-442f-9471-2460619d4e62",
      "doc_id": "387ccffe-e894-442f-9471-2460619d4e62",
      "title": "387ccffe-e894-442f-9471-2460619d4e62",
      "updated": 1696747320000,
      "body_original": "\n# Redis é¢è¯•å®å…¸ğŸ¤ª\n\n\n> ğŸ’¡ Redisæ˜¯ä¸€ç§é«˜æ€§èƒ½çš„key-valueå­˜å‚¨ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š  \n> 1. å†…å­˜å­˜å‚¨ï¼šRediså°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œé€šå¸¸æ¯”åŸºäºç£ç›˜çš„å­˜å‚¨ç³»ç»Ÿå¿«å‡ ä¸ªæ•°é‡çº§ã€‚  \n>   \n> 2. æ•°æ®ç»“æ„å¤šæ ·ï¼šRedisæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆç­‰ï¼Œä¸°å¯Œçš„æ•°æ®ç»“æ„ä½¿Rediså¯ä»¥æ”¯æŒæ›´å¤šçš„åº”ç”¨åœºæ™¯ã€‚  \n>   \n> 3. æŒä¹…åŒ–ï¼šRedisæ”¯æŒå°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œä»¥ä¿è¯æ•°æ®çš„å¯é æ€§ã€‚  \n>   \n> 4. é«˜å¹¶å‘æ€§ï¼šRedisé‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼Œå‡å°‘äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œä»è€Œä½¿å¾—Rediså…·æœ‰æ›´é«˜çš„å¹¶å‘æ€§ã€‚  \n>   \n> 5. åˆ†å¸ƒå¼ï¼šRedisæä¾›äº†é›†ç¾¤æ¨¡å¼ï¼Œå¯ä»¥å°†æ•°æ®åˆ†å¸ƒåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå®ç°æ°´å¹³æ‰©å±•ã€‚\n\n\n> ğŸ’¡ Redisçš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š  \n>   \n> 1. ç¼“å­˜ï¼šRediså¸¸ç”¨äºä½œä¸ºç¼“å­˜ç³»ç»Ÿï¼Œç”¨äºåŠ é€Ÿæ•°æ®çš„è¯»å–ã€‚é€šè¿‡å°†çƒ­æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå¯ä»¥å‡å°‘ç£ç›˜è¯»å–æ¬¡æ•°ï¼Œä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚  \n>   \n> 2. è®¡æ•°å™¨ï¼šRedisæ”¯æŒåŸå­æ“ä½œï¼Œå¯ä»¥ç”¨äºå®ç°è®¡æ•°å™¨åŠŸèƒ½ã€‚  \n>   \n> 3. æ¶ˆæ¯é˜Ÿåˆ—ï¼šRedisæ”¯æŒå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œå¯ä»¥ç”¨äºå®ç°ç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½ã€‚  \n>   \n> 4. åˆ†å¸ƒå¼é”ï¼šRediså¯ä»¥é€šè¿‡åŸå­æ“ä½œå®ç°åˆ†å¸ƒå¼é”ï¼Œç”¨äºå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„äº’æ–¥è®¿é—®ã€‚  \n>   \n> 5. ä¼šè¯ç®¡ç†ï¼šRediså¯ä»¥ç”¨äºå­˜å‚¨ä¼šè¯æ•°æ®ï¼Œä»è€Œå®ç°åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„ä¼šè¯ç®¡ç†ã€‚\n\n\n## **ä¸€è‡´æ€§hash**\n\n\n> åœ¨Redis é›†ç¾¤æ¨¡å¼Clusterä¸­ï¼ŒRedisé‡‡ç”¨çš„æ˜¯åˆ†ç‰‡Shardingçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®é‡‡ç”¨ä¸€å®šçš„åˆ†åŒºç­–ç•¥ï¼Œåˆ†å‘åˆ°ç›¸åº”çš„é›†ç¾¤èŠ‚ç‚¹ä¸­ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°HASHç®—æ³•è¿›è¡Œç¼“å­˜æ—¶ï¼Œä¼šå‡ºç°ä¸€äº›ç¼ºé™·ï¼Œä¸»è¦ä½“ç°åœ¨æœåŠ¡å™¨æ•°é‡å˜åŠ¨çš„æ—¶å€™ï¼Œæ‰€æœ‰ç¼“å­˜çš„ä½ç½®éƒ½è¦å‘ç”Ÿæ”¹å˜ï¼å…·ä½“æ¥è®²å°±æ˜¯è¯´ç¬¬ä¸€å½“ç¼“å­˜æœåŠ¡å™¨æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå¼•èµ·ç¼“å­˜çš„é›ªå´©ï¼Œå¯èƒ½ä¼šå¼•èµ·æ•´ä½“ç³»ç»Ÿå‹åŠ›è¿‡å¤§è€Œå´©æºƒï¼ˆå¤§é‡ç¼“å­˜åŒä¸€æ—¶é—´å¤±æ•ˆï¼‰ã€‚ç¬¬äºŒå½“ç¼“å­˜æœåŠ¡å™¨æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‡ ä¹æ‰€æœ‰ç¼“å­˜çš„ä½ç½®éƒ½ä¼šå‘ç”Ÿæ”¹å˜ã€‚\n\n\nä¸€è‡´æ€§Hashç®—æ³•ä¹Ÿæ˜¯ä½¿ç”¨å–æ¨¡çš„æ–¹æ³•ï¼Œåªæ˜¯ï¼Œåˆšæ‰æè¿°çš„å–æ¨¡æ³•æ˜¯å¯¹æœåŠ¡å™¨çš„æ•°é‡è¿›è¡Œå–æ¨¡ï¼Œè€Œä¸€è‡´æ€§Hashç®—æ³•æ˜¯å¯¹232å–æ¨¡ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œä¸€è‡´æ€§Hashç®—æ³•å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œå¦‚å‡è®¾æŸå“ˆå¸Œå‡½æ•°Hçš„å€¼ç©ºé—´ä¸º0-232-1ï¼ˆå³å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å½¢ï¼‰ï¼Œæ•´ä¸ªå“ˆå¸Œç¯å¦‚ä¸‹ï¼š\n\n\n![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/8a35a23c-1341-49da-a621-55a436622c1d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20231031%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20231031T090555Z&X-Amz-Expires=3600&X-Amz-Signature=56ed1dd1e3db26bc28cea11990eb4d5a3ca9a077d6ca90e9cb3f7ed5584d2329&X-Amz-SignedHeaders=host&x-id=GetObject)\n\n\næ•´ä¸ªç©ºé—´æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ï¼Œåœ†ç¯çš„æ­£ä¸Šæ–¹çš„ç‚¹ä»£è¡¨0ï¼Œ0ç‚¹å³ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨1ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ2ã€3ã€4ã€5ã€6â€¦â€¦ç›´åˆ°232-1ï¼Œä¹Ÿå°±æ˜¯è¯´0ç‚¹å·¦ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨232-1ï¼Œ 0å’Œ232-1åœ¨é›¶ç‚¹ä¸­æ–¹å‘é‡åˆï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç”±232ä¸ªç‚¹ç»„æˆçš„åœ†ç¯ç§°ä¸ºHashç¯ã€‚\n\n\né‚£ä¹ˆï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸ä¸Šå›¾ä¸­çš„åœ†ç¯æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­èŠï¼Œä»ç„¶ä»¥ä¹‹å‰æè¿°çš„åœºæ™¯ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰4å°ç¼“å­˜æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨Aã€æœåŠ¡å™¨Bã€æœåŠ¡å™¨Cï¼ŒæœåŠ¡å™¨Dï¼Œé‚£ä¹ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™4å°æœåŠ¡å™¨è‚¯å®šæœ‰è‡ªå·±çš„IPåœ°å€æˆ–ä¸»æœºåï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒä»¬å„è‡ªçš„IPåœ°å€æˆ–ä¸»æœºåä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œä½¿ç”¨å“ˆå¸Œåçš„ç»“æœå¯¹2^32å–æ¨¡ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å…¬å¼ç¤ºæ„ï¼š\n\n\n$$\nhashï¼ˆæœåŠ¡å™¨Açš„IPåœ°å€ï¼‰ %  2^32\n$$\n\n\né€šè¿‡ä¸Šè¿°å…¬å¼ç®—å‡ºçš„ç»“æœä¸€å®šæ˜¯ä¸€ä¸ª0åˆ°232-1ä¹‹é—´çš„ä¸€ä¸ªæ•´æ•°ï¼Œæˆ‘ä»¬å°±ç”¨ç®—å‡ºçš„è¿™ä¸ªæ•´æ•°ï¼Œä»£è¡¨æœåŠ¡å™¨Aï¼Œæ—¢ç„¶è¿™ä¸ªæ•´æ•°è‚¯å®šå¤„äº0åˆ°232-1ä¹‹é—´ï¼Œé‚£ä¹ˆï¼Œä¸Šå›¾ä¸­çš„hashç¯ä¸Šå¿…å®šæœ‰ä¸€ä¸ªç‚¹ä¸è¿™ä¸ªæ•´æ•°å¯¹åº”ï¼Œè€Œæˆ‘ä»¬åˆšæ‰å·²ç»è¯´æ˜ï¼Œä½¿ç”¨è¿™ä¸ªæ•´æ•°ä»£è¡¨æœåŠ¡å™¨Aï¼Œé‚£ä¹ˆï¼ŒæœåŠ¡å™¨Aå°±å¯ä»¥æ˜ å°„åˆ°è¿™ä¸ªç¯ä¸Šã€‚\n\n\nä»¥æ­¤ç±»æ¨ï¼Œä¸‹ä¸€æ­¥å°†å„ä¸ªæœåŠ¡å™¨ä½¿ç”¨ç±»ä¼¼çš„Hashç®—å¼è¿›è¡Œä¸€ä¸ªå“ˆå¸Œï¼Œè¿™æ ·æ¯å°æœºå™¨å°±èƒ½ç¡®å®šå…¶åœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ï¼Œè¿™é‡Œå‡è®¾å°†ä¸Šæ–‡ä¸­å››å°æœåŠ¡å™¨ä½¿ç”¨IPåœ°å€å“ˆå¸Œååœ¨ç¯ç©ºé—´çš„ä½ç½®å¦‚ä¸‹ï¼š\n\n\næ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹ç®—æ³•å®šä½æ•°æ®è®¿é—®åˆ°ç›¸åº”æœåŠ¡å™¨ï¼š å°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œå¹¶ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨ï¼\n\n\n### **Hashç®—æ³•çš„å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§**\n\n\nç°å‡è®¾Node Cä¸å¹¸å®•æœºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å¯¹è±¡Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Cå¯¹è±¡è¢«é‡å®šä½åˆ°Node Dã€‚ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§Hashç®—æ³•ä¸­ï¼Œå¦‚æœä¸€å°æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒä¸ä¼šå—åˆ°å½±å“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n\n![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/d578620f-e4b5-41c5-990a-8c7bc1aa4fdc/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20231031%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20231031T090555Z&X-Amz-Expires=3600&X-Amz-Signature=b9eeb7b958cf50850f0215debb777ea9d3c0e5b688b1ee07234f11f29c91f3e3&X-Amz-SignedHeaders=host&x-id=GetObject)\n\n\nä¸‹é¢è€ƒè™‘å¦å¤–ä¸€ç§æƒ…å†µï¼Œå¦‚æœåœ¨ç³»ç»Ÿä¸­å¢åŠ ä¸€å°æœåŠ¡å™¨Node Xï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/5dc25236-bddd-4d82-928a-30497f92890d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20231031%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20231031T090555Z&X-Amz-Expires=3600&X-Amz-Signature=d5e082ad528629fa7f4364bab377e59535918c2c896b565f10e189c47222ff05&X-Amz-SignedHeaders=host&x-id=GetObject)\n\n\næ­¤æ—¶å¯¹è±¡Object Aã€Bã€Dä¸å—å½±å“ï¼Œåªæœ‰å¯¹è±¡Céœ€è¦é‡å®šä½åˆ°æ–°çš„Node X ï¼ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§Hashç®—æ³•ä¸­ï¼Œå¦‚æœå¢åŠ ä¸€å°æœåŠ¡å™¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ–°æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒæ•°æ®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚\n\n\nç»¼ä¸Šæ‰€è¿°ï¼Œä¸€è‡´æ€§Hashç®—æ³•å¯¹äºèŠ‚ç‚¹çš„å¢å‡éƒ½åªéœ€é‡å®šä½ç¯ç©ºé—´ä¸­çš„ä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œå…·æœ‰è¾ƒå¥½çš„å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§ã€‚\n\n\n### **æ•°æ®å€¾æ–œé—®é¢˜**\n\n\nä¸€è‡´æ€§Hashç®—æ³•åœ¨æœåŠ¡èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†éƒ¨ä¸å‡åŒ€è€Œé€ æˆæ•°æ®å€¾æ–œï¼ˆè¢«ç¼“å­˜çš„å¯¹è±¡å¤§éƒ¨åˆ†é›†ä¸­ç¼“å­˜åœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šï¼‰é—®é¢˜ï¼Œä¾‹å¦‚ç³»ç»Ÿä¸­åªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œå…¶ç¯åˆ†å¸ƒå¦‚ä¸‹ï¼š\n\n\n![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/5d967984-598b-4263-b0e8-7d5d4d08cc3e/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20231031%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20231031T090555Z&X-Amz-Expires=3600&X-Amz-Signature=1458f39bff9625ff6a497e21a843a5badc34d56058b053fc89a9a5bf59c4c40e&X-Amz-SignedHeaders=host&x-id=GetObject)\n\n\næ­¤æ—¶å¿…ç„¶é€ æˆå¤§é‡æ•°æ®é›†ä¸­åˆ°Node Aä¸Šï¼Œè€Œåªæœ‰æå°‘é‡ä¼šå®šä½åˆ°Node Bä¸Šï¼Œä»è€Œå‡ºç°hashç¯åæ–œçš„æƒ…å†µï¼Œå½“hashç¯åæ–œä»¥åï¼Œç¼“å­˜å¾€å¾€ä¼šæåº¦ä¸å‡è¡¡çš„åˆ†å¸ƒåœ¨å„æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœæƒ³è¦å‡è¡¡çš„å°†ç¼“å­˜åˆ†å¸ƒåˆ°2å°æœåŠ¡å™¨ä¸Šï¼Œæœ€å¥½èƒ½è®©è¿™2å°æœåŠ¡å™¨å°½é‡å¤šçš„ã€å‡åŒ€çš„å‡ºç°åœ¨hashç¯ä¸Šï¼Œä½†æ˜¯ï¼ŒçœŸå®çš„æœåŠ¡å™¨èµ„æºåªæœ‰2å°ï¼Œæˆ‘ä»¬æ€æ ·å‡­ç©ºçš„è®©å®ƒä»¬å¤šèµ·æ¥å‘¢ï¼Œæ²¡é”™ï¼Œå°±æ˜¯å‡­ç©ºçš„è®©æœåŠ¡å™¨èŠ‚ç‚¹å¤šèµ·æ¥ï¼Œæ—¢ç„¶æ²¡æœ‰å¤šä½™çš„çœŸæ­£çš„ç‰©ç†æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°±åªèƒ½å°†ç°æœ‰çš„ç‰©ç†èŠ‚ç‚¹é€šè¿‡è™šæ‹Ÿçš„æ–¹æ³•å¤åˆ¶å‡ºæ¥ã€‚\n\n\nè¿™äº›ç”±å®é™…èŠ‚ç‚¹è™šæ‹Ÿå¤åˆ¶è€Œæ¥çš„èŠ‚ç‚¹è¢«ç§°ä¸º\"è™šæ‹ŸèŠ‚ç‚¹\"ï¼Œå³å¯¹æ¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªæ­¤æœåŠ¡èŠ‚ç‚¹ï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚å…·ä½“åšæ³•å¯ä»¥åœ¨æœåŠ¡å™¨IPæˆ–ä¸»æœºåçš„åé¢å¢åŠ ç¼–å·æ¥å®ç°ã€‚\n\n\nä¾‹å¦‚ä¸Šé¢çš„æƒ…å†µï¼Œå¯ä»¥ä¸ºæ¯å°æœåŠ¡å™¨è®¡ç®—ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œäºæ˜¯å¯ä»¥åˆ†åˆ«è®¡ç®— â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ã€â€œNode B#1â€ã€â€œNode B#2â€ã€â€œNode B#3â€çš„å“ˆå¸Œå€¼ï¼Œäºæ˜¯å½¢æˆå…­ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼š\n\n\n![](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/a0cf35dd-13c4-40da-9eb5-e219a514f3b5/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20231031%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20231031T090555Z&X-Amz-Expires=3600&X-Amz-Signature=364f7f5225eb453c08f298c29baf4f03c63bc2ab6cc06d43ddc8ffc4e3a4e911&X-Amz-SignedHeaders=host&x-id=GetObject)\n\n\nåŒæ—¶æ•°æ®å®šä½ç®—æ³•ä¸å˜ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥è™šæ‹ŸèŠ‚ç‚¹åˆ°å®é™…èŠ‚ç‚¹çš„æ˜ å°„ï¼Œä¾‹å¦‚å®šä½åˆ°â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®å‡å®šä½åˆ°Node Aä¸Šã€‚è¿™æ ·å°±è§£å†³äº†æœåŠ¡èŠ‚ç‚¹å°‘æ—¶æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸å°†è™šæ‹ŸèŠ‚ç‚¹æ•°è®¾ç½®ä¸º32ç”šè‡³æ›´å¤§ï¼Œå› æ­¤å³ä½¿å¾ˆå°‘çš„æœåŠ¡èŠ‚ç‚¹ä¹Ÿèƒ½åšåˆ°ç›¸å¯¹å‡åŒ€çš„æ•°æ®åˆ†å¸ƒã€‚\n\n\n## **é›†ç¾¤æƒ…å†µä¸‹ä»€ä¹ˆæ—¶å€™ä¸å¯ç”¨**\n\n- å¦‚æœé›†ç¾¤ä»»æ„_master_æŒ‚æ‰_,_ä¸”å½“å‰_master_æ²¡æœ‰_slave._é›†ç¾¤è¿›å…¥_fail_çŠ¶æ€\n- æœ‰A,B,Cä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œåœ¨æ²¡æœ‰å¤åˆ¶æ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œå¦‚æœèŠ‚ç‚¹Bå¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±ä¼šä»¥ä¸ºç¼ºå°‘5501-11000è¿™ä¸ªèŒƒå›´çš„æ§½è€Œä¸å¯ç”¨ã€‚\n- å¦‚æœé›†ç¾¤è¶…è¿‡åŠæ•°ä»¥ä¸Š_master_æŒ‚æ‰ï¼Œæ— è®ºæ˜¯å¦æœ‰_slave_é›†ç¾¤è¿›å…¥_fail_çŠ¶æ€\n- é›†ç¾¤æŸä¸€èŠ‚ç‚¹çš„ä¸»ä»å…¨æ•°å®•æœº ï¼ˆä¸2ç›¸ä¼¼ï¼‰\n\n## **æ•…éšœçš„å¤„ç†è¿‡ç¨‹**\n\n1. æŸ¥çœ‹ä¸šåŠ¡æ—¥å¿—ï¼ˆå¾®æœåŠ¡ï¼‰\n2. é¦–å…ˆæŸ¥çœ‹redisé›†ç¾¤çŠ¶æ€ã€‚\n3. ç»§ç»­æŸ¥çœ‹redisé›†ç¾¤èŠ‚ç‚¹çš„çŠ¶æ€ã€‚\n\n\t**å¤„ç†è¿‡ç¨‹**\n\n\n1ã€å…ˆåœæ­¢æ‰€æœ‰redisèŠ‚ç‚¹ã€‚\n2ã€åˆ é™¤æ¯ä¸ªèŠ‚ç‚¹çš„ç¼“å­˜æ–‡ä»¶ï¼ŒåŒ…æ‹¬node-6380.conf dump.rdpç­‰æ–‡ä»¶ã€‚\n3ã€é‡å¯æ¯ä¸ªredisèŠ‚ç‚¹ã€‚\n4ã€é‡æ–°åˆ›å»ºredisé›†ç¾¤ã€‚\n\n\n## **é›†ç¾¤**\n\n\n> å‘ç°æˆ‘ä»¬å½“å‰é¡¹ç›®ç”¨çš„redisæ˜¯ä¸»ä»ï¼Œä½†æ˜¯è·Ÿå•ç‚¹å…¶å®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨åº”ç”¨å±‚é¢æ²¡æœ‰åšè¯»å†™åˆ†ç¦»ï¼Œæ‰€ä»¥å…¶å®ä»æœåŠ¡å™¨åªæ˜¯åšäº†ä¸€ä¸ªä¸»ä»å¤åˆ¶çš„å·¥ä½œï¼Œå…¶ä»–çš„ä»€ä¹ˆéƒ½æ²¡æœ‰åšã€‚\n\n\n\té‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿå‡çº§ï¼Œç”¨æˆ·é‡ä¸Šå‡ï¼Œé‚£ä¹ˆä¸€ä¸»ä¸€ä»å¯èƒ½æ‰›ä¸ä½é‚£ä¹ˆå¤§çš„å‹åŠ›ï¼Œå¯èƒ½éœ€è¦ä¸€ä¸»å¤šä»åšå¤‡æœºï¼Œé‚£ä¹ˆå‡å¦‚ä¸»æœåŠ¡å™¨å®•æœºäº†ï¼Œé€‰ä¸¾å“ªå°ä»æœåŠ¡å™¨åšä¸»å‘¢ï¼Ÿè¿™å°±æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦ä¸€ä¸ªç¬¬ä¸‰ä¸ªäººæ¥è§£å†³ï¼Œæ‰€ä»¥æˆ‘æŸ¥äº†ä¸€ä¸‹ï¼Œå“¨å…µæ¨¡å¼å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å“¨å…µæ¨¡å¼çš„ç»†èŠ‚ä¸‹é¢ä¼šè®²åˆ°ã€‚\n\n\n\tç„¶åæˆ‘åˆæƒ³äº†ï¼Œé‚£å¦‚æœå•å°æœåŠ¡å™¨æ— æ³•æ‰¿å—100%çš„å­˜å‚¨å‹åŠ›ï¼Œé‚£å°±åº”è¯¥å°†å­˜å‚¨å‹åŠ›åˆ†æ•£å¼€æ¥ï¼Œæ‰€ä»¥é›†ç¾¤å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨6å°æœåŠ¡å™¨åšé›†ç¾¤ï¼Œ3ä¸»3ä»ï¼Œé‚£ä¹ˆæ¯å°æœåŠ¡å™¨åªéœ€è¦å­˜å‚¨1/3å³å¯ã€‚å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥è¯¦ç»†çœ‹ä¸€ä¸‹è¿™äº›å…·ä½“æ€ä¹ˆåšçš„ã€‚\n\n\n### **å•ç‚¹ä¸»ä»**\n\n\nåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œæˆ‘ä»¬åº”ç”¨å±‚ä¸»è¦ä½¿ç”¨çš„æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹çš„ä¸»è¦å·¥ä½œæ˜¯ä»ä¸»èŠ‚ç‚¹åšä¸»ä»å¤åˆ¶ã€‚å…³é”®æ—¶åˆ»ï¼Œå¦‚æœä¸»æœåŠ¡å™¨æŒ‚æ‰ï¼Œå¯ä»¥æ‰‹åŠ¨å¯åŠ¨ä»æœåŠ¡å™¨ï¼Œç„¶åæ›´æ”¹åº”ç”¨å±‚çš„redisçš„ipå³å¯\n\n\n> å®ç°ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave Replicationï¼‰çš„å·¥ä½œåŸç†ï¼šSlaveä»èŠ‚ç‚¹æœåŠ¡å¯åŠ¨å¹¶è¿æ¥åˆ°Masterä¹‹åï¼Œå®ƒå°†ä¸»åŠ¨å‘é€ä¸€ä¸ªSYNCå‘½ä»¤ã€‚MasteræœåŠ¡ä¸»èŠ‚ç‚¹æ”¶åˆ°åŒæ­¥å‘½ä»¤åå°†å¯åŠ¨åå°å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†çš„å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼ŒMasterå°†ä¼ é€æ•´ä¸ªæ•°æ®åº“æ–‡ä»¶åˆ°Slaveï¼Œä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚è€ŒSlaveä»èŠ‚ç‚¹æœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®ä¹‹åå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æ­¤åï¼ŒMasterä¸»èŠ‚ç‚¹ç»§ç»­å°†æ‰€æœ‰å·²ç»æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ï¼Œå’Œæ–°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ é€ç»™Slavesï¼ŒSlaveå°†åœ¨æœ¬æ¬¡æ‰§è¡Œè¿™äº›æ•°æ®ä¿®æ”¹å‘½ä»¤ï¼Œä»è€Œè¾¾åˆ°æœ€ç»ˆçš„æ•°æ®åŒæ­¥ã€‚\n\n\nå¦‚æœMasterå’ŒSlaveä¹‹é—´çš„é“¾æ¥å‡ºç°æ–­è¿ç°è±¡ï¼ŒSlaveå¯ä»¥è‡ªåŠ¨é‡è¿Masterï¼Œä½†æ˜¯åœ¨è¿æ¥æˆåŠŸä¹‹åï¼Œä¸€æ¬¡å®Œå…¨åŒæ­¥å°†è¢«è‡ªåŠ¨æ‰§è¡Œã€‚\n\n\n**ä¸»ä»å¤åˆ¶é…ç½®**\n\n\nä¿®æ”¹ä»èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼šslaveof masterip masterport\nå¦‚æœè®¾ç½®äº†å¯†ç ï¼Œå°±è¦è®¾ç½®ï¼šmasterauth master-password\n\n\nä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹\n\n\n**ä¼˜ç‚¹ï¼š**\n\n- åŒä¸€ä¸ªMasterå¯ä»¥åŒæ­¥å¤šä¸ªSlavesã€‚\n- SlaveåŒæ ·å¯ä»¥æ¥å—å…¶å®ƒSlavesçš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„åˆ†è½½Masterçš„åŒæ­¥å‹åŠ›ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å°†Redisçš„Replicationæ¶æ„è§†ä¸ºå›¾ç»“æ„ã€‚\n- Master Serveræ˜¯ä»¥éé˜»å¡çš„æ–¹å¼ä¸ºSlavesæä¾›æœåŠ¡ã€‚æ‰€ä»¥åœ¨Master-SlaveåŒæ­¥æœŸé—´ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æäº¤æŸ¥è¯¢æˆ–ä¿®æ”¹è¯·æ±‚ã€‚\n- Slave ServeråŒæ ·æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼å®Œæˆæ•°æ®åŒæ­¥ã€‚åœ¨åŒæ­¥æœŸé—´ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯æäº¤æŸ¥è¯¢è¯·æ±‚ï¼ŒRedisåˆ™è¿”å›åŒæ­¥ä¹‹å‰çš„æ•°æ®\n- ä¸ºäº†åˆ†è½½Masterçš„è¯»æ“ä½œå‹åŠ›ï¼ŒSlaveæœåŠ¡å™¨å¯ä»¥ä¸ºå®¢æˆ·ç«¯æä¾›åªè¯»æ“ä½œçš„æœåŠ¡ï¼Œå†™æœåŠ¡ä»ç„¶å¿…é¡»ç”±Masteræ¥å®Œæˆã€‚å³ä¾¿å¦‚æ­¤ï¼Œç³»ç»Ÿçš„ä¼¸ç¼©æ€§è¿˜æ˜¯å¾—åˆ°äº†å¾ˆå¤§çš„æé«˜ã€‚\n- Masterå¯ä»¥å°†æ•°æ®ä¿å­˜æ“ä½œäº¤ç»™Slaveså®Œæˆï¼Œä»è€Œé¿å…äº†åœ¨Masterä¸­è¦æœ‰ç‹¬ç«‹çš„è¿›ç¨‹æ¥å®Œæˆæ­¤æ“ä½œã€‚\næ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚\n\n**ç¼ºç‚¹ï¼š**\n\n- Redisä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„IPæ‰èƒ½æ¢å¤ã€‚\n- ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢IPåè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚\n- Redisçš„ä¸»ä»å¤åˆ¶é‡‡ç”¨å…¨é‡å¤åˆ¶ï¼Œå¤åˆ¶è¿‡ç¨‹ä¸­ä¸»æœºä¼šforkå‡ºä¸€ä¸ªå­è¿›ç¨‹å¯¹å†…å­˜åšä¸€ä»½å¿«ç…§ï¼Œå¹¶å°†å­è¿›ç¨‹çš„å†…å­˜å¿«ç…§ä¿å­˜ä¸ºæ–‡ä»¶å‘é€ç»™ä»æœºï¼Œè¿™ä¸€è¿‡ç¨‹éœ€è¦ç¡®ä¿ä¸»æœºæœ‰è¶³å¤Ÿå¤šçš„ç©ºä½™å†…å­˜ã€‚è‹¥å¿«ç…§æ–‡ä»¶è¾ƒå¤§ï¼Œå¯¹é›†ç¾¤çš„æœåŠ¡èƒ½åŠ›ä¼šäº§ç”Ÿè¾ƒå¤§çš„å½±å“ï¼Œè€Œä¸”å¤åˆ¶è¿‡ç¨‹æ˜¯åœ¨ä»æœºæ–°åŠ å…¥é›†ç¾¤æˆ–è€…ä»æœºå’Œä¸»æœºç½‘ç»œæ–­å¼€é‡è¿æ—¶éƒ½ä¼šè¿›è¡Œï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œæ³¢åŠ¨éƒ½ä¼šé€ æˆä¸»æœºå’Œä»æœºé—´çš„ä¸€æ¬¡å…¨é‡çš„æ•°æ®å¤åˆ¶ï¼Œè¿™å¯¹å®é™…çš„ç³»ç»Ÿè¿è¥é€ æˆäº†ä¸å°çš„éº»çƒ¦ã€‚\n- Redisè¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ä¸ºé¿å…è¿™ä¸€é—®é¢˜ï¼Œè¿ç»´äººå‘˜åœ¨ç³»ç»Ÿä¸Šçº¿æ—¶å¿…é¡»ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œè¿™å¯¹èµ„æºé€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚\n- å…¶å®redisçš„ä¸»ä»æ¨¡å¼å¾ˆç®€å•ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯å¾ˆå°‘ä½¿ç”¨çš„ï¼Œæˆ‘ä¹Ÿä¸å»ºè®®åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¸»ä»æ¨¡å¼æ¥æä¾›ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œä¹‹æ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨éƒ½æ˜¯ç”±å®ƒçš„ç¼ºç‚¹é€ æˆçš„ï¼Œåœ¨æ•°æ®é‡éå¸¸å¤§çš„æƒ…å†µï¼Œæˆ–è€…å¯¹ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§è¦æ±‚å¾ˆé«˜çš„æƒ…å†µä¸‹ï¼Œä¸»ä»æ¨¡å¼ä¹Ÿæ˜¯ä¸ç¨³å®šçš„ã€‚\n\n### **è¯»å†™åˆ†ç¦»**\n\n\n> å¯¹äºè¯»å æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œå¯ä»¥é€šè¿‡æŠŠä¸€éƒ¨åˆ†æµé‡åˆ†æ‘Šå¯¼å‡ºä»èŠ‚ç‚¹(salve) æ¥å‡è½»ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰å‹åŠ›ï¼ŒåŒæ—¶éœ€è¦ä¸»è¦åªå¯¹ä¸»èŠ‚ç‚¹æ‰§è¡Œå†™æ“ä½œã€‚\n\n\nå¸¸è§çš„åº”ç”¨åœºæ™¯ä¸‹æˆ‘è§‰å¾—redisæ²¡å¿…è¦è¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚\n\n\nå…ˆæ¥è®¨è®ºä¸€ä¸‹ä¸ºä»€ä¹ˆè¦è¯»å†™åˆ†ç¦»ï¼š\n\n\n> è¯»å†™åˆ†ç¦»ä½¿ç”¨äºå¤§é‡è¯»è¯·æ±‚çš„æƒ…å†µï¼Œé€šè¿‡å¤šä¸ªslaveåˆ†æ‘Šäº†è¯»çš„å‹åŠ›ï¼Œä»è€Œå¢åŠ äº†è¯»çš„æ€§èƒ½ã€‚è¿‡å¤šçš„selectä¼šé˜»å¡ä½æ•°æ®åº“ï¼Œä½¿ä½ å¢åˆ æ”¹ä¸èƒ½æ‰§è¡Œï¼Œè€Œä¸”åˆ°å¹¶å‘é‡è¿‡å¤§æ—¶ï¼Œæ•°æ®åº“ä¼šæ‹’ç»æœåŠ¡ã€‚\n\n\n\tå› è€Œé€šè¿‡è¯»å†™åˆ†ç¦»ï¼Œä»è€Œå¢åŠ æ€§èƒ½ï¼Œé¿å…æ‹’ç»æœåŠ¡çš„å‘ç”Ÿã€‚\n\n\n\tæˆ‘è®¤ä¸ºéœ€è¦è¯»å†™åˆ†ç¦»çš„åº”ç”¨åœºæ™¯æ˜¯ï¼šå†™è¯·æ±‚åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œä½†è¯»è¯·æ±‚è¦è¿œå¤§äºå†™è¯·æ±‚çš„åœºæ™¯ã€‚\n\n\nå†æ¥è®¨è®ºä¸€ä¸‹rediså¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š\n\n1. ç¼“å­˜\n2. æ’åå‹çš„åº”ç”¨ï¼Œè®¿é—®è®¡æ•°å‹åº”ç”¨\n3. å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ\n\né¦–å…ˆè¯´ä¸€ä¸‹ç¼“å­˜é›†ç¾¤ï¼Œè¿™ä¹Ÿæ˜¯éå¸¸å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š\n\n1. ç¼“å­˜ä¸»è¦è§£å†³çš„æ˜¯ç”¨æˆ·è®¿é—®æ—¶ï¼Œæ€ä¹ˆä»¥æ›´å¿«çš„é€Ÿåº¦å¾—åˆ°æ•°æ®ã€‚\n2. å•æœºçš„å†…å­˜èµ„æºæ˜¯å¾ˆæœ‰é™çš„ï¼Œæ‰€ä»¥ç¼“å­˜é›†ç¾¤ä¼šé€šè¿‡æŸç§ç®—æ³•å°†ä¸åŒçš„æ•°æ®æ”¾å…¥åˆ°ä¸åŒçš„æœºå™¨ä¸­ã€‚\n3. ä¸åŒæŒä¹…åŒ–æ•°æ®åº“ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå†…å­˜æ•°æ®åº“å•æœºå¯ä»¥æ”¯æŒå¤§é‡çš„å¢åˆ æŸ¥æ”¹ã€‚\n4. å¦‚æœä¸€å°æœºå™¨æ”¯æŒä¸ä½ï¼Œå¯ä»¥ç”¨ä¸»ä»å¤åˆ¶ï¼Œè¿›è¡Œç¼“å­˜çš„æ–¹æ³•è§£å†³ã€‚\n5. ç»¼ä¸Šï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹åº”ç”¨redis è¿›è¡Œè¯»å†™åˆ†ç¦»ï¼Œå®Œå…¨å°±å¤±å»äº†è¯»å†™åˆ†ç¦»çš„æ„ä¹‰ã€‚\n\n> å½“ç„¶ï¼Œä¹Ÿæœ‰å¯èƒ½è€ƒè™‘ä¸åˆ°çš„åœ°æ–¹éœ€è¦è¯»å†™åˆ†ç¦»ï¼Œæ¯•ç«Ÿâ€œå­˜åœ¨å³åˆç†â€å˜›ï¼Œé‚£ä¹ˆå°±æ¥ä»‹ç»ä¸€ä¸‹è¿™ä¸ªè¯»å†™åˆ†ç¦»å§ã€‚\n\n\n`å½“ä½¿ç”¨ä»èŠ‚ç‚¹å“åº”è¯»è¯·æ±‚æ—¶ï¼Œä¸šåŠ¡ç«¯å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜`\n\n- å¤åˆ¶æ•°æ®å»¶è¿Ÿ\n- è¯»åˆ°è¿‡æœŸæ•°æ®\n- ä»èŠ‚ç‚¹æ•…éšœ\n\n**æ•°æ®å»¶è¿Ÿ**\n\n\n> Redis å¤åˆ¶æ•°çš„å»¶è¿Ÿç”±äºå¼‚æ­¥å¤åˆ¶ç‰¹æ€§æ˜¯æ— æ³•é¿å…çš„ï¼Œå»¶è¿Ÿå–å†³äºç½‘ç»œå¸¦å®½å’Œå‘½ä»¤é˜»å¡æƒ…å†µï¼Œå¯¹äºæ— æ³•å®¹å¿å¤§é‡å»¶è¿Ÿåœºæ™¯ï¼Œå¯ä»¥ç¼–å†™å¤–éƒ¨ç›‘æ§ç¨‹åºç›‘å¬ä¸»ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ï¼Œå½“å»¶è¿Ÿè¾ƒå¤§æ—¶è§¦å‘æŠ¥è­¦æˆ–è€…é€šçŸ¥å®¢æˆ·ç«¯é¿å…è¯»å–å»¶è¿Ÿè¿‡é«˜çš„ä»èŠ‚ç‚¹ï¼Œå®ç°é€»è¾‘å¦‚ä¸‹ï¼š\n\n1. ç›‘æ§ç¨‹åº(monitor) å®šæœŸæ£€æŸ¥ä¸»ä»èŠ‚ç‚¹çš„åç§»é‡ï¼Œä¸»èŠ‚ç‚¹åç§»é‡åœ¨info replication çš„master_repl_offset æŒ‡æ ‡è®°å½•ï¼Œä»èŠ‚ç‚¹ åç§»é‡å¯ä»¥æŸ¥è¯¢ä¸»èŠ‚ç‚¹çš„slave0 å­—æ®µçš„offsetæŒ‡æ ‡ï¼Œå®ƒä»¬çš„å·®å€¼å°±æ˜¯ä¸»ä»èŠ‚ç‚¹å»¶è¿Ÿçš„å­—èŠ‚ é‡ã€‚\n2. å½“å»¶è¿Ÿå­—èŠ‚é‡è¿‡é«˜æ—¶ï¼Œæ¯”å¦‚è¶…è¿‡10Mã€‚ç›‘æ§ç¨‹åºè§¦å‘æŠ¥è­¦å¹¶é€šçŸ¥å®¢æˆ·ç«¯ä»èŠ‚ç‚¹å»¶è¿Ÿè¿‡é«˜ã€‚å¯ä»¥é‡‡ç”¨Zookeeperçš„ç›‘å¬å›è°ƒæœºåˆ¶å®ç°å®¢æˆ·ç«¯é€šçŸ¥ã€‚\n3. å®¢æˆ·ç«¯æ¥åˆ°å…·ä½“çš„ä»èŠ‚ç‚¹é«˜å»¶è¿Ÿé€šçŸ¥åï¼Œä¿®æ”¹è¯»å‘½ä»¤è·¯ç”±åˆ°å…¶ä»–ä»èŠ‚ç‚¹æˆ–ä¸»èŠ‚ç‚¹ä¸Šã€‚å½“å»¶è¿Ÿå›å¤åï¼Œå†æ¬¡é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå›å¤ä»èŠ‚ç‚¹çš„è¯»å‘½ä»¤è¯·æ±‚ã€‚\n\nè¿™ç§æ–¹æ¡ˆæˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦å•ç‹¬ä¿®æ”¹é€‚é…Redisçš„å®¢æˆ·ç«¯ç±»åº“ã€‚\n\n\n**è¯»åˆ°è¿‡æœŸæ•°æ®**\n\n\nå½“ä¸»èŠ‚ç‚¹å­˜å‚¨å¤§é‡è®¾ç½®è¶…æ—¶çš„æ•°æ®æ—¶ï¼Œå¦‚ç¼“å­˜æ•°æ®ï¼ŒRediså†…éƒ¨éœ€è¦ç»´æŠ¤è¿‡æœŸæ•°æ®åˆ é™¤ç­–ç•¥ï¼Œåˆ é™¤ç­–ç•¥ä¸»è¦æœ‰ä¸¤ç§ï¼š`æƒ°æ€§åˆ é™¤å’Œå®šæ—¶åˆ é™¤`ã€‚\n\n\n`æƒ°æ€§åˆ é™¤`ï¼šä¸»èŠ‚ç‚¹æ¯æ¬¡å¤„ç†è¯»å–å‘½ä»¤æ—¶ï¼Œéƒ½ä¼šæ£€æŸ¥é”®æ˜¯å¦è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶åˆ™æ‰§è¡Œdelå‘½ä»¤åˆ é™¤é”®å¯¹è±¡é‚£ä¸ªï¼Œä¹‹ådelå‘½ä»¤ä¹Ÿä¼šå¼‚æ­¥ å‘é€ç»™ ä»èŠ‚ç‚¹\n\n\n> éœ€è¦æ³¨æ„çš„æ˜¯ä¸ºäº†ä¿è¯å¤åˆ¶çš„ä¸€è‡´æ€§ï¼Œä»èŠ‚ç‚¹è‡ªèº«æ°¸è¿œä¸ä¼šä¸»åŠ¨åˆ é™¤è¶…æ—¶æ•°æ®ï¼Œ\n\n\n`å®šæ—¶åˆ é™¤`ï¼š\n\n\nRedisä¸»èŠ‚ç‚¹åœ¨å†…éƒ¨å®šæ—¶ä»»åŠ¡ä¼šå¾ªç¯é‡‡æ ·ä¸€å®šæ•°é‡çš„é”®ï¼Œå½“å‘ç°é‡‡æ ·çš„é”®è¿‡æœŸå°±æ‰§è¡Œdelå‘½ä»¤ï¼Œä¹‹åå†åŒæ­¥ç»™ä»èŠ‚ç‚¹\n\n\n> å¦‚æœæ­¤æ—¶ æ•°æ®çš„å¤§é‡è¶…æ—¶ï¼Œä¸»èŠ‚ç‚¹é‡‡æ ·é€Ÿåº¦è·Ÿä¸ä¸Šè¿‡æœŸé€Ÿåº¦ä¸”ä¸»èŠ‚ç‚¹æ²¡æœ‰è¯»å–è¿‡æœŸé”®çš„æ“ä½œï¼Œé‚£ä¹ˆä»èŠ‚ç‚¹å°†æ— æ³•æ”¶åˆ°delå‘½ä»¤ï¼Œè¿™æ—¶åœ¨ä»èŠ‚ç‚¹ ä¸Šå¯ä»¥è¯»å–åˆ°å·²ç»è¶…æ—¶çš„æ•°æ®ã€‚Redisåœ¨3.2 ç‰ˆæœ¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä»èŠ‚ç‚¹ è¯»å–æ•°æ®ä¹‹å‰ä¼šæ£€æŸ¥é”®çš„è¿‡æœŸæ—¶é—´æ¥å†³å®šæ˜¯å¦è¿”å›æ•°æ®ï¼Œå¯ä»¥å‡çº§åˆ°3.2ç‰ˆæœ¬æ¥è§„é¿è¿™ä¸ªé—®é¢˜ã€‚\n\n\n### **å“¨å…µæ¨¡å¼**\n\n\n> è¯¥æ¨¡å¼æ˜¯ä»Redisçš„2.6ç‰ˆæœ¬å¼€å§‹æä¾›çš„ï¼Œä½†æ˜¯å½“æ—¶è¿™ä¸ªç‰ˆæœ¬çš„æ¨¡å¼æ˜¯ä¸ç¨³å®šçš„ï¼Œç›´åˆ°Redisçš„2.8ç‰ˆæœ¬ä»¥åï¼Œè¿™ä¸ªå“¨å…µæ¨¡å¼æ‰ç¨³å®šä¸‹æ¥ï¼Œæ— è®ºæ˜¯ä¸»ä»æ¨¡å¼ï¼Œè¿˜æ˜¯å“¨å…µæ¨¡å¼ï¼Œè¿™ä¸¤ä¸ªæ¨¡å¼éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸èƒ½æ°´å¹³æ‰©å®¹ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªæ¨¡å¼çš„é«˜å¯ç”¨ç‰¹æ€§éƒ½ä¼šå—åˆ°Masterä¸»èŠ‚ç‚¹å†…å­˜çš„é™åˆ¶ã€‚\n\n\nSentinel(å“¨å…µ)è¿›ç¨‹æ˜¯ç”¨äºç›‘æ§redisé›†ç¾¤ä¸­Masterä¸»æœåŠ¡å™¨å·¥ä½œçš„çŠ¶æ€ï¼Œåœ¨Masterä¸»æœåŠ¡å™¨å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥å®ç°Masterå’ŒSlaveæœåŠ¡å™¨çš„åˆ‡æ¢ï¼Œä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ã€‚\n\n\n**Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹çš„ä½œç”¨**\n\n- ç›‘æ§(Monitoring): å“¨å…µ(sentinel) ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„Masterå’ŒSlaveæ˜¯å¦è¿ä½œæ­£å¸¸ã€‚\n- æé†’(Notification)ï¼šå½“è¢«ç›‘æ§çš„æŸä¸ªRedisèŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶, å“¨å…µ(sentinel) å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚\n- è‡ªåŠ¨æ•…éšœè¿ç§»(Automatic failover)ï¼š\n\n\t> å½“ä¸€ä¸ªMasterä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µ(sentinel) ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆMasterçš„å…¶ä¸­ä¸€ä¸ªSlaveå‡çº§ä¸ºæ–°çš„Master, å¹¶è®©å¤±æ•ˆMasterçš„å…¶ä»–Slaveæ”¹ä¸ºå¤åˆ¶æ–°çš„Masterï¼›å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥å¤±æ•ˆçš„Masteræ—¶ï¼Œé›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›æ–°Masterçš„åœ°å€ï¼Œä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨ç°åœ¨çš„Masteræ›¿æ¢å¤±æ•ˆMasterã€‚\n\n\n\t\tMasterå’ŒSlaveæœåŠ¡å™¨åˆ‡æ¢åï¼ŒMasterçš„redis.confã€Slaveçš„redis.confå’Œsentinel.confçš„é…ç½®æ–‡ä»¶çš„å†…å®¹éƒ½ä¼šå‘ç”Ÿç›¸åº”çš„æ”¹å˜ï¼Œå³ï¼ŒMasterä¸»æœåŠ¡å™¨çš„redis.confé…ç½®æ–‡ä»¶ä¸­ä¼šå¤šä¸€è¡Œslaveofçš„é…ç½®ï¼Œsentinel.confçš„ç›‘æ§ç›®æ ‡ä¼šéšä¹‹è°ƒæ¢ã€‚\n\n\n**Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹çš„å·¥ä½œæ–¹å¼**\n\n- æ¯ä¸ªSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘æ•´ä¸ªé›†ç¾¤ä¸­çš„Masterä¸»æœåŠ¡å™¨ï¼ŒSlaveä»æœåŠ¡å™¨ä»¥åŠå…¶ä»–Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ä¸€ä¸ª PING å‘½ä»¤ã€‚\n- å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰\n- å¦‚æœä¸€ä¸ªMasterä¸»æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ªMasterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤Masterä¸»æœåŠ¡å™¨çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€\n- å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤Masterä¸»æœåŠ¡å™¨è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ˆSDOWNï¼‰ï¼Œ åˆ™Masterä¸»æœåŠ¡å™¨ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰\n- åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘é›†ç¾¤ä¸­çš„æ‰€æœ‰Masterä¸»æœåŠ¡å™¨ã€Slaveä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤ã€‚\n- å½“Masterä¸»æœåŠ¡å™¨è¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰æ—¶ï¼ŒSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘ä¸‹çº¿çš„ Masterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Slaveä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚\n- è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹åŒæ„ Masterä¸»æœåŠ¡å™¨ä¸‹çº¿ï¼Œ Masterä¸»æœåŠ¡å™¨çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚è‹¥ Masterä¸»æœåŠ¡å™¨é‡æ–°å‘ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼ŒMasterä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚\nå“¨å…µæ¨¡å¼çš„ä¼˜ç¼ºç‚¹\n\n**ä¼˜ç‚¹:**\n\n- å“¨å…µé›†ç¾¤æ¨¡å¼æ˜¯åŸºäºä¸»ä»æ¨¡å¼çš„ï¼Œæ‰€æœ‰ä¸»ä»çš„ä¼˜ç‚¹ï¼Œå“¨å…µæ¨¡å¼åŒæ ·å…·æœ‰ã€‚\n- ä¸»ä»å¯ä»¥åˆ‡æ¢ï¼Œæ•…éšœå¯ä»¥è½¬ç§»ï¼Œç³»ç»Ÿå¯ç”¨æ€§æ›´å¥½ã€‚\n- å“¨å…µæ¨¡å¼æ˜¯ä¸»ä»æ¨¡å¼çš„å‡çº§ï¼Œç³»ç»Ÿæ›´å¥å£®ï¼Œå¯ç”¨æ€§æ›´é«˜ã€‚\n\n**ç¼ºç‚¹:**\n\n- Redisè¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ä¸ºé¿å…è¿™ä¸€é—®é¢˜ï¼Œè¿ç»´äººå‘˜åœ¨ç³»ç»Ÿä¸Šçº¿æ—¶å¿…é¡»ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œè¿™å¯¹èµ„æºé€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚\n- é…ç½®å¤æ‚\n\n`å·¥ä½œåŸç†:`\n\n1. ç”¨æˆ·é“¾æ¥æ—¶å…ˆé€šè¿‡å“¨å…µè·å–ä¸»æœºMasterçš„ä¿¡æ¯\n2. è·å–Masterçš„é“¾æ¥åå®ç°redisçš„æ“ä½œ(set/get)\n3. å½“masterå‡ºç°å®•æœºæ—¶,å“¨å…µçš„å¿ƒè·³æ£€æµ‹å‘ç°ä¸»æœºé•¿æ—¶é—´æ²¡æœ‰å“åº”.è¿™æ—¶å“¨å…µä¼šè¿›è¡Œæ¨é€‰.æ¨é€‰å‡ºæ–°çš„ä¸»æœºå®Œæˆä»»åŠ¡.\n4. å½“æ–°çš„ä¸»æœºå‡ºç°æ—¶,å…¶ä½™çš„å…¨éƒ¨æœºå™¨éƒ½å……å½“è¯¥ä¸»æœºçš„ä»æœº\n\n> è¿™å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ·»åŠ å“¨å…µä»¥åï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡å“¨å…µè¯¢é—®å½“å‰çš„ä¸»æœåŠ¡å™¨æ˜¯è°ï¼Œæ‰€ä»¥å¦‚æœå“¨å…µéƒ¨åœ¨ä¸»æœåŠ¡å™¨ä¸Šé¢çš„è¯å¯èƒ½ä¼šå¢åŠ æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯å°†å“¨å…µå•ç‹¬æ”¾åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šé¢ã€‚ä»¥åˆ†è§£å‹åŠ›ã€‚\n\n\n\tç„¶åå¯èƒ½è¿˜æœ‰äººæ‹…å¿ƒå“¨å…µæœåŠ¡å™¨å®•æœºäº†æ€ä¹ˆåŠå•Šï¼Œé¦–å…ˆå“¨å…µæœåŠ¡å™¨å®•æœºçš„å¯èƒ½æ€§å¾ˆå°ï¼Œç„¶åæ˜¯å¦‚æœå“¨å…µæœåŠ¡å™¨å®•æœºäº†ï¼Œä½¿ç”¨äººå·¥å¹²é¢„é‡å¯å³å¯ï¼Œå°±ä¼šå¯¼è‡´ä¸»ä»æœåŠ¡å™¨ç›‘æ§çš„æš‚æ—¶ä¸å¯ç”¨ï¼Œä¸å½±å“ä¸»ä»æœåŠ¡å™¨çš„æ­£å¸¸è¿è¡Œã€‚\n\n\nå…ˆé…ç½®æœåŠ¡å™¨ï¼ˆæœ¬åœ°ï¼‰å“¨å…µæ¨¡å¼ï¼Œç›´æ¥ä»rediså®˜ç½‘ä¸‹è½½å®‰è£…æˆ–è€…è§£å‹ç‰ˆï¼Œå®‰è£…åçš„ç›®å½•ç»“æ„\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629092443832-206225549.png)\n\n\nç„¶åé…ç½®å“¨å…µæ¨¡å¼\n\n\næµ‹è¯•é‡‡ç”¨3ä¸ªå“¨å…µï¼Œ1ä¸ªä¸»redisï¼Œ2ä¸ªä»redisã€‚\n\n\nå¤åˆ¶6ä»½redis.windows.confæ–‡ä»¶å¹¶é‡å‘½åå¦‚ä¸‹ï¼ˆå¼€å‘è€…å¯æ ¹æ®è‡ªå·±çš„å¼€å‘ä¹ æƒ¯è¿›è¡Œé‡å‘½åï¼‰\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629092420294-1751487154.png)\n\n\n**é…ç½®master.6378.conf**\n\n\n```text\nport:6379\n\n\n\n#è®¾ç½®è¿æ¥å¯†ç \n\n\n\nrequirepass:grs\n\n\n\n#è¿æ¥å¯†ç \n\n\n\nmasterauth:grs\n```\n\n\n**slave.6380.confé…ç½®**\n\n\n```text\nport:6380\n\n\n\ndbfilename dump6380.rdb\n\n\n\n#é…ç½®master\n\n\n\nslaveof 127.0.0.1 6379\n```\n\n\n**slave.6381.confé…ç½®**\n\n\n```text\nport 6381\n\n\n\nslaveof 127.0.0.1 6379\n\n\n\ndbfilename \"dump.rdb\"\n```\n\n\n**é…ç½®å“¨å…µsentinel.63791.confï¼ˆå…¶ä»–ä¸¤ä¸ªå“¨å…µé…ç½®æ–‡ä»¶ä¸€è‡´ï¼Œåªä¿®æ”¹ç«¯å£å·ç å³å¯ï¼‰**\n\n\n```text\nport 63791\n\n\n\n#ä¸»masterï¼Œ2ä¸ªsentinelé€‰ä¸¾æˆåŠŸåæ‰æœ‰æ•ˆï¼Œè¿™é‡Œçš„master-1æ˜¯åç§°ï¼Œåœ¨æ•´åˆçš„æ—¶å€™éœ€è¦ä¸€è‡´ï¼Œè¿™é‡Œå¯ä»¥éšä¾¿æ›´æ”¹\n\n\n\nsentinel monitor master-1 127.0.0.1 6379 2\n\n\n\n#åˆ¤æ–­ä¸»masterçš„æŒ‚æœºæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶æœªè¿”å›æ­£ç¡®ä¿¡æ¯åæ ‡è®°ä¸ºsdownçŠ¶æ€\n\n\n\nsentinel down-after-milliseconds master-1 5000\n\n\n\n#è‹¥sentinelåœ¨è¯¥é…ç½®å€¼å†…æœªèƒ½å®Œæˆfailoveræ“ä½œï¼ˆå³æ•…éšœæ—¶master/slaveè‡ªåŠ¨åˆ‡æ¢ï¼‰ï¼Œåˆ™è®¤ä¸ºæœ¬æ¬¡failoverå¤±è´¥ã€‚\n\n\n\nsentinel failover-timeout master-1 18000\n\n\n\n#é€‰é¡¹æŒ‡å®šäº†åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œ æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªä»æœåŠ¡å™¨åŒæ—¶å¯¹æ–°çš„ä¸»æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆæ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿\n\n\n\nsentinel config-epoch master-1 2\n```\n\n\n**éœ€è¦æ³¨æ„çš„åœ°æ–¹**\n\n\n1ã€è‹¥é€šè¿‡redis-cli -h 127.0.0.1 -p 6379è¿æ¥ï¼Œæ— éœ€æ”¹å˜é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶é»˜è®¤é…ç½®ä¸ºbind 127.0.0.1(åªå…è®¸127.0.0.1è¿æ¥è®¿é—®ï¼‰è‹¥é€šè¿‡redis-cli -h 192.168.180.78 -p 6379è¿æ¥ï¼Œéœ€æ”¹å˜é…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¿¡æ¯ä¸ºbind 127.0.0.1 192.168.180.78ï¼ˆåªå…è®¸127.0.0.1å’Œ192.168.180.78è®¿é—®ï¼‰æˆ–è€…å°†bind 127.0.0.1æ³¨é‡Šæ‰ï¼ˆå…è®¸æ‰€æœ‰è¿œç¨‹è®¿é—®ï¼‰\n\n\n2ã€masterauthä¸ºæ‰€è¦è¿æ¥çš„masteræœåŠ¡å™¨çš„requirepass,å¦‚æœä¸€ä¸ªredisé›†ç¾¤ä¸­æœ‰ä¸€ä¸ªmasteræœåŠ¡å™¨ï¼Œä¸¤ä¸ªslaveæœåŠ¡å™¨ï¼Œå½“masteræœåŠ¡å™¨æŒ‚æ‰æ—¶ï¼Œsentinelå“¨å…µä¼šéšæœºé€‰æ‹©ä¸€ä¸ªslaveæœåŠ¡å™¨å……å½“masteræœåŠ¡å™¨ï¼Œé‰´äºè¿™ç§æœºåˆ¶ï¼Œè§£å†³åŠæ³•æ˜¯å°†æ‰€æœ‰çš„ä¸»ä»æœåŠ¡å™¨çš„requirepasså’Œmasterauthéƒ½è®¾ç½®ä¸ºä¸€æ ·ã€‚\n\n\n3ã€sentinel monitor master-1 127.0.0.1 6379 2 è¡Œå°¾æœ€åçš„ä¸€ä¸ª2ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæœ‰æ—¶å€™ä¸€ä¸ªsentinelä¼šå› ä¸ºç½‘ç»œå µå¡è€Œè¯¯ä»¥ä¸ºä¸€ä¸ªmaster rediså·²ç»æ­»æ‰äº†ï¼Œå½“sentinelé›†ç¾¤å¼ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å°±å˜å¾—å¾ˆç®€å•ï¼Œåªéœ€è¦å¤šä¸ªsentineläº’ç›¸æ²Ÿé€šæ¥ç¡®è®¤æŸä¸ªmasteræ˜¯å¦çœŸçš„æ­»äº†ï¼Œè¿™ä¸ª2ä»£è¡¨ï¼Œå½“é›†ç¾¤ä¸­æœ‰2ä¸ªsentinelè®¤ä¸ºmasteræ­»äº†æ—¶ï¼Œæ‰èƒ½çœŸæ­£è®¤ä¸ºè¯¥masterå·²ç»ä¸å¯ç”¨äº†ã€‚ï¼ˆsentinelé›†ç¾¤ä¸­å„ä¸ªsentinelä¹Ÿæœ‰äº’ç›¸é€šä¿¡ï¼Œé€šè¿‡gossipåè®®ï¼‰ã€‚\n\n\n**ä¾æ¬¡å¯åŠ¨redis**\n\n\nredis-server master.6379.conf\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629094553158-1599779576.png)\n\n\nredis-server slave.6380.conf\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629094725047-214223016.png)\n\n\nredis-server slave.6381.conf\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629094815575-184254002.png)\n\n\nredis-server sentinel.63791.conf --sentinelï¼ˆlinux:redis-sentinel sentinel.63791.confï¼‰**å…¶ä»–ä¸¤ä¸ªå“¨å…µä¹Ÿè¿™æ ·å¯åŠ¨**\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629095126662-1063517024.png)\n\n\nä½¿ç”¨å®¢æˆ·ç«¯æŸ¥çœ‹ä¸€ä¸‹masterçŠ¶æ€\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629095541491-1901809546.png)\n\n\næŸ¥çœ‹ä¸€ä¸‹å“¨å…µçŠ¶æ€\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629095632770-302235804.png)\n\n\nç°åœ¨å°±å¯ä»¥åœ¨masteræ’å…¥æ•°æ®ï¼Œæ‰€æœ‰çš„redisæœåŠ¡éƒ½å¯ä»¥è·å–åˆ°ï¼Œslaveåªèƒ½è¯»\n\n\n**æ•´åˆspringï¼Œå¯¼å…¥ä¾èµ–**\n\n\n```text\n\n<dependency>\n Â  Â  Â  Â <groupId>redis.clients</groupId>\n Â  Â  Â  Â <artifactId>jedis</artifactId>\n Â  Â  Â  Â <version>2.8.0</version>\n Â  Â </dependency>\n Â  Â <!-- spring-redis -->\n Â  Â <dependency>\n Â  Â  Â  Â <groupId>org.springframework.data</groupId>\n Â  Â  Â  Â <artifactId>spring-data-redis</artifactId>\n Â  Â  Â  Â <version>1.6.4.RELEASE</version>\n Â  Â </dependency>\n<dependency>\n Â  Â <groupId>org.apache.commons</groupId>\n Â  Â <artifactId>commons-pool2</artifactId>\n Â  Â <version>2.4.2</version>\n</dependency>\n\n```\n\n\n**redis.properties**\n\n\n```text\n#redisä¸­å¿ƒ\nredis.host=127.0.0.1\n#redis.host=10.75.202.11\nredis.port=6379\nredis.password=\n#redis.password=123456\nredis.maxTotal=200\nredis.maxIdle=100\nredis.minIdle=8\nredis.maxWaitMillis=100000\nredis.maxActive=300\nredis.testOnBorrow=true\nredis.testOnReturn=true\n#Idleæ—¶è¿›è¡Œè¿æ¥æ‰«æ\nredis.testWhileIdle=true\n#è¡¨ç¤ºidle object evitorä¸¤æ¬¡æ‰«æä¹‹é—´è¦sleepçš„æ¯«ç§’æ•°\nredis.timeBetweenEvictionRunsMillis=30000\n#è¡¨ç¤ºidle object evitoræ¯æ¬¡æ‰«æçš„æœ€å¤šçš„å¯¹è±¡æ•°\nredis.numTestsPerEvictionRun=10\n#è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡è‡³å°‘åœç•™åœ¨idleçŠ¶æ€çš„æœ€çŸ­æ—¶é—´ï¼Œç„¶åæ‰èƒ½è¢«idle object evitoræ‰«æå¹¶é©±é€ï¼›è¿™ä¸€é¡¹åªæœ‰åœ¨timeBetweenEvictionRunsMilliså¤§äº0æ—¶æ‰æœ‰æ„ä¹‰\nredis.minEvictableIdleTimeMillis=60000\nredis.timeout=100000\n```\n\n\n### **Cluster**\n\n\n> Redis3.0ç‰ˆæœ¬ä¹‹åæ”¯æŒCluster.\n\n\n**redis clusterçš„ç°çŠ¶**\n\n\nç›®å‰redisæ”¯æŒçš„clusterç‰¹æ€§ï¼š\n\n\n1):èŠ‚ç‚¹è‡ªåŠ¨å‘ç°\n\n\n2):slave->master é€‰ä¸¾,é›†ç¾¤å®¹é”™\n\n\n3):Hot resharding:åœ¨çº¿åˆ†ç‰‡\n\n\n4):è¿›ç¾¤ç®¡ç†:cluster xxx\n\n\n5):åŸºäºé…ç½®(nodes-port.conf)çš„é›†ç¾¤ç®¡ç†\n\n\n6):ASK è½¬å‘/MOVED è½¬å‘æœºåˆ¶.\n\n\n**redis cluster æ¶æ„**\n\n\n1)redis-clusteræ¶æ„å›¾\n\n\n![](https://images2015.cnblogs.com/blog/17405/201607/17405-20160729120110388-883077606.jpg)\n\n\nåœ¨è¿™ä¸ªå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªè“è‰²çš„åœˆéƒ½ä»£è¡¨ç€ä¸€ä¸ªredisçš„æœåŠ¡å™¨èŠ‚ç‚¹ã€‚å®ƒä»¬ä»»ä½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½æ˜¯ç›¸äº’è¿é€šçš„ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¸ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ç›¸è¿æ¥ï¼Œç„¶åå°±å¯ä»¥è®¿é—®é›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¯¹å…¶è¿›è¡Œå­˜å–å’Œå…¶ä»–æ“ä½œã€‚\n\n\n**æ¶æ„ç»†èŠ‚:**\n\n- æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½.\n- èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆ.\n- å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯\n- redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Š,cluster è´Ÿè´£ç»´æŠ¤node<->slot<->value\n\n**redis-clusteré€‰ä¸¾:å®¹é”™**\n\n\n![](https://images2015.cnblogs.com/blog/17405/201607/17405-20160729120154169-1347608301.jpg)\n\n- é¢†ç€é€‰ä¸¾è¿‡ç¨‹æ˜¯é›†ç¾¤ä¸­æ‰€æœ‰masterå‚ä¸,å¦‚æœåŠæ•°ä»¥ä¸ŠmasterèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹é€šä¿¡è¶…è¿‡(cluster-node-timeout),è®¤ä¸ºå½“å‰masterèŠ‚ç‚¹æŒ‚æ‰.\n- ä»€ä¹ˆæ—¶å€™æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨(cluster_state:fail),å½“é›†ç¾¤ä¸å¯ç”¨æ—¶,æ‰€æœ‰å¯¹é›†ç¾¤çš„æ“ä½œåšéƒ½ä¸å¯ç”¨ï¼Œæ”¶åˆ°((error) CLUSTERDOWN The cluster is down)é”™è¯¯\n- å¦‚æœé›†ç¾¤ä»»æ„masteræŒ‚æ‰,ä¸”å½“å‰masteræ²¡æœ‰slave.é›†ç¾¤è¿›å…¥failçŠ¶æ€,ä¹Ÿå¯ä»¥ç†è§£æˆè¿›ç¾¤çš„slotæ˜ å°„[0-16383]ä¸å®Œæˆæ—¶è¿›å…¥failçŠ¶æ€.\n- å¦‚æœè¿›ç¾¤è¶…è¿‡åŠæ•°ä»¥ä¸ŠmasteræŒ‚æ‰ï¼Œæ— è®ºæ˜¯å¦æœ‰slaveé›†ç¾¤è¿›å…¥failçŠ¶æ€.\n\n> å®ƒä»¬ä¹‹é—´é€šè¿‡äº’ç›¸çš„ping-pongåˆ¤æ–­æ˜¯å¦èŠ‚ç‚¹å¯ä»¥è¿æ¥ä¸Šã€‚å¦‚æœæœ‰ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å»pingä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™æ²¡æœ‰å›åº”ï¼Œé›†ç¾¤å°±è®¤ä¸ºè¿™ä¸ªèŠ‚ç‚¹å®•æœºäº†ï¼Œç„¶åå»è¿æ¥å®ƒçš„å¤‡ç”¨èŠ‚ç‚¹ã€‚\n\n\n\tå¦‚æœæŸä¸ªèŠ‚ç‚¹å’Œæ‰€æœ‰ä»èŠ‚ç‚¹å…¨éƒ¨æŒ‚æ‰ï¼Œæˆ‘ä»¬é›†ç¾¤å°±è¿›å…¥faillçŠ¶æ€ã€‚è¿˜æœ‰å°±æ˜¯å¦‚æœæœ‰ä¸€åŠä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹å®•æœºï¼Œé‚£ä¹ˆæˆ‘ä»¬é›†ç¾¤åŒæ ·è¿›å…¥å‘åŠ›äº†çŠ¶æ€ã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„redisçš„æŠ•ç¥¨æœºåˆ¶\n\n\n**Redis 3.0çš„é›†ç¾¤æ–¹æ¡ˆæœ‰ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ã€‚**\n\n\n`ä¸€ä¸ªRediså®ä¾‹å…·å¤‡äº†â€œæ•°æ®å­˜å‚¨â€å’Œâ€œè·¯ç”±é‡å®šå‘â€ï¼Œå®Œå…¨å»ä¸­å¿ƒåŒ–çš„è®¾è®¡ã€‚`\n\n\n> è¿™å¸¦æ¥çš„å¥½å¤„æ˜¯éƒ¨ç½²éå¸¸ç®€å•ï¼Œç›´æ¥éƒ¨ç½²Rediså°±è¡Œï¼Œä¸åƒCodisæœ‰é‚£ä¹ˆå¤šçš„ç»„ä»¶å’Œä¾èµ–ã€‚ä½†å¸¦æ¥çš„é—®é¢˜æ˜¯å¾ˆéš¾å¯¹ä¸šåŠ¡è¿›è¡Œæ— ç—›çš„å‡çº§ï¼Œå¦‚æœå“ªå¤©Redisé›†ç¾¤å‡ºäº†ä»€ä¹ˆä¸¥é‡çš„Bugï¼Œå°±åªèƒ½å›æ»šæ•´ä¸ªRedisé›†ç¾¤ã€‚  \n> å¯¹åè®®è¿›è¡Œäº†è¾ƒå¤§çš„ä¿®æ”¹ï¼Œå¯¹åº”çš„Rediså®¢æˆ·ç«¯ä¹Ÿéœ€è¦å‡çº§ã€‚å‡çº§Rediså®¢æˆ·ç«¯åè°èƒ½ç¡®ä¿æ²¡æœ‰Bugï¼Ÿè€Œä¸”å¯¹äºçº¿ä¸Šå·²ç»å¤§è§„æ¨¡è¿è¡Œçš„ä¸šåŠ¡ï¼Œå‡çº§ä»£ç ä¸­çš„Rediså®¢æˆ·ç«¯ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ã€‚  \n> Redis Clusteræ˜¯Redis 3.0ä»¥åæ‰æ­£å¼æ¨å‡ºï¼Œæ—¶é—´è¾ƒæ™šï¼Œç›®å‰èƒ½è¯æ˜åœ¨å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒä¸‹æˆåŠŸçš„æ¡ˆä¾‹è¿˜ä¸æ˜¯å¾ˆå¤šï¼Œéœ€è¦æ—¶é—´æ£€éªŒã€‚\n\n\n### **Jedis sharding**\n\n\n> Redis Shardingå¯ä»¥è¯´æ˜¯åœ¨Redis clusterå‡ºæ¥ä¹‹å‰ä¸šç•Œæ™®éçš„é‡‡ç”¨æ–¹å¼ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯é‡‡ç”¨hashç®—æ³•å°†å­˜å‚¨æ•°æ®çš„keyè¿›è¡Œhashæ•£åˆ—ï¼Œè¿™æ ·ç‰¹å®šçš„keyä¼šè¢«å®šä¸ºåˆ°ç‰¹å®šçš„èŠ‚ç‚¹ä¸Šã€‚\n\n\n**åº†å¹¸çš„æ˜¯ï¼ŒJava Rediså®¢æˆ·ç«¯é©±åŠ¨Jediså·²æ”¯æŒRedis ShardingåŠŸèƒ½ï¼Œå³ShardedJedisä»¥åŠç»“åˆç¼“å­˜æ± çš„ShardedJedisPool**\n\n\n`Jedisçš„Redis Shardingå®ç°å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š`\n\n1. é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå°†keyå’ŒèŠ‚ç‚¹nameåŒæ—¶hashingï¼Œç„¶åè¿›è¡Œæ˜ å°„åŒ¹é…ï¼Œé‡‡ç”¨çš„ç®—æ³•æ˜¯MURMUR_HASHã€‚é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œè€Œä¸æ˜¯é‡‡ç”¨ç®€å•ç±»ä¼¼å“ˆå¸Œæ±‚æ¨¡æ˜ å°„çš„ä¸»è¦åŸå› æ˜¯å½“å¢åŠ æˆ–å‡å°‘èŠ‚ç‚¹æ—¶ï¼Œä¸ä¼šäº§ç”Ÿç”±äºé‡æ–°åŒ¹é…é€ æˆçš„rehashingã€‚ä¸€è‡´æ€§å“ˆå¸Œåªå½±å“ç›¸é‚»èŠ‚ç‚¹keyåˆ†é…ï¼Œå½±å“é‡å°ã€‚\n2. ä¸ºäº†é¿å…ä¸€è‡´æ€§å“ˆå¸Œåªå½±å“ç›¸é‚»èŠ‚ç‚¹é€ æˆèŠ‚ç‚¹åˆ†é…å‹åŠ›ï¼ŒShardedJedisä¼šå¯¹æ¯ä¸ªRedisèŠ‚ç‚¹æ ¹æ®åå­—(æ²¡æœ‰ï¼ŒJedisä¼šèµ‹äºˆç¼ºçœåå­—)ä¼šè™šæ‹ŸåŒ–å‡º160ä¸ªè™šæ‹ŸèŠ‚ç‚¹è¿›è¡Œæ•£åˆ—ã€‚æ ¹æ®æƒé‡weightï¼Œä¹Ÿå¯è™šæ‹ŸåŒ–å‡º160å€æ•°çš„è™šæ‹ŸèŠ‚ç‚¹ã€‚ç”¨è™šæ‹ŸèŠ‚ç‚¹åšæ˜ å°„åŒ¹é…ï¼Œå¯ä»¥åœ¨å¢åŠ æˆ–å‡å°‘RedisèŠ‚ç‚¹æ—¶ï¼Œkeyåœ¨å„RedisèŠ‚ç‚¹ç§»åŠ¨å†åˆ†é…æ›´å‡åŒ€ï¼Œè€Œä¸æ˜¯åªæœ‰ç›¸é‚»èŠ‚ç‚¹å—å½±å“ã€‚\n3. ShardedJedisæ”¯æŒkeyTagPatternæ¨¡å¼ï¼Œå³æŠ½å–keyçš„ä¸€éƒ¨åˆ†keyTagåšshardingï¼Œè¿™æ ·é€šè¿‡åˆç†å‘½åkeyï¼Œå¯ä»¥å°†ä¸€ç»„ç›¸å…³è”çš„keyæ”¾å…¥åŒä¸€ä¸ªRedisèŠ‚ç‚¹ï¼Œè¿™åœ¨é¿å…è·¨èŠ‚ç‚¹è®¿é—®ç›¸å…³æ•°æ®æ—¶å¾ˆé‡è¦ã€‚\n\n> å½“ç„¶ï¼ŒRedis Shardingè¿™ç§è½»é‡çµæ´»æ–¹å¼å¿…ç„¶åœ¨é›†ç¾¤å…¶å®ƒèƒ½åŠ›æ–¹é¢åšå‡ºå¦¥åã€‚æ¯”å¦‚æ‰©å®¹ï¼Œå½“æƒ³è¦å¢åŠ RedisèŠ‚ç‚¹æ—¶ï¼Œå°½ç®¡é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œï¼Œæ¯•ç«Ÿè¿˜æ˜¯ä¼šæœ‰keyåŒ¹é…ä¸åˆ°è€Œä¸¢å¤±ï¼Œè¿™æ—¶éœ€è¦é”®å€¼è¿ç§»ã€‚  \n> ä½œä¸ºè½»é‡çº§å®¢æˆ·ç«¯shardingï¼Œå¤„ç†Redisé”®å€¼è¿ç§»æ˜¯ä¸ç°å®çš„ï¼Œè¿™å°±è¦æ±‚åº”ç”¨å±‚é¢å…è®¸Redisä¸­æ•°æ®ä¸¢å¤±æˆ–ä»åç«¯æ•°æ®åº“é‡æ–°åŠ è½½æ•°æ®ã€‚ä½†æœ‰äº›æ—¶å€™ï¼Œå‡»ç©¿ç¼“å­˜å±‚ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“å±‚ï¼Œä¼šå¯¹ç³»ç»Ÿè®¿é—®é€ æˆå¾ˆå¤§å‹åŠ›ã€‚\n\n\n### **åˆ©ç”¨ä¸­é—´ä»¶ä»£ç†**\n\n\nä¸­é—´ä»¶çš„ä½œç”¨æ˜¯å°†æˆ‘ä»¬éœ€è¦å­˜å…¥redisä¸­çš„æ•°æ®çš„keyé€šè¿‡ä¸€å¥—ç®—æ³•è®¡ç®—å¾—å‡ºä¸€ä¸ªå€¼ã€‚ç„¶åæ ¹æ®è¿™ä¸ªå€¼æ‰¾åˆ°å¯¹åº”çš„redisèŠ‚ç‚¹ï¼Œå°†è¿™äº›æ•°æ®å­˜åœ¨è¿™ä¸ªredisçš„èŠ‚ç‚¹ä¸­ã€‚\n\n\nå¸¸ç”¨çš„ä¸­é—´ä»¶æœ‰è¿™å‡ ç§\n\n- Twemproxy\n- Codis\n- nginx\n\nå…·ä½“ç”¨æ³•å°±ä¸èµ˜è¿°äº†ï¼Œå¯ä»¥è‡ªè¡Œç™¾åº¦ã€‚\n\n\n### **æ€»ç»“**\n\n1. å®¢æˆ·ç«¯åˆ†ç‰‡ï¼ˆshardingï¼‰éœ€è¦å®¢æˆ·ç«¯ç»´æŠ¤åˆ†ç‰‡ç®—æ³•ï¼Œè¿™æ˜¯ä¸€ç§é™æ€çš„åˆ†ç‰‡æ–¹æ¡ˆï¼Œéœ€è¦å¢åŠ æˆ–è€…å‡å°‘Rediså®ä¾‹çš„æ•°é‡ï¼Œéœ€è¦æ‰‹å·¥è°ƒæ•´åˆ†ç‰‡çš„ç¨‹åºã€‚\n2. åˆ©ç”¨ä¸­é—´ä»¶çš„æƒ…å†µåˆ™ä¼šå½±å“åˆ°redisçš„æ€§èƒ½ï¼Œå…·ä½“çœ‹ä¸­é—´ä»¶è€Œå®šï¼Œæ¯•ç«Ÿæ‰€æœ‰è¯·æ±‚éƒ½è¦ç»è¿‡ä¸­é—´ä»¶ä¸€å±‚è¿‡æ»¤\n3. å®˜æ–¹æä¾›æ–¹æ¡ˆ ï¼ˆClusterï¼‰ï¼Œç°æ—¶ç‚¹æˆåŠŸæ¡ˆä¾‹ä¸å¤šã€‚\n\n## **Redisåˆ†ç‰‡**\n\n\nRedis çš„åˆ†ç‰‡æ‰¿æ‹…ç€ä¸¤ä¸ªä¸»è¦ç›®æ ‡ï¼š\n\n1. å…è®¸ä½¿ç”¨å¾ˆå¤šç”µè„‘çš„å†…å­˜æ€»å’Œæ¥æ”¯æŒæ›´å¤§çš„æ•°æ®åº“ã€‚æ²¡æœ‰åˆ†ç‰‡ï¼Œä½ å°±è¢«å±€é™äºå•æœºèƒ½æ”¯æŒçš„å†…å­˜å®¹é‡\n2. å…è®¸ä¼¸ç¼©è®¡ç®—èƒ½åŠ›åˆ°å¤šæ ¸æˆ–å¤šæœåŠ¡å™¨ï¼Œä¼¸ç¼©ç½‘ç»œå¸¦å®½åˆ°å¤šæœåŠ¡å™¨æˆ–å¤šç½‘ç»œé€‚é…å™¨\nèŒƒå›´åˆ†ç‰‡çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯å“ˆå¸Œåˆ†ç‰‡(hash partitioning)ã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºä»»ä½•é”®\tå“ˆå¸Œæ§½è®¾ç½®\tkey-->hashcode-->16384\n\n> åœ¨redisçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œéƒ½æœ‰è¿™ä¹ˆä¸¤ä¸ªä¸œè¥¿\n\n\n\tä¸€ä¸ªæ˜¯æ’æ§½ï¼ˆslotï¼‰å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå¯ä»¥å­˜å‚¨ä¸¤ä¸ªæ•°å€¼çš„ä¸€ä¸ªå˜é‡è¿™ä¸ªå˜é‡çš„å–å€¼èŒƒå›´æ˜¯ï¼š0-16383ã€‚\n\n\n\tè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯clusteræˆ‘ä¸ªäººæŠŠè¿™ä¸ªclusterç†è§£ä¸ºæ˜¯ä¸€ä¸ªé›†ç¾¤ç®¡ç†çš„æ’ä»¶ã€‚\n\n\n\tå½“æˆ‘ä»¬çš„å­˜å–çš„keyåˆ°è¾¾çš„æ—¶å€™ï¼Œredisä¼šæ ¹æ®crc16çš„ç®—æ³•å¾—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå¯¹ 16384 æ±‚ä½™æ•°ï¼Œè¿™æ ·æ¯ä¸ª key éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ 0-16383 ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œé€šè¿‡è¿™ä¸ªå€¼ï¼Œå»æ‰¾åˆ°å¯¹åº”çš„æ’æ§½æ‰€å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶åç›´æ¥è‡ªåŠ¨è·³è½¬åˆ°è¿™ä¸ªå¯¹åº”çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå­˜å–æ“ä½œã€‚\n\n\n\tè¿˜æœ‰å°±æ˜¯å› ä¸ºå¦‚æœé›†ç¾¤çš„è¯ï¼Œæ˜¯æœ‰å¥½å¤šä¸ªredisä¸€èµ·å·¥ä½œçš„ï¼Œé‚£ä¹ˆï¼Œå°±éœ€è¦è¿™ä¸ªé›†ç¾¤ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“æŒ‚æ‰ï¼Œæ‰€ä»¥å‘¢ï¼Œç†è®ºä¸Šå°±åº”è¯¥ç»™é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘ä¸€ä¸ªå¤‡ç”¨çš„redisæœåŠ¡ã€‚è¿™ä¸ªå¤‡ç”¨çš„redisç§°ä¸ºä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ã€‚é‚£ä¹ˆè¿™ä¸ªé›†ç¾¤æ˜¯å¦‚ä½•åˆ¤æ–­æ˜¯å¦æœ‰æŸä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†å‘¢ï¼Ÿ\n\n\né¦–å…ˆè¦è¯´çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å­˜æœ‰è¿™ä¸ªé›†ç¾¤æ‰€æœ‰ä¸»èŠ‚ç‚¹ä»¥åŠä»èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚\n\n\n## **RedisæŒä¹…åŒ–**\n\n\n### **RDB**\n\n\n> Redis Databaseï¼Œå°±æ˜¯å¿«ç…§snapshotsã€‚ç¼ºçœæƒ…å†µæƒ…å†µä¸‹ï¼ŒRedisæŠŠæ•°æ®å¿«ç…§å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åä¸ºdump.rdbã€‚å¯ä»¥é…ç½®Redisçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚æ•°æ®é›†ä¸­æ¯Nç§’é’Ÿæœ‰è¶…è¿‡Mæ¬¡æ›´æ–°ï¼Œå°±å°†æ•°æ®å†™å…¥ç£ç›˜ï¼›æˆ–è€…ä½ å¯ä»¥æ‰‹å·¥è°ƒç”¨å‘½ä»¤SAVEæˆ–BGSAVEã€‚\n\n\nRedisæ˜¯ä½¿ç”¨forkå‡½æ•°å¤åˆ¶ä¸€ä»½å½“å‰è¿›ç¨‹(çˆ¶è¿›ç¨‹)çš„å‰¯æœ¬(å­è¿›ç¨‹) \tå­è¿›ç¨‹å¼€å§‹å°†æ•°æ®å†™åˆ°ä¸´æ—¶RDBæ–‡ä»¶ä¸­ \tå½“å­è¿›ç¨‹å®Œæˆå†™RDBæ–‡ä»¶ï¼Œç”¨æ–°æ–‡ä»¶æ›¿æ¢è€æ–‡ä»¶ \tè¿™ç§æ–¹å¼å¯ä»¥ä½¿Redisä½¿ç”¨copy-on-writeæŠ€æœ¯ã€‚\n\n\n### **AOF**\n\n\n> Append Only Fileã€‚å¿«ç…§æ¨¡å¼å¹¶ä¸ååˆ†å¥å£®ï¼Œå½“ç³»ç»Ÿåœæ­¢æˆ–è€…æ— æ„ä¸­Redisè¢«killæ‰ï¼Œæœ€åå†™å…¥Redisçš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚è¿™å¯¹æŸäº›åº”ç”¨ä¹Ÿè®¸ä¸æ˜¯å¤§é—®é¢˜ï¼Œä½†å¯¹äºè¦æ±‚é«˜å¯é æ€§çš„åº”ç”¨æ¥è¯´ï¼ŒRediså°±ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚Append-onlyæ–‡ä»¶æ¨¡å¼æ˜¯å¦ä¸€ç§é€‰æ‹©ã€‚å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰“å¼€AOFæ¨¡å¼  \n> Redisä¸­æä¾›äº†3ä¸­åŒæ­¥ç­–ç•¥ï¼Œå³æ¯ç§’åŒæ­¥ã€æ¯ä¿®æ”¹åŒæ­¥å’Œä¸åŒæ­¥ã€‚äº‹å®ä¸Šæ¯ç§’åŒæ­¥ä¹Ÿæ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œå…¶æ•ˆç‡ä¹Ÿæ˜¯éå¸¸é«˜çš„ï¼Œæ‰€å·®çš„æ˜¯ä¸€æ—¦ç³»ç»Ÿå‡ºç°å®•æœºç°è±¡ï¼Œé‚£ä¹ˆè¿™ä¸€ç§’é’Ÿä¹‹å†…ä¿®æ”¹çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚\n\n1. appendfsync alwaysæ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶\n2. appendfsync everysec æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œè¯¥ç­–ç•¥ä¸ºAOFçš„ç¼ºçœç­–ç•¥ã€‚åœ¨æ€§èƒ½å’ŒæŒä¹…åŒ–æ–¹é¢ä½œäº†å¾ˆå¥½çš„æŠ˜ä¸­\n3. appendfsync noä»ä¸åŒæ­¥ã€‚é«˜æ•ˆä½†æ˜¯æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ã€‚\n\n### **è™šæ‹Ÿå†…å­˜æ–¹å¼**\n\n\n> å½“keyå¾ˆå°è€Œvalueå¾ˆå¤§æ—¶ï¼Œä½¿ç”¨VMçš„æ•ˆæœä¼šæ¯”è¾ƒå¥½ï¼Œå› ä¸ºè¿™æ ·èŠ‚çº¦çš„å†…å­˜æ¯”è¾ƒå¤§ã€‚å½“keyä¸å°æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€äº›éå¸¸æ–¹æ³•å°†å¾ˆå¤§çš„keyå˜æˆå¾ˆå¤§çš„valueï¼Œå¦‚å¯ä»¥è€ƒè™‘å°†key/valueç»„åˆæˆä¸€ä¸ªæ–°value.  \n> vm-max-threadsè¿™ä¸ªå‚æ•°,å¯ä»¥è®¾ç½®è®¿é—®swapæ–‡ä»¶çš„çº¿ç¨‹æ•°,è®¾ç½®æœ€å¥½ä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°,å¦‚æœè®¾ç½®ä¸º0,é‚£ä¹ˆæ‰€æœ‰å¯¹swapæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„.å¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿ,ä½†æ˜¯å¯¹æ•°æ®å®Œæ•´æ€§æœ‰å¾ˆå¥½çš„ä¿è¯.ç”¨è™šæ‹Ÿå†…å­˜æ€§èƒ½ä¹Ÿä¸é”™ã€‚å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå¯ä»¥è€ƒè™‘åˆ†å¸ƒå¼æˆ–è€…å…¶ä»–æ•°æ®åº“\n\n\nredis.windows.conf\ndaemonize noé»˜è®¤æƒ…å†µä¸‹redisä¸æ˜¯ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„ï¼Œå¦‚æœæƒ³è®©å®ƒåœ¨åå°è¿è¡Œï¼Œå°±æŠŠå®ƒæ”¹æˆyesã€‚å½“redisä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šå†™ä¸€ä¸ªpidåˆ°/var/run/redis.pidæ–‡ä»¶é‡Œé¢\n\n\n### **å»ºè®®**\n\n- æ›´æ–°é¢‘ç¹: ä¸€è‡´æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼ŒAOFç­–ç•¥ä¸ºä¸»\n- æ›´æ–°ä¸é¢‘ç¹: å¯ä»¥å®¹å¿å°‘é‡æ•°æ®ä¸¢å¤±æˆ–é”™è¯¯ï¼Œsnapshotï¼ˆå¿«ç…§ï¼‰ç­–ç•¥ä¸ºä¸»\n\n## **Redisäº‹åŠ¡**\n\n\nredisäº‹åŠ¡æ˜¯é€šè¿‡MULTIï¼ŒEXECï¼ŒDISCARDå’ŒWATCHå››ä¸ªåŸè¯­å®ç°çš„ã€‚\n\n\n```text\nMULTIå‘½ä»¤ç”¨äºå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒæ€»æ˜¯è¿”å›OKã€‚\n    MULTIæ‰§è¡Œä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘æœåŠ¡å™¨å‘é€ä»»æ„å¤šæ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå½“EXECå‘½ä»¤è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚\n    å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡è°ƒç”¨DISCARDï¼Œå®¢æˆ·ç«¯å¯ä»¥æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ï¼Œå¹¶æ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡ã€‚\n\nredisäº‹åŠ¡èŒƒå›´\n  ä»multiå‘½ä»¤å¼€å§‹ï¼Œåˆ°execæˆ–è€…discardä¸ºæ­¢ï¼Œæ•´ä¸ªæ“ä½œè¿‡ç¨‹æ˜¯åŸå­æ€§çš„ï¼Œä¸èƒ½æ‰“ä¹±é¡ºåºï¼Œä¹Ÿä¸èƒ½æ’å…¥æ“ä½œ\n  ä½†æ˜¯å‡ºé”™ä¹‹å‰çš„æ“ä½œä¼šæ­£å¸¸æäº¤\n\nWATCH å‘½ä»¤å¯ä»¥ä¸º Redis äº‹åŠ¡æä¾› check-and-set ï¼ˆCASï¼‰è¡Œä¸ºã€‚\n  è¢« WATCH çš„é”®ä¼šè¢«ç›‘è§†ï¼Œå¹¶ä¼šå‘è§‰è¿™äº›é”®æ˜¯å¦è¢«æ”¹åŠ¨è¿‡äº†ã€‚ å¦‚æœæœ‰è‡³å°‘ä¸€ä¸ªè¢«ç›‘è§†çš„é”®åœ¨ EXEC æ‰§è¡Œä¹‹å‰\nè¢«ä¿®æ”¹äº†ï¼Œ é‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡éƒ½ä¼šè¢«å–æ¶ˆï¼Œ EXEC è¿”å›ç©ºå¤šæ¡æ‰¹é‡å›å¤ï¼ˆnull multi-bulk replyï¼‰æ¥è¡¨ç¤ºäº‹åŠ¡å·²\nç»å¤±è´¥ã€‚\n```\n\n\n### **ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”**\n\n\n```text\n1ã€å‘Redisä¸­å­˜æ”¾å›ºå®škeyçš„å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨åˆ™å®ç°å­˜æ”¾å¹¶è·å–é”ï¼›å¦‚æœkeyå·²ç»å­˜åœ¨åˆ™ä¸èƒ½è·å–é”\n      ï¼ˆä¾é Redisä¸­çš„åŸå­æ“ä½œè¿›è¡ŒCASæ¯”å¯¹ï¼Œå®ç°é”çš„äº’æ–¥ï¼‰\n2ã€è·å–keyæ‰€å¯¹åº”çš„æ—¶é—´ï¼Œæ—¶é—´æ˜¯é”é¢„æœŸçš„å®æ•ˆæ—¶é—´ï¼Œå¦‚æœå·²ç»å®æ•ˆï¼Œåˆ™å­˜å‚¨æ–°å€¼ï¼Œå¹¶è·å–é”\n3ã€å¦åˆ™è·å–é”å¤±è´¥\n\nè§£é”ï¼š\n  åˆ é™¤æŒ‡å®škeyçš„redisåˆ—\n\n```\n\n\næŠ¢è´­ã€ç§’æ€æ˜¯å¦‚ä»Šå¾ˆå¸¸è§çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œä¸»è¦éœ€è¦è§£å†³çš„é—®é¢˜æœ‰ä¸¤ä¸ªï¼š\n\n1. é«˜å¹¶å‘å¯¹æ•°æ®åº“äº§ç”Ÿçš„å‹åŠ›\n2. ç«äº‰çŠ¶æ€ä¸‹å¦‚ä½•è§£å†³åº“å­˜çš„æ­£ç¡®å‡å°‘ï¼ˆ\"è¶…å–\"é—®é¢˜ï¼‰\n\nå¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå·²ç»å¾ˆå®¹æ˜“æƒ³åˆ°ç”¨ç¼“å­˜æ¥å¤„ç†æŠ¢è´­ï¼Œé¿å…ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œä¾‹å¦‚ä½¿ç”¨Redisã€‚\n\n\n### **Redisä½¿ç”¨watchå®Œæˆç§’æ€æŠ¢è´­åŠŸèƒ½ï¼š**\n\n\nä½¿ç”¨redisä¸­ä¸¤ä¸ªkeyå®Œæˆç§’æ€æŠ¢è´­åŠŸèƒ½ï¼Œmywatchkeyç”¨äºå­˜å‚¨æŠ¢è´­æ•°é‡å’Œmywatchlistç”¨æˆ·å­˜å‚¨æŠ¢è´­åˆ—è¡¨ã€‚\n\n\n```text\nä¼˜ç‚¹ï¼š\n  1ã€é¦–å…ˆé€‰ç”¨å†…å­˜æ•°æ®åº“æ¥æŠ¢è´­é€Ÿåº¦æå¿«\n  2ã€é€Ÿåº¦å¿«å¹¶å‘è‡ªç„¶æ²¡ä¸æ˜¯é—®é¢˜\n  3ã€ä½¿ç”¨æ‚²è§‚é”ï¼Œä¼šè¿…é€Ÿå¢åŠ ç³»ç»Ÿèµ„æº\n  4ã€æ¯”é˜Ÿåˆ—å¼ºçš„å¤šï¼Œé˜Ÿåˆ—ä¼šä½¿å†…å­˜æ•°æ®åº“èµ„æºç¬é—´çˆ†æ£š\n  5ã€ä½¿ç”¨ä¹è§‚é”ï¼Œè¾¾åˆ°ç»¼åˆéœ€æ±‚\n```\n\n\n## **ä¸å…³ç³»å‹æ•°æ®åº“çš„åŒºåˆ«**\n\n\n### **æ•°æ®baiå­˜å‚¨æ–¹å¼ä¸åŒã€‚**\n\n\nå…³ç³»å‹å’Œéå…³ç³»å‹æ•°æ®åº“çš„ä¸»è¦å·®å¼‚æ˜¯æ•°æ®å­˜å‚¨çš„æ–¹å¼ã€‚å…³ç³»å‹æ•°æ®å¤©ç„¶å°±æ˜¯è¡¨æ ¼å¼çš„ï¼Œå› æ­¤å­˜å‚¨åœ¨æ•°æ®è¡¨çš„è¡Œå’Œåˆ—ä¸­ã€‚æ•°æ®è¡¨å¯ä»¥å½¼æ­¤å…³è”åä½œå­˜å‚¨ï¼Œä¹Ÿå¾ˆå®¹æ˜“æå–æ•°æ®ã€‚\n\n\nä¸å…¶ç›¸åï¼Œéå…³ç³»å‹æ•°æ®ä¸é€‚åˆå­˜å‚¨åœ¨æ•°æ®è¡¨çš„è¡Œå’Œåˆ—ä¸­ï¼Œè€Œæ˜¯å¤§å—ç»„åˆåœ¨ä¸€èµ·ã€‚éå…³ç³»å‹æ•°æ®é€šå¸¸å­˜å‚¨åœ¨æ•°æ®é›†ä¸­ï¼Œå°±åƒæ–‡æ¡£ã€é”®å€¼å¯¹æˆ–è€…å›¾ç»“æ„ã€‚ä½ çš„æ•°æ®åŠå…¶ç‰¹æ€§æ˜¯é€‰æ‹©æ•°æ®å­˜å‚¨å’Œæå–æ–¹å¼çš„é¦–è¦å½±å“å› ç´ ã€‚\n\n\n### **æ‰©å±•æ–¹å¼ä¸åŒã€‚**\n\n\nSQLå’ŒNoSQLæ•°æ®åº“æœ€å¤§çš„å·®åˆ«å¯èƒ½æ˜¯åœ¨æ‰©å±•æ–¹å¼ä¸Šï¼Œè¦æ”¯æŒæ—¥ç›Šå¢é•¿çš„éœ€æ±‚å½“ç„¶è¦æ‰©å±•ã€‚\n\n\nè¦æ”¯æŒæ›´å¤šå¹¶å‘é‡ï¼ŒSQLæ•°æ®åº“æ˜¯çºµå‘æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯è¯´æé«˜å¤„ç†èƒ½åŠ›ï¼Œä½¿ç”¨é€Ÿåº¦æ›´å¿«é€Ÿçš„è®¡ç®—æœºï¼Œè¿™æ ·å¤„ç†ç›¸åŒçš„æ•°æ®é›†å°±æ›´å¿«äº†ã€‚\n\n\nå› ä¸ºæ•°æ®å­˜å‚¨åœ¨å…³ç³»è¡¨ä¸­ï¼Œæ“ä½œçš„æ€§èƒ½ç“¶é¢ˆå¯èƒ½æ¶‰åŠå¾ˆå¤šä¸ªè¡¨ï¼Œè¿™éƒ½éœ€è¦é€šè¿‡æé«˜è®¡ç®—æœºæ€§èƒ½æ¥å®¢æœã€‚è™½ç„¶SQLæ•°æ®åº“æœ‰å¾ˆå¤§æ‰©å±•ç©ºé—´ï¼Œä½†æœ€ç»ˆè‚¯å®šä¼šè¾¾åˆ°çºµå‘æ‰©å±•çš„ä¸Šé™ã€‚è€ŒNoSQLæ•°æ®åº“æ˜¯æ¨ªå‘æ‰©å±•çš„ã€‚\n\n\nè€Œéå…³ç³»å‹æ•°æ®å­˜å‚¨å¤©ç„¶å°±æ˜¯åˆ†å¸ƒå¼çš„ï¼ŒNoSQLæ•°æ®åº“çš„æ‰©å±•å¯ä»¥é€šè¿‡ç»™èµ„æºæ± æ·»åŠ æ›´å¤šæ™®é€šçš„æ•°æ®åº“æœåŠ¡å™¨(èŠ‚ç‚¹)æ¥åˆ†æ‹…è´Ÿè½½ã€‚\n\n\n### **å¯¹äº‹åŠ¡æ€§çš„æ”¯æŒä¸åŒã€‚**\n\n\nå¦‚æœæ•°æ®æ“ä½œéœ€è¦é«˜äº‹åŠ¡æ€§æˆ–è€…å¤æ‚æ•°æ®æŸ¥è¯¢éœ€è¦æ§åˆ¶æ‰§è¡Œè®¡åˆ’ï¼Œé‚£ä¹ˆä¼ ç»Ÿçš„SQLæ•°æ®åº“ä»æ€§èƒ½å’Œç¨³å®šæ€§æ–¹é¢è€ƒè™‘æ˜¯ä½ çš„æœ€ä½³é€‰æ‹©ã€‚SQLæ•°æ®åº“æ”¯æŒå¯¹äº‹åŠ¡åŸå­æ€§ç»†ç²’åº¦æ§åˆ¶ï¼Œå¹¶ä¸”æ˜“äºå›æ»šäº‹åŠ¡ã€‚\n\n\nè™½ç„¶NoSQLæ•°æ®åº“ä¹Ÿå¯ä»¥ä½¿ç”¨äº‹åŠ¡æ“ä½œï¼Œä½†ç¨³å®šæ€§æ–¹é¢æ²¡æ³•å’Œå…³ç³»å‹æ•°æ®åº“æ¯”è¾ƒï¼Œæ‰€ä»¥å®ƒä»¬çœŸæ­£é—ªäº®çš„ä»·å€¼æ˜¯åœ¨æ“ä½œçš„æ‰©å±•æ€§å’Œå¤§æ•°æ®é‡å¤„ç†æ–¹é¢ã€‚\n\n\n### **å…³ç³»å‹**\n\n\n**ä¼˜ç‚¹ï¼š**\n\n1. æ˜“äºç»´æŠ¤ï¼šéƒ½æ˜¯ä½¿ç”¨è¡¨ç»“æ„ï¼Œæ ¼å¼ä¸€è‡´ï¼›\n2. ä½¿ç”¨æ–¹ä¾¿ï¼šSQLè¯­è¨€é€šç”¨ï¼Œå¯ç”¨äºå¤æ‚æŸ¥è¯¢ï¼›\n3. å¤æ‚æ“ä½œï¼šæ”¯æŒSQLï¼Œå¯ç”¨äºä¸€ä¸ªè¡¨ä»¥åŠå¤šä¸ªè¡¨ä¹‹é—´éå¸¸å¤æ‚çš„æŸ¥è¯¢ã€‚\n\n**ç¼ºç‚¹ï¼š**\n\n1. è¯»å†™æ€§èƒ½æ¯”è¾ƒå·®ï¼Œå°¤å…¶æ˜¯æµ·é‡æ•°æ®çš„é«˜æ•ˆç‡è¯»å†™ï¼›\n2. å›ºå®šçš„è¡¨ç»“æ„ï¼Œçµæ´»åº¦ç¨æ¬ ï¼›\n3. é«˜å¹¶å‘è¯»å†™éœ€æ±‚ï¼Œä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“æ¥è¯´ï¼Œç¡¬ç›˜I/Oæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç“¶é¢ˆã€‚\n\n### **éå…³ç³»å‹**\n\n\néå…³ç³»å‹æ•°æ®åº“ä¸¥æ ¼ä¸Šä¸æ˜¯ä¸€ç§æ•°æ®åº“ï¼Œåº”è¯¥æ˜¯ä¸€ç§æ•°æ®ç»“æ„åŒ–å­˜å‚¨æ–¹æ³•çš„é›†åˆï¼Œå¯ä»¥æ˜¯æ–‡æ¡£æˆ–è€…é”®å€¼å¯¹ç­‰ã€‚\n\n\n**ä¼˜ç‚¹ï¼š**\n\n1. æ ¼å¼çµæ´»ï¼šå­˜å‚¨æ•°æ®çš„æ ¼å¼å¯ä»¥æ˜¯key,valueå½¢å¼ã€æ–‡æ¡£å½¢å¼ã€å›¾ç‰‡å½¢å¼ç­‰ç­‰ï¼Œæ–‡æ¡£å½¢å¼ã€å›¾ç‰‡å½¢å¼ç­‰ç­‰ï¼Œä½¿ç”¨çµæ´»ï¼Œåº”ç”¨åœºæ™¯å¹¿æ³›ï¼Œè€Œå…³ç³»å‹æ•°æ®åº“åˆ™åªæ”¯æŒåŸºç¡€ç±»å‹ã€‚\n2. é€Ÿåº¦å¿«ï¼šnosqlå¯ä»¥ä½¿ç”¨ç¡¬ç›˜æˆ–è€…éšæœºå­˜å‚¨å™¨ä½œä¸ºè½½ä½“ï¼Œè€Œå…³ç³»å‹æ•°æ®åº“åªèƒ½ä½¿ç”¨ç¡¬ç›˜ï¼›\n3. é«˜æ‰©å±•æ€§ï¼›\n4. æˆæœ¬ä½ï¼šnosqlæ•°æ®åº“éƒ¨ç½²ç®€å•ï¼ŒåŸºæœ¬éƒ½æ˜¯å¼€æºè½¯ä»¶ã€‚\n\n**ç¼ºç‚¹ï¼š**\n\n1. ä¸æä¾›sqlæ”¯æŒï¼Œå­¦ä¹ å’Œä½¿ç”¨æˆæœ¬è¾ƒé«˜ï¼›\n2. æ— äº‹åŠ¡å¤„ç†ï¼›\n3. æ•°æ®ç»“æ„ç›¸å¯¹å¤æ‚ï¼Œå¤æ‚æŸ¥è¯¢æ–¹é¢ç¨æ¬ ã€‚\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "redis-01",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å¼€å‘",
          "å¾®æœåŠ¡",
          "åˆ†å¸ƒå¼",
          "Redis",
          "ç¼“å­˜"
        ],
        "summary": "Redisæ˜¯ä¸€ç§é«˜æ€§èƒ½çš„key-valueå­˜å‚¨ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\n1. å†…å­˜å­˜å‚¨ï¼šRediså°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œé€šå¸¸æ¯”åŸºäºç£ç›˜çš„å­˜å‚¨ç³»ç»Ÿå¿«å‡ ä¸ªæ•°é‡çº§ã€‚\n2. æ•°æ®ç»“æ„å¤šæ ·ï¼šRedisæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆç­‰ï¼Œä¸°å¯Œçš„æ•°æ®ç»“æ„ä½¿Rediså¯ä»¥æ”¯æŒæ›´å¤šçš„åº”ç”¨åœºæ™¯ã€‚\n3. æŒä¹…åŒ–ï¼šRedisæ”¯æŒå°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œä»¥ä¿è¯æ•°æ®çš„å¯é æ€§ã€‚\n4. é«˜å¹¶å‘æ€§ï¼šRedisé‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼Œå‡å°‘äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œä»è€Œä½¿å¾—Rediså…·æœ‰æ›´é«˜çš„å¹¶å‘æ€§ã€‚\n5. åˆ†å¸ƒå¼ï¼šRedisæä¾›äº†é›†ç¾¤æ¨¡å¼ï¼Œå¯ä»¥å°†æ•°æ®åˆ†å¸ƒåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå®ç°æ°´å¹³æ‰©å±•ã€‚",
        "sort": "",
        "title": "Redis å…¥æ‰‹çŸ¥è¯†ç‚¹",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "387ccffe-e894-442f-9471-2460619d4e62"
        }
      ],
      "body": "",
      "realName": "Redis å…¥æ‰‹çŸ¥è¯†ç‚¹",
      "relativePath": "/archives/Redis å…¥æ‰‹çŸ¥è¯†ç‚¹.md"
    },
    {
      "id": "f2eefe59-c1ef-4dba-847d-6525d1ddc518",
      "doc_id": "f2eefe59-c1ef-4dba-847d-6525d1ddc518",
      "title": "f2eefe59-c1ef-4dba-847d-6525d1ddc518",
      "updated": 1696747320000,
      "body_original": "\n## JMM\n\n\n### å†…å­˜æ¨¡å‹\n\n\nåœ¨ JDK1.2 ä¹‹å‰ï¼ŒJava çš„å†…å­˜æ¨¡å‹å®ç°æ€»æ˜¯ä»**ä¸»å­˜**ï¼ˆå³å…±äº«å†…å­˜ï¼‰è¯»å–å˜é‡ï¼Œæ˜¯ä¸éœ€è¦è¿›è¡Œç‰¹åˆ«çš„æ³¨æ„çš„ã€‚è€Œåœ¨å½“å‰çš„ Java å†…å­˜æ¨¡å‹ä¸‹ï¼Œçº¿ç¨‹å¯ä»¥æŠŠå˜é‡ä¿å­˜**æœ¬åœ°å†…å­˜**ï¼ˆæ¯”å¦‚æœºå™¨çš„å¯„å­˜å™¨ï¼‰ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ä¸»å­˜ä¸­è¿›è¡Œè¯»å†™ã€‚è¿™å°±å¯èƒ½é€ æˆä¸€ä¸ªçº¿ç¨‹åœ¨ä¸»å­˜ä¸­ä¿®æ”¹äº†ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œè€Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿˜ç»§ç»­ä½¿ç”¨å®ƒåœ¨å¯„å­˜å™¨ä¸­çš„å˜é‡å€¼çš„æ‹·è´ï¼Œé€ æˆ**æ•°æ®çš„ä¸ä¸€è‡´**ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203113.png)\n\n\nè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦æŠŠå˜é‡å£°æ˜ä¸º**`volatile`**ï¼Œè¿™å°±æŒ‡ç¤º JVMï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¿›è¡Œè¯»å–ã€‚\n\n\næ‰€ä»¥ï¼Œ**`volatile`** **å…³é”®å­— é™¤äº†é˜²æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨å°±æ˜¯ä¿è¯å˜é‡çš„å¯è§æ€§ã€‚**\n\n\n![](https://blog-file.hehouhui.cn/202203222203555.png)\n\n\n## JVM\n\n\n> å¯¹äº Java ç¨‹åºå‘˜æ¥è¯´ï¼Œåœ¨è™šæ‹Ÿæœºè‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ä¸‹ï¼Œä¸å†éœ€è¦åƒ C/C++ç¨‹åºå¼€å‘ç¨‹åºå‘˜è¿™æ ·ä¸ºæ¯ä¸€ä¸ª new æ“ä½œå»å†™å¯¹åº”çš„ delete/free æ“ä½œï¼Œä¸å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºé—®é¢˜ã€‚æ­£æ˜¯å› ä¸º Java ç¨‹åºå‘˜æŠŠå†…å­˜æ§åˆ¶æƒåˆ©äº¤ç»™ Java è™šæ‹Ÿæœºï¼Œä¸€æ—¦å‡ºç°å†…å­˜æ³„æ¼å’Œæº¢å‡ºæ–¹é¢çš„é—®é¢˜ï¼Œå¦‚æœä¸äº†è§£è™šæ‹Ÿæœºæ˜¯æ€æ ·ä½¿ç”¨å†…å­˜çš„ï¼Œé‚£ä¹ˆæ’æŸ¥é”™è¯¯å°†ä¼šæ˜¯ä¸€ä¸ªéå¸¸è‰°å·¨çš„ä»»åŠ¡ã€‚\n\n\n### åŸºæœ¬é—®é¢˜\n\n- **ä»‹ç»ä¸‹ Java å†…å­˜åŒºåŸŸï¼ˆè¿è¡Œæ—¶æ•°æ®åŒºï¼‰**\n- **Java å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼ˆäº”æ­¥ï¼Œå»ºè®®èƒ½é»˜å†™å‡ºæ¥å¹¶ä¸”è¦çŸ¥é“æ¯ä¸€æ­¥è™šæ‹Ÿæœºåšäº†ä»€ä¹ˆï¼‰**\n- **å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼ï¼ˆå¥æŸ„å’Œç›´æ¥æŒ‡é’ˆä¸¤ç§æ–¹å¼ï¼‰**\n\n**å…¶ä»–é—®é¢˜**\n\n- **String ç±»å’Œå¸¸é‡æ± **\n- **8 ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± **\n\n### è¿è¡Œæ—¶å†…å­˜åŒº\n\n\nava è™šæ‹Ÿæœºåœ¨æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒç®¡ç†çš„å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚JDK. 1.8 å’Œä¹‹å‰çš„ç‰ˆæœ¬ç•¥æœ‰ä¸åŒï¼Œä¸‹é¢ä¼šä»‹ç»åˆ°ã€‚\n\n\n**JDK 1.8 ä¹‹å‰ï¼š**\n\n\n![](https://blog-file.hehouhui.cn/202203222203825.png)\n\n\n**JDK 1.8 ï¼š**\n\n\n![](https://blog-file.hehouhui.cn/202203222129191.png)\n\n\n**çº¿ç¨‹ç§æœ‰çš„ï¼š**\n\n- ç¨‹åºè®¡æ•°å™¨\n- è™šæ‹Ÿæœºæ ˆ\n- æœ¬åœ°æ–¹æ³•æ ˆ\n\n**çº¿ç¨‹å…±äº«çš„ï¼š**\n\n- å †\n- æ–¹æ³•åŒº\n- ç›´æ¥å†…å­˜ (éè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†)\n\n### ç¨‹åºè®¡æ•°å™¨\n\n\nç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚**å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚**\n\n\nå¦å¤–ï¼Œ**ä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚**\n\n\n**ä»ä¸Šé¢çš„ä»‹ç»ä¸­æˆ‘ä»¬çŸ¥é“ç¨‹åºè®¡æ•°å™¨ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š**\n\n1. å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚\n2. åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚\n\n**æ³¨æ„ï¼šç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç°** **`OutOfMemoryError`** **çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚**\n\n\n### è™šæ‹Ÿæœºæ ˆ\n\n\n**ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼ŒJava è™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒï¼Œæè¿°çš„æ˜¯ Java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œæ¯æ¬¡æ–¹æ³•è°ƒç”¨çš„æ•°æ®éƒ½æ˜¯é€šè¿‡æ ˆä¼ é€’çš„ã€‚**\n\n\n**Java å†…å­˜å¯ä»¥ç²—ç³™çš„åŒºåˆ†ä¸ºå †å†…å­˜ï¼ˆHeapï¼‰å’Œæ ˆå†…å­˜ (Stack),å…¶ä¸­æ ˆå°±æ˜¯ç°åœ¨è¯´çš„è™šæ‹Ÿæœºæ ˆï¼Œæˆ–è€…è¯´æ˜¯è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨éƒ¨åˆ†ã€‚** ï¼ˆå®é™…ä¸Šï¼ŒJava è™šæ‹Ÿæœºæ ˆæ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆï¼Œè€Œæ¯ä¸ªæ ˆå¸§ä¸­éƒ½æ‹¥æœ‰ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ä¿¡æ¯ã€‚ï¼‰\n\n\n**å±€éƒ¨å˜é‡è¡¨ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹**ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€**å¯¹è±¡å¼•ç”¨**ï¼ˆreference ç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ã€‚\n\n\n**Java è™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§é”™è¯¯ï¼š****`StackOverFlowError`** **å’Œ** **`OutOfMemoryError`****ã€‚**\n\n- **`StackOverFlowError`****ï¼š** è‹¥ Java è™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º StackOverFlowError é”™è¯¯ã€‚\n- **`OutOfMemoryError`****ï¼š** è‹¥ Java è™šæ‹Ÿæœºå †ä¸­æ²¡æœ‰ç©ºé—²å†…å­˜ï¼Œå¹¶ä¸”åƒåœ¾å›æ”¶å™¨ä¹Ÿæ— æ³•æä¾›æ›´å¤šå†…å­˜çš„è¯ã€‚å°±ä¼šæŠ›å‡º OutOfMemoryError é”™è¯¯ã€‚\n\nJava è™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å„è‡ªçš„ Java è™šæ‹Ÿæœºæ ˆï¼Œè€Œä¸”éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„æ­»äº¡è€Œæ­»äº¡ã€‚\n\n\n**æ‰©å±•ï¼šé‚£ä¹ˆæ–¹æ³•/å‡½æ•°å¦‚ä½•è°ƒç”¨ï¼Ÿ**\n\n\nJava æ ˆå¯ç”¨ç±»æ¯”æ•°æ®ç»“æ„ä¸­æ ˆï¼ŒJava æ ˆä¸­ä¿å­˜çš„ä¸»è¦å†…å®¹æ˜¯æ ˆå¸§ï¼Œæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§è¢«å‹å…¥ Java æ ˆï¼Œæ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ç»“æŸåï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå¸§è¢«å¼¹å‡ºã€‚\n\n\nJava æ–¹æ³•æœ‰ä¸¤ç§è¿”å›æ–¹å¼ï¼š\n\n1. return è¯­å¥ã€‚\n2. æŠ›å‡ºå¼‚å¸¸ã€‚\n\nä¸ç®¡å“ªç§è¿”å›æ–¹å¼éƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚\n\n\n### æœ¬åœ°æ–¹æ³•æ ˆ\n\n\nå’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š **è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚** åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚\n\n\næœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚\n\n\næ–¹æ³•æ‰§è¡Œå®Œæ¯•åç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¼šå‡ºç° `StackOverFlowError` å’Œ `OutOfMemoryError` ä¸¤ç§é”™è¯¯ã€‚\n\n\n### å †\n\n\nJava è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJava å †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚**æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚**\n\n\n**Javaä¸–ç•Œä¸­â€œå‡ ä¹â€æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨å †ä¸­åˆ†é…ï¼Œä½†æ˜¯ï¼Œéšç€JITç¼–è¯‘æœŸçš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚ä»jdk 1.7å¼€å§‹å·²ç»é»˜è®¤å¼€å¯é€ƒé€¸åˆ†æï¼Œå¦‚æœæŸäº›æ–¹æ³•ä¸­çš„å¯¹è±¡å¼•ç”¨æ²¡æœ‰è¢«è¿”å›æˆ–è€…æœªè¢«å¤–é¢ä½¿ç”¨ï¼ˆä¹Ÿå°±æ˜¯æœªé€ƒé€¸å‡ºå»ï¼‰ï¼Œé‚£ä¹ˆå¯¹è±¡å¯ä»¥ç›´æ¥åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚**\n\n\nJava å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œ**GC å †ï¼ˆGarbage Collected Heapï¼‰**.ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼šå†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEden ç©ºé—´ã€From Survivorã€To Survivor ç©ºé—´ç­‰ã€‚**è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚**\n\n\nåœ¨ JDK 7 ç‰ˆæœ¬åŠJDK 7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸è¢«åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š\n\n1. æ–°ç”Ÿä»£å†…å­˜(Young Generation)\n2. è€ç”Ÿä»£(Old Generation)\n3. æ°¸ç”Ÿä»£(Permanent Generation)\n\n![](https://blog-file.hehouhui.cn/202203222203705.png)\n\n\n![](https://blog-file.hehouhui.cn/202203222203389.png)\n\n\nJDK 8 ç‰ˆæœ¬ä¹‹åæ–¹æ³•åŒºï¼ˆHotSpot çš„æ°¸ä¹…ä»£ï¼‰è¢«å½»åº•ç§»é™¤äº†ï¼ˆJDK1.7 å°±å·²ç»å¼€å§‹äº†ï¼‰ï¼Œå–è€Œä»£ä¹‹æ˜¯å…ƒç©ºé—´ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203514.png)\n\n\n**ä¸Šå›¾æ‰€ç¤ºçš„ Eden åŒºã€ä¸¤ä¸ª Survivor åŒºéƒ½å±äºæ–°ç”Ÿä»£ï¼ˆä¸ºäº†åŒºåˆ†ï¼Œè¿™ä¸¤ä¸ª Survivor åŒºåŸŸæŒ‰ç…§é¡ºåºè¢«å‘½åä¸º from å’Œ toï¼‰ï¼Œä¸­é—´ä¸€å±‚å±äºè€å¹´ä»£ã€‚**\n\n\nå¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ s0 æˆ–è€… s1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº->Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° `-XX:MaxTenuringThreshold` æ¥è®¾ç½®ã€‚\n\n\n> ä¿®æ­£ï¼ˆissue552ï¼‰ï¼šâ€œHotspotéå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº†survivoråŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’ŒMaxTenuringThresholdä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚\n\n\n\t**åŠ¨æ€å¹´é¾„è®¡ç®—çš„ä»£ç å¦‚ä¸‹**\n\n\n\t```text\n\tuint ageTable::compute_tenuring_threshold(size_t survivor_capacity) {\n\t//survivor_capacityæ˜¯survivorç©ºé—´çš„å¤§å°\n\tsize_t desired_survivor_size = (size_t)((((double) survivor_capacity)*TargetSurvivorRatio)/100);\n\tsize_t total = 0;\n\tuint age = 1;\n\twhile (age < table_size) {\n\ttotal += sizes[age];//sizesæ•°ç»„æ˜¯æ¯ä¸ªå¹´é¾„æ®µå¯¹è±¡å¤§å°\n\tif (total > desired_survivor_size) break;\n\tage++;\n\t}\n\tuint result = age < MaxTenuringThreshold ? age : MaxTenuringThreshold;\n\t...\n\t}\n\tCopy to clipboardErrorCopied\n\t\n\t```\n\n\nå †è¿™é‡Œæœ€å®¹æ˜“å‡ºç°çš„å°±æ˜¯ OutOfMemoryError é”™è¯¯ï¼Œå¹¶ä¸”å‡ºç°è¿™ç§é”™è¯¯ä¹‹åçš„è¡¨ç°å½¢å¼è¿˜ä¼šæœ‰å‡ ç§ï¼Œæ¯”å¦‚ï¼š\n\n1. **`OutOfMemoryError: GC Overhead Limit Exceeded`** ï¼š å½“JVMèŠ±å¤ªå¤šæ—¶é—´æ‰§è¡Œåƒåœ¾å›æ”¶å¹¶ä¸”åªèƒ½å›æ”¶å¾ˆå°‘çš„å †ç©ºé—´æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤é”™è¯¯ã€‚\n2. **`java.lang.OutOfMemoryError: Java heap space`** :å‡å¦‚åœ¨åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶, å †å†…å­˜ä¸­çš„ç©ºé—´ä¸è¶³ä»¥å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡, å°±ä¼šå¼•å‘`java.lang.OutOfMemoryError: Java heap space` é”™è¯¯ã€‚(å’Œæœ¬æœºç‰©ç†å†…å­˜æ— å…³ï¼Œå’Œä½ é…ç½®çš„å†…å­˜å¤§å°æœ‰å…³ï¼)\n3. ......\n\n### æ–¹æ³•åŒº\n\n\næ–¹æ³•åŒºä¸ Java å †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚è™½ç„¶ **Java è™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†**ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«åš **Non-Heapï¼ˆéå †ï¼‰**ï¼Œç›®çš„åº”è¯¥æ˜¯ä¸ Java å †åŒºåˆ†å¼€æ¥ã€‚\n\n\næ–¹æ³•åŒºä¹Ÿè¢«ç§°ä¸ºæ°¸ä¹…ä»£ã€‚å¾ˆå¤šäººéƒ½ä¼šåˆ†ä¸æ¸…æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»ï¼Œä¸ºæ­¤æˆ‘ä¹ŸæŸ¥é˜…äº†æ–‡çŒ®ã€‚\n\n\n**æ–¹æ³•åŒºå’Œæ°¸ç”Ÿä»£çš„å…³ç³»**\n\n\n> ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹åªæ˜¯è§„å®šäº†æœ‰æ–¹æ³•åŒºè¿™ä¹ˆä¸ªæ¦‚å¿µå’Œå®ƒçš„ä½œç”¨ï¼Œå¹¶æ²¡æœ‰è§„å®šå¦‚ä½•å»å®ç°å®ƒã€‚é‚£ä¹ˆï¼Œåœ¨ä¸åŒçš„ JVM ä¸Šæ–¹æ³•åŒºçš„å®ç°è‚¯å®šæ˜¯ä¸åŒçš„äº†ã€‚ æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»å¾ˆåƒ Java ä¸­æ¥å£å’Œç±»çš„å…³ç³»ï¼Œç±»å®ç°äº†æ¥å£ï¼Œè€Œæ°¸ä¹…ä»£å°±æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸€ç§å®ç°æ–¹å¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ°¸ä¹…ä»£æ˜¯ HotSpot çš„æ¦‚å¿µï¼Œæ–¹æ³•åŒºæ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­çš„å®šä¹‰ï¼Œæ˜¯ä¸€ç§è§„èŒƒï¼Œè€Œæ°¸ä¹…ä»£æ˜¯ä¸€ç§å®ç°ï¼Œä¸€ä¸ªæ˜¯æ ‡å‡†ä¸€ä¸ªæ˜¯å®ç°ï¼Œå…¶ä»–çš„è™šæ‹Ÿæœºå®ç°å¹¶æ²¡æœ‰æ°¸ä¹…ä»£è¿™ä¸€è¯´æ³•ã€‚\n\n\n**å‚æ•°**\n\n\nJDK 1.8 ä¹‹å‰æ°¸ä¹…ä»£è¿˜æ²¡è¢«å½»åº•ç§»é™¤çš„æ—¶å€™é€šå¸¸é€šè¿‡ä¸‹é¢è¿™äº›å‚æ•°æ¥è°ƒèŠ‚æ–¹æ³•åŒºå¤§å°\n\n\n```text\n-XX:PermSize=N //æ–¹æ³•åŒº (æ°¸ä¹…ä»£) åˆå§‹å¤§å°\n-XX:MaxPermSize=N //æ–¹æ³•åŒº (æ°¸ä¹…ä»£) æœ€å¤§å¤§å°,è¶…è¿‡è¿™ä¸ªå€¼å°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸:java.lang.OutOfMemoryError: PermGenCopy to clipboardErrorCopied\n\n```\n\n\nç›¸å¯¹è€Œè¨€ï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œä½†å¹¶éæ•°æ®è¿›å…¥æ–¹æ³•åŒºåå°±â€œæ°¸ä¹…å­˜åœ¨â€äº†ã€‚\n\n\nJDK 1.8 çš„æ—¶å€™ï¼Œæ–¹æ³•åŒºï¼ˆHotSpot çš„æ°¸ä¹…ä»£ï¼‰è¢«å½»åº•ç§»é™¤äº†ï¼ˆJDK1.7 å°±å·²ç»å¼€å§‹äº†ï¼‰ï¼Œå–è€Œä»£ä¹‹æ˜¯å…ƒç©ºé—´ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ã€‚\n\n\nä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨å‚æ•°ï¼š\n\n\n```text\n-XX:MetaspaceSize=N //è®¾ç½® Metaspace çš„åˆå§‹ï¼ˆå’Œæœ€å°å¤§å°ï¼‰\n-XX:MaxMetaspaceSize=N //è®¾ç½® Metaspace çš„æœ€å¤§å¤§å°Copy to clipboardErrorCopied\n\n```\n\n\nä¸æ°¸ä¹…ä»£å¾ˆå¤§çš„ä¸åŒå°±æ˜¯ï¼Œå¦‚æœä¸æŒ‡å®šå¤§å°çš„è¯ï¼Œéšç€æ›´å¤šç±»çš„åˆ›å»ºï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿå†…å­˜ã€‚\n\n\n### å…ƒç©ºé—´\n\n1. æ•´ä¸ªæ°¸ä¹…ä»£æœ‰ä¸€ä¸ª JVM æœ¬èº«è®¾ç½®å›ºå®šå¤§å°ä¸Šé™ï¼Œæ— æ³•è¿›è¡Œè°ƒæ•´ï¼Œè€Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ï¼Œå—æœ¬æœºå¯ç”¨å†…å­˜çš„é™åˆ¶ï¼Œè™½ç„¶å…ƒç©ºé—´ä»æ—§å¯èƒ½æº¢å‡ºï¼Œä½†æ˜¯æ¯”åŸæ¥å‡ºç°çš„å‡ ç‡ä¼šæ›´å°ã€‚\n\n\t> å½“ä½ å…ƒç©ºé—´æº¢å‡ºæ—¶ä¼šå¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š java.lang.OutOfMemoryError: MetaSpace\n\n\nä½ å¯ä»¥ä½¿ç”¨ `-XXï¼šMaxMetaspaceSize` æ ‡å¿—è®¾ç½®æœ€å¤§å…ƒç©ºé—´å¤§å°ï¼Œé»˜è®¤å€¼ä¸º unlimitedï¼Œè¿™æ„å‘³ç€å®ƒåªå—ç³»ç»Ÿå†…å­˜çš„é™åˆ¶ã€‚`-XXï¼šMetaspaceSize` è°ƒæ•´æ ‡å¿—å®šä¹‰å…ƒç©ºé—´çš„åˆå§‹å¤§å°å¦‚æœæœªæŒ‡å®šæ­¤æ ‡å¿—ï¼Œåˆ™ Metaspace å°†æ ¹æ®è¿è¡Œæ—¶çš„åº”ç”¨ç¨‹åºéœ€æ±‚åŠ¨æ€åœ°é‡æ–°è°ƒæ•´å¤§å°ã€‚\n\n1. å…ƒç©ºé—´é‡Œé¢å­˜æ”¾çš„æ˜¯ç±»çš„å…ƒæ•°æ®ï¼Œè¿™æ ·åŠ è½½å¤šå°‘ç±»çš„å…ƒæ•°æ®å°±ä¸ç”± `MaxPermSize` æ§åˆ¶äº†, è€Œç”±ç³»ç»Ÿçš„å®é™…å¯ç”¨ç©ºé—´æ¥æ§åˆ¶ï¼Œè¿™æ ·èƒ½åŠ è½½çš„ç±»å°±æ›´å¤šäº†ã€‚\n2. åœ¨ JDK8ï¼Œåˆå¹¶ HotSpot å’Œ JRockit çš„ä»£ç æ—¶, JRockit ä»æ¥æ²¡æœ‰ä¸€ä¸ªå«æ°¸ä¹…ä»£çš„ä¸œè¥¿, åˆå¹¶ä¹‹åå°±æ²¡æœ‰å¿…è¦é¢å¤–çš„è®¾ç½®è¿™ä¹ˆä¸€ä¸ªæ°¸ä¹…ä»£çš„åœ°æ–¹äº†ã€‚\n\n### è¿è¡Œæ—¶å¸¸é‡æ± \n\n\nè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰å¸¸é‡æ± è¡¨ï¼ˆç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰\n\n\næ—¢ç„¶è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè‡ªç„¶å—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡º OutOfMemoryError é”™è¯¯ã€‚\n\n\n~~**JDK1.7 åŠä¹‹åç‰ˆæœ¬çš„ JVM å·²ç»å°†è¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºä¸­ç§»äº†å‡ºæ¥ï¼Œåœ¨ Java å †ï¼ˆHeapï¼‰ä¸­å¼€è¾Ÿäº†ä¸€å—åŒºåŸŸå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ã€‚**~~\n\n\n> ä¿®æ­£(issue747ï¼Œreference)ï¼š\n\n\t1. **JDK1.7ä¹‹å‰è¿è¡Œæ—¶å¸¸é‡æ± é€»è¾‘åŒ…å«å­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ–¹æ³•åŒº, æ­¤æ—¶hotspotè™šæ‹Ÿæœºå¯¹æ–¹æ³•åŒºçš„å®ç°ä¸ºæ°¸ä¹…ä»£**\n\t2. **JDK1.7 å­—ç¬¦ä¸²å¸¸é‡æ± è¢«ä»æ–¹æ³•åŒºæ‹¿åˆ°äº†å †ä¸­, è¿™é‡Œæ²¡æœ‰æåˆ°è¿è¡Œæ—¶å¸¸é‡æ± ,ä¹Ÿå°±æ˜¯è¯´å­—ç¬¦ä¸²å¸¸é‡æ± è¢«å•ç‹¬æ‹¿åˆ°å †,è¿è¡Œæ—¶å¸¸é‡æ± å‰©ä¸‹çš„ä¸œè¥¿è¿˜åœ¨æ–¹æ³•åŒº, ä¹Ÿå°±æ˜¯hotspotä¸­çš„æ°¸ä¹…ä»£** ã€‚\n\t3. **JDK1.8 hotspotç§»é™¤äº†æ°¸ä¹…ä»£ç”¨å…ƒç©ºé—´(Metaspace)å–è€Œä»£ä¹‹, è¿™æ—¶å€™å­—ç¬¦ä¸²å¸¸é‡æ± è¿˜åœ¨å †, è¿è¡Œæ—¶å¸¸é‡æ± è¿˜åœ¨æ–¹æ³•åŒº, åªä¸è¿‡æ–¹æ³•åŒºçš„å®ç°ä»æ°¸ä¹…ä»£å˜æˆäº†å…ƒç©ºé—´(Metaspace)**\n\nç›¸å…³é—®é¢˜ï¼šJVM å¸¸é‡æ± ä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡è¿˜æ˜¯å¼•ç”¨å‘¢ï¼Ÿï¼š [https://www.zhihu.com/question/57109429/answer/151717241](https://www.zhihu.com/question/57109429/answer/151717241) by RednaxelaFX\n\n\n**ç‰¹åˆ«æ³¨æ„âš ï¸**\n\n\n**Java åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»çš„å¤§éƒ¨åˆ†éƒ½å®ç°äº†å¸¸é‡æ± æŠ€æœ¯ï¼Œå³ Byte,Short,Integer,Long,Character,Booleanï¼›å‰é¢ 4 ç§åŒ…è£…ç±»é»˜è®¤åˆ›å»ºäº†æ•°å€¼[-128ï¼Œ127] çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼ŒCharacteråˆ›å»ºäº†æ•°å€¼åœ¨[0,127]èŒƒå›´çš„ç¼“å­˜æ•°æ®ï¼ŒBoolean ç›´æ¥è¿”å›True Or Falseã€‚å¦‚æœè¶…å‡ºå¯¹åº”èŒƒå›´ä»ç„¶ä¼šå»åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚** ä¸ºå•¥æŠŠç¼“å­˜è®¾ç½®ä¸º[-128ï¼Œ127]åŒºé—´ï¼Ÿï¼ˆ[å‚è§issue/461](https://github.com/Snailclimb/JavaGuide/issues/461)ï¼‰æ€§èƒ½å’Œèµ„æºä¹‹é—´çš„æƒè¡¡ã€‚\n\n\n```text\npublic static Boolean valueOf(boolean b) {\n    return (b ? TRUE : FALSE);\n}Copy to clipboardErrorCopied\nprivate static class CharacterCache {\n    private CharacterCache(){}\n\n    static final Character cache[] = new Character[127 + 1];\n    static {\n        for (int i = 0; i < cache.length; i++)\n            cache[i] = new Character((char)i);\n    }\n}Copy to clipboardErrorCopied\n\n```\n\n\nä¸¤ç§æµ®ç‚¹æ•°ç±»å‹çš„åŒ…è£…ç±» Float,Double å¹¶æ²¡æœ‰å®ç°å¸¸é‡æ± æŠ€æœ¯ã€‚\n\n\n```text\n        Integer i1 = 33;\n        Integer i2 = 33;\n        System.out.println(i1 == i2);// è¾“å‡º true\n        Integer i11 = 333;\n        Integer i22 = 333;\n        System.out.println(i11 == i22);// è¾“å‡º false\n        Double i3 = 1.2;\n        Double i4 = 1.2;\n        System.out.println(i3 == i4);// è¾“å‡º falseCopy to clipboardErrorCopied\n\n```\n\n\n**Integer ç¼“å­˜æºä»£ç ï¼š**\n\n\n```text\n/**\n*æ­¤æ–¹æ³•å°†å§‹ç»ˆç¼“å­˜-128 åˆ° 127ï¼ˆåŒ…æ‹¬ç«¯ç‚¹ï¼‰èŒƒå›´å†…çš„å€¼ï¼Œå¹¶å¯ä»¥ç¼“å­˜æ­¤èŒƒå›´ä¹‹å¤–çš„å…¶ä»–å€¼ã€‚\n*/\n    public static Integer valueOf(int i) {\n        if (i >= IntegerCache.low && i <= IntegerCache.high)\n            return IntegerCache.cache[i + (-IntegerCache.low)];\n        return new Integer(i);\n    }\nCopy to clipboardErrorCopied\n\n```\n\n\n**åº”ç”¨åœºæ™¯ï¼š**\n\n1. Integer i1=40ï¼›Java åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç›´æ¥å°†ä»£ç å°è£…æˆ Integer i1=Integer.valueOf(40);ï¼Œä»è€Œä½¿ç”¨å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚\n2. Integer i1 = new Integer(40);è¿™ç§æƒ…å†µä¸‹ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚\n\n```text\n  Integer i1 = 40;\n  Integer i2 = new Integer(40);\n  System.out.println(i1==i2);//è¾“å‡º falseCopy to clipboardErrorCopied\n\n```\n\n\n**Integer æ¯”è¾ƒæ›´ä¸°å¯Œçš„ä¸€ä¸ªä¾‹å­:**\n\n\n```text\n  Integer i1 = 40;\n  Integer i2 = 40;\n  Integer i3 = 0;\n  Integer i4 = new Integer(40);\n  Integer i5 = new Integer(40);\n  Integer i6 = new Integer(0);\n\n  System.out.println(\"i1=i2   \" + (i1 == i2));\n  System.out.println(\"i1=i2+i3   \" + (i1 == i2 + i3));\n  System.out.println(\"i1=i4   \" + (i1 == i4));\n  System.out.println(\"i4=i5   \" + (i4 == i5));\n  System.out.println(\"i4=i5+i6   \" + (i4 == i5 + i6));\n  System.out.println(\"40=i5+i6   \" + (40 == i5 + i6));     Copy to clipboardErrorCopied\n\n```\n\n\nç»“æœï¼š\n\n\n```text\ni1=i2   true\ni1=i2+i3   true\ni1=i4   false\ni4=i5   false\ni4=i5+i6   true\n40=i5+i6   trueCopy to clipboardErrorCopied\n\n```\n\n\nè§£é‡Šï¼š\n\n\nè¯­å¥ i4 == i5 + i6ï¼Œå› ä¸º+è¿™ä¸ªæ“ä½œç¬¦ä¸é€‚ç”¨äº Integer å¯¹è±¡ï¼Œé¦–å…ˆ i5 å’Œ i6 è¿›è¡Œè‡ªåŠ¨æ‹†ç®±æ“ä½œï¼Œè¿›è¡Œæ•°å€¼ç›¸åŠ ï¼Œå³ i4 == 40ã€‚ç„¶å Integer å¯¹è±¡æ— æ³•ä¸æ•°å€¼è¿›è¡Œç›´æ¥æ¯”è¾ƒï¼Œæ‰€ä»¥ i4 è‡ªåŠ¨æ‹†ç®±è½¬ä¸º int å€¼ 40ï¼Œæœ€ç»ˆè¿™æ¡è¯­å¥è½¬ä¸º 40 == 40 è¿›è¡Œæ•°å€¼æ¯”è¾ƒã€‚\n\n\n### ç›´æ¥å†…å­˜\n\n\n**ç›´æ¥å†…å­˜å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ã€‚è€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´ OutOfMemoryError é”™è¯¯å‡ºç°ã€‚**\n\n\nJDK1.4 ä¸­æ–°åŠ å…¥çš„ **NIO(New Input/Output) ç±»**ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäº**é€šé“ï¼ˆChannelï¼‰** ä¸**ç¼“å­˜åŒºï¼ˆBufferï¼‰** çš„ I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ç›´æ¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †ä¸­çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·å°±èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸º**é¿å…äº†åœ¨ Java å †å’Œ Native å †ä¹‹é—´æ¥å›å¤åˆ¶æ•°æ®**ã€‚\n\n\næœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ° Java å †çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜å°±ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚\n\n\n### åƒåœ¾å›æ”¶\n\n\nJava çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡å†…å­˜çš„å›æ”¶å’Œå¯¹è±¡å†…å­˜çš„åˆ†é…ã€‚åŒæ—¶ï¼ŒJava è‡ªåŠ¨å†…å­˜ç®¡ç†æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯ **å †** å†…å­˜ä¸­å¯¹è±¡çš„åˆ†é…ä¸å›æ”¶ã€‚\n\n\nJava å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œ**GC å †ï¼ˆGarbage Collected Heapï¼‰**.ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼šå†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEden ç©ºé—´ã€From Survivorã€To Survivor ç©ºé—´ç­‰ã€‚**è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚**\n\n\n**å †ç©ºé—´çš„åŸºæœ¬ç»“æ„ï¼š**\n\n\n![](https://snailclimb.gitee.io/javaguide/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01d330d8-2710-4fad-a91c-7bbbfaaefc0e.png)\n\n\nä¸Šå›¾æ‰€ç¤ºçš„ Eden åŒºã€From Survivor0(\"From\") åŒºã€To Survivor1(\"To\") åŒºéƒ½å±äºæ–°ç”Ÿä»£ï¼ŒOld Memory åŒºå±äºè€å¹´ä»£ã€‚\n\n\nå¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ s0 æˆ–è€… s1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº->Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° `-XX:MaxTenuringThreshold` æ¥è®¾ç½®ã€‚\n\n\n> ä¿®æ­£ï¼ˆissue552ï¼‰ï¼šâ€œHotspot éå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚\n\n\n\t**åŠ¨æ€å¹´é¾„è®¡ç®—çš„ä»£ç å¦‚ä¸‹**\n\n\n\t```text\n\tuint ageTable::compute_tenuring_threshold(size_t survivor_capacity) {\n\t//survivor_capacityæ˜¯survivorç©ºé—´çš„å¤§å°\n\tsize_t desired_survivor_size = (size_t)((((double)survivor_capacity)*TargetSurvivorRatio)/100);\n\tsize_t total = 0;\n\tuint age = 1;\n\twhile (age < table_size) {\n\t  //sizesæ•°ç»„æ˜¯æ¯ä¸ªå¹´é¾„æ®µå¯¹è±¡å¤§å°\n\t  total += sizes[age];\n\t  if (total > desired_survivor_size) {\n\t      break;\n\t  }\n\t  age++;\n\t}\n\tuint result = age < MaxTenuringThreshold ? age : MaxTenuringThreshold;\n\t...\n\t}\n\tCopy to clipboardErrorCopied\n\t\n\t```\n\n\nç»è¿‡è¿™æ¬¡ GC åï¼ŒEden åŒºå’Œ\"From\"åŒºå·²ç»è¢«æ¸…ç©ºã€‚è¿™ä¸ªæ—¶å€™ï¼Œ\"From\"å’Œ\"To\"ä¼šäº¤æ¢ä»–ä»¬çš„è§’è‰²ï¼Œä¹Ÿå°±æ˜¯æ–°çš„\"To\"å°±æ˜¯ä¸Šæ¬¡ GC å‰çš„â€œFromâ€ï¼Œæ–°çš„\"From\"å°±æ˜¯ä¸Šæ¬¡ GC å‰çš„\"To\"ã€‚ä¸ç®¡æ€æ ·ï¼Œéƒ½ä¼šä¿è¯åä¸º To çš„ Survivor åŒºåŸŸæ˜¯ç©ºçš„ã€‚Minor GC ä¼šä¸€ç›´é‡å¤è¿™æ ·çš„è¿‡ç¨‹ï¼Œç›´åˆ°â€œToâ€åŒºè¢«å¡«æ»¡ï¼Œ\"To\"åŒºè¢«å¡«æ»¡ä¹‹åï¼Œä¼šå°†æ‰€æœ‰å¯¹è±¡ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203744.png)\n\n\n![](https://blog-file.hehouhui.cn/202203222203096.png)\n\n\n![](https://blog-file.hehouhui.cn/202203222203366.png)\n\n\n![](https://blog-file.hehouhui.cn/202203222203478.png)\n\n\n> å½“éœ€è¦æ’æŸ¥å„ç§å†…å­˜æº¢å‡ºé—®é¢˜ã€å½“åƒåœ¾æ”¶é›†æˆä¸ºç³»ç»Ÿè¾¾åˆ°æ›´é«˜å¹¶å‘çš„ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹è¿™äº›â€œè‡ªåŠ¨åŒ–â€çš„æŠ€æœ¯å®æ–½å¿…è¦çš„ç›‘æ§å’Œè°ƒèŠ‚ã€‚\n\n\né—®é¢˜ç­”æ¡ˆåœ¨æ–‡ä¸­éƒ½æœ‰æåˆ°\n\n- å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ­»äº¡ï¼ˆä¸¤ç§æ–¹æ³•ï¼‰ã€‚\n- ç®€å•çš„ä»‹ç»ä¸€ä¸‹å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼ˆè™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„åŒºåˆ«ã€ä½¿ç”¨è½¯å¼•ç”¨èƒ½å¸¦æ¥çš„å¥½å¤„ï¼‰ã€‚\n- å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡\n- å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»\n- åƒåœ¾æ”¶é›†æœ‰å“ªäº›ç®—æ³•ï¼Œå„è‡ªçš„ç‰¹ç‚¹ï¼Ÿ\n- HotSpot ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ\n- å¸¸è§çš„åƒåœ¾å›æ”¶å™¨æœ‰å“ªäº›ï¼Ÿ\n- ä»‹ç»ä¸€ä¸‹ CMS,G1 æ”¶é›†å™¨ã€‚\n- Minor Gc å’Œ Full GC æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ\n\n### å†…å­˜åˆ†é…ä¸å›æ”¶æœºåˆ¶\n\n\n### å¯¹è±¡ä¼˜å…ˆåœ¨edenåŒºåˆ†é…\n\n\nç›®å‰ä¸»æµçš„åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šé‡‡ç”¨åˆ†ä»£å›æ”¶ç®—æ³•ï¼Œå› æ­¤éœ€è¦å°†å †å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚\n\n\nå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ eden åŒºåˆ†é…ã€‚å½“ eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡ Minor GC.ä¸‹é¢æˆ‘ä»¬æ¥è¿›è¡Œå®é™…æµ‹è¯•ä»¥ä¸‹ã€‚\n\n\n**æµ‹è¯•ï¼š**\n\n\n```text\npublic class GCTest {\n\n    public static void main(String[] args) {\n        byte[] allocation1, allocation2;\n        allocation1 = new byte[30900*1024];\n        //allocation2 = new byte[900*1024];\n    }\n}Copy to clipboardErrorCopied\n\n```\n\n\né€šè¿‡ä»¥ä¸‹æ–¹å¼è¿è¡Œï¼š\n\n\n![](https://blog-file.hehouhui.cn/202203222136423.png)\n\n\næ·»åŠ çš„å‚æ•°ï¼š\n\n\n```text\n-XX:+PrintGCDetails\n```\n\n\n![](https://snailclimb.gitee.io/javaguide/docs/java/jvm/pictures/jvm%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/10317146.png)\n\n\nè¿è¡Œç»“æœ (çº¢è‰²å­—ä½“æè¿°æœ‰è¯¯ï¼Œåº”è¯¥æ˜¯å¯¹åº”äº JDK1.7 çš„æ°¸ä¹…ä»£)ï¼š\n\n\n![](https://blog-file.hehouhui.cn/202203222203083.jpg)\n\n\nä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡º eden åŒºå†…å­˜å‡ ä¹å·²ç»è¢«åˆ†é…å®Œå…¨ï¼ˆå³ä½¿ç¨‹åºä»€ä¹ˆä¹Ÿä¸åšï¼Œæ–°ç”Ÿä»£ä¹Ÿä¼šä½¿ç”¨ 2000 å¤š k å†…å­˜ï¼‰ã€‚å‡å¦‚æˆ‘ä»¬å†ä¸º allocation2 åˆ†é…å†…å­˜ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ\n\n\n```text\nallocation2 = new byte[900*1024];Copy to clipboardErrorCopied\n\n```\n\n\n![](https://blog-file.hehouhui.cn/202203222203234.png)\n\n\n**ç®€å•è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š** å› ä¸ºç»™ allocation2 åˆ†é…å†…å­˜çš„æ—¶å€™ eden åŒºå†…å­˜å‡ ä¹å·²ç»è¢«åˆ†é…å®Œäº†ï¼Œæˆ‘ä»¬åˆšåˆšè®²äº†å½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡ Minor GC.GC æœŸé—´è™šæ‹Ÿæœºåˆå‘ç° allocation1 æ— æ³•å­˜å…¥ Survivor ç©ºé—´ï¼Œæ‰€ä»¥åªå¥½é€šè¿‡ **åˆ†é…æ‹…ä¿æœºåˆ¶** æŠŠæ–°ç”Ÿä»£çš„å¯¹è±¡æå‰è½¬ç§»åˆ°è€å¹´ä»£ä¸­å»ï¼Œè€å¹´ä»£ä¸Šçš„ç©ºé—´è¶³å¤Ÿå­˜æ”¾ allocation1ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° Full GCã€‚æ‰§è¡Œ Minor GC åï¼Œåé¢åˆ†é…çš„å¯¹è±¡å¦‚æœèƒ½å¤Ÿå­˜åœ¨ eden åŒºçš„è¯ï¼Œè¿˜æ˜¯ä¼šåœ¨ eden åŒºåˆ†é…å†…å­˜ã€‚å¯ä»¥æ‰§è¡Œå¦‚ä¸‹ä»£ç éªŒè¯ï¼š\n\n\n```text\npublic class GCTest {\n\n    public static void main(String[] args) {\n        byte[] allocation1, allocation2,allocation3,allocation4,allocation5;\n        allocation1 = new byte[32000*1024];\n        allocation2 = new byte[1000*1024];\n        allocation3 = new byte[1000*1024];\n        allocation4 = new byte[1000*1024];\n        allocation5 = new byte[1000*1024];\n    }\n}\nCopy to clipboardErrorCopied\n\n```\n\n\n### å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£\n\n\n> å¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ã€‚\n\n\n**ä¸ºä»€ä¹ˆè¦è¿™æ ·å‘¢ï¼Ÿ**\n\n\nä¸ºäº†é¿å…ä¸ºå¤§å¯¹è±¡åˆ†é…å†…å­˜æ—¶ç”±äºåˆ†é…æ‹…ä¿æœºåˆ¶å¸¦æ¥çš„å¤åˆ¶è€Œé™ä½æ•ˆç‡\n\n\n### é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£\n\n\næ—¢ç„¶è™šæ‹Ÿæœºé‡‡ç”¨äº†åˆ†ä»£æ”¶é›†çš„æ€æƒ³æ¥ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆå†…å­˜å›æ”¶æ—¶å°±å¿…é¡»èƒ½è¯†åˆ«å“ªäº›å¯¹è±¡åº”æ”¾åœ¨æ–°ç”Ÿä»£ï¼Œå“ªäº›å¯¹è±¡åº”æ”¾åœ¨è€å¹´ä»£ä¸­ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œè™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡ä¸€ä¸ªå¯¹è±¡å¹´é¾„ï¼ˆAgeï¼‰è®¡æ•°å™¨ã€‚\n\n\nå¦‚æœå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€æ¬¡ Minor GC åä»ç„¶èƒ½å¤Ÿå­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢« Survivor å®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ° Survivor ç©ºé—´ä¸­ï¼Œå¹¶å°†å¯¹è±¡å¹´é¾„è®¾ä¸º 1.å¯¹è±¡åœ¨ Survivor ä¸­æ¯ç†¬è¿‡ä¸€æ¬¡ MinorGC,å¹´é¾„å°±å¢åŠ  1 å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° `-XX:MaxTenuringThreshold` æ¥è®¾ç½®ã€‚\n\n\n### åŠ¨æ€åˆ¤æ–­å¯¹è±¡å¹´é¾„\n\n\nå¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ s0 æˆ–è€… s1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº->Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° `-XX:MaxTenuringThreshold` æ¥è®¾ç½®ã€‚\n\n\n> ä¿®æ­£ï¼ˆissue552ï¼‰ï¼šâ€œHotspot éå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚\n\n\n\t**åŠ¨æ€å¹´é¾„è®¡ç®—çš„ä»£ç å¦‚ä¸‹**\n\n\n\t```text\n\tuint ageTable::compute_tenuring_threshold(size_t survivor_capacity) {\n\t//survivor_capacityæ˜¯survivorç©ºé—´çš„å¤§å°\n\tsize_t desired_survivor_size = (size_t)((((double)survivor_capacity)*TargetSurvivorRatio)/100);\n\tsize_t total = 0;\n\tuint age = 1;\n\twhile (age < table_size) {\n\t  //sizesæ•°ç»„æ˜¯æ¯ä¸ªå¹´é¾„æ®µå¯¹è±¡å¤§å°\n\t  total += sizes[age];\n\t  if (total > desired_survivor_size) {\n\t      break;\n\t  }\n\t  age++;\n\t}\n\tuint result = age < MaxTenuringThreshold ? age : MaxTenuringThreshold;\n\t...\n\t}\n\tCopy to clipboardErrorCopied\n\t\n\t```\n\n\n\té¢å¤–è¡¥å……è¯´æ˜([issue672](https://github.com/Snailclimb/JavaGuide/issues/672))ï¼š**å…³äºé»˜è®¤çš„æ™‹å‡å¹´é¾„æ˜¯ 15ï¼Œè¿™ä¸ªè¯´æ³•çš„æ¥æºå¤§éƒ¨åˆ†éƒ½æ˜¯ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹è¿™æœ¬ä¹¦ã€‚** å¦‚æœä½ å» Oracle çš„å®˜ç½‘é˜…è¯»[ç›¸å…³çš„è™šæ‹Ÿæœºå‚æ•°](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html)ï¼Œä½ ä¼šå‘ç°`-XX:MaxTenuringThreshold=threshold`è¿™é‡Œæœ‰ä¸ªè¯´æ˜\n\n\n\t**Sets the maximum tenuring threshold for use in adaptive GC sizing. The largest value is 15. The default value is 15 for the parallel (throughput) collector, and 6 for the CMS collector.é»˜è®¤æ™‹å‡å¹´é¾„å¹¶ä¸éƒ½æ˜¯ 15ï¼Œè¿™ä¸ªæ˜¯è¦åŒºåˆ†åƒåœ¾æ”¶é›†å™¨çš„ï¼ŒCMS å°±æ˜¯ 6.**\n\n\n### GCåŒºåŸŸ\n\n\nå‘¨å¿—æ˜å…ˆç”Ÿåœ¨ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ç¬¬äºŒç‰ˆä¸­ P92 å¦‚æ˜¯å†™é“ï¼š\n\n\n> â€œè€å¹´ä»£ GCï¼ˆMajor GC/Full GCï¼‰ï¼ŒæŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCâ€¦â€¦â€\n\n\nä¸Šé¢çš„è¯´æ³•å·²ç»åœ¨ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ç¬¬ä¸‰ç‰ˆä¸­è¢«æ”¹æ­£è¿‡æ¥äº†ã€‚æ„Ÿè°¢ R å¤§çš„å›ç­”ï¼š\n\n\n![](https://blog-file.hehouhui.cn/202203222203561.png)\n\n\n**æ€»ç»“ï¼š**\n\n\né’ˆå¯¹ HotSpot VM çš„å®ç°ï¼Œå®ƒé‡Œé¢çš„ GC å…¶å®å‡†ç¡®åˆ†ç±»åªæœ‰ä¸¤å¤§ç§ï¼š\n\n\néƒ¨åˆ†æ”¶é›† (Partial GC)ï¼š\n\n- æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC / Young GCï¼‰ï¼šåªå¯¹æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾æ”¶é›†ï¼›\n- è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC / Old GCï¼‰ï¼šåªå¯¹è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ Major GC åœ¨æœ‰çš„è¯­å¢ƒä¸­ä¹Ÿç”¨äºæŒ‡ä»£æ•´å †æ”¶é›†ï¼›\n- æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šå¯¹æ•´ä¸ªæ–°ç”Ÿä»£å’Œéƒ¨åˆ†è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚\n\næ•´å †æ”¶é›† (Full GC)ï¼šæ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºã€‚\n\n\n### å¯¹è±¡æ˜¯å¦æ­»äº¡\n\n\nå †ä¸­å‡ ä¹æ”¾ç€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œå¯¹å †åƒåœ¾å›æ”¶å‰çš„ç¬¬ä¸€æ­¥å°±æ˜¯è¦åˆ¤æ–­å“ªäº›å¯¹è±¡å·²ç»æ­»äº¡ï¼ˆå³ä¸èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡ï¼‰ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203717.png)\n\n\n### å¼•ç”¨è®¡æ•°å™¨\n\n\nç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒï¼Œè®¡æ•°å™¨å°±åŠ  1ï¼›å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨å°±å‡ 1ï¼›ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º 0 çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚\n\n\n**è¿™ä¸ªæ–¹æ³•å®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºä¸­å¹¶æ²¡æœ‰é€‰æ‹©è¿™ä¸ªç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œå…¶æœ€ä¸»è¦çš„åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚** æ‰€è°“å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨é—®é¢˜ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼šé™¤äº†å¯¹è±¡ objA å’Œ objB ç›¸äº’å¼•ç”¨ç€å¯¹æ–¹ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å†æ— ä»»ä½•å¼•ç”¨ã€‚ä½†æ˜¯ä»–ä»¬å› ä¸ºäº’ç›¸å¼•ç”¨å¯¹æ–¹ï¼Œå¯¼è‡´å®ƒä»¬çš„å¼•ç”¨è®¡æ•°å™¨éƒ½ä¸ä¸º 0ï¼Œäºæ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•é€šçŸ¥ GC å›æ”¶å™¨å›æ”¶ä»–ä»¬ã€‚\n\n\n```text\npublic class ReferenceCountingGc {\n    Object instance = null;\n    public static void main(String[] args) {\n        ReferenceCountingGc objA = new ReferenceCountingGc();\n        ReferenceCountingGc objB = new ReferenceCountingGc();\n        objA.instance = objB;\n        objB.instance = objA;\n        objA = null;\n        objB = null;\n\n    }\n}Copy to clipboardErrorCopied\n\n```\n\n\n### å¯è¾¾æ€§åˆ†æ\n\n\nè¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€æƒ³å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ç§°ä¸º **â€œGC Rootsâ€** çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼ŒèŠ‚ç‚¹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203882.png)\n\n\nå¯ä½œä¸º GC Roots çš„å¯¹è±¡åŒ…æ‹¬ä¸‹é¢å‡ ç§:\n\n- è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡\n- æœ¬åœ°æ–¹æ³•æ ˆ(Native æ–¹æ³•)ä¸­å¼•ç”¨çš„å¯¹è±¡\n- æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡\n- æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡\n- æ‰€æœ‰è¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡\n\n### å¼•ç”¨\n\n\næ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°æ³•åˆ¤æ–­å¯¹è±¡å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†ææ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨é“¾æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡çš„å­˜æ´»éƒ½ä¸â€œå¼•ç”¨â€æœ‰å…³ã€‚\n\n\nJDK1.2 ä¹‹å‰ï¼ŒJava ä¸­å¼•ç”¨çš„å®šä¹‰å¾ˆä¼ ç»Ÿï¼šå¦‚æœ reference ç±»å‹çš„æ•°æ®å­˜å‚¨çš„æ•°å€¼ä»£è¡¨çš„æ˜¯å¦ä¸€å—å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå°±ç§°è¿™å—å†…å­˜ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ã€‚\n\n\nJDK1.2 ä»¥åï¼ŒJava å¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨å››ç§ï¼ˆå¼•ç”¨å¼ºåº¦é€æ¸å‡å¼±ï¼‰\n\n\n**1ï¼å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰**\n\n\nä»¥å‰æˆ‘ä»¬ä½¿ç”¨çš„å¤§éƒ¨åˆ†å¼•ç”¨å®é™…ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œè¿™æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äº**å¿…ä¸å¯å°‘çš„ç”Ÿæ´»ç”¨å“**ï¼Œåƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJava è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º OutOfMemoryError é”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³é—®é¢˜ã€‚\n\n\n**2ï¼è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰**\n\n\nå¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äº**å¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“**ã€‚å¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚\n\n\nè½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJAVA è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚\n\n\n**3ï¼å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰**\n\n\nå¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äº**å¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“**ã€‚å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚\n\n\nå¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚\n\n\n**4ï¼è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰**\n\n\n\"è™šå¼•ç”¨\"é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶ã€‚\n\n\n**è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨**ã€‚\n\n\n**è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼š** è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚ç¨‹åºå¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚\n\n\nç‰¹åˆ«æ³¨æ„ï¼Œåœ¨ç¨‹åºè®¾è®¡ä¸­ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨å¼±å¼•ç”¨ä¸è™šå¼•ç”¨ï¼Œä½¿ç”¨è½¯å¼•ç”¨çš„æƒ…å†µè¾ƒå¤šï¼Œè¿™æ˜¯å› ä¸º**è½¯å¼•ç”¨å¯ä»¥åŠ é€Ÿ JVM å¯¹åƒåœ¾å†…å­˜çš„å›æ”¶é€Ÿåº¦ï¼Œå¯ä»¥ç»´æŠ¤ç³»ç»Ÿçš„è¿è¡Œå®‰å…¨ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryï¼‰ç­‰é—®é¢˜çš„äº§ç”Ÿ**ã€‚\n\n\n### ä¸å¯è¾¾å¯¹è±¡åˆ«éâ€œéæ­»ä¸å¯â€œ\n\n\nå³ä½¿åœ¨å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘é˜¶æ®µâ€ï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼›å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡è¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize æ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›– finalize æ–¹æ³•ï¼Œæˆ– finalize æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡æ—¶ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µè§†ä¸ºæ²¡æœ‰å¿…è¦æ‰§è¡Œã€‚\n\n\nè¢«åˆ¤å®šä¸ºéœ€è¦æ‰§è¡Œçš„å¯¹è±¡å°†ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ï¼Œé™¤éè¿™ä¸ªå¯¹è±¡ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”ï¼Œå¦åˆ™å°±ä¼šè¢«çœŸçš„å›æ”¶ã€‚\n\n\n### å¦‚ä½•åˆ¤æ–­å¸¸é‡æ˜¯å¦åºŸå¼ƒ?\n\n\nè¿è¡Œæ—¶å¸¸é‡æ± ä¸»è¦å›æ”¶çš„æ˜¯åºŸå¼ƒçš„å¸¸é‡ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡å‘¢ï¼Ÿ\n\n\n~~**JDK1.7 åŠä¹‹åç‰ˆæœ¬çš„ JVM å·²ç»å°†è¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºä¸­ç§»äº†å‡ºæ¥ï¼Œåœ¨ Java å †ï¼ˆHeapï¼‰ä¸­å¼€è¾Ÿäº†ä¸€å—åŒºåŸŸå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ã€‚**~~\n\n\n> ä¿®æ­£(issue747ï¼Œreference)ï¼š\n\n\t1. **JDK1.7 ä¹‹å‰è¿è¡Œæ—¶å¸¸é‡æ± é€»è¾‘åŒ…å«å­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ–¹æ³•åŒº, æ­¤æ—¶ hotspot è™šæ‹Ÿæœºå¯¹æ–¹æ³•åŒºçš„å®ç°ä¸ºæ°¸ä¹…ä»£**\n\t2. **JDK1.7 å­—ç¬¦ä¸²å¸¸é‡æ± è¢«ä»æ–¹æ³•åŒºæ‹¿åˆ°äº†å †ä¸­, è¿™é‡Œæ²¡æœ‰æåˆ°è¿è¡Œæ—¶å¸¸é‡æ± ,ä¹Ÿå°±æ˜¯è¯´å­—ç¬¦ä¸²å¸¸é‡æ± è¢«å•ç‹¬æ‹¿åˆ°å †,è¿è¡Œæ—¶å¸¸é‡æ± å‰©ä¸‹çš„ä¸œè¥¿è¿˜åœ¨æ–¹æ³•åŒº, ä¹Ÿå°±æ˜¯ hotspot ä¸­çš„æ°¸ä¹…ä»£** ã€‚\n\t3. **JDK1.8 hotspot ç§»é™¤äº†æ°¸ä¹…ä»£ç”¨å…ƒç©ºé—´(Metaspace)å–è€Œä»£ä¹‹, è¿™æ—¶å€™å­—ç¬¦ä¸²å¸¸é‡æ± è¿˜åœ¨å †, è¿è¡Œæ—¶å¸¸é‡æ± è¿˜åœ¨æ–¹æ³•åŒº, åªä¸è¿‡æ–¹æ³•åŒºçš„å®ç°ä»æ°¸ä¹…ä»£å˜æˆäº†å…ƒç©ºé—´(Metaspace)**\n\nå‡å¦‚åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜åœ¨å­—ç¬¦ä¸² \"abc\"ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ä»»ä½• String å¯¹è±¡å¼•ç”¨è¯¥å­—ç¬¦ä¸²å¸¸é‡çš„è¯ï¼Œå°±è¯´æ˜å¸¸é‡ \"abc\" å°±æ˜¯åºŸå¼ƒå¸¸é‡ï¼Œå¦‚æœè¿™æ—¶å‘ç”Ÿå†…å­˜å›æ”¶çš„è¯è€Œä¸”æœ‰å¿…è¦çš„è¯ï¼Œ\"abc\" å°±ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± äº†ã€‚\n\n\n### å¦‚ä½•åˆ¤æ–­ç±»ä¸ºæ— ç”¨ç±»\n\n\næ–¹æ³•åŒºä¸»è¦å›æ”¶çš„æ˜¯æ— ç”¨çš„ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»çš„å‘¢ï¼Ÿ\n\n\nåˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦æ˜¯â€œåºŸå¼ƒå¸¸é‡â€æ¯”è¾ƒç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»æ˜¯å¦æ˜¯â€œæ— ç”¨çš„ç±»â€çš„æ¡ä»¶åˆ™ç›¸å¯¹è‹›åˆ»è®¸å¤šã€‚ç±»éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ 3 ä¸ªæ¡ä»¶æ‰èƒ½ç®—æ˜¯ **â€œæ— ç”¨çš„ç±»â€** ï¼š\n\n- è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚\n- åŠ è½½è¯¥ç±»çš„ `ClassLoader` å·²ç»è¢«å›æ”¶ã€‚\n- è¯¥ç±»å¯¹åº”çš„ `java.lang.Class` å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚\n\nè™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿° 3 ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œå¯ä»¥â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ä¸ä½¿ç”¨äº†å°±ä¼šå¿…ç„¶è¢«å›æ”¶ã€‚\n\n\n### åƒåœ¾æ”¶é›†ç®—æ³•\n\n\n![](https://blog-file.hehouhui.cn/202203222203133.png)\n\n\n### æ ‡è®°-æ¸…é™¤æœ¯ç®—æ³•\n\n\nè¯¥ç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€é˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚å®ƒæ˜¯æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ï¼Œåç»­çš„ç®—æ³•éƒ½æ˜¯å¯¹å…¶ä¸è¶³è¿›è¡Œæ”¹è¿›å¾—åˆ°ã€‚è¿™ç§åƒåœ¾æ”¶é›†ç®—æ³•ä¼šå¸¦æ¥ä¸¤ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼š\n\n1. **æ•ˆç‡é—®é¢˜**\n2. **ç©ºé—´é—®é¢˜ï¼ˆæ ‡è®°æ¸…é™¤åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„ç¢ç‰‡ï¼‰**\n\n![](https://blog-file.hehouhui.cn/202203222203288.jpeg)\n\n\n### æ ‡è®°-å¤åˆ¶ç®—æ³•\n\n\nä¸ºäº†è§£å†³æ•ˆç‡é—®é¢˜ï¼Œâ€œæ ‡è®°-å¤åˆ¶â€æ”¶é›†ç®—æ³•å‡ºç°äº†ã€‚å®ƒå¯ä»¥å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—ï¼Œæ¯æ¬¡ä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ä½¿ç”¨å®Œåï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å»ï¼Œç„¶åå†æŠŠä½¿ç”¨çš„ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·å°±ä½¿æ¯æ¬¡çš„å†…å­˜å›æ”¶éƒ½æ˜¯å¯¹å†…å­˜åŒºé—´çš„ä¸€åŠè¿›è¡Œå›æ”¶ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222146680.png)\n\n\n### æ ‡è®°-æ•´ç†ç®—æ³•\n\n\næ ¹æ®è€å¹´ä»£çš„ç‰¹ç‚¹æå‡ºçš„ä¸€ç§æ ‡è®°ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡å›æ”¶ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203632.png)\n\n\n### åˆ†ä»£æ”¶é›†ç®—æ³•\n\n\nå½“å‰è™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œè¿™ç§ç®—æ³•æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ†ä¸ºå‡ å—ã€‚ä¸€èˆ¬å°† java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚\n\n\n**æ¯”å¦‚åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡æ”¶é›†éƒ½ä¼šæœ‰å¤§é‡å¯¹è±¡æ­»å»ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©â€æ ‡è®°-å¤åˆ¶â€œç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ¯æ¬¡åƒåœ¾æ”¶é›†ã€‚è€Œè€å¹´ä»£çš„å¯¹è±¡å­˜æ´»å‡ ç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œè€Œä¸”æ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»é€‰æ‹©â€œæ ‡è®°-æ¸…é™¤â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚**\n\n\n**å»¶ä¼¸é¢è¯•é—®é¢˜ï¼š** HotSpot ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ\n\n\næ ¹æ®ä¸Šé¢çš„å¯¹åˆ†ä»£æ”¶é›†ç®—æ³•çš„ä»‹ç»å›ç­”ã€‚\n\n\n### åƒåœ¾æ”¶é›†å™¨\n\n\n![](https://blog-file.hehouhui.cn/202203222150111.png)\n\n\nHotSpot VMä¸­çš„åƒåœ¾å›æ”¶å™¨ï¼Œä»¥åŠé€‚ç”¨åœºæ™¯\n\n\n![](https://blog-file.hehouhui.cn/202203222121319.png)\n\n\nåˆ°jdk8ä¸ºæ­¢ï¼Œé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨æ˜¯Parallel Scavenge å’Œ Parallel Old\n\n\nä»jdk9å¼€å§‹ï¼ŒG1æ”¶é›†å™¨æˆä¸ºé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ ç›®å‰æ¥çœ‹ï¼ŒG1å›æ”¶å™¨åœé¡¿æ—¶é—´æœ€çŸ­è€Œä¸”æ²¡æœ‰æ˜æ˜¾ç¼ºç‚¹ï¼Œéå¸¸é€‚åˆWebåº”ç”¨ã€‚åœ¨jdk8ä¸­æµ‹è¯•Webåº”ç”¨ï¼Œå †å†…å­˜6Gï¼Œæ–°ç”Ÿä»£4.5Gçš„æƒ…å†µä¸‹ï¼ŒParallel Scavenge å›æ”¶æ–°ç”Ÿä»£åœé¡¿é•¿è¾¾1.5ç§’ã€‚G1å›æ”¶å™¨å›æ”¶åŒæ ·å¤§å°çš„æ–°ç”Ÿä»£åªåœé¡¿0.2ç§’ã€‚\n\n\n**å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚**\n\n\nè™½ç„¶æˆ‘ä»¬å¯¹å„ä¸ªæ”¶é›†å™¨è¿›è¡Œæ¯”è¾ƒï¼Œä½†å¹¶éè¦æŒ‘é€‰å‡ºä¸€ä¸ªæœ€å¥½çš„æ”¶é›†å™¨ã€‚å› ä¸ºç›´åˆ°ç°åœ¨ä¸ºæ­¢è¿˜æ²¡æœ‰æœ€å¥½çš„åƒåœ¾æ”¶é›†å™¨å‡ºç°ï¼Œæ›´åŠ æ²¡æœ‰ä¸‡èƒ½çš„åƒåœ¾æ”¶é›†å™¨ï¼Œ**æˆ‘ä»¬èƒ½åšçš„å°±æ˜¯æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯é€‰æ‹©é€‚åˆè‡ªå·±çš„åƒåœ¾æ”¶é›†å™¨**ã€‚è¯•æƒ³ä¸€ä¸‹ï¼šå¦‚æœæœ‰ä¸€ç§å››æµ·ä¹‹å†…ã€ä»»ä½•åœºæ™¯ä¸‹éƒ½é€‚ç”¨çš„å®Œç¾æ”¶é›†å™¨å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ HotSpot è™šæ‹Ÿæœºå°±ä¸ä¼šå®ç°é‚£ä¹ˆå¤šä¸åŒçš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚\n\n\n### Serialï¼ˆä¸²è¡Œï¼‰æ”¶é›†å™¨\n\n\nSerialï¼ˆä¸²è¡Œï¼‰æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚å¤§å®¶çœ‹åå­—å°±çŸ¥é“è¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨äº†ã€‚å®ƒçš„ **â€œå•çº¿ç¨‹â€** çš„æ„ä¹‰ä¸ä»…ä»…æ„å‘³ç€å®ƒåªä¼šä½¿ç”¨ä¸€æ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œçš„æ—¶å€™å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼ˆ **\"Stop The World\"** ï¼‰ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚\n\n\n**æ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚**\n\n\n![](https://blog-file.hehouhui.cn/202203222203314.png)\n\n\nè™šæ‹Ÿæœºçš„è®¾è®¡è€…ä»¬å½“ç„¶çŸ¥é“ Stop The World å¸¦æ¥çš„ä¸è‰¯ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥åœ¨åç»­çš„åƒåœ¾æ”¶é›†å™¨è®¾è®¡ä¸­åœé¡¿æ—¶é—´åœ¨ä¸æ–­ç¼©çŸ­ï¼ˆä»ç„¶è¿˜æœ‰åœé¡¿ï¼Œå¯»æ‰¾æœ€ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨çš„è¿‡ç¨‹ä»ç„¶åœ¨ç»§ç»­ï¼‰ã€‚\n\n\nä½†æ˜¯ Serial æ”¶é›†å™¨æœ‰æ²¡æœ‰ä¼˜äºå…¶ä»–åƒåœ¾æ”¶é›†å™¨çš„åœ°æ–¹å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œå®ƒ**ç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰**ã€‚Serial æ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè‡ªç„¶å¯ä»¥è·å¾—å¾ˆé«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚Serial æ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\n\n\n### **ParNew**æ”¶é›†å™¨\n\n\n**ParNew æ”¶é›†å™¨å…¶å®å°±æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºï¼ˆæ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€å›æ”¶ç­–ç•¥ç­‰ç­‰ï¼‰å’Œ Serial æ”¶é›†å™¨å®Œå…¨ä¸€æ ·ã€‚**\n\n\n**æ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚**\n\n\n![](https://blog-file.hehouhui.cn/202203222203393.png)\n\n\nå®ƒæ˜¯è®¸å¤šè¿è¡Œåœ¨ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é¦–è¦é€‰æ‹©ï¼Œé™¤äº† Serial æ”¶é›†å™¨å¤–ï¼Œåªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨ï¼ˆçœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œåé¢ä¼šä»‹ç»åˆ°ï¼‰é…åˆå·¥ä½œã€‚\n\n\n**å¹¶è¡Œå’Œå¹¶å‘æ¦‚å¿µè¡¥å……ï¼š**\n\n- **å¹¶è¡Œï¼ˆParallelï¼‰** ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ã€‚\n- **å¹¶å‘ï¼ˆConcurrentï¼‰**ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†å™¨è¿è¡Œåœ¨å¦ä¸€ä¸ª CPU ä¸Šã€‚\n\n### Parallel Scavenge æ”¶é›†å™¨\n\n\nParallel Scavenge æ”¶é›†å™¨ä¹Ÿæ˜¯ä½¿ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œå®ƒçœ‹ä¸Šå»å‡ ä¹å’Œ ParNew éƒ½ä¸€æ ·ã€‚ **é‚£ä¹ˆå®ƒæœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„å‘¢ï¼Ÿ**\n\n\n```text\n-XX:+UseParallelGC\n\n    ä½¿ç”¨ Parallel æ”¶é›†å™¨+ è€å¹´ä»£ä¸²è¡Œ\n\n-XX:+UseParallelOldGC\n\n    ä½¿ç”¨ Parallel æ”¶é›†å™¨+ è€å¹´ä»£å¹¶è¡Œ\nCopy to clipboardErrorCopied\n\n```\n\n\n**Parallel Scavenge æ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯ååé‡ï¼ˆé«˜æ•ˆç‡çš„åˆ©ç”¨ CPUï¼‰ã€‚CMS ç­‰åƒåœ¾æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ›´å¤šçš„æ˜¯ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼ˆæé«˜ç”¨æˆ·ä½“éªŒï¼‰ã€‚æ‰€è°“ååé‡å°±æ˜¯ CPU ä¸­ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ã€‚** Parallel Scavenge æ”¶é›†å™¨æä¾›äº†å¾ˆå¤šå‚æ•°ä¾›ç”¨æˆ·æ‰¾åˆ°æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§ååé‡ï¼Œå¦‚æœå¯¹äºæ”¶é›†å™¨è¿ä½œä¸å¤ªäº†è§£ï¼Œæ‰‹å·¥ä¼˜åŒ–å­˜åœ¨å›°éš¾çš„æ—¶å€™ï¼Œä½¿ç”¨ Parallel Scavenge æ”¶é›†å™¨é…åˆè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼ŒæŠŠå†…å­˜ç®¡ç†ä¼˜åŒ–äº¤ç»™è™šæ‹Ÿæœºå»å®Œæˆä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\n\n\n**æ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚**\n\n\n![](https://blog-file.hehouhui.cn/202203222152500.png)\n\n\n**è¿™æ˜¯ JDK1.8 é»˜è®¤æ”¶é›†å™¨**\n\n\nä½¿ç”¨ java -XX:+PrintCommandLineFlags -version å‘½ä»¤æŸ¥çœ‹\n\n\n```text\n-XX:InitialHeapSize=262921408 -XX:MaxHeapSize=4206742528 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC\njava version \"1.8.0_211\"\nJava(TM) SE Runtime Environment (build 1.8.0_211-b12)\nJava HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)Copy to clipboardErrorCopied\n\n```\n\n\nJDK1.8 é»˜è®¤ä½¿ç”¨çš„æ˜¯ Parallel Scavenge + Parallel Oldï¼Œå¦‚æœæŒ‡å®šäº†-XX:+UseParallelGC å‚æ•°ï¼Œåˆ™é»˜è®¤æŒ‡å®šäº†-XX:+UseParallelOldGCï¼Œå¯ä»¥ä½¿ç”¨-XX:-UseParallelOldGC æ¥ç¦ç”¨è¯¥åŠŸèƒ½\n\n\n### **Serial** Oldæ”¶é›†å™¨\n\n\n**Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬**ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ã€‚å®ƒä¸»è¦æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ç§ç”¨é€”æ˜¯åœ¨ JDK1.5 ä»¥åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦ä¸€ç§ç”¨é€”æ˜¯ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆã€‚\n\n\n### **Parallel Scavenge**æ”¶é›†å™¨\n\n\n**Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬**ã€‚ä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚åœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge æ”¶é›†å™¨å’Œ Parallel Old æ”¶é›†å™¨ã€‚\n\n\n### CMSæ”¶é›†å™¨\n\n\n**CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚å®ƒéå¸¸ç¬¦åˆåœ¨æ³¨é‡ç”¨æˆ·ä½“éªŒçš„åº”ç”¨ä¸Šä½¿ç”¨ã€‚**\n\n\n**CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ HotSpot è™šæ‹Ÿæœºç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œã€‚**\n\n\nä»åå­—ä¸­çš„**Mark Sweep**è¿™ä¸¤ä¸ªè¯å¯ä»¥çœ‹å‡ºï¼ŒCMS æ”¶é›†å™¨æ˜¯ä¸€ç§ **â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•**å®ç°çš„ï¼Œå®ƒçš„è¿ä½œè¿‡ç¨‹ç›¸æ¯”äºå‰é¢å‡ ç§åƒåœ¾æ”¶é›†å™¨æ¥è¯´æ›´åŠ å¤æ‚ä¸€äº›ã€‚æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š\n\n- **åˆå§‹æ ‡è®°ï¼š** æš‚åœæ‰€æœ‰çš„å…¶ä»–çº¿ç¨‹ï¼Œå¹¶è®°å½•ä¸‹ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿« ï¼›\n- **å¹¶å‘æ ‡è®°ï¼š** åŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥ GC çº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ã€‚\n- **é‡æ–°æ ‡è®°ï¼š** é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­\n- **å¹¶å‘æ¸…é™¤ï¼š** å¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶ GC çº¿ç¨‹å¼€å§‹å¯¹æœªæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ã€‚\n\n![](https://blog-file.hehouhui.cn/image-1647957148871.png)\n\n\nä»å®ƒçš„åå­—å°±å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦ä¼˜ç‚¹ï¼š**å¹¶å‘æ”¶é›†ã€ä½åœé¡¿**ã€‚ä½†æ˜¯å®ƒæœ‰ä¸‹é¢ä¸‰ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼š\n\n- **å¯¹ CPU èµ„æºæ•æ„Ÿï¼›**\n- **æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼›**\n- **å®ƒä½¿ç”¨çš„å›æ”¶ç®—æ³•-â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚**\n\n### G1æ”¶é›†å™¨\n\n\n**G1 (Garbage-First) æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨,ä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨. ä»¥æé«˜æ¦‚ç‡æ»¡è¶³ GC åœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶,è¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½ç‰¹å¾.**\n\n\nè¢«è§†ä¸º JDK1.7 ä¸­ HotSpot è™šæ‹Ÿæœºçš„ä¸€ä¸ªé‡è¦è¿›åŒ–ç‰¹å¾ã€‚å®ƒå…·å¤‡ä¸€ä¸‹ç‰¹ç‚¹ï¼š\n\n- **å¹¶è¡Œä¸å¹¶å‘**ï¼šG1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ Stop-The-World åœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼ŒG1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œã€‚\n- **åˆ†ä»£æ”¶é›†**ï¼šè™½ç„¶ G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚\n- **ç©ºé—´æ•´åˆ**ï¼šä¸ CMS çš„â€œæ ‡è®°-æ¸…ç†â€ç®—æ³•ä¸åŒï¼ŒG1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-å¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚\n- **å¯é¢„æµ‹çš„åœé¡¿**ï¼šè¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½† G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ã€‚\n\nG1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\n\n- **åˆå§‹æ ‡è®°**\n- **å¹¶å‘æ ‡è®°**\n- **æœ€ç»ˆæ ‡è®°**\n- **ç­›é€‰å›æ”¶**\n\n**G1 æ”¶é›†å™¨åœ¨åå°ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„ Region(è¿™ä¹Ÿå°±æ˜¯å®ƒçš„åå­— Garbage-First çš„ç”±æ¥)** ã€‚è¿™ç§ä½¿ç”¨ Region åˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº† G1 æ”¶é›†å™¨åœ¨æœ‰é™æ—¶é—´å†…å¯ä»¥å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ï¼ˆæŠŠå†…å­˜åŒ–æ•´ä¸ºé›¶ï¼‰ã€‚\n\n\n### ZGCæ”¶é›†å™¨\n\n\nä¸ CMS ä¸­çš„ ParNew å’Œ G1 ç±»ä¼¼ï¼ŒZGC ä¹Ÿé‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œä¸è¿‡ ZGC å¯¹è¯¥ç®—æ³•åšäº†é‡å¤§æ”¹è¿›ã€‚\n\n\nåœ¨ ZGC ä¸­å‡ºç° Stop The World çš„æƒ…å†µä¼šæ›´å°‘ï¼\n\n\nè¯¦æƒ…å¯ä»¥çœ‹ ï¼š [ã€Šæ–°ä¸€ä»£åƒåœ¾å›æ”¶å™¨ ZGC çš„æ¢ç´¢ä¸å®è·µã€‹](https://tech.meituan.com/2020/08/06/new-zgc-practice-in-meituan.html)\n\n\n### å‚è€ƒ\n\n- ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºï¼šJVM é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µï¼ˆç¬¬äºŒç‰ˆã€‹\n- [https://my.oschina.net/hosee/blog/644618](https://my.oschina.net/hosee/blog/644618)\n- [https://docs.oracle.com/javase/specs/jvms/se8/html/index.html](https://docs.oracle.com/javase/specs/jvms/se8/html/index.html)\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-03-12",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "42",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java",
          "Jvm"
        ],
        "summary": "JavaåŸºç¡€-JVMæ˜¯Javaå¼€å‘è€…å¿…é¡»è¦æŒæ¡çš„é‡è¦çŸ¥è¯†ç‚¹ä¹‹ä¸€ï¼ŒJVMå…¨ç§°ä¸ºJava Virtual Machineï¼ˆJavaè™šæ‹Ÿæœºï¼‰ï¼Œå®ƒæ˜¯Javaç¨‹åºè¿è¡Œçš„ç¯å¢ƒï¼Œåœ¨Javaç¼–ç¨‹ä¸­å…·æœ‰æå…¶é‡è¦çš„ä½œç”¨ã€‚\nä½œä¸ºJavaè¯­è¨€çš„æ ¸å¿ƒï¼ŒJVMèƒ½å¤Ÿé€šè¿‡å°†Javaä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œå†é€šè¿‡å­—èŠ‚ç çš„è§£é‡Šå™¨å®ç°Javaç¨‹åºçš„è¿è¡Œã€‚JVMè´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºçš„å†…å­˜ã€å¤šçº¿ç¨‹ã€åƒåœ¾å›æ”¶ç­‰æ“ä½œï¼Œæ˜¯å®ç°è·¨å¹³å°ã€è‡ªåŠ¨åƒåœ¾å›æ”¶ã€å®‰å…¨æ€§é«˜ç­‰ç‰¹æ€§çš„å…³é”®ã€‚\nè¦æ·±å…¥ç†è§£JVMï¼Œéœ€è¦æŒæ¡JVMçš„å†…éƒ¨æœºåˆ¶ï¼ŒåŒ…æ‹¬è™šæ‹Ÿæœºç±»åŠ è½½å™¨ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸã€å­—èŠ‚ç æ‰§è¡Œå¼•æ“ç­‰æ–¹é¢ã€‚æ­¤å¤–ï¼Œå¯¹äºJVMçš„æ€§èƒ½è°ƒä¼˜åŠæ•…éšœæ’æŸ¥ä¹Ÿéå¸¸é‡è¦ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚\næ€»ä¹‹ï¼ŒæŒæ¡JavaåŸºç¡€-JVMæ˜¯Javaå¼€å‘è€…å¿…é¡»è¦å…·å¤‡çš„çŸ¥è¯†æŠ€èƒ½ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£Javaç¨‹åºçš„è¿è¡Œæœºåˆ¶ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œæå‡åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä»¥åŠç¨³å®šæ€§ã€‚",
        "sort": "",
        "title": "JavaåŸºç¡€-JVM",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "f2eefe59-c1ef-4dba-847d-6525d1ddc518"
        }
      ],
      "body": "",
      "realName": "JavaåŸºç¡€-JVM",
      "relativePath": "/archives/JavaåŸºç¡€-JVM.md"
    },
    {
      "id": "7d7311ba-8ed2-4a90-91ac-5d2b4a503c4c",
      "doc_id": "7d7311ba-8ed2-4a90-91ac-5d2b4a503c4c",
      "title": "7d7311ba-8ed2-4a90-91ac-5d2b4a503c4c",
      "updated": 1696747320000,
      "body_original": "\nå¯ç”¨èº«ä»½éªŒè¯å’Œæˆæƒæ¶‰åŠå¤æ‚çš„åŠŸèƒ½ï¼Œè€Œä¸ä»…ä»…æ˜¯ç®€å•çš„ç™»å½• APIã€‚[åœ¨ä¹‹å‰çš„æ–‡ç« ï¼ˆä½¿ç”¨ Keycloak çš„ API ç™»å½•å’Œ JWT ä»¤ç‰Œç”Ÿæˆï¼‰ä¸­](https://blog.hehouhui.cn/archives/api-login-and-jwt-token-generation-using-keycloak)ï¼Œæˆ‘æè¿°äº† Keycloak REST ç™»å½• API ç«¯ç‚¹ï¼Œå®ƒåªå¤„ç†ä¸€äº›èº«ä»½éªŒè¯ä»»åŠ¡ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æè¿°äº†å¦‚ä½•ä½¿ç”¨å¼€ç®±å³ç”¨çš„ Keycloak REST API åŠŸèƒ½å¯ç”¨èº«ä»½éªŒè¯å’Œæˆæƒçš„å…¶ä»–æ–¹é¢ã€‚\n\n\n# èº«ä»½éªŒè¯ä¸æˆæƒ\n\n\nä½†é¦–å…ˆï¼Œèº«ä»½éªŒè¯å’Œæˆæƒä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç®€å•åœ°è¯´ï¼Œèº«ä»½éªŒè¯æ„å‘³ç€_ä½ æ˜¯è°_ï¼Œè€Œæˆæƒæ„å‘³ç€_ä½ å¯ä»¥åšä»€ä¹ˆ_ï¼Œæ¯ç§æ–¹æ³•éƒ½ä½¿ç”¨ä¸åŒçš„æ–¹æ³•è¿›è¡ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œèº«ä»½éªŒè¯ä½¿ç”¨ç”¨æˆ·ç®¡ç†å’Œç™»å½•è¡¨å•ï¼Œæˆæƒä½¿ç”¨åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) æˆ–è®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL)ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™äº›éªŒè¯æ–¹æ³•åœ¨ Red Hat çš„å•ç‚¹ç™»å½• (SSO) å·¥å…·ä¸­æä¾›ï¼Œæˆ–è€…åœ¨ä»–ä»¬çš„ä¸Šæ¸¸å¼€æºé¡¹ç›® Keycloak çš„ REST API ä¸­æä¾›ã€‚\n\n\n# Keycloak SSO æ¡ˆä¾‹ç ”ç©¶\n\n\nä¸ºäº†æ›´å¥½åœ°ç†è§£ä½¿ç”¨ Keycloak è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼Œè®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ç ”ç©¶å¼€å§‹ã€‚å‡è®¾å°åº¦å°¼è¥¿äºšæ•™è‚²éƒ¨è®¡åˆ’åˆ›å»ºä¸å¤šæ‰€å­¦æ ¡çš„å•ç‚¹ç™»å½•é›†æˆã€‚ä»–ä»¬è®¡åˆ’ä½¿ç”¨é›†ä¸­å¼å¹³å°åœ¨å¤šä¸ªå­¦æ ¡ç»´æŠ¤å­¦ç”Ÿå’Œæ•™å¸ˆçš„å•ä¸€å¸æˆ· IDã€‚è¿™è®©æ¯ä¸ªç”¨æˆ·éƒ½å…·æœ‰ç›¸åŒçš„è§’è‰²ï¼Œä½†åœ¨æ¯æ‰€å­¦æ ¡å…·æœ‰ä¸åŒçš„è®¿é—®æƒé™å’Œç‰¹æƒï¼Œå¦‚å›¾ 1 æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-00.png?itok=aKKqoLgU)\n\n\nå›¾ 1ï¼šæ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„è§’è‰²ï¼Œä½†åœ¨æ¯æ‰€å­¦æ ¡å…·æœ‰ä¸åŒçš„è®¿é—®æƒé™å’Œæƒé™ã€‚\">\n\n\n# Keycloak SSO æ¼”ç¤º\n\n\nè®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ª Keycloak é¢†åŸŸæ¥å¼€å§‹æ¼”ç¤ºã€‚ä¸ºè¯¥éƒ¨é—¨ä½¿ç”¨ Add realm å¯¹è¯æ¡†ï¼ˆå¦‚å›¾ 2 æ‰€ç¤ºï¼‰ã€‚ä¸ºé¢†åŸŸå‘½å`education`ï¼Œå°†**Enabled**è®¾ç½®ä¸º**ON**ï¼Œç„¶åå•å‡»**Create**ã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-01.png?itok=TFFotz_T)\n\n\nå›¾ 2ï¼šä¸ºæ•™è‚²éƒ¨åˆ›å»ºåä¸ºâ€œæ•™è‚²â€çš„ Keycloak é¢†åŸŸã€‚\">\n\n\næ¥ä¸‹æ¥ï¼Œè½¬åˆ° Roles é¡µé¢å¹¶ç¡®ä¿é€‰æ‹©äº†**Realm Roles**é€‰é¡¹å¡ï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-06.png?itok=kN1XyC0P)\n\n\nå›¾ 3ï¼šä¸ºæ•™è‚²é¢†åŸŸåˆ›å»ºä¸¤ä¸ªç‹¬ç«‹çš„è§’è‰²ï¼šæ•™å¸ˆå’Œå­¦ç”Ÿã€‚\n\n\nå•å‡»**æ·»åŠ è§’è‰²**ä¸ºè¯¥é¢†åŸŸåˆ›å»ºä¸¤ä¸ªå•ç‹¬çš„è§’è‰²ï¼Œç§°ä¸ºâ€œæ•™å¸ˆâ€å’Œâ€œå­¦ç”Ÿâ€ã€‚ç„¶åï¼Œè¿™äº›æ–°è§’è‰²å°†å‡ºç°åœ¨**Realm Roles**é€‰é¡¹å¡ä¸­ï¼Œå¦‚å›¾ 4 æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-07.png?itok=KBPu-x5E)\n\n\nå›¾ 4ï¼šæ·»åŠ æ•™å¸ˆå’Œå­¦ç”Ÿè§’è‰²ã€‚\">\n\n\nç„¶åï¼Œä½¿ç”¨ Clients é¡µé¢ï¼Œå•å‡»**Create**æ·»åŠ å®¢æˆ·ç«¯ï¼Œå¦‚å›¾ 5 æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-02.png?itok=_XcRiyxZ)\n\n\nå›¾ 5ï¼šæ·»åŠ å®¢æˆ·ç«¯ã€‚\n\n\nåœ¨ Add Client é¡µé¢ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºâ€œjakarta-schoolâ€çš„å®¢æˆ·ç«¯ï¼Œç„¶åå•å‡»**Save**æ·»åŠ è¯¥å®¢æˆ·ç«¯ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-03.png?itok=ioRUgKYl)\n\n\nåœ¨ jakarta-school è¯¦ç»†ä¿¡æ¯é¡µé¢ä¸Šï¼Œè½¬åˆ°**â€œè®¾ç½®â€**é€‰é¡¹å¡å¹¶è¾“å…¥ä»¥ä¸‹å®¢æˆ·ç«¯é…ç½®ï¼Œå¦‚å›¾ 7 æ‰€ç¤ºï¼š\n\n- **å®¢æˆ· ID**\n\n\t: jakarta-school\n\n- **å¯ç”¨**\n\n\tï¼šå¼€\n\n- **éœ€è¦åŒæ„**\n\n\tï¼šå…³é—­\n\n- **å®¢æˆ·ç«¯åè®®**\n\n\tï¼šopenid-connect\n\n- **è®¿é—®ç±»å‹**\n\n\tï¼šæœºå¯†\n\n- **å¯ç”¨æ ‡å‡†æµé‡**\n\n\tï¼šå¼€\n\n- **å¯ç”¨å½±å“æµ**\n\n\tï¼šå…³é—­\n\n- **å·²å¯ç”¨ç›´æ¥è®¿é—®æˆæƒ**\n\n\tï¼šON\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-04.png?itok=UAhXaIL2)\n\n\nå›¾ 7ï¼šåœ¨ jakarta-school è¯¦ç»†ä¿¡æ¯é¡µé¢ä¸Šï¼Œè¾“å…¥å®¢æˆ·ç«¯é…ç½®ã€‚\n\n\nåœ¨åŒä¸€é¡µé¢çš„åº•éƒ¨ï¼Œåœ¨ Authentication Flow Overrides éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å¦‚ä¸‹ï¼Œå¦‚å›¾ 8 æ‰€ç¤ºï¼š\n\n- **æµè§ˆå™¨æµç¨‹**\n\n\tï¼šæµè§ˆå™¨\n\n- **ç›´æ¥æ‹¨æ¬¾æµç¨‹**\n\n\tï¼šç›´æ¥æ‹¨æ¬¾\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-05.png?itok=bjT_1W98)\n\n\nå›¾ 8ï¼šé…ç½®èº«ä»½éªŒè¯æµç¨‹è¦†ç›–ã€‚\">\n\n\nè½¬åˆ°**Roles**é€‰é¡¹å¡ï¼Œå•å‡»**Add Role**ï¼Œç„¶åä¸ºæ­¤å®¢æˆ·ç«¯åˆ›å»º create-student-gradeã€view-student-grade å’Œ view-student-profile è§’è‰²ï¼Œå¦‚å›¾ 9 æ‰€ç¤ºã€‚æ¯ä¸ªè§’è‰²éƒ½åº”è®¾ç½®ä¸º CompositeÂ **False**ã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-11.png?itok=MySy1CkW)\n\n\nå›¾ 9ï¼šä¸ºæ­¤å®¢æˆ·åˆ›å»ºè§’è‰²ã€‚\n\n\næ¥ä¸‹æ¥ï¼Œè½¬åˆ°**Client Scopes**é€‰é¡¹å¡ï¼Œåœ¨**Default Client Scopes**éƒ¨åˆ†ä¸­ï¼Œå°†â€œrolesâ€å’Œâ€œprofileâ€æ·»åŠ åˆ°**Assigned Default Client Scopes**ä¸­ï¼Œå¦‚å›¾ 10 æ‰€ç¤ºã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-08.png?itok=EQBlb8Yo)\n\n\nå›¾ 10ï¼šè®¾ç½®å®¢æˆ·ç«¯èŒƒå›´ã€‚\n\n\nåœ¨jakarta-schoolè¯¦æƒ…é¡µé¢ï¼Œé€‰æ‹©**Mappers**ï¼Œç„¶åé€‰æ‹©**Create Protocol Mappers**ï¼Œè®¾ç½®mappersåœ¨Userinfo APIä¸Šæ˜¾ç¤ºå®¢æˆ·ç«¯è§’è‰²ï¼Œå¦‚å›¾11æ‰€ç¤ºï¼š\n\n- **åç§°**\n\n\tï¼šè§’è‰²\n\n- **æ˜ å°„å™¨ç±»å‹**\n\n\tï¼šç”¨æˆ·é¢†åŸŸè§’è‰²\n\n- **å¤šå€¼**\n\n\tï¼šå¼€\n\n- **ä»¤ç‰Œå£°æ˜åç§°**\n\n\tï¼šè§’è‰²\n\n- **å£°æ˜ JSON ç±»å‹**\n\n\tï¼šå­—ç¬¦ä¸²\n\n- **æ·»åŠ åˆ° ID ä»¤ç‰Œ**\n\n\tï¼šå…³é—­\n\n- **æ·»åŠ åˆ°è®¿é—®ä»¤ç‰Œ**\n\n\tï¼šå…³é—­\n\n- **æ·»åŠ åˆ°ç”¨æˆ·ä¿¡æ¯**\n\n\tï¼šON\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-09.png?itok=zZAbM6Sr)\n\n\nå›¾ 11ï¼šè®¾ç½®æ˜ å°„å™¨ä»¥æ˜¾ç¤ºå®¢æˆ·ç«¯è§’è‰²ã€‚\n\n\næ¥ä¸‹æ¥ï¼Œè½¬åˆ°**Users**é¡µé¢ï¼Œé€‰æ‹©**Add user**ï¼Œåˆ›å»ºæ–°ç”¨æˆ·ï¼Œç„¶åå•å‡»**Saveï¼Œ**å¦‚å›¾ 12 æ‰€ç¤ºï¼š\n\n- **ç”¨æˆ·å**\n\n\tï¼šåŸƒå¾·æ¸©\n\n- **ç”µå­é‚®ä»¶**\n\n\tï¼šedwin@redhat.com\n\n- **åå­—**\n\n\tï¼šåŸƒå¾·æ¸©\n\n- **å§“**\n\n\t: M\n\n- **ç”¨æˆ·å¯ç”¨**\n\n\tï¼šON\n\n- **ç”µå­é‚®ä»¶å·²éªŒè¯**\n\n\tï¼šå…³é—­\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-10.png?itok=rOzI0tsb)\n\n\nå›¾ 12ï¼šåˆ›å»ºæ–°ç”¨æˆ·ã€‚\n\n\næœ€åï¼Œåœ¨**Role Mappings**é€‰é¡¹å¡ä¸­ï¼Œä¸º jakarta-school ä¸­çš„æ¯ä¸ªç”¨æˆ·é€‰æ‹©**Client Roles**ï¼Œå¦‚å›¾ 13 æ‰€ç¤ºã€‚å®ƒä»¬åº”è¯¥æ˜¯ create-student-gradeã€view-student-grade å’Œ view-student-profileã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/08/keycloak-education-12.png?itok=3QIR03u9)\n\n\nå›¾ 13ï¼šä¸º jakarta-school ä¸­çš„æ¯ä¸ªç”¨æˆ·é€‰æ‹©å®¢æˆ·ç«¯è§’è‰²ã€‚\n\n\næˆ‘çš„ Keycloak é…ç½®æ¼”ç¤ºåˆ°æ­¤ç»“æŸã€‚\n\n\n# ä½¿ç”¨ Java åº”ç”¨ç¨‹åºçš„ Keycloak è¿æ¥\n\n\nç°åœ¨æˆ‘æƒ³æ¼”ç¤ºå¦‚ä½•å¼€å‘ä¸€ä¸ªéå¸¸ç®€å•çš„ Java åº”ç”¨ç¨‹åºã€‚æ­¤åº”ç”¨ç¨‹åºè¿æ¥åˆ°æ‚¨çš„ Keycloak å®ä¾‹ï¼Œå¹¶é€šè¿‡å…¶ REST API ä½¿ç”¨ Keycloak çš„èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½ã€‚\n\n\né¦–å…ˆï¼Œä» pom.xml æ–‡ä»¶å¼€å§‹å¼€å‘ Java åº”ç”¨ç¨‹åºï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š\n\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>EducationService</groupId>\n    <artifactId>com.edw</artifactId>\n    <version>1.0-SNAPSHOT</version>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.2.1.RELEASE</version>\n        <relativePath/>\n    </parent>\n\n    <properties>\n        <java.version>11</java.version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.auth0</groupId>\n            <artifactId>jwks-rsa</artifactId>\n            <version>0.12.0</version>\n        </dependency>\n\n        <dependency>\n            <groupId>com.auth0</groupId>\n            <artifactId>java-jwt</artifactId>\n            <version>3.8.3</version>\n        </dependency>\n\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n```\n\n\nJavaåº”ç”¨ç¨‹åºè¿˜è¦æ±‚æ‚¨å¼€å‘ä¸€ä¸ªç®€å•çš„å±æ€§æ–‡ä»¶ï¼š\n\n\n```yaml\nserver:\n    error:\n        whitelabel:\n            enabled:false\n    port: 8082\nspring:\n    mvc:\n        favicon:\n            enabled:false\nkeycloak:\n    client-id: jakarta-school\n    client-secret: 197bc3b4-64b0-452f-9bdb-fcaea0988e90\n    scope: openid, profile\n    authorization-grant-type: password\n    authorization-uri: http://localhost:8080/auth/realms/education/protocol/openid-connect/auth\n    user-info-uri: http://localhost:8080/auth/realms/education/protocol/openid-connect/userinfo\n    token-uri: http://localhost:8080/auth/realms/education/protocol/openid-connect/token\n    logout: http://localhost:8080/auth/realms/education/protocol/openid-connect/logout\n    jwk-set-uri: http://localhost:8080/auth/realms/education/protocol/openid-connect/certs\n    certs-id: vdaec4Br3ZnRFtZN-pimK9v1eGd3gL2MHu8rQ6M5SiE\nlogging:\n    level:\n        root: INFO\n```\n\n\næ¥ä¸‹æ¥ï¼Œä»å›¾ 14 æ‰€ç¤ºçš„è¡¨å•ä¸­è·å– Keycloak è¯ä¹¦ IDã€‚\n\n\n![](https://developers.redhat.com/sites/default/files/styles/article_floated/public/blog/2020/11/keycloak-education-13.png?itok=KkNUCm4W)\n\n\nå›¾ 14ï¼šæ‰¾åˆ° Keycloak è¯ä¹¦ IDã€‚\n\n\nä¹‹åï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨çš„ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯å¼€å‘é›†æˆä»£ç ï¼›æ­¤æ“ä½œæ¶‰åŠå¤šä¸ª Keycloak APIã€‚è¯·æ³¨æ„ï¼Œæˆ‘æ²¡æœ‰è¯¦ç»†ä»‹ç» Keycloak ç™»å½• APIï¼Œå› ä¸ºå®ƒå·²ç»åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« ä¸­è¿›è¡Œäº†æè¿°ã€‚\n\n\nä»ä¸€ä¸ªç®€å•çš„æ³¨é”€ API å¼€å§‹ï¼š\n\n\n```java\n    @Value(\"${keycloak.logout}\") \n    private String keycloakLogout;\n\n    public void logout(String refreshToken) throws Exception { \n        MultiValueMap<String, String> map = new LinkedMultiValueMap<>(); \n        map.add(\"client_id\",clientId); \n        map.add(\"client_secret\",clientSecret); \n        map.add(\"refresh_token\",refreshToken); \n\n        HttpEntity<MultiValueMap<String, String>> request = new HttpEntity<>(map, null); \n        restTemplate.postForObject(keycloakLogout, request, String.class); \n    }\n```\n\n\né¦–å…ˆï¼Œæˆ‘æƒ³æŒ‡å‡ºï¼Œå¯¹äºæ³¨é”€ï¼Œä½¿ç”¨å‚æ•°`refresh_token`è€Œä¸æ˜¯æ˜¯è‡³å…³é‡è¦çš„`access_token`ã€‚ç°åœ¨ï¼Œä½¿ç”¨ API æ£€æŸ¥ä¸è®°åä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆå’Œæ´»è·ƒï¼Œä»¥éªŒè¯è¯·æ±‚æ˜¯å¦å¸¦æ¥æœ‰æ•ˆå‡­è¯ã€‚\n\n\n```java\n    @Value(\"${keycloak.user-info-uri}\")\n    private String keycloakUserInfo;\n\n    private String getUserInfo(String token) {\n        MultiValueMap<String, String> headers = new LinkedMultiValueMap<>();\n        headers.add(\"Authorization\", token);\n\n        HttpEntity<MultiValueMap<String, String>> request = new HttpEntity<>(null, headers);\n        return restTemplate.postForObject(keycloakUserInfo, request, String.class);\n    }\n```\n\n\nå¯¹äºæˆæƒï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•æ¥å†³å®šç»™å®šè§’è‰²æ˜¯å¦æœ‰èµ„æ ¼è®¿é—®ç‰¹å®š APIã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡é’ˆå¯¹ Keycloak çš„ userinfo API è¿›è¡ŒéªŒè¯æ¥ç¡®å®šä¸è®°åä»¤ç‰Œå¸¦æ¥çš„è§’è‰²ï¼Œä¸‹ä¸€ä¸ªæ–¹æ³•æ˜¯éªŒè¯ä¸è®°åä»¤ç‰Œä¸­çš„è§’è‰²ã€‚\n\n\nå¯¹äºç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ‚¨å¯ä»¥æœŸå¾… Keycloak çš„ä»¥ä¸‹å“åº”ï¼š\n\n\n```json\n{\n    \"sub\": \"ef2cbe43-9748-40e5-aed9-fe981e3082d5\",\n    \"roles\": [\n        \"teacher\"\n    ],\n    \"name\": \"Edwin M\",\n    \"preferred_username\": \"edwin\",\n    \"given_name\": \"Edwin \",\n    \"family_name\": \"M\"\n}\n```\n\n\nå¦‚æ‚¨æ‰€è§ï¼Œé‚£é‡Œæœ‰ä¸€ä¸ª`roles`æ ‡ç­¾ï¼Œä¸€ç§æ–¹æ³•æ˜¯æ ¹æ®å®ƒæ¥éªŒè¯è®¿é—®æƒé™ã€‚ç¼ºç‚¹æ˜¯æ¯ä¸ªè¯·æ±‚åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºå’Œ Keycloak ä¹‹é—´æœ‰å¤šæ¬¡å¾€è¿”è¯·æ±‚ï¼Œè¿™ä¼šå¯¼è‡´æ›´é«˜çš„å»¶è¿Ÿã€‚\n\n\nå¦ä¸€ç§æ–¹æ³•æ˜¯è¯»å–é€šè¿‡æ¯ä¸ªè¯·æ±‚å‘é€çš„ JWT ä»¤ç‰Œçš„å†…å®¹ã€‚ä¸ºäº†æˆåŠŸè§£ç æ‚¨çš„ JWT ä»¤ç‰Œï¼Œæ‚¨å¿…é¡»çŸ¥é“ç”¨äºå¯¹å…¶ç­¾åçš„å…¬é’¥ã€‚è¿™å°±æ˜¯ Keycloak æä¾› JWKS ç«¯ç‚¹çš„åŸå› ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ curl å‘½ä»¤æŸ¥çœ‹å…¶å†…å®¹ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š\n\n\n```json\n{\n    \"keys\": [\n        {\n            \"kid\": \"vdaec4Br3ZnRFtZN-pimK9v1eGd3gL2MHu8rQ6M5SiE\",\n            \"kty\": \"RSA\",\n            \"alg\": \"RS256\",\n            \"use\": \"sig\",\n            \"n\": \"4OPCc_LDhU6ADQj7cEgRei4VUf4PZH8GYsxsR6RSdeKmDvZ48hCSEFiEgfc3FIfh-gC4r9PtKucc_nkRofrAKR4qL8KNNoSuzQAOC92Yz6r7Ao4HppHJ8-QVdo5H-d9wfNSlDLBSo5My4b4EnHb1HLuFxDqyhFpGvsoUJdgbt3m_Q3WAVb2yrM83S6HX__vrQvqUk2e7z5RNrI7LSsW3ZOz9fU7pvm8-kFFAIPJ7fOJIC7UQ9wBWg3YdwQ0B2b24jXjVr0QCGzqJ6o1G_UZYSJCDMGQDpDcEuYnvSKBLfVR-0EcAjolRhcSPjHlW0Cp0YU8qwWDHpjkbrMrFmxlO4Q\",\n            \"e\": \"AQAB\"\n        }\n    ]\n}\n```\n\n\nè¯·æ³¨æ„ï¼Œåœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œkidä»£è¡¨key idï¼Œalgä»£è¡¨åŠ å¯†ç®—æ³•ï¼Œnä»£è¡¨ç”¨äºæ­¤é¢†åŸŸçš„å…¬é’¥ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤å…¬é’¥è½»æ¾è§£ç æˆ‘ä»¬çš„JWTä»¤ç‰Œï¼Œå¹¶ä»JWTå£°æ˜ä¸­è¯»å–rolesã€‚ä¸‹é¢æ˜¾ç¤ºäº†è§£ç åçš„æ ·æœ¬JWTä»¤ç‰Œï¼š\n\n\n```json\n{\n  \"jti\": \"85edca8c-a4a6-4a4c-b8c0-356043e7ba7d\",\n  \"exp\": 1598079154,\n  \"nbf\": 0,\n  \"iat\": 1598078854,\n  \"iss\": \"http://localhost:8080/auth/realms/education\",\n  \"sub\": \"ef2cbe43-9748-40e5-aed9-fe981e3082d5\",\n  \"typ\": \"Bearer\",\n  \"azp\": \"jakarta-school\",\n  \"auth_time\": 0,\n  \"session_state\": \"f8ab78f8-15ee-403d-8db7-7052a8647c65\",\n  \"acr\": \"1\",\n  \"realm_access\": {\n    \"roles\": [\n      \"teacher\"\n    ]\n  },\n  \"resource_access\": {\n    \"jakarta-school\": {\n      \"roles\": [\n        \"create-student-grade\",\n        \"view-student-profile\",\n        \"view-student-grade\"\n      ]\n    }\n  },\n  \"scope\": \"profile\",\n  \"name\": \"Edwin M\",\n  \"preferred_username\": \"edwin\",\n  \"given_name\": \"Edwin\",\n  \"family_name\": \"M\"\n}\n```\n\n\næ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹ä¸­æ˜¾ç¤ºçš„ä»£ç è¯»å–è§’è‰²æ ‡ç­¾ï¼š\n\n\n```java\n   @GetMapping(\"/teacher\")\n    public HashMap teacher(@RequestHeader(\"Authorization\") String authHeader) {\n        try {\n            DecodedJWT jwt = JWT.decode(authHeader.replace(\"Bearer\", \"\").trim());\n\n            // check JWT is valid\n            Jwk jwk = jwtService.getJwk();\n            Algorithm algorithm = Algorithm.RSA256((RSAPublicKey) jwk.getPublicKey(), null);\n\n            algorithm.verify(jwt);\n\n            // check JWT role is correct\n            List<String> roles = ((List)jwt.getClaim(\"realm_access\").asMap().get(\"roles\"));\n            if(!roles.contains(\"teacher\"))\n                throw new Exception(\"not a teacher role\");\n\n            // check JWT is still active\n            Date expiryDate = jwt.getExpiresAt();\n            if(expiryDate.before(new Date()))\n                throw new Exception(\"token is expired\");\n\n            // all validation passed\n            return new HashMap() {{\n                put(\"role\", \"teacher\");\n            }};\n        } catch (Exception e) {\n            logger.error(\"exception : {} \", e.getMessage());\n            return new HashMap() {{\n                put(\"status\", \"forbidden\");\n            }};\n        }\n    }\n```\n\n\nè¿™ç§æ–¹æ³•æœ€å¥½çš„éƒ¨åˆ†æ˜¯æ‚¨å¯ä»¥å°†æ¥è‡ª Keycloak çš„å…¬é’¥æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œä»è€Œå‡å°‘å¾€è¿”è¯·æ±‚ï¼Œè¿™ç§åšæ³•æœ€ç»ˆä¼šå¢åŠ åº”ç”¨ç¨‹åºå»¶è¿Ÿå’Œæ€§èƒ½ã€‚[å¯ä»¥åœ¨æˆ‘çš„ GitHub å­˜å‚¨åº“ä¸­](https://github.com/edwin/java-keycloak-integration)æ‰¾åˆ°æœ¬æ–‡çš„å®Œæ•´ä»£ç ã€‚\n\n\n# ç»“è®º\n\n\næ€»ä¹‹ï¼Œæˆ‘å‡†å¤‡è¿™ç¯‡æ–‡ç« é¦–å…ˆæ˜¯ä¸ºäº†è§£é‡Šå¯ç”¨èº«ä»½éªŒè¯å’Œæˆæƒæ¶‰åŠå¤æ‚çš„åŠŸèƒ½ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„ç™»å½• APIã€‚ç„¶åæˆ‘æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨å¼€ç®±å³ç”¨çš„ Keycloak REST API åŠŸèƒ½å¯ç”¨èº«ä»½éªŒè¯å’Œæˆæƒçš„è®¸å¤šæ–¹é¢ã€‚\n\n\næ­¤å¤–ï¼Œæˆ‘è¿˜æ¼”ç¤ºäº†å¦‚ä½•å¼€å‘ä¸€ä¸ªè¿æ¥åˆ°æ‚¨çš„ Keycloak å®ä¾‹çš„ç®€å• Java åº”ç”¨ç¨‹åºï¼Œå¹¶é€šè¿‡å…¶ REST API ä½¿ç”¨ Keycloak çš„èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½ã€‚\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-28T13:13:00.000+08:00",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "authentication-and-authorization-using-the-keycloak-rest-api",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å¼€å‘",
          "å»ºç«™",
          "Java",
          "oauth",
          "keycloak"
        ],
        "summary": "Keycloak REST API å¯ä»¥è¢«ç”¨æ¥è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚ä½¿ç”¨è¯¥APIï¼Œå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°åœ¨å…¶åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨æ€§éªŒè¯å’ŒæˆæƒåŠŸèƒ½ï¼ŒåŒæ—¶ä½¿ç”¨Keycloakçš„å†…ç½®åŠŸèƒ½è¿›è¡Œç®¡ç†å’Œé…ç½®ã€‚Keycloakçš„REST APIè¿˜æä¾›äº†è®¸å¤šä¸åŒçš„ç»ˆç«¯ç‚¹æ¥è¿›è¡Œç”¨æˆ·å’Œè§’è‰²ç®¡ç†ã€è®¤è¯äº‹ä»¶å’ŒSAMLå…ƒæ•°æ®çš„è®¿é—®ç­‰ã€‚ ä½œä¸ºä¸€ä¸ªåŸºäºå¼€æºçš„èº«ä»½å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ŒKeycloakçš„REST APIå¯¹äºä»»ä½•éœ€è¦å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œè®¤è¯å’Œæˆæƒçš„å¼€å‘äººå‘˜éƒ½éå¸¸æœ‰å¸®åŠ©ã€‚",
        "sort": "",
        "title": "ä½¿ç”¨ Keycloak REST API è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "7d7311ba-8ed2-4a90-91ac-5d2b4a503c4c"
        }
      ],
      "body": "",
      "realName": "ä½¿ç”¨ Keycloak REST API è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒ",
      "relativePath": "/archives/ä½¿ç”¨ Keycloak REST API è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒ.md"
    },
    {
      "id": "bcd4f723-5f6a-4d94-90a1-63bb8c6dbfcf",
      "doc_id": "bcd4f723-5f6a-4d94-90a1-63bb8c6dbfcf",
      "title": "bcd4f723-5f6a-4d94-90a1-63bb8c6dbfcf",
      "updated": 1696747320000,
      "body_original": "\n> ğŸ’¡ Spring Cacheæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç¼“å­˜æ¡†æ¶ï¼Œå¯ç”¨äºæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯é æ€§ã€‚å®ƒæ˜¯Springæ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼ŒåŸºäºæ ‡å‡†çš„ç¼“å­˜æŠ½è±¡ï¼Œæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„ã€å¯æ‰©å±•çš„ç¼“å­˜è§£å†³æ–¹æ¡ˆã€‚Spring Cacheæ”¯æŒå¤šç§ç¼“å­˜æä¾›è€…ï¼ŒåŒ…æ‹¬Ehcacheã€Redisã€Couchbaseç­‰ã€‚å®ƒè¿˜æä¾›äº†çµæ´»çš„é…ç½®é€‰é¡¹ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€è¦é€‰æ‹©æœ€é€‚åˆçš„ç¼“å­˜è§£å†³æ–¹æ¡ˆã€‚  \n>   \n> ä½¿ç”¨Spring Cacheå¯ä»¥å¸®åŠ©åº”ç”¨ç¨‹åºå‡å°‘å¯¹æ•°æ®åº“å’Œå…¶ä»–å¤–éƒ¨èµ„æºçš„è®¿é—®æ¬¡æ•°ï¼Œä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦å’Œååé‡ã€‚é™¤äº†æé«˜æ€§èƒ½ä¹‹å¤–ï¼ŒSpring Cacheè¿˜å¯ä»¥ç”¨äºæ·»åŠ åº”ç”¨ç¨‹åºçº§åˆ«çš„ç¼“å­˜é€»è¾‘ï¼Œä¾‹å¦‚ç¼“å­˜ç”¨æˆ·ä¼šè¯ã€ç»“æœé›†ç­‰ã€‚  \n>   \n> æ€»ä¹‹ï¼ŒSpring Cacheæ˜¯ä¸€ä¸ªååˆ†å¼ºå¤§çš„å·¥å…·ï¼Œå¯ç”¨äºæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯é æ€§ã€‚å®ƒåœ¨Springæ¡†æ¶ä¸­çš„å®šä½ååˆ†é‡è¦ï¼Œæ˜¯ä¸€ä¸ªä¸å¯æˆ–ç¼ºçš„ç»„ä»¶ã€‚å¦‚æœæ‚¨æƒ³è¦åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ç¼“å­˜ï¼Œé‚£ä¹ˆSpring Cacheç»å¯¹æ˜¯ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„é€‰æ‹©ã€‚\n\n\n### **@Cacheable**\n\n\n@Cacheable çš„ä½œç”¨ ä¸»è¦é’ˆå¯¹æ–¹æ³•é…ç½®ï¼Œ**èƒ½å¤Ÿæ ¹æ®æ–¹æ³•çš„è¯·æ±‚å‚æ•°å¯¹å…¶ç»“æœè¿›è¡Œç¼“å­˜**\n\n\n@Cacheable ä½œç”¨å’Œé…ç½®æ–¹æ³•\n\n\n| å‚æ•°        | è§£é‡Š                                                                             | example                                                              |\n| --------- | ------------------------------------------------------------------------------ | -------------------------------------------------------------------- |\n| value     | ç¼“å­˜çš„åç§°ï¼Œåœ¨ [spring](http://www.aspku.com/kaifa/java/237386.html) é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ª | ä¾‹å¦‚: @Cacheable(value=â€mycacheâ€) @Cacheable(value={â€cache1â€,â€cache2â€} |\n| key       | ç¼“å­˜çš„ keyï¼Œå¯ä»¥ä¸ºç©ºï¼Œå¦‚æœæŒ‡å®šè¦æŒ‰ç…§ SpEL è¡¨è¾¾å¼ç¼–å†™ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™ç¼ºçœæŒ‰ç…§æ–¹æ³•çš„æ‰€æœ‰å‚æ•°è¿›è¡Œç»„åˆ                         | @Cacheable(value=â€testcacheâ€,key=â€#userNameâ€)                        |\n| condition | ç¼“å­˜çš„æ¡ä»¶ï¼Œå¯ä»¥ä¸ºç©ºï¼Œä½¿ç”¨ SpEL ç¼–å†™ï¼Œè¿”å› true æˆ–è€… falseï¼Œåªæœ‰ä¸º true æ‰è¿›è¡Œç¼“å­˜                          | @Cacheable(value=â€testcacheâ€,condition=â€#userName.length()>2â€)       |\n\n\n---\n\n\n**å®ä¾‹**\n\n\n> @Cacheable(value=â€accountCacheâ€)ï¼Œè¿™ä¸ªæ³¨é‡Šçš„æ„æ€æ˜¯ï¼š\n\n\nå½“è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œ**ä¼šå…ˆä»ä¸€ä¸ªåå« accountCache çš„ç¼“å­˜ä¸­æŸ¥è¯¢**ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ‰§è¡Œå®é™…çš„æ–¹æ³•ï¼ˆå³æŸ¥è¯¢æ•°æ®åº“ï¼‰ï¼Œå¹¶å°†æ‰§è¡Œçš„ç»“æœå­˜å…¥ç¼“å­˜ä¸­ï¼Œå¦åˆ™è¿”å›ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚**è¿™é‡Œçš„ç¼“å­˜ä¸­çš„ key å°±æ˜¯å‚æ•° userNameï¼Œvalue å°±æ˜¯ Account å¯¹è±¡ã€‚**\n\n\n**â€œaccountCacheâ€ç¼“å­˜æ˜¯åœ¨ \\****spring\\*.xml\\** **ä¸­å®šä¹‰çš„åç§°ã€‚**\n\n\n```java\n@Cacheable(value=\"accountCache\")// ä½¿ç”¨äº†ä¸€ä¸ªç¼“å­˜åå« accountCache\npublic Account getAccountByName(String userName) {\n   // æ–¹æ³•å†…éƒ¨å®ç°ä¸è€ƒè™‘ç¼“å­˜é€»è¾‘ï¼Œç›´æ¥å®ç°ä¸šåŠ¡\n   System.out.println(\"real query account.\"+userName);\n   return getFromDB(userName);\n\n}\n\n```\n\n\n**è€Œåœ¨SpringBootä¸­ä½¿ç”¨çš„è¯æ˜¯å­˜æ”¾åœ¨resourcesä¸‹çš„\\****ehcache.xml\\****ã€‚**\n\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<ehcache xmlns:xsi=\"<http://www.w3.org/2001/XMLSchema-instance>\"\n         xsi:noNamespaceSchemaLocation=\"<http://ehcache.org/ehcache.xsd>\"\n\n         updateCheck=\"false\">\n\n    <!--è´¦å·ç¼“å­˜-->\n\n    <cache name=\"accountCache\" maxElementsInMemory=\"10000\" timeToLiveSeconds=\"300\"  timeToIdleSeconds=\"310\"   eternal=\"false\" overflowToDisk=\"true\"/>\n\n</ehcache>\n\n```\n\n\n---\n\n\n### **@CachePut**\n\n\n> @CachePut ä½œç”¨å’Œé…ç½®æ–¹æ³•ï¼š\n\n\n@CachePut çš„ä½œç”¨ ä¸»è¦é’ˆå¯¹æ–¹æ³•é…ç½®ï¼Œèƒ½å¤Ÿæ ¹æ®æ–¹æ³•çš„è¯·æ±‚å‚æ•°å¯¹å…¶ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå’Œ @Cacheable ä¸åŒçš„æ˜¯ï¼Œ**å®ƒæ¯æ¬¡éƒ½ä¼šè§¦å‘çœŸå®æ–¹æ³•çš„è°ƒç”¨**\n\n\n| å‚æ•°        | è§£é‡Š                                                     | example                                                       |\n| --------- | ------------------------------------------------------ | ------------------------------------------------------------- |\n| value     | ç¼“å­˜çš„åç§°ï¼Œåœ¨ spring é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ª                        | @CachePut(value=â€my cacheâ€)                                   |\n| key       | ç¼“å­˜çš„ keyï¼Œå¯ä»¥ä¸ºç©ºï¼Œå¦‚æœæŒ‡å®šè¦æŒ‰ç…§ SpEL è¡¨è¾¾å¼ç¼–å†™ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™ç¼ºçœæŒ‰ç…§æ–¹æ³•çš„æ‰€æœ‰å‚æ•°è¿›è¡Œç»„åˆ | @CachePut(value=â€testcacheâ€,key=â€#userNameâ€)                  |\n| condition | ç¼“å­˜çš„æ¡ä»¶ï¼Œå¯ä»¥ä¸ºç©ºï¼Œä½¿ç”¨ SpEL ç¼–å†™ï¼Œè¿”å› true æˆ–è€… falseï¼Œåªæœ‰ä¸º true æ‰è¿›è¡Œç¼“å­˜  | @CachePut(value=â€testcacheâ€,condition=â€#userName.length()>2â€) |\n\n\n**å®ä¾‹**\n\n\n**@CachePut æ³¨é‡Šï¼Œè¿™ä¸ªæ³¨é‡Šå¯ä»¥ç¡®ä¿æ–¹æ³•è¢«æ‰§è¡Œï¼ŒåŒæ—¶æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿè¢«è®°å½•åˆ°ç¼“å­˜ä¸­ï¼Œå®ç°ç¼“å­˜ä¸æ•°æ®åº“çš„åŒæ­¥æ›´æ–°ã€‚**\n\n\n```java\n@CachePut(value=\"accountCache\",key=\"#account.getName()\")// æ›´æ–°accountCache ç¼“å­˜\npublic Account updateAccount(Account account) {\n  return updateDB(account);\n}\n\n```\n\n\n---\n\n\n### **@CacheEvict**\n\n\n> @CacheEvict ä½œç”¨å’Œé…ç½®æ–¹æ³•\n\n\n@CachEvict çš„ä½œç”¨ ä¸»è¦é’ˆå¯¹æ–¹æ³•é…ç½®ï¼Œ**èƒ½å¤Ÿæ ¹æ®ä¸€å®šçš„æ¡ä»¶å¯¹ç¼“å­˜è¿›è¡Œæ¸…ç©º**\n\n\n| å‚æ•°               | è§£é‡Š                                                                          | example                                                         |\n| ---------------- | --------------------------------------------------------------------------- | --------------------------------------------------------------- |\n| value            | ç¼“å­˜çš„åç§°ï¼Œåœ¨ spring é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ª                                             | @CacheEvict(value=â€my cacheâ€)                                   |\n| key              | ç¼“å­˜çš„ keyï¼Œå¯ä»¥ä¸ºç©ºï¼Œå¦‚æœæŒ‡å®šè¦æŒ‰ç…§ SpEL è¡¨è¾¾å¼ç¼–å†™ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™ç¼ºçœæŒ‰ç…§æ–¹æ³•çš„æ‰€æœ‰å‚æ•°è¿›è¡Œç»„åˆ                      | @CacheEvict(value=â€testcacheâ€,key=â€#userNameâ€)                  |\n| condition        | ç¼“å­˜çš„æ¡ä»¶ï¼Œå¯ä»¥ä¸ºç©ºï¼Œä½¿ç”¨ SpEL ç¼–å†™ï¼Œè¿”å› true æˆ–è€… falseï¼Œåªæœ‰ä¸º true æ‰è¿›è¡Œç¼“å­˜                       | @CacheEvict(value=â€testcacheâ€,condition=â€#userName.length()>2â€) |\n| allEntries       | æ˜¯å¦æ¸…ç©ºæ‰€æœ‰ç¼“å­˜å†…å®¹ï¼Œç¼ºçœä¸º falseï¼Œå¦‚æœæŒ‡å®šä¸º trueï¼Œåˆ™æ–¹æ³•è°ƒç”¨åå°†ç«‹å³æ¸…ç©ºæ‰€æœ‰ç¼“å­˜                             | @CachEvict(value=â€testcacheâ€,allEntries=true)                   |\n| beforeInvocation | æ˜¯å¦åœ¨æ–¹æ³•æ‰§è¡Œå‰å°±æ¸…ç©ºï¼Œç¼ºçœä¸º falseï¼Œå¦‚æœæŒ‡å®šä¸º trueï¼Œåˆ™åœ¨æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œçš„æ—¶å€™å°±æ¸…ç©ºç¼“å­˜ï¼Œç¼ºçœæƒ…å†µä¸‹ï¼Œå¦‚æœæ–¹æ³•æ‰§è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ä¸ä¼šæ¸…ç©ºç¼“å­˜ | @CachEvict(value=â€testcacheâ€ï¼ŒbeforeInvocation=true)             |\n\n\nå®ä¾‹\n\n\n```java\n@CacheEvict(value=\"accountCache\",key=\"#account.getName()\")// æ¸…ç©ºaccountCache ç¼“å­˜\npublic void updateAccount(Account account) {\n   updateDB(account);\n}\n\n\n@CacheEvict(value=\"accountCache\",allEntries=true)// æ¸…ç©ºaccountCache ç¼“å­˜\npublic void reload() {\n\n   reloadAll()\n\n}\n\n\n\n\n@Cacheable(value=\"accountCache\",condition=\"#userName.length() <=4\")// ç¼“å­˜åå« accountCache\npublic Account getAccountByName(String userName) {\n\n // æ–¹æ³•å†…éƒ¨å®ç°ä¸è€ƒè™‘ç¼“å­˜é€»è¾‘ï¼Œç›´æ¥å®ç°ä¸šåŠ¡\n return getFromDB(userName);\n\n}\n\n```\n\n\n---\n\n\n### **@CacheConfig**\n\n\næ‰€æœ‰çš„@Cacheableï¼ˆï¼‰é‡Œé¢éƒ½æœ‰ä¸€ä¸ªvalueï¼â€œxxxâ€çš„å±æ€§ï¼Œè¿™æ˜¾ç„¶å¦‚æœæ–¹æ³•å¤šäº†ï¼Œå†™èµ·æ¥ä¹Ÿæ˜¯æŒºç´¯çš„ï¼Œå¦‚æœå¯ä»¥ä¸€æ¬¡æ€§å£°æ˜å®Œ é‚£å°±çœäº‹äº†ï¼Œ æ‰€ä»¥ï¼Œæœ‰äº†@CacheConfigè¿™ä¸ªé…ç½®ï¼Œ@CacheConfig is a class-level annotation that allows to share the cache namesï¼Œå¦‚æœä½ åœ¨ä½ çš„æ–¹æ³•å†™åˆ«çš„åå­—ï¼Œé‚£ä¹ˆä¾ç„¶ä»¥æ–¹æ³•çš„åå­—ä¸ºå‡†ã€‚\n\n\n```java\n@CacheConfig(\"books\")\npublic class BookRepositoryImpl implements BookRepository {\n\n\n  @Cacheable\n  public Book findBook(ISBN isbn) {...}\n\n}\n```\n\n\n---\n\n\n### **æ¡ä»¶ç¼“å­˜**\n\n\nä¸‹é¢æä¾›ä¸€äº›å¸¸ç”¨çš„æ¡ä»¶ç¼“å­˜\n\n\n```java\n//@Cacheableå°†åœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰( #resultè¿˜æ‹¿ä¸åˆ°è¿”å›å€¼)åˆ¤æ–­conditionï¼Œå¦‚æœè¿”å›trueï¼Œåˆ™æŸ¥ç¼“å­˜ï¼›\n@Cacheable(value = \"user\", key = \"#id\", condition = \"#id lt 10\")\npublic User conditionFindById(final Long id)\n\n\n\n\n//@CachePutå°†åœ¨æ‰§è¡Œå®Œæ–¹æ³•åï¼ˆ#resultå°±èƒ½æ‹¿åˆ°è¿”å›å€¼äº†ï¼‰åˆ¤æ–­conditionï¼Œå¦‚æœè¿”å›trueï¼Œåˆ™æ”¾å…¥ç¼“å­˜ï¼›\n@CachePut(value = \"user\", key = \"#id\", condition = \"#result.username ne 'zhang'\")\npublic User conditionSave(final User user)\n\n\n\n//@CachePutå°†åœ¨æ‰§è¡Œå®Œæ–¹æ³•åï¼ˆ#resultå°±èƒ½æ‹¿åˆ°è¿”å›å€¼äº†ï¼‰åˆ¤æ–­unlessï¼Œå¦‚æœè¿”å›falseï¼Œåˆ™æ”¾å…¥ç¼“å­˜ï¼›ï¼ˆå³è·Ÿconditionç›¸åï¼‰\n@CachePut(value = \"user\", key = \"#user.id\", unless = \"#result.username eq 'zhang'\")\npublic User conditionSave2(final User user)\n\n\n\n//@CacheEvictï¼Œ beforeInvocation=falseè¡¨ç¤ºåœ¨æ–¹æ³•æ‰§è¡Œä¹‹åè°ƒç”¨ï¼ˆ#resultèƒ½æ‹¿åˆ°è¿”å›å€¼äº†ï¼‰ï¼›ä¸”åˆ¤æ–­conditionï¼Œå¦‚æœè¿”å›trueï¼Œåˆ™ç§»é™¤ç¼“å­˜ï¼›\n@CacheEvict(value = \"user\", key = \"#user.id\", beforeInvocation = false, condition = \"#result.username ne 'zhang'\")\npublic User conditionDelete(final User user)\n\n```\n\n\n---\n\n\n### **@Caching**\n\n\næœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ç»„åˆå¤šä¸ªCacheæ³¨è§£ä½¿ç”¨ï¼›æ¯”å¦‚ç”¨æˆ·æ–°å¢æˆåŠŸåï¼Œæˆ‘ä»¬è¦æ·»åŠ idâ€“>userï¼›usernameâ€”>userï¼›emailâ€”>userçš„ç¼“å­˜ï¼›æ­¤æ—¶å°±éœ€è¦@Cachingç»„åˆå¤šä¸ªæ³¨è§£æ ‡ç­¾äº†ã€‚\n\n\n```java\n@Caching(put = {\n@CachePut(value = \"user\", key = \"#user.id\"),\n@CachePut(value = \"user\", key = \"#user.username\"),\n@CachePut(value = \"user\", key = \"#user.email\")\n})\n\npublic User save(User user) {\n\n```\n\n\n---\n\n\n### **è‡ªå®šä¹‰ç¼“å­˜æ³¨è§£**\n\n\næ¯”å¦‚ä¹‹å‰çš„é‚£ä¸ª@Cachingç»„åˆï¼Œä¼šè®©æ–¹æ³•ä¸Šçš„æ³¨è§£æ˜¾å¾—æ•´ä¸ªä»£ç æ¯”è¾ƒä¹±ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£æŠŠè¿™äº›æ³¨è§£ç»„åˆåˆ°ä¸€ä¸ªæ³¨è§£ä¸­ï¼Œå¦‚ï¼š\n\n\n```java\n@Caching(put = {\n@CachePut(value = \"user\", key = \"#user.id\"),\n@CachePut(value = \"user\", key = \"#user.username\"),\n @CachePut(value = \"user\", key = \"#user.email\")\n})\n\n@Target({ElementType.METHOD, ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Inherited\npublic @interface UserSaveCache {\n}\n```\n\n\nè¿™æ ·æˆ‘ä»¬åœ¨æ–¹æ³•ä¸Šä½¿ç”¨å¦‚ä¸‹ä»£ç å³å¯ï¼Œæ•´ä¸ªä»£ç æ˜¾å¾—æ¯”è¾ƒå¹²å‡€ã€‚\n\n\n```java\n@UserSaveCache\npublic User save(User user)\n\n```\n\n\n---\n\n\n### æ‰©å±•\n\n\næ¯”å¦‚findByUsernameæ—¶ï¼Œä¸åº”è¯¥åªæ”¾usernameâ€“>userï¼Œåº”è¯¥è¿åŒidâ€”>userå’Œemailâ€”>userä¸€èµ·æ”¾å…¥ï¼›è¿™æ ·ä¸‹æ¬¡å¦‚æœæŒ‰ç…§idæŸ¥æ‰¾ç›´æ¥ä»ç¼“å­˜ä¸­å°±å‘½ä¸­äº†\n\n\n```java\n@Caching(\n  cacheable = {\n    @Cacheable(value = \"user\", key = \"#username\")\n  },\n  put = {\n    @CachePut(value = \"user\", key = \"#result.id\", condition = \"#result != null\"),\n    @CachePut(value = \"user\", key = \"#result.email\", condition = \"#result != null\")\n  }\n)\npublic User findByUsername(final String username) {\n  System.out.println(\"cache miss, invoke find by username, username:\" + username);\n  for (User user : users) {\n    if (user.getUsername().equals(username)) {\n      return user;\n    }\n  }\n  return null;\n}\n\n```\n\n\nå…¶å®å¯¹äºï¼šidâ€”>userï¼›usernameâ€”->userï¼›emailâ€”>userï¼›æ›´å¥½çš„æ–¹å¼å¯èƒ½æ˜¯ï¼šidâ€”>userï¼›usernameâ€”>idï¼›emailâ€”>idï¼›ä¿è¯useråªå­˜ä¸€ä»½ï¼›å¦‚ï¼š\n\n\n```java\n@CachePut(value=\"cacheName\", key=\"#user.username\", cacheValue=\"#user.username\")\npublic void save(User user)\n\n\n@Cacheable(value=\"cacheName\", key=\"#user.username\", cacheValue=\"#caches[0].get(#caches[0].get(#username).get())\")\n\npublic User findByUsername(String username)\n\n```\n\n\n**SpELä¸Šä¸‹æ–‡æ•°æ®**\n\n\nSpring Cacheæä¾›äº†ä¸€äº›ä¾›æˆ‘ä»¬ä½¿ç”¨çš„SpELä¸Šä¸‹æ–‡æ•°æ®ï¼Œä¸‹è¡¨ç›´æ¥æ‘˜è‡ªSpringå®˜æ–¹æ–‡æ¡£ï¼š\n\n\n| åç§°            | ä½ç½®     | æè¿°                                                                      | ç¤ºä¾‹                                           |\n| ------------- | ------ | ----------------------------------------------------------------------- | -------------------------------------------- |\n| methodName    | rootå¯¹è±¡ | å½“å‰è¢«è°ƒç”¨çš„æ–¹æ³•å                                                               | root.methodName                              |\n| method        | rootå¯¹è±¡ | å½“å‰è¢«è°ƒç”¨çš„æ–¹æ³•                                                                | [root.method.name](http://root.method.name/) |\n| target        | rootå¯¹è±¡ | å½“å‰è¢«è°ƒç”¨çš„ç›®æ ‡å¯¹è±¡                                                              | root.target                                  |\n| targetClass   | rootå¯¹è±¡ | å½“å‰è¢«è°ƒç”¨çš„ç›®æ ‡å¯¹è±¡ç±»                                                             | root.targetClass                             |\n| args          | rootå¯¹è±¡ | å½“å‰è¢«è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨                                                           | root.args[0]                                 |\n| caches        | rootå¯¹è±¡ | å½“å‰æ–¹æ³•è°ƒç”¨ä½¿ç”¨çš„ç¼“å­˜åˆ—è¡¨ï¼ˆå¦‚@Cacheable(value={â€œcache1â€, â€œcache2â€})ï¼‰ï¼Œåˆ™æœ‰ä¸¤ä¸ªcache        | root.caches[0].name                          |\n| argument name | æ‰§è¡Œä¸Šä¸‹æ–‡  | å½“å‰è¢«è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•°ï¼Œå¦‚findById(Long id)ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡#idæ‹¿åˆ°å‚æ•°                            | [user.id](http://user.id/)                   |\n| result        | æ‰§è¡Œä¸Šä¸‹æ–‡  | æ–¹æ³•æ‰§è¡Œåçš„è¿”å›å€¼ï¼ˆä»…å½“æ–¹æ³•æ‰§è¡Œä¹‹åçš„åˆ¤æ–­æœ‰æ•ˆï¼Œå¦‚â€˜unless'ï¼Œ'cache evict'çš„beforeInvocation=falseï¼‰ | result                                       |\n\n\n```java\n@CacheEvict(value = \"user\", key = \"#user.id\", condition = \"#root.target.canCache() and #root.caches[0].get(#user.id).get().username ne #user.username\", beforeInvocation = true)\npublic void conditionUpdate(User user)\n```\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-06-02",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "18",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "ç¼“å­˜"
        ],
        "summary": "Spring Cacheæ˜¯Springæ¡†æ¶ç”¨äºæ”¯æŒç¼“å­˜çš„æ¨¡å—ã€‚å®ƒæä¾›äº†ä¸€ç»„ç¼“å­˜æŠ½è±¡ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†ä¸åŒçš„ç¼“å­˜æŠ€æœ¯é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œæé«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚Spring Cacheé€šè¿‡ä½¿ç”¨è½»é‡çº§çš„æ³¨é‡Šæ¥å®šä¹‰ç¼“å­˜çš„è¡Œä¸ºï¼Œä»è€Œå‡å°‘äº†ç¼“å­˜æ“ä½œçš„å¤æ‚æ€§ã€‚æ­¤å¤–ï¼ŒSpring Cacheè¿˜æ”¯æŒäº‹åŠ¡æ€§ç¼“å­˜ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚æ€»ä½“æ¥è¯´ï¼ŒSpring Cacheæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥æå¤§åœ°æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚",
        "sort": "",
        "title": "spring cache",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "bcd4f723-5f6a-4d94-90a1-63bb8c6dbfcf"
        }
      ],
      "body": "",
      "realName": "spring cache",
      "relativePath": "/archives/spring cache.md"
    },
    {
      "id": "76be662e-68e2-4e75-8d51-c66197e850d3",
      "doc_id": "76be662e-68e2-4e75-8d51-c66197e850d3",
      "title": "76be662e-68e2-4e75-8d51-c66197e850d3",
      "updated": 1696747320000,
      "body_original": "\n> è®°å½•ä¸€æ¬¡scanå’Œkeysçš„ä½¿ç”¨,scanå’Œkeyéƒ½æ˜¯redisæœç´¢keyçš„å€¼å‡½æ•°,ä½†å®ç°å´å®Œå…¨ä¸åŒã€‚ç”Ÿäº§ç¯å¢ƒç”¨keyçš„åŒå­¦å‡†å¤‡å¥½è·‘è·¯å§~\n\n\n# keys\n\n\n> Warning: consider KEYS as a command that should only be used in production environments with extreme care. It may ruin performance when it is executed against large databases. This command is intended for debugging and special operations, such as changing your keyspace layout. Don't use KEYS in your regular application code. If you're looking for a way to find keys in a subset of your keyspace, consider using sets.\n\n\n> ä¸Šé¢æ˜¯å®˜æ–¹æ–‡æ¡£å£°æ˜ï¼ŒKEYSå‘½ä»¤ä¸èƒ½ç”¨åœ¨ç”Ÿäº§çš„ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæ•°é‡è¿‡å¤§æ•ˆç‡æ˜¯ååˆ†ä½çš„ã€‚\n\n\n```text\n       /**\n\t * Find all keys matching the given {@code pattern}.\n\t *\n\t * @param pattern must not be {@literal null}.\n\t * @return {@literal null} when used in pipeline / transaction.\n\t * @see <a href=\"<https://redis.io/commands/keys>\">Redis Documentation: KEYS</a>\n\t */\n\t@Nullable\n\tSet<K> keys(K pattern);\n\n\n```\n\n\n> keyså‡½æ•°æ”¯æŒä¼ å…¥ä¸€ä¸ªæ­£åˆ™å­—ç¬¦ä¸²ï¼Œéå†redisä¸­æ‰€æœ‰åŒ¹é…åˆ°çš„keyã€‚å‘½ä»¤ä¼šå¼•èµ·é˜»å¡,æ€§èƒ½éšç€æ•°æ®åº“æ•°æ®çš„å¢å¤šè€Œè¶Šæ¥è¶Šæ…¢ã€‚\n\n\n# SCAN\n\n\n> Redisä»2.8ç‰ˆæœ¬å¼€å§‹æ”¯æŒscanå‘½ä»¤ï¼ŒSCANå‘½ä»¤çš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹\n\n1. å¤æ‚åº¦è™½ç„¶ä¹Ÿæ˜¯ O(n)ï¼Œé€šè¿‡æ¸¸æ ‡åˆ†æ­¥è¿›è¡Œä¸ä¼šé˜»å¡çº¿ç¨‹;\n2. æœ‰é™åˆ¶å‚æ•° COUNT ï¼›\n3. åŒ keyså‘½ä»¤ ä¸€æ ·æä¾›æ¨¡å¼åŒ¹é…åŠŸèƒ½;\n4. æœåŠ¡å™¨ä¸éœ€è¦ä¸ºæ¸¸æ ‡ä¿å­˜çŠ¶æ€ï¼Œæ¸¸æ ‡çš„å”¯ä¸€çŠ¶æ€å°±æ˜¯ scan è¿”å›ç»™å®¢æˆ·ç«¯çš„æ¸¸æ ‡æ•´æ•°;\n\n> ä½†æ˜¯éœ€è¦æ³¨æ„è¿”å›ç»“æœå¯èƒ½é‡å¤ï¼Œéœ€è¦å®¢æˆ·ç«¯å»é‡ã€‚å¦‚æœéå†è¿‡ç¨‹ä¸­æœ‰æ•°æ®ä¿®æ”¹ï¼Œæ”¹åŠ¨åçš„æ•°æ®ä¸ä¿è¯åŒæ­¥ã€‚\n\n\n_scan å‘½ä»¤æä¾›ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯cursorï¼Œç¬¬äºŒä¸ªæ˜¯è¦åŒ¹é…çš„æ­£åˆ™ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å•æ¬¡éå†çš„æ§½ä½_\n\n\n## RedisOperations sacn\n\n\n> springä¸­redisOperationsåªæœ‰HashOperationsç±»æä¾›scanæ–¹æ³•\n\n\n```text\n      /**\n\t * Use a {@link Cursor} to iterate over entries in hash at {@code key}. <br />\n\t * <strong>Important:</strong> Call {@link Cursor#close()} when done to avoid resource leak.\n\t *\n\t * @param key must not be {@literal null}.\n\t * @param options\n\t * @return {@literal null} when used in pipeline / transaction.\n\t * @since 1.4\n\t */\n\tCursor<Map.Entry<HK, HV>> scan(H key, ScanOptions options);\n\n```\n\n\n## ä½¿ç”¨\n\n\n```text\n       /**\n         *  æœç´¢\n         */\n        Cursor<Map.Entry<ID, Double>> cursor = hash.scan(key,new ScanOptions.ScanOptionsBuilder().match(sb.toString()).count(keys.size()).build());\n\n        Map<ID, Double> map = new HashMap<>(keys.size());\n        while (cursor.hasNext()) {\n            Map.Entry<ID, Double> next = cursor.next();\n            map.put(next.getKey(), next.getValue());\n        }\n\n```\n\n\n> ç¬¬ä¸€ä¸ªéå†æ˜¯ cursor å€¼ä¸º0ï¼Œç„¶åå°†è¿”å›ç»“æœçš„ç¬¬ä¸€ä¸ªæ•´æ•°ä½œä¸ºä¸‹ä¸€ä¸ªéå†çš„æ¸¸æ ‡ï¼Œå¦‚æœæœ€åè¿”å›çš„åˆ°cursorçš„å€¼ä¸º0å°±ä»£è¡¨ç»“æŸã€‚\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-07-23",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "9",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "Java",
          "Redis"
        ],
        "summary": "è®°å½•ä¸€æ¬¡scanå’Œkeysçš„ä½¿ç”¨,scanå’Œkeyéƒ½æ˜¯redisæœç´¢keyçš„å€¼å‡½æ•°,ä½†å®ç°å´å®Œå…¨ä¸åŒã€‚ç”Ÿäº§ç¯å¢ƒç”¨keyçš„åŒå­¦å‡†å¤‡å¥½è·‘è·¯å§~keysWarning: consider KEYS as a",
        "sort": "",
        "title": "RedisOperations scan ç”¨æ³•",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "76be662e-68e2-4e75-8d51-c66197e850d3"
        }
      ],
      "body": "",
      "realName": "RedisOperations scan ç”¨æ³•",
      "relativePath": "/archives/RedisOperations scan ç”¨æ³•.md"
    },
    {
      "id": "a1eb98de-4986-46c0-b1ac-6846629d0819",
      "doc_id": "a1eb98de-4986-46c0-b1ac-6846629d0819",
      "title": "a1eb98de-4986-46c0-b1ac-6846629d0819",
      "updated": 1696747320000,
      "body_original": "\n# webFlux åˆè¯†\n\n\n## **Lambda**\n\n\nLambda è¡¨è¾¾å¼ï¼Œæœ‰æ—¶å€™ä¹Ÿç§°ä¸ºåŒ¿åå‡½æ•°æˆ–ç®­å¤´å‡½æ•°ï¼Œå‡ ä¹åœ¨å½“å‰çš„å„ç§ä¸»æµçš„ç¼–ç¨‹è¯­è¨€ä¸­éƒ½æœ‰å®ƒçš„èº«å½±ã€‚Java8 ä¸­å¼•å…¥ Lambda è¡¨è¾¾å¼ï¼Œä½¿åŸæœ¬éœ€è¦ç”¨**åŒ¿åç±»**å®ç°æ¥å£æ¥ä¼ é€’è¡Œä¸ºï¼Œç°åœ¨é€šè¿‡ Lambda å¯ä»¥æ›´ç›´è§‚çš„è¡¨è¾¾ã€‚\n\n- Lambda è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ç§°ä¸ºé—­åŒ…ã€‚é—­åŒ…å°±æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨å‡½æ•°å†…éƒ¨çš„å‡½æ•°ï¼Œé—­åŒ…ä½¿å¾—å˜é‡å³ä½¿è„±ç¦»äº†è¯¥å‡½æ•°çš„ä½œç”¨åŸŸèŒƒå›´ä¹Ÿä¾ç„¶èƒ½è¢«è®¿é—®åˆ°ã€‚\n- Lambda è¡¨è¾¾å¼çš„æœ¬è´¨åªæ˜¯ä¸€ä¸ªâ€è¯­æ³•ç³–â€ï¼Œç”±ç¼–è¯‘å™¨æ¨æ–­å¹¶å¸®ä½ è½¬æ¢åŒ…è£…ä¸ºå¸¸è§„çš„ä»£ç ,å› æ­¤ä½ å¯ä»¥ä½¿ç”¨æ›´å°‘çš„ä»£ç æ¥å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚\n- Lambda è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå³æ²¡æœ‰å‡½æ•°åçš„å‡½æ•°ã€‚æœ‰äº›å‡½æ•°å¦‚æœåªæ˜¯ä¸´æ—¶ä¸€ç”¨ï¼Œè€Œä¸”å®ƒçš„ä¸šåŠ¡é€»è¾‘ä¹Ÿå¾ˆç®€å•æ—¶ï¼Œå°±æ²¡å¿…è¦éç»™å®ƒå–ä¸ªåå­—ä¸å¯ã€‚\n- Lambda å…è®¸æŠŠå‡½æ•°ä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ï¼ˆå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’è¿›æ–¹æ³•ä¸­ï¼‰.\n\nLambda è¡¨è¾¾å¼è¯­æ³•å¦‚ä¸‹ï¼š**å½¢å‚åˆ—è¡¨=>å‡½æ•°ä½“**ï¼ˆå‡½æ•°ä½“å¤šäºä¸€æ¡è¯­å¥çš„å¯ç”¨å¤§æ‹¬å·æ‹¬èµ·ï¼‰ã€‚åœ¨Javaé‡Œå°±æ˜¯**() -> {}**ï¼š\n\n\n```text\n(å‚æ•°) -> è¡¨è¾¾å¼\n\n```\n\n\næˆ–\n\n\n```text\n(å‚æ•°) ->{ ä»£ç è¯­å¥ }\n\n```\n\n\nLambdaè¡¨è¾¾å¼çš„é‡è¦ç‰¹å¾ï¼š\n\n- Lambda è¡¨è¾¾å¼ä¸»è¦ç”¨æ¥å®šä¹‰è¡Œå†…æ‰§è¡Œçš„æ–¹æ³•ç±»å‹æ¥å£ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•æ–¹æ³•æ¥å£ã€‚\n- Lambdaè¡¨è¾¾å¼æ˜¯é€šè¿‡å‡½æ•°å¼æ¥å£ï¼ˆå¿…é¡»**æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•å£°æ˜**ï¼‰è¯†åˆ«çš„\n- å¯é€‰ç±»å‹å£°æ˜ï¼šä¸éœ€è¦å£°æ˜å‚æ•°ç±»å‹ï¼Œç¼–è¯‘å™¨å¯ä»¥ç»Ÿä¸€è¯†åˆ«å‚æ•°å€¼ã€‚\n- å¯é€‰çš„å‚æ•°åœ†æ‹¬å·ï¼šä¸€ä¸ªå‚æ•°æ— éœ€å®šä¹‰åœ†æ‹¬å·ï¼Œä½†å¤šä¸ªå‚æ•°éœ€è¦å®šä¹‰åœ†æ‹¬å·ã€‚\n- å¯é€‰çš„å¤§æ‹¬å·ï¼šå¦‚æœä¸»ä½“åŒ…å«äº†ä¸€ä¸ªè¯­å¥ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨å¤§æ‹¬å·ã€‚\n- å¯é€‰çš„è¿”å›å…³é”®å­—ï¼šå¦‚æœä¸»ä½“åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼è¿”å›å€¼ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿”å›å€¼ï¼Œå¤§æ‹¬å·éœ€è¦æŒ‡å®šè¡¨è¾¾å¼è¿”å›ä¸€ä¸ªå€¼ã€‚\n\nLambdaè¡¨è¾¾å¼ä¸­çš„å˜é‡ä½œç”¨åŸŸï¼š\n\n- è®¿é—®æƒé™ä¸åŒ¿åå¯¹è±¡çš„æ–¹å¼éå¸¸ç±»ä¼¼ã€‚åªèƒ½å¤Ÿè®¿é—®**å±€éƒ¨å¯¹åº”çš„å¤–éƒ¨åŒºåŸŸçš„å±€éƒ¨finalå˜é‡ï¼Œä»¥åŠæˆå‘˜å˜é‡å’Œé™æ€å˜é‡**ã€‚\n- åœ¨Lambdaè¡¨è¾¾å¼ä¸­èƒ½è®¿é—®åŸŸå¤–çš„å±€éƒ¨éfinalå˜é‡ã€ä½†**ä¸èƒ½ä¿®æ”¹LambdaåŸŸå¤–çš„å±€éƒ¨éfinalå˜é‡**ã€‚å› ä¸ºåœ¨Lambdaè¡¨è¾¾å¼ä¸­ï¼ŒLambdaåŸŸå¤–çš„å±€éƒ¨éfinalå˜é‡ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šè¢«**éšå¼åœ°å½“åšfinalå˜é‡æ¥å¤„ç†**ã€‚\n- Lambdaè¡¨è¾¾å¼å†…éƒ¨**æ— æ³•è®¿é—®æ¥å£é»˜è®¤ï¼ˆdefaultï¼‰æ–¹æ³•**\n\nä¾‹å­ï¼šä½¿ç”¨Java 8ä¹‹å‰çš„æ–¹æ³•æ¥å®ç°å¯¹ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œæ’åºï¼š\n\n\n```text\nList<String> names = Arrays.asList(\"aaa\", \"cccc\", \"ddd\", \"bbb\");\nCollections.sort(names, new Comparator<String>() {\n    @Override\n    public int compare(String a, String b) {\n        return b.compareTo(a);\n    }\n});\n\n```\n\n\nJava 8 Lambda è¡¨è¾¾å¼ï¼š\n\n\n```text\nCollections.sort(names, (String a, String b) -> {\n    return b.compareTo(a);\n});\n// åªæœ‰ä¸€æ¡é€»è¾‘è¯­å¥ï¼Œå¯ä»¥çœç•¥å¤§æ‹¬å·\nCollections.sort(names, (String a, String b) -> b.compareTo(a));\n// å¯ä»¥çœç•¥å…¥å‚ç±»å‹\nCollections.sort(names, (a, b) -> b.compareTo(a));\n\n```\n\n\n### **ç±»å‹æ¨æ–­**\n\n\né€šå¸¸ Lambda è¡¨è¾¾å¼çš„å‚æ•°å¹¶ä¸éœ€è¦æ˜¾ç¤ºå£°æ˜ç±»å‹ã€‚é‚£ä¹ˆå¯¹äºç»™å®šçš„Lambdaè¡¨è¾¾å¼ï¼Œç¨‹åºå¦‚ä½•çŸ¥é“å¯¹åº”çš„æ˜¯å“ªä¸ªå‡½æ•°æ¥å£ä»¥åŠå‚æ•°çš„ç±»å‹å‘¢ï¼Ÿç¼–è¯‘å™¨**é€šè¿‡ Lambda è¡¨è¾¾å¼æ‰€åœ¨çš„ä¸Šä¸‹æ–‡æ¥è¿›è¡Œç›®æ ‡ç±»å‹æ¨æ–­ï¼Œé€šè¿‡æ£€æŸ¥ Lambda è¡¨è¾¾å¼çš„å…¥å‚ç±»å‹åŠè¿”å›ç±»å‹ï¼Œå’Œå¯¹åº”çš„ç›®æ ‡ç±»å‹çš„æ–¹æ³•ç­¾åæ˜¯å¦ä¸€è‡´ï¼Œæ¨å¯¼å‡ºåˆé€‚çš„å‡½æ•°æ¥å£**ã€‚æ¯”å¦‚ï¼š\n\n\n```text\nStream.of(\"æˆ‘æ˜¯å­—ç¬¦ä¸²A\", \"æˆ‘æ˜¯å­—ç¬¦ä¸²B\").map(s -> s.length()).filter(l -> l == 3);\n\n```\n\n\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯¹äºä¼ å…¥ map æ–¹æ³•çš„ Lamda è¡¨è¾¾å¼ï¼Œä» Stream çš„ç±»å‹ä¸Šä¸‹æ–‡å¯ä»¥æ¨å¯¼å‡ºå…¥å‚æ˜¯ String ç±»å‹ï¼Œä»å‡½æ•°çš„è¿”å›å€¼å¯ä»¥æ¨å¯¼å‡ºå‡ºå‚æ˜¯æ•´å½¢ç±»å‹ï¼Œå› æ­¤å¯æ¨å¯¼å‡ºå¯¹åº”çš„å‡½æ•°æ¥å£ç±»å‹ä¸º Functionï¼›å¯¹äºä¼ å…¥ filter æ–¹æ³•çš„ Lamda è¡¨è¾¾å¼ï¼Œä» pipeline çš„ä¸Šä¸‹æ–‡å¯å¾—çŸ¥å…¥å‚æ˜¯æ•´å½¢ç±»å‹ï¼Œå› æ­¤å¯æ¨å¯¼å‡ºå‡½æ•°æ¥å£ Predicateã€‚\n\n\n### æ–¹æ³•å¼•ç”¨\n\n\nJava 8 ä¸­è¿˜å¯ä»¥é€šè¿‡**æ–¹æ³•å¼•ç”¨**æ¥**è¡¨ç¤º Lambda è¡¨è¾¾å¼**ã€‚æ–¹æ³•å¼•ç”¨æ˜¯ç”¨æ¥ç›´æ¥è®¿é—®ç±»æˆ–è€…å®ä¾‹çš„å·²ç»å­˜åœ¨çš„æ–¹æ³•æˆ–è€…æ„é€ æ–¹æ³•ã€‚Java 8 å…è®¸ä½ é€šè¿‡\"**::**\"å…³é”®å­—è·å–æ–¹æ³•æˆ–è€…æ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚æ–¹æ³•å¼•ç”¨æä¾›äº†ä¸€ç§**å¼•ç”¨è€Œä¸æ‰§è¡Œæ–¹æ³•**çš„æ–¹å¼ï¼Œå®ƒéœ€è¦ç”±å…¼å®¹çš„å‡½æ•°å¼æ¥å£æ„æˆç›®æ ‡ç±»å‹ä¸Šä¸‹æ–‡ã€‚è®¡ç®—æ—¶ï¼Œæ–¹æ³•å¼•ç”¨ä¼šåˆ›å»ºå‡½æ•°å¼æ¥å£çš„ä¸€ä¸ªå®ä¾‹ã€‚å¸¸ç”¨çš„æ–¹æ³•å¼•ç”¨æœ‰ï¼š\n\n- é™æ€æ–¹æ³•å¼•ç”¨ï¼šClassName::methodName\n- å®ä¾‹å¯¹è±¡ä¸Šçš„æ–¹æ³•å¼•ç”¨ï¼šinstanceReference::methodName\n- ç±»ä¸Šçš„æ–¹æ³•å¼•ç”¨ï¼šClassName::methodName\n- æ„é€ æ–¹æ³•å¼•ç”¨ï¼šClass::new\n- æ•°ç»„æ„é€ æ–¹æ³•å¼•ç”¨ï¼šTypeName[]::new\n\nä¾‹å­ï¼š\n\n\n```text\n// é™æ€æ–¹æ³•å¼•ç”¨\nStream.of(someStringArray).allMatch(StringUtils::isNotEmpty);\n// å®ä¾‹å¯¹è±¡ä¸Šçš„æ–¹æ³•å¼•ç”¨\nStream.of(someStringArray).map(this::someTransform);\n// ç±»ä¸Šçš„æ–¹æ³•å¼•ç”¨\nStream.of(someStringArray).mapToInt(String::length);\n// æ„é€ æ–¹æ³•å¼•ç”¨\nStream.of(someStringArray).collect(Collectors.toCollection(LinkedList::new));\n// æ•°ç»„æ„é€ æ–¹æ³•å¼•ç”¨\nStream.of(someStringArray).toArray(String[]::new);\n\n```\n\n\n### å‡½æ•°å¼æ¥å£\n\n\nJava 8 ä¸­é‡‡ç”¨**å‡½æ•°å¼æ¥å£**ä½œä¸º**Lambda è¡¨è¾¾å¼**çš„ç›®æ ‡ç±»å‹ã€‚**å‡½æ•°å¼æ¥å£(Functional Interface)****æ˜¯ä¸€ä¸ª****æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•å£°æ˜**çš„**æ¥å£**ã€‚ä»»æ„åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨æ¥åšæˆLambdaè¡¨è¾¾å¼ã€‚æ¯ä¸ªä¸ä¹‹å¯¹åº”çš„lambdaè¡¨è¾¾å¼å¿…é¡»è¦ä¸æŠ½è±¡æ–¹æ³•çš„å£°æ˜ç›¸åŒ¹é…ã€‚å‡½æ•°å¼æ¥å£ä¸å…¶ä»–æ™®é€šæ¥å£çš„åŒºåˆ«ï¼š\n\n- å‡½æ•°å¼æ¥å£ä¸­**åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•**ï¼ˆè¿™é‡Œä¸åŒ…æ‹¬ä¸Objectçš„æ–¹æ³•é‡åçš„æ–¹æ³•ï¼‰\n- æ¥å£ä¸­å”¯ä¸€æŠ½è±¡æ–¹æ³•çš„å‘½åå¹¶ä¸é‡è¦ï¼Œå› ä¸ºå‡½æ•°å¼æ¥å£å°±æ˜¯å¯¹æŸä¸€è¡Œä¸ºè¿›è¡ŒæŠ½è±¡ï¼Œä¸»è¦ç›®çš„å°±æ˜¯æ”¯æŒ Lambda è¡¨è¾¾å¼\n- è‡ªå®šä¹‰å‡½æ•°å¼æ¥å£æ—¶ï¼Œåº”å½“åœ¨æ¥å£å‰åŠ ä¸Š**@FunctionalInterface**æ ‡æ³¨ï¼ˆè™½ç„¶ä¸åŠ ä¹Ÿä¸ä¼šæœ‰é”™è¯¯ï¼‰ã€‚ç¼–è¯‘å™¨ä¼šæ³¨æ„åˆ°è¿™ä¸ªæ ‡æ³¨ï¼Œå¦‚æœä½ çš„æ¥å£ä¸­å®šä¹‰äº†ç¬¬äºŒä¸ªæŠ½è±¡æ–¹æ³•çš„è¯ï¼Œç¼–è¯‘å™¨ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\n\n## å‡½æ•°å¼ç¼–ç¨‹\n\n\n> Javaæ¥è®²ï¼Œä»å‘½ä»¤å¼ç¼–ç¨‹åˆ°å‡½æ•°å¼ç¼–ç¨‹çš„å…³é”®è½¬å˜æ˜¯ä»Java8å¤šäº†ä¸€ä¸ªfuntcionåŒ…å¼€å§‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šçš„streamæ›´å¥½çš„è¯ é‡Šäº†è¿™ä¸€ç‚¹ï¼Œè€Œä¹‹åjava 9 çš„reactorï¼Œå†åˆ°spring5çš„webfluxéƒ½æ˜¯åœ¨å…¶åŸºç¡€ä¸Šä¸€æ­¥æ­¥æ¼”å˜çš„\n\n\n### java.util.function\n\n\n![](https://pic3.zhimg.com/80/v2-aae13ab98b68ec811e4efa2808b499ae_1440w.jpg)\n\n\n```text\n        Function<T, R> stringIntegerFunction //è¾“å…¥Tè¿”å›Rçš„å‡½æ•°\n        Predicate<T> predicate //è¾“å…¥Tï¼Œè¿”å›booleanå€¼ï¼Œæ–­è¨€ï¼ˆè°“è¯ï¼‰å‡½æ•°\n        Consumer<T> consumer; //æ¶ˆè´¹è€…å‡½æ•°ï¼Œæ¶ˆè´¹ä¸€ä¸ªæ•°æ®\n        Supplier<T> supplier; // ç”Ÿäº§è€…å‡½æ•°ï¼Œæä¾›æ•°æ®\n\n```\n\n\n### Function\n\n\n```text\n    /**\n     * å°†èŒƒå‹Tå¯¹è±¡åº”ç”¨åˆ°è¾“å…¥çš„å‚æ•°ä¸Šï¼Œç„¶åè¿”å›è®¡ç®—ç»“æœ\n     *\n     * @param t the function argument\n     * @return the function result\n     */\n    R apply(T t);\n\n   /**\n     *  è¿”å›ä¸€ä¸ªå…ˆæ‰§è¡Œbeforeå‡½æ•°å¯¹è±¡applyæ–¹æ³•å†æ‰§è¡Œå½“å‰å‡½æ•°å¯¹è±¡applyæ–¹æ³•çš„å‡½æ•°å¯¹è±¡\n     *\n     * @param <V> å‰ç½®å‡½æ•°çš„çš„è¾“å…¥ç±»å‹ï¼Œä»¥åŠå‡½æ•°çš„è¾“å…¥ç±»å‹ ç”±å‡½æ•°\n     *\n     */\n    default <V> Function<V, R> compose(Function<? super V, ? extends T> before) {\n        Objects.requireNonNull(before);\n        return (V v) -> apply(before.apply(v));\n    }\n\n\n  /**\n    * è¿”å›ä¸€ä¸ªå…ˆæ‰§è¡Œå½“å‰å‡½æ•°å¯¹è±¡applyæ–¹æ³•å†æ‰§è¡Œafterå‡½æ•°å¯¹è±¡applyæ–¹æ³•çš„å‡½æ•°å¯¹è±¡ã€‚\n    *  <br>\n    *    compose å’Œ andThen çš„ä¸åŒä¹‹å¤„æ˜¯å‡½æ•°æ‰§è¡Œçš„é¡ºåºä¸åŒã€‚compose å‡½æ•°å…ˆæ‰§è¡Œå‚æ•°ï¼Œ\n    *     ç„¶åæ‰§è¡Œè°ƒç”¨è€…ï¼Œè€Œ andThen å…ˆæ‰§è¡Œè°ƒç”¨è€…ï¼Œç„¶åå†æ‰§è¡Œå‚æ•°ã€‚\n    *  </br>\n    */\n   default <V> Function<T, V> andThen(Function<? super R, ? extends V> after) {\n        Objects.requireNonNull(after);\n        return (T t) -> after.apply(apply(t));\n    }\n\n   /**\n     *  è¿”å›è¾“å…¥ç»“æœ\n     */\n    static <T> Function<T, T> identity() {\n        return t -> t;\n    }\n\n```\n\n\n> æ ‡æ³¨ä¸ºFunctionalInterfaceçš„æ¥å£è¢«ç§°ä¸ºå‡½æ•°å¼æ¥å£ï¼Œè¯¥æ¥å£åªèƒ½æœ‰ä¸€ä¸ªè‡ªå®šä¹‰æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥åŒ…æ‹¬ä»objectç±»ç»§æ‰¿è€Œæ¥çš„æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šè®¤ä¸ºè¿™å°±æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚\n\n\n**æ˜¯å¦æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œéœ€è¦æ³¨æ„çš„æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š**\n\n- è¯¥æ³¨è§£åªèƒ½æ ‡è®°åœ¨â€æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•â€çš„æ¥å£ä¸Šã€‚\n- JDK8æ¥å£ä¸­çš„é™æ€æ–¹æ³•å’Œé»˜è®¤æ–¹æ³•ï¼Œéƒ½ä¸ç®—æ˜¯æŠ½è±¡æ–¹æ³•ã€‚\n- æ¥å£é»˜è®¤ç»§æ‰¿java.lang.Objectï¼Œæ‰€ä»¥å¦‚æœæ¥å£æ˜¾ç¤ºå£°æ˜è¦†ç›–äº†Objectä¸­æ–¹æ³•ï¼Œé‚£ä¹ˆä¹Ÿä¸ç®—æŠ½è±¡æ–¹æ³•ã€‚\n- è¯¥æ³¨è§£ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä¸€ä¸ªæ¥å£ç¬¦åˆâ€å‡½æ•°å¼æ¥å£â€å®šä¹‰ï¼Œé‚£ä¹ˆåŠ ä¸åŠ è¯¥æ³¨è§£éƒ½æ²¡æœ‰å½±å“ã€‚åŠ ä¸Šè¯¥æ³¨è§£èƒ½å¤Ÿæ›´å¥½åœ°è®©ç¼–è¯‘å™¨è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœç¼–å†™çš„ä¸æ˜¯å‡½æ•°å¼æ¥å£ï¼Œä½†æ˜¯åŠ ä¸Šäº†@FunctionInterfaceï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚\n- åœ¨ä¸€ä¸ªæ¥å£ä¸­å®šä¹‰ä¸¤ä¸ªè‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œå°±ä¼šäº§ç”ŸInvalid â€˜@FunctionalInterfaceâ€™ annotation; FunctionalInterfaceTest is not a functional interfaceé”™è¯¯.\n\n## å“åº”å¼\n\n\n> å“åº”å¼æµ(Reactive Streams)é€šè¿‡å®šä¹‰ä¸€ç»„å®ä½“ï¼Œæ¥å£å’Œäº’æ“ä½œæ–¹æ³•ï¼Œç»™å‡ºäº†å®ç°å¼‚æ­¥éé˜»å¡èƒŒå‹çš„æ ‡å‡†ã€‚ç¬¬ä¸‰æ–¹éµå¾ªè¿™ä¸ªæ ‡å‡†æ¥å®ç°å…·ä½“çš„è§£å†³æ–¹æ¡ˆï¼Œå¸¸è§çš„æœ‰Reactorï¼ŒRxJavaï¼ŒAkka Streamsï¼ŒRatpackç­‰ã€‚\n\n\nå“åº”å¼ç¼–ç¨‹ï¼ˆreactive programmingï¼‰æ˜¯ä¸€ç§åŸºäºæ•°æ®æµï¼ˆdata streamï¼‰å’Œå˜åŒ–ä¼ é€’ï¼ˆpropagation of changeï¼‰çš„å£°æ˜å¼ï¼ˆdeclarativeï¼‰çš„ç¼–ç¨‹èŒƒå¼\n\n\nä¸€ä¸ªé€šç”¨çš„æµå¤„ç†æ¶æ„ä¸€èˆ¬ä¼šæ˜¯è¿™æ ·çš„ï¼ˆ**ç”Ÿäº§è€…äº§ç”Ÿæ•°æ®ï¼Œå¯¹æ•°æ®è¿›è¡Œä¸­é—´å¤„ç†ï¼Œæ¶ˆè´¹è€…æ‹¿åˆ°æ•°æ®æ¶ˆè´¹**)\n\n\n![](https://pic4.zhimg.com/80/v2-edb2811ded51ed4de4de5656b057fc07_1440w.png)\n\n- æ•°æ®æ¥æºï¼Œä¸€èˆ¬ç§°ä¸ºç”Ÿäº§è€…ï¼ˆProducerï¼‰\n- æ•°æ®çš„ç›®çš„åœ°ï¼Œä¸€èˆ¬ç§°ä¸ºæ¶ˆè´¹è€…(Consumer)\n- åœ¨å¤„ç†æ—¶ï¼Œå¯¹æ•°æ®æ‰§è¡ŒæŸäº›æ“ä½œä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†é˜¶æ®µã€‚ï¼ˆProcessor)\n\nè§„èŒƒå®šä¹‰äº†4ä¸ªæ¥å£\n\n\n![](https://pic4.zhimg.com/80/v2-d235427992d3feb5e49bcf2b210ba5eb_1440w.jpg)\n\n\nåœ¨å“åº”å¼æµä¸Šæåˆ°äº†back pressureï¼ˆèƒŒå‹ï¼‰è¿™ä¹ˆä¸€ä¸ªæ¦‚å¿µã€‚åœ¨å“åº”å¼æµå®ç°å¼‚æ­¥éé˜»å¡æ˜¯åŸºäºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼çš„ï¼Œè€Œç”Ÿäº§è€…æ¶ˆè´¹è€…å¾ˆå®¹æ˜“å‡ºç°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼š**ç”Ÿäº§è€…ç”Ÿäº§æ•°æ®å¤šäº†ï¼Œå°±æŠŠæ¶ˆè´¹è€…ç»™å‹å®äº†**\n\n\né€šä¿—å°±æ˜¯ï¼š **æ¶ˆè´¹è€…èƒ½å‘Šè¯‰ç”Ÿäº§è€…è‡ªå·±éœ€è¦å¤šå°‘é‡çš„æ•°æ®**ã€‚è¿™é‡Œå°±æ˜¯**Subscription**æ¥å£æ‰€åšçš„äº‹\n\n\n**ç‰¹è´¨**\n\n\n[åŸæ–‡:](https://www.reactivemanifesto.org/zh-CN)[https://www.reactivemanifesto.org/zh-CN](https://www.reactivemanifesto.org/zh-CN)\n\n\n**å³æ—¶å“åº”æ€§:** ï¼šåªè¦æœ‰å¯èƒ½ï¼Œ [ç³»ç»Ÿ](https://www.reactivemanifesto.org/zh-CN/glossary#System)å°±ä¼šåŠæ—¶åœ°åšå‡ºå“åº”ã€‚ å³æ—¶å“åº”æ˜¯å¯ç”¨æ€§å’Œå®ç”¨æ€§çš„åŸºçŸ³ï¼Œ è€Œæ›´åŠ é‡è¦çš„æ˜¯ï¼Œå³æ—¶å“åº”æ„å‘³ç€å¯ä»¥å¿«é€Ÿåœ°æ£€æµ‹åˆ°é—®é¢˜å¹¶ä¸”æœ‰æ•ˆåœ°å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ å³æ—¶å“åº”çš„ç³»ç»Ÿä¸“æ³¨äºæä¾›å¿«é€Ÿè€Œä¸€è‡´çš„å“åº”æ—¶é—´ï¼Œ ç¡®ç«‹å¯é çš„åé¦ˆä¸Šé™ï¼Œ ä»¥æä¾›ä¸€è‡´çš„æœåŠ¡è´¨é‡ã€‚ è¿™ç§ä¸€è‡´çš„è¡Œä¸ºè½¬è€Œå°†ç®€åŒ–é”™è¯¯å¤„ç†ã€ å»ºç«‹æœ€ç»ˆç”¨æˆ·çš„ä¿¡ä»»å¹¶ä¿ƒä½¿ç”¨æˆ·ä¸ç³»ç»Ÿä½œè¿›ä¸€æ­¥çš„äº’åŠ¨ã€‚\n\n- *å›å¼¹æ€§ï¼š**ç³»ç»Ÿåœ¨å‡ºç°[å¤±è´¥](https://www.reactivemanifesto.org/zh-CN/glossary#Failure)æ—¶ä¾ç„¶ä¿æŒå³æ—¶å“åº”æ€§ã€‚ è¿™ä¸ä»…é€‚ç”¨äºé«˜å¯ç”¨çš„ã€ ä»»åŠ¡å…³é”®å‹ç³»ç»Ÿâ€”â€”ä»»ä½•ä¸å…·å¤‡å›å¼¹æ€§çš„ç³»ç»Ÿéƒ½å°†ä¼šåœ¨å‘ç”Ÿå¤±è´¥ä¹‹åä¸¢å¤±å³æ—¶å“åº”æ€§ã€‚ å›å¼¹æ€§æ˜¯é€šè¿‡[å¤åˆ¶](https://www.reactivemanifesto.org/zh-CN/glossary#Replication)ã€ éåˆ¶ã€ [éš”ç¦»](https://www.reactivemanifesto.org/zh-CN/glossary#Isolation)ä»¥åŠ[å§”æ‰˜](https://www.reactivemanifesto.org/zh-CN/glossary#Delegation)æ¥å®ç°çš„ã€‚ å¤±è´¥çš„æ‰©æ•£è¢«éåˆ¶åœ¨äº†æ¯ä¸ª[ç»„ä»¶](notion://www.notion.so/glossary.zh-cn.md#%E7%BB%84%E4%BB%B6)å†…éƒ¨ï¼Œ ä¸å…¶ä»–ç»„ä»¶ç›¸äº’éš”ç¦»ï¼Œ ä»è€Œç¡®ä¿ç³»ç»ŸæŸéƒ¨åˆ†çš„å¤±è´¥ä¸ä¼šå±åŠæ•´ä¸ªç³»ç»Ÿï¼Œå¹¶èƒ½ç‹¬ç«‹æ¢å¤ã€‚ æ¯ä¸ªç»„ä»¶çš„æ¢å¤éƒ½è¢«å§”æ‰˜ç»™äº†å¦ä¸€ä¸ªï¼ˆå¤–éƒ¨çš„ï¼‰ç»„ä»¶ï¼Œ æ­¤å¤–ï¼Œåœ¨å¿…è¦æ—¶å¯ä»¥é€šè¿‡å¤åˆ¶æ¥ä¿è¯é«˜å¯ç”¨æ€§ã€‚ ï¼ˆå› æ­¤ï¼‰ç»„ä»¶çš„å®¢æˆ·ç«¯ä¸å†æ‰¿æ‹…ç»„ä»¶å¤±è´¥çš„å¤„ç†ã€‚\n\n**å¼¹æ€§ï¼š** ç³»ç»Ÿåœ¨ä¸æ–­å˜åŒ–çš„å·¥ä½œè´Ÿè½½ä¹‹ä¸‹ä¾ç„¶ä¿æŒå³æ—¶å“åº”æ€§ã€‚ ååº”å¼ç³»ç»Ÿå¯ä»¥å¯¹è¾“å…¥ï¼ˆè´Ÿè½½ï¼‰çš„é€Ÿç‡å˜åŒ–åšå‡ºååº”ï¼Œæ¯”å¦‚é€šè¿‡å¢åŠ æˆ–è€…å‡å°‘è¢«åˆ†é…ç”¨äºæœåŠ¡è¿™äº›è¾“å…¥ï¼ˆè´Ÿè½½ï¼‰çš„[èµ„æº](https://www.reactivemanifesto.org/zh-CN/glossary#Resource)ã€‚ è¿™æ„å‘³ç€è®¾è®¡ä¸Šå¹¶æ²¡æœ‰äº‰ç”¨ç‚¹å’Œä¸­å¤®ç“¶é¢ˆï¼Œ å¾—ä»¥è¿›è¡Œç»„ä»¶çš„åˆ†ç‰‡æˆ–è€…å¤åˆ¶ï¼Œ å¹¶åœ¨å®ƒä»¬ä¹‹é—´åˆ†å¸ƒè¾“å…¥ï¼ˆè´Ÿè½½ï¼‰ã€‚ é€šè¿‡æä¾›ç›¸å…³çš„å®æ—¶æ€§èƒ½æŒ‡æ ‡ï¼Œ ååº”å¼ç³»ç»Ÿèƒ½æ”¯æŒé¢„æµ‹å¼ä»¥åŠååº”å¼çš„ä¼¸ç¼©ç®—æ³•ã€‚ è¿™äº›ç³»ç»Ÿå¯ä»¥åœ¨å¸¸è§„çš„ç¡¬ä»¶ä»¥åŠè½¯ä»¶å¹³å°ä¸Šå®ç°æˆæœ¬é«˜æ•ˆçš„[å¼¹æ€§](https://www.reactivemanifesto.org/zh-CN/glossary#Elasticity)[ã€‚](https://www.reactivemanifesto.org/zh-CN/glossary#Elasticity)\n\n- [*æ¶ˆæ¯é©±åŠ¨ï¼š**ååº”å¼ç³»ç»Ÿä¾èµ–](https://www.reactivemanifesto.org/zh-CN/glossary#Elasticity)[å¼‚æ­¥çš„](https://www.reactivemanifesto.org/zh-CN/glossary#Asynchronous)[æ¶ˆæ¯ä¼ é€’](https://www.reactivemanifesto.org/zh-CN/glossary#Message-Driven)ï¼Œä»è€Œç¡®ä¿äº†æ¾è€¦åˆã€éš”ç¦»ã€[ä½ç½®é€æ˜](https://www.reactivemanifesto.org/zh-CN/glossary#Location-Transparency)çš„ç»„ä»¶ä¹‹é—´æœ‰ç€æ˜ç¡®è¾¹ç•Œã€‚ è¿™ä¸€è¾¹ç•Œè¿˜æä¾›äº†å°†[å¤±è´¥](https://www.reactivemanifesto.org/zh-CN/glossary#Failure)ä½œä¸ºæ¶ˆæ¯å§”æ‰˜å‡ºå»çš„æ‰‹æ®µã€‚ ä½¿ç”¨æ˜¾å¼çš„æ¶ˆæ¯ä¼ é€’ï¼Œå¯ä»¥é€šè¿‡åœ¨ç³»ç»Ÿä¸­å¡‘é€ å¹¶ç›‘è§†æ¶ˆæ¯æµé˜Ÿåˆ—ï¼Œ å¹¶åœ¨å¿…è¦æ—¶åº”ç”¨[å›å‹](https://www.reactivemanifesto.org/zh-CN/glossary#Back-Pressure)ï¼Œ ä»è€Œå®ç°è´Ÿè½½ç®¡ç†ã€ å¼¹æ€§ä»¥åŠæµé‡æ§åˆ¶ã€‚ ä½¿ç”¨ä½ç½®é€æ˜çš„æ¶ˆæ¯ä¼ é€’ä½œä¸ºé€šä¿¡çš„æ‰‹æ®µï¼Œ ä½¿å¾—è·¨é›†ç¾¤æˆ–è€…åœ¨å•ä¸ªä¸»æœºä¸­ä½¿ç”¨ç›¸åŒçš„ç»“æ„æˆåˆ†å’Œè¯­ä¹‰æ¥ç®¡ç†å¤±è´¥æˆä¸ºäº†å¯èƒ½ã€‚ [éé˜»å¡çš„](https://www.reactivemanifesto.org/zh-CN/glossary#Non-Blocking)é€šä¿¡ä½¿å¾—æ¥æ”¶è€…å¯ä»¥åªåœ¨æ´»åŠ¨æ—¶æ‰æ¶ˆè€—[èµ„æº](https://www.reactivemanifesto.org/zh-CN/glossary#Resource)ï¼Œ ä»è€Œå‡å°‘ç³»ç»Ÿå¼€é”€ã€‚\n\n![](https://www.reactivemanifesto.org/images/reactive-traits-zh-cn.svg)\n\n\nå¤§å‹ç³»ç»Ÿç”±å¤šä¸ªè¾ƒå°å‹çš„ç³»ç»Ÿæ‰€æ„æˆï¼Œ å› æ­¤æ•´ä½“æ•ˆç”¨å–å†³äºå®ƒä»¬çš„æ„æˆéƒ¨åˆ†çš„ååº”å¼å±æ€§ã€‚ è¿™æ„å‘³ç€ï¼Œ ååº”å¼ç³»ç»Ÿåº”ç”¨ç€ä¸€äº›è®¾è®¡åŸåˆ™ï¼Œä½¿è¿™äº›å±æ€§èƒ½åœ¨æ‰€æœ‰çº§åˆ«çš„è§„æ¨¡ä¸Šç”Ÿæ•ˆï¼Œè€Œä¸”å¯ç»„åˆã€‚\n\n\n## Reactive\n\n\n[å®˜ç½‘https://projectreactor.io/docs/core/release/reference/index.html#which.windowprojectreactor.io](https://projectreactor.io/docs/core/release/reference/index.html)\n\n\nåœ¨reactorä¸­æœ‰ä¸¤ä¸ªæœ€åŸºæœ¬çš„æ¦‚å¿µï¼Œå‘å¸ƒè€…å’Œè®¢é˜…è€…ï¼Œå¯ä»¥ç†è§£ä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„æ¦‚å¿µã€‚åœ¨Reactorä¸­å‘å¸ƒè€…æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯**Flux**ï¼Œä¸€ä¸ªæ˜¯**Monoã€‚** Fluxä»£è¡¨çš„æ˜¯0-Nä¸ªå…ƒç´ çš„å“åº”å¼åºåˆ—ï¼Œè€ŒMonoä»£è¡¨çš„æ˜¯0-1ä¸ªçš„å…ƒç´ çš„ç»“æœã€‚\n\n\nåœ¨Reactiveä¸­\n\n- Publisherï¼ˆå‘å¸ƒè€…)ç›¸å½“äºç”Ÿäº§è€…(Producer)\n- Subscriber(è®¢é˜…è€…)ç›¸å½“äºæ¶ˆè´¹è€…(Consumer)\n- Processorå°±æ˜¯åœ¨å‘å¸ƒè€…ä¸è®¢é˜…è€…ä¹‹é—´å¤„ç†æ•°æ®ç”¨çš„\n\n```text\n// å‘å¸ƒè€…(ç”Ÿäº§è€…)public interface Publisher<T> {   // å¯ä»¥è¢«è®¢é˜…å¤šæ¬¡ï¼Œæ¯æ¬¡ç”Ÿæˆæ–°çš„Subscriberï¼Œæ¯ä¸ªæ¶ˆè´¹è€…åªèƒ½è®¢é˜…ä¸€æ¬¡Publisherï¼Œæ‰§è¡Œè¿‡ç¨‹å‡ºé”™ä¼šç›´æ¥æŠ¥error    public void subscribe(Subscriber<? super T> s);}// è®¢é˜…è€…(æ¶ˆè´¹è€…)public interface Subscriber<T> {   //è¯¥æ–¹æ³•åœ¨è®¢é˜…Publisherä¹‹åæ‰§è¡Œï¼Œåœ¨è®¢é˜…ä¹‹å‰ä¸ä¼šæœ‰æ•°æ®æµçš„æ¶ˆè´¹    public void onSubscribe(Subscription s);   /**     * æ¶ˆè´¹ä¸‹ä¸€ä¸ªæ¶ˆæ¯ï¼Œåœ¨æ‰§è¡Œrequestæ–¹æ³•ä¹‹åé€šçŸ¥Publisherï¼Œ     *å¯è¢«è°ƒç”¨å¤šæ¬¡ï¼Œæœ‰requestï¼ˆxï¼‰ï¼Œå‚æ•°xå†³å®šæ‰§è¡Œå‡ æ¬¡     */    public void onNext(T t);    //æ‰§è¡Œå‡ºé”™è°ƒç”¨æ–¹æ³•    public void onError(Throwable t);     //æ‰§è¡Œå®Œæˆä¹‹åè°ƒç”¨æ–¹æ³•    public void onComplete();}// ç”¨äºå‘å¸ƒè€…ä¸è®¢é˜…è€…ä¹‹é—´çš„é€šä¿¡(å®ç°èƒŒå‹ï¼šè®¢é˜…è€…èƒ½å¤Ÿå‘Šè¯‰ç”Ÿäº§è€…éœ€è¦å¤šå°‘æ•°æ®)public interface Subscription {    \t//æ¶ˆè´¹è¯·æ±‚    public void request(long n);       //å–æ¶ˆè¯·æ±‚    public void cancel();}// ç”¨äºå¤„ç†å‘å¸ƒè€… å‘å¸ƒæ¶ˆæ¯åï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå†äº¤ç”±æ¶ˆè´¹è€…æ¶ˆè´¹public interface Processor<T,R> extends Subscriber<T>, Publisher<R> {}\n\n```\n\n\n### **Mono** (è¿”å›0æˆ–1ä¸ªå…ƒç´ )\n\n\nMono æ˜¯å“åº”æµ Publisher å…·æœ‰åŸºç¡€ rx æ“ä½œç¬¦ã€‚å¯ä»¥æˆåŠŸå‘å¸ƒå…ƒç´ æˆ–è€…é”™è¯¯ã€‚å¦‚å›¾æ‰€ç¤ºï¼š\n\n\n![](https:////upload-images.jianshu.io/upload_images/1483536-03c853fb59816f3a.png)\n\n\n### å¸¸ç”¨æ–¹æ³•\n\n\n```text\nMono.create(); //ï¼šä½¿ç”¨ MonoSink æ¥åˆ›å»º MonoMono.justOrEmpty(); //ï¼šä»ä¸€ä¸ª Optional å¯¹è±¡æˆ– null å¯¹è±¡ä¸­åˆ›å»º Monoã€‚ åªæœ‰ Optional å¯¹è±¡ä¸­åŒ…å«å€¼æˆ–å¯¹è±¡ä¸ä¸º null æ—¶ï¼ŒMono åºåˆ—æ‰äº§ç”Ÿå¯¹åº”çš„å…ƒç´ ã€‚Mono.error(); //ï¼šåˆ›å»ºä¸€ä¸ªåªåŒ…å«é”™è¯¯æ¶ˆæ¯çš„ MonoMono.never(); //ï¼šåˆ›å»ºä¸€ä¸ªä¸åŒ…å«ä»»ä½•æ¶ˆæ¯é€šçŸ¥çš„ MonoMono.delay(); //ï¼šåœ¨æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´ä¹‹åï¼Œåˆ›å»ºä¸€ä¸ª Monoï¼Œäº§ç”Ÿæ•°å­— 0 ä½œä¸ºå”¯ä¸€å€¼Mono.just(); //åˆ›å»ºä¸€ä¸ªä¸ä¸ºnullçš„æ•°æ®æµ å£°æ˜çš„å‚æ•°å°±æ˜¯æ•°æ®æµçš„å…ƒç´  åˆ›å»ºå‡ºæ¥çš„ Monoåºåˆ—åœ¨å‘å¸ƒè¿™äº›å…ƒç´ ä¹‹åä¼šè‡ªåŠ¨ç»“æŸ/**æ³¨é‡ŠåŒä¸‹*/Mono.fromCallable(); // ä»å›è°ƒå‡½æ•°ç”Ÿäº§æ•°æ® CallableMono.fromCompletionStage(); //å¼‚æ­¥ä»»åŠ¡ä¸­ CompletionStage Mono.fromFuture(); //å¼‚æ­¥ä»»åŠ¡ä¸­ CompletableFutureMono.fromRunnable(); // å¼‚æ­¥ä»»åŠ¡ RunnableMono.fromSupplier()ï¼š//Supplier æä¾›ç€\n\n```\n\n\n### *Flux **(è¿”å›0-nä¸ªå…ƒç´ )\n\n\nFlux æ˜¯å“åº”æµ Publisher å…·æœ‰åŸºç¡€ rx æ“ä½œç¬¦ã€‚å¯ä»¥æˆåŠŸå‘å¸ƒ 0 åˆ° N ä¸ªå…ƒç´ æˆ–è€…é”™è¯¯ã€‚Flux å…¶å®æ˜¯ Mono çš„ä¸€ä¸ªè¡¥å……ã€‚å¦‚å›¾æ‰€ç¤ºï¼š\n\n\n![](https:////upload-images.jianshu.io/upload_images/1483536-55fd0aeaaea2d023.png)\n\n\næ‰€ä»¥è¦æ³¨æ„ï¼šå¦‚æœçŸ¥é“ Publisher æ˜¯ 0 æˆ– 1 ä¸ªï¼Œåˆ™ç”¨ Monoã€‚\n\n\nFlux æœ€å€¼å¾—ä¸€æçš„æ˜¯ fromIterable æ–¹æ³•ã€‚   fromIterable(Iterable<? extends T> it)  å¯ä»¥å‘å¸ƒ Iterable ç±»å‹çš„å…ƒç´ ã€‚\n\n\n![](https://pic1.zhimg.com/80/v2-a72c1db9d5564ae6e47ec22ad3e6b7f0_1440w.jpg)\n\n\nå½“è°ƒç”¨justæ–¹æ³•ï¼ŒæŸ¥çœ‹æºç å¯ä»¥å¾—çŸ¥ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªFlux<T>å¯¹è±¡ï¼Œå½“æ¬¡æ•°ä¸º0ç›´æ¥è¿”å›ç©ºï¼Œä¸º1 çš„æ—¶å€™å•ç‹¬å¤„ç†ï¼Œå…¶ä½™çš„é€šè¿‡_onAssemblyæ–¹æ³•å¤„ç†è¿”å›fluxarraryå¯¹è±¡ã€‚_\n\n\n```text\n\t/**\t * Create a {@link Flux} that emits the items contained in the provided array.\t * <p>\t * <img class=\"marble\" src=\"doc-files/marbles/fromArray.svg\" alt=\"\">\t *\t * @param array the array to read data from\t * @param <T> The type of values in the source array and resulting Flux\t *\t * @return a new {@link Flux}\t */\tpublic static <T> Flux<T> fromArray(T[] array) {\t\tif (array.length == 0) {\t\t\treturn empty();\t\t}\t\tif (array.length == 1) {\t\t\treturn just(array[0]);\t\t}\t\treturn onAssembly(new FluxArray<>(array));\t}final class FluxArray<T> extends Flux<T> implements Fuseable, SourceProducer<T> {\tfinal T[] array; //å­˜å‚¨æ•°æ®\t@SafeVarargs\tpublic FluxArray(T... array) {\t\tthis.array = Objects.requireNonNull(array, \"array\");\t}\t@SuppressWarnings(\"unchecked\")        //è®¢é˜…æ–¹æ³•\tpublic static <T> void subscribe(CoreSubscriber<? super T> s, T[] array) {\t\tif (array.length == 0) {\t\t\tOperators.complete(s);\t\t\treturn;\t\t}\t\tif (s instanceof ConditionalSubscriber) {      // æ­¤å¤„æ˜¯ä¸ªå•¥ï¼Ÿ\t\t\ts.onSubscribe(new ArrayConditionalSubscription<>((ConditionalSubscriber<? super T>) s, array));\t\t}\t\telse {\t\t\ts.onSubscribe(new ArraySubscription<>(s, array));\t\t}\t}      // æ­£å¸¸æ¶ˆè´¹è€…  static final class ArraySubscription<T>\t\t\timplements InnerProducer<T>, SynchronousSubscription<T> {\t\tfinal CoreSubscriber<? super T> actual;\t\tfinal T[] array; //å­˜å‚¨æ•°æ®\t\tint index;\t\tvolatile boolean cancelled; //è®°å½•æ˜¯å¦å–æ¶ˆ\t\tvolatile long requested; //è®°å½•è¯·æ±‚å¤šå°‘æ¬¡\t\t@SuppressWarnings(\"rawtypes\")\t\tstatic final AtomicLongFieldUpdater<ArraySubscription> REQUESTED =\t\t\t\tAtomicLongFieldUpdater.newUpdater(ArraySubscription.class, \"requested\");\t\tArraySubscription(CoreSubscriber<? super T> actual, T[] array) {\t\t\tthis.actual = actual;\t\t\tthis.array = array;\t\t}\t\t@Override\t\tpublic void request(long n) {\t\t\tif (Operators.validate(n)) {\t\t\t\tif (Operators.addCap(REQUESTED, this, n) == 0) {\t\t\t\t\tif (n == Long.MAX_VALUE) {\t\t\t\t\t\tfastPath();\t\t\t\t\t}\t\t\t\t\telse {\t\t\t\t\t\tslowPath(n);\t\t\t\t\t}\t\t\t\t}\t\t\t}\t\t}\n\n```\n\n\næµç¨‹\n\n\n![](https://pic3.zhimg.com/80/v2-feadef87bacc918580803b777a21e042_1440w.jpg)\n\n\n### å†…ç½®çš„ Processor\n\n\n`Processor`æ—¢æ˜¯ä¸€ç§ç‰¹åˆ«çš„å‘å¸ƒè€…ï¼ˆ`Publisher`ï¼‰åˆæ˜¯ä¸€ç§è®¢é˜…è€…ï¼ˆ`Subscriber`ï¼‰ã€‚ æ‰€ä»¥ä½ èƒ½å¤Ÿè®¢é˜…ä¸€ä¸ª`Processor`ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨å®ƒä»¬æä¾›çš„æ–¹æ³•æ¥æ‰‹åŠ¨æ’å…¥æ•°æ®åˆ°åºåˆ—ï¼Œæˆ–ç»ˆæ­¢åºåˆ—ã€‚\n\n\n> ä¸€ç›´åœ¨èŠå“åº”å¼æµçš„å››ä¸ªæ¥å£ä¸­çš„ä¸‰ä¸ªï¼šPublisherã€Subscriberã€Subscriptionï¼Œå”¯ç‹¬Processorè¿Ÿè¿Ÿæ²¡æœ‰æåŠã€‚åŸå› åœ¨äºæƒ³ç”¨å¥½å®ƒä»¬ä¸å¤ªå®¹æ˜“ï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥è¿›è¡Œé¿å…ä½¿ç”¨Processorï¼Œé€šå¸¸æ¥è¯´ä»…ç”¨äºä¸€äº›ç‰¹æ®Šåœºæ™¯ã€‚\n\n\n`Reactor Core` å†…ç½®å¤šç§ `Processor`ã€‚è¿™äº› processor å…·æœ‰ä¸åŒçš„è¯­æ³•ï¼Œå¤§æ¦‚åˆ†ä¸ºä¸‰ç±»ã€‚\n\n- **ç›´æ¥çš„ï¼ˆdirectï¼‰**ï¼ˆDirectProcessor å’Œ UnicastProcessorï¼‰ï¼šè¿™äº› processors åªèƒ½é€šè¿‡ç›´æ¥ è°ƒç”¨ Sink çš„æ–¹æ³•æ¥æ¨é€æ•°æ®ã€‚\n- **åŒæ­¥çš„ï¼ˆsynchronousï¼‰**ï¼ˆEmitterProcessor å’Œ ReplayProcessorï¼‰ï¼šè¿™äº› processors æ—¢å¯ä»¥ç›´æ¥è°ƒç”¨ Sink æ–¹æ³•æ¥æ¨é€æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¢é˜…åˆ°ä¸€ä¸ªä¸Šæ¸¸çš„å‘å¸ƒè€…æ¥åŒæ­¥åœ°äº§ç”Ÿæ•°æ®ã€‚\n- **å¼‚æ­¥çš„ï¼ˆasynchronousï¼‰**ï¼ˆWorkQueueProcessor å’Œ TopicProcessorï¼‰ï¼šè¿™äº› processors å¯ä»¥å°†ä»å¤šä¸ªä¸Šæ¸¸å‘å¸ƒè€…å¾—åˆ°çš„æ•°æ®æ¨é€ä¸‹å»ã€‚ç”±äºä½¿ç”¨äº† RingBuffer çš„æ•°æ®ç»“æ„æ¥ç¼“å­˜å¤šä¸ªæ¥è‡ªä¸Šæ¸¸çš„æ•°æ®ï¼Œå› æ­¤æ›´åŠ æœ‰å¥å£®æ€§ã€‚\n\nå¼‚æ­¥çš„ processor åœ¨å®ä¾‹åŒ–çš„æ—¶å€™æœ€å¤æ‚ï¼Œå› ä¸ºæœ‰è®¸å¤šä¸åŒçš„é€‰é¡¹ã€‚å› æ­¤å®ƒä»¬æš´éœ²å‡ºä¸€ä¸ª Builder æ¥å£ã€‚ è€Œç®€å•çš„ processors æœ‰é™æ€çš„å·¥å‚æ–¹æ³•ã€‚\n\n\n### DirectProcessor\n\n\n       `DirectProcessor` å¯ä»¥å°†ä¿¡å·åˆ†å‘ç»™é›¶åˆ°å¤šä¸ªè®¢é˜…è€…ï¼ˆSubscriberï¼‰ã€‚å®ƒæ˜¯æœ€å®¹æ˜“å®ä¾‹åŒ–çš„ï¼Œä½¿ç”¨é™æ€æ–¹æ³• create() å³å¯ã€‚å¦ä¸€æ–¹é¢ï¼Œå®ƒçš„ä¸è¶³æ˜¯æ— æ³•å¤„ç†èƒŒå‹ã€‚æ‰€ä»¥ï¼Œå½“DirectProcessoræ¨é€çš„æ˜¯ N ä¸ªå…ƒç´ ï¼Œè€Œè‡³å°‘æœ‰ä¸€ä¸ªè®¢é˜…è€…çš„è¯·æ±‚ä¸ªæ•°å°‘äº N çš„æ—¶å€™ï¼Œå°±ä¼šå‘å‡ºä¸€ä¸ªIllegalStateExceptionã€‚\n\n\nä¸€æ—¦ Processor ç»“æŸï¼ˆé€šå¸¸é€šè¿‡è°ƒç”¨å®ƒçš„ Sink çš„ error(Throwable) æˆ– complete() æ–¹æ³•ï¼‰ï¼Œ è™½ç„¶å®ƒå…è®¸æ›´å¤šçš„è®¢é˜…è€…è®¢é˜…å®ƒï¼Œä½†æ˜¯ä¼šç«‹å³å‘å®ƒä»¬é‡æ–°å‘é€ç»ˆæ­¢ä¿¡å·ã€‚\n\n\n### UnicastProcessor\n\n\n     `UnicastProcessor`å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå†…ç½®çš„ç¼“å­˜æ¥å¤„ç†èƒŒå‹ã€‚ä»£ä»·å°±æ˜¯å®ƒæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…ï¼ˆä¸Šä¸€èŠ‚çš„ä¾‹å­é€šè¿‡publishè½¬æ¢æˆäº†ConnectableFluxï¼Œæ‰€ä»¥å¯ä»¥æ¥å…¥ä¸¤ä¸ªè®¢é˜…è€…ï¼‰ã€‚\n\n\n> UnicastProcessoræœ‰å¤šç§é€‰é¡¹ï¼Œå› æ­¤æä¾›å¤šç§ä¸åŒçš„createé™æ€æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå®ƒé»˜è®¤æ˜¯ æ— é™çš„ï¼ˆunboundedï¼‰ ï¼šå¦‚æœä½ åœ¨åœ¨è®¢é˜…è€…è¿˜æ²¡æœ‰è¯·æ±‚æ•°æ®çš„æƒ…å†µä¸‹è®©å®ƒæ¨é€æ•°æ®ï¼Œå®ƒä¼šç¼“å­˜æ‰€æœ‰æ•°æ®ã€‚\n\n\n\tå¯ä»¥é€šè¿‡æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„ Queue çš„å…·ä½“å®ç°ä¼ é€’ç»™ create å·¥å‚æ–¹æ³•æ¥æ”¹å˜é»˜è®¤è¡Œä¸ºã€‚å¦‚æœç»™å‡ºçš„é˜Ÿåˆ—æ˜¯æœ‰é™çš„ï¼ˆboundedï¼‰ï¼Œ å¹¶ä¸”ç¼“å­˜å·²æ»¡ï¼Œè€Œä¸”æœªæ”¶åˆ°ä¸‹æ¸¸çš„è¯·æ±‚ï¼Œprocessor ä¼šæ‹’ç»æ¨é€æ•°æ®ã€‚\n\n\nåœ¨â€œæœ‰é™çš„â€é˜Ÿåˆ—ä¸­ï¼Œè¿˜å¯ä»¥åœ¨æ„é€  processor çš„æ—¶å€™æä¾›ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œè¿™ä¸ªå›è°ƒæ–¹æ³•å¯ä»¥åœ¨æ¯ä¸€ä¸ª è¢«æ‹’ç»æ¨é€çš„å…ƒç´ ä¸Šè°ƒç”¨ï¼Œä»è€Œè®©å¼€å‘è€…æœ‰æœºä¼šæ¸…ç†è¿™äº›å…ƒç´ ã€‚\n\n\n### EmitterProcessor\n\n\n    `EmitterProcessor`èƒ½å¤Ÿå‘å¤šä¸ªè®¢é˜…è€…å‘é€æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥å¯¹æ¯ä¸€ä¸ªè®¢é˜…è€…è¿›è¡ŒèƒŒå‹å¤„ç†ã€‚å®ƒæœ¬èº«ä¹Ÿå¯ä»¥è®¢é˜…ä¸€ä¸ªå‘å¸ƒè€…å¹¶åŒæ­¥è·å¾—æ•°æ®ã€‚\n\n\n       æœ€åˆå¦‚æœæ²¡æœ‰è®¢é˜…è€…ï¼Œå®ƒä»ç„¶å…è®¸æ¨é€ä¸€äº›æ•°æ®åˆ°ç¼“å­˜ï¼Œç¼“å­˜å¤§å°ç”±bufferSizeå®šä¹‰ã€‚ ä¹‹åå¦‚æœä»ç„¶æ²¡æœ‰è®¢é˜…è€…è®¢é˜…å®ƒå¹¶æ¶ˆè´¹æ•°æ®ï¼Œå¯¹onNextçš„è°ƒç”¨ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰è®¢é˜…è€…æ¥å…¥ ï¼ˆè¿™æ—¶åªèƒ½å¹¶å‘åœ°è®¢é˜…äº†ï¼‰ã€‚\n\n\n> å› æ­¤ç¬¬ä¸€ä¸ªè®¢é˜…è€…ä¼šæ”¶åˆ°æœ€å¤šbufferSizeä¸ªå…ƒç´ ã€‚ç„¶è€Œä¹‹åï¼Œåç»­æ¥å…¥çš„è®¢é˜…è€…åªèƒ½è·å–åˆ°å®ƒä»¬å¼€å§‹è®¢é˜…ä¹‹åæ¨é€çš„æ•°æ®ã€‚è¿™ä¸ªå†…éƒ¨çš„ç¼“å­˜ä¼šç»§ç»­ç”¨äºèƒŒå‹çš„ç›®çš„ã€‚\n\n\n**é»˜è®¤æƒ…å†µä¸‹**ï¼Œå¦‚æœæ‰€æœ‰çš„è®¢é˜…è€…éƒ½å–æ¶ˆäº†è®¢é˜…ï¼Œå®ƒä¼šæ¸…ç©ºå†…éƒ¨ç¼“å­˜ï¼Œå¹¶ä¸”ä¸å†æ¥å—æ›´å¤šçš„è®¢é˜…è€…ã€‚è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡ create é™æ€å·¥å‚æ–¹æ³•çš„ autoCancel å‚æ•°æ¥é…ç½®ã€‚\n\n\n### ReplayProcessor\n\n\n`ReplayProcessor`ä¼šç¼“å­˜ç›´æ¥é€šè¿‡è‡ªèº«çš„ Sink æ¨é€çš„å…ƒç´ ï¼Œä»¥åŠæ¥è‡ªä¸Šæ¸¸å‘å¸ƒè€…çš„å…ƒç´ ï¼Œ å¹¶ä¸”åæ¥çš„è®¢é˜…è€…ä¹Ÿä¼šæ”¶åˆ°é‡å‘ï¼ˆreplayï¼‰çš„è¿™äº›å…ƒç´ ã€‚\n\n\nå¯ä»¥é€šè¿‡å¤šç§é…ç½®æ–¹å¼åˆ›å»ºå®ƒï¼š\n\n- ç¼“å­˜ä¸€ä¸ªå…ƒç´ ï¼ˆcacheLastï¼‰ã€‚\n- ç¼“å­˜ä¸€å®šä¸ªæ•°çš„å†å²å…ƒç´ ï¼ˆcreate(int)ï¼‰ï¼Œæ‰€æœ‰çš„å†å²å…ƒç´ ï¼ˆcreate()ï¼‰ã€‚\n- ç¼“å­˜åŸºäºæ—¶é—´çª—æœŸé—´å†…çš„å…ƒç´ ï¼ˆcreateTimeout(Duration)ï¼‰ã€‚\n- ç¼“å­˜åŸºäºå†å²ä¸ªæ•°å’Œæ—¶é—´çª—çš„å…ƒç´ ï¼ˆcreateSizeOrTimeout(int, Duration)ï¼‰ã€‚\n\n### TopicProcessor\n\n\n     TopicProcessoræ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ processorï¼Œå®ƒèƒ½å¤Ÿé‡å‘æ¥è‡ªå¤šä¸ªä¸Šæ¸¸å‘å¸ƒè€…çš„å…ƒç´ ï¼Œ è¿™éœ€è¦åœ¨åˆ›å»ºå®ƒçš„æ—¶å€™é…ç½®sharedï¼ˆbuild() çš„ share(boolean) é…ç½®ï¼‰ã€‚\n\n\n> å¦‚æœä½ ä¼å›¾åœ¨å¹¶å‘ç¯å¢ƒä¸‹é€šè¿‡å¹¶å‘çš„ä¸Šæ¸¸å‘å¸ƒè€…è°ƒç”¨TopicProcessorçš„onNextã€ onCompleteï¼Œæˆ–onErroræ–¹æ³•ï¼Œå°±å¿…é¡»é…ç½®sharedã€‚å¦åˆ™ï¼Œå¹¶å‘è°ƒç”¨å°±æ˜¯éæ³•çš„ï¼Œä»è€Œ processor æ˜¯å®Œå…¨å…¼å®¹å“åº”å¼æµè§„èŒƒçš„ã€‚\n\n\n**TopicProcessorèƒ½å¤Ÿå¯¹å¤šä¸ªè®¢é˜…è€…å‘é€æ•°æ®**ã€‚å®ƒé€šè¿‡å¯¹æ¯ä¸€ä¸ªè®¢é˜…è€…å…³è”ä¸€ä¸ªçº¿ç¨‹æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œ è¿™ä¸ªçº¿ç¨‹ä¼šä¸€ç›´æ‰§è¡Œç›´åˆ° processor å‘å‡ºonErroræˆ–onCompleteä¿¡å·ï¼Œæˆ–å…³è”çš„è®¢é˜…è€…è¢«å–æ¶ˆã€‚ æœ€å¤šå¯ä»¥æ¥å—çš„è®¢é˜…è€…ä¸ªæ•°ç”±æ„é€ è€…æ–¹æ³•executoræŒ‡å®šï¼Œé€šè¿‡æä¾›ä¸€ä¸ªæœ‰é™çº¿ç¨‹æ•°çš„ ExecutorServiceæ¥é™åˆ¶è¿™ä¸€ä¸ªæ•°ã€‚\n\n\nè¿™ä¸ª processor åŸºäºä¸€ä¸ªRingBufferæ•°æ®ç»“æ„æ¥å­˜å‚¨å·²å‘é€çš„æ•°æ®ã€‚æ¯ä¸€ä¸ªè®¢é˜…è€…çº¿ç¨‹ è‡ªè¡Œç®¡ç†å…¶ç›¸å…³çš„æ•°æ®åœ¨RingBufferä¸­çš„ç´¢å¼•ã€‚\n\n\nè¿™ä¸ª processor ä¹Ÿæœ‰ä¸€ä¸ªautoCancelæ„é€ å™¨æ–¹æ³•ï¼šå¦‚æœè®¾ç½®ä¸ºtrueï¼ˆé»˜è®¤çš„ï¼‰ï¼Œé‚£ä¹ˆå½“ æ‰€æœ‰çš„è®¢é˜…è€…å–æ¶ˆä¹‹åï¼Œä¸Šæ¸¸å‘å¸ƒè€…ä¹Ÿå°±è¢«å–æ¶ˆäº†ã€‚\n\n\n### WorkQueueProcessor\n\n\n    WorkQueueProcessorä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ processorï¼Œä¹Ÿèƒ½å¤Ÿé‡å‘æ¥è‡ªå¤šä¸ªä¸Šæ¸¸å‘å¸ƒè€…çš„å…ƒç´ ï¼Œ åŒæ ·åœ¨åˆ›å»ºæ—¶éœ€è¦é…ç½®sharedï¼ˆå®ƒå¤šæ•°æ„é€ å™¨é…ç½®ä¸TopicProcessorç›¸åŒï¼‰ã€‚\n\n\n> å®ƒæ”¾æ¾äº†å¯¹å“åº”å¼æµè§„èŒƒçš„å…¼å®¹ï¼Œä½†æ˜¯å¥½å¤„å°±åœ¨äºç›¸å¯¹äºTopicProcessoræ¥è¯´éœ€è¦æ›´å°‘çš„èµ„æºã€‚ å®ƒä»ç„¶åŸºäºRingBufferï¼Œä½†æ˜¯ä¸å†è¦æ±‚æ¯ä¸€ä¸ªè®¢é˜…è€…éƒ½å…³è”ä¸€ä¸ªçº¿ç¨‹ï¼Œå› æ­¤ç›¸å¯¹äºTopicProcessoræ¥è¯´æ›´å…·æ‰©å±•æ€§ã€‚\n\n\n\t    ä»£ä»·åœ¨äºåˆ†å‘æ¨¡å¼æœ‰äº›åŒºåˆ«ï¼šæ¥è‡ªè®¢é˜…è€…çš„è¯·æ±‚ä¼šæ±‡æ€»åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”è¿™ä¸ª processor æ¯æ¬¡åªå¯¹ä¸€ä¸ª è®¢é˜…è€…å‘é€æ•°æ®ï¼Œå› æ­¤éœ€è¦å¾ªç¯ï¼ˆround-robinï¼‰å¯¹è®¢é˜…è€…å‘é€æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡å…¨éƒ¨å‘å‡ºçš„æ¨¡å¼ï¼ˆæ— æ³•ä¿è¯å®Œå…¨å…¬å¹³çš„å¾ªç¯åˆ†å‘ï¼‰ã€‚\n\n\nWorkQueueProcessorå¤šæ•°æ„é€ å™¨æ–¹æ³•ä¸TopicProcessorç›¸åŒï¼Œæ¯”å¦‚autoCancelã€shareï¼Œ ä»¥åŠwaitStrategyã€‚ä¸‹æ¸¸è®¢é˜…è€…çš„æœ€å¤§æ•°ç›®åŒæ ·ç”±æ„é€ å™¨executoré…ç½®çš„ExecutorService å†³å®šã€‚\n\n- *æ³¨æ„ï¼š**æœ€å¥½ä¸è¦æœ‰å¤ªå¤šè®¢é˜…è€…è®¢é˜…WorkQueueProcessorï¼Œå› ä¸ºè¿™ä¼šé”ä½ processorã€‚å¦‚æœä½ éœ€è¦é™åˆ¶è®¢é˜…è€…æ•°é‡ï¼Œæœ€å¥½ä½¿ç”¨ä¸€ä¸ªThreadPoolExecutoræˆ– ForkJoinPoolã€‚è¿™ä¸ª processor èƒ½å¤Ÿæ£€æµ‹åˆ°ï¼ˆçº¿ç¨‹æ± ï¼‰å®¹é‡å¹¶åœ¨è®¢é˜…è€…è¿‡å¤šæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚\n\n### å®Œæˆä¿¡å·\n\n\nå¯¹äº Fluxå’ŒMonoæ¥è¯´,just æ˜¯æ•°æ®å®Œæˆçš„ä¿¡å·ï¼Œé‚£å¦‚æœä¸æ˜¯é€šè¿‡justå£°æ˜çš„æ•°æ®æµï¼Œæ²¡æœ‰è¿™ç§æ•°æ®å‡†å¤‡å®Œæˆçš„ä¿¡å·ï¼Œé‚£ä¹ˆè¿™ä¸ªæµå°±æ˜¯ä¸€ä¸ªæ— é™æµã€‚é™¤äº†æˆ‘ä»¬æ‰‹åŠ¨å£°æ˜æ•°æ®å‡†å¤‡çš„å®Œæˆï¼Œé”™è¯¯ä¿¡å·ä¹Ÿæ ‡å¿—è¿™æ•´ä¸ªæµçš„å®Œæˆã€‚\n\n\n```text\n        Flux.error(new RuntimeException());\n\n```\n\n\nè¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯å½“Fluxå’ŒMonoæ²¡æœ‰å‘å‡ºä»»ä½•ä¸€ä¸ªå…ƒç´ ï¼Œè€Œæ˜¯ç›´æ¥å‘å‡ºäº†å®Œæˆä¿¡å·ï¼Œé‚£ä¹ˆè¿™ä¸ªæµå°±æ˜¯ä¸€ä¸ªç©ºçš„æµï¼Œåƒè¿™æ ·ã€‚\n\n\n```text\n        Flux.error(new RuntimeException());        Flux.just();        Flux.empty();\n\n```\n\n\nè¿˜æœ‰å¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯ **Flux.just(1ï¼Œ2ï¼Œ4)** åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ•°æ®æµè€Œå·²ï¼Œåœ¨**subscribe()** ä¹‹å‰çš„æ“ä½œä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿï¼Œç±»ä¼¼ **Stream**çš„æƒ°æ€§æ±‚å€¼ï¼Œåœ¨ä¸­æ­¢æ“ä½œä¹‹å‰çš„æ“ä½œéƒ½ä¸ä¼šè§¦å‘ã€‚\n\n\nä¾‹å¦‚æ‰“å°å£°æ˜çš„æ•°æ®æµéœ€è¦è¿™æ ·åš\n\n\n```text\n        Flux.just(1, 2, 3).subscribe(System.out::println);\n\n```\n\n\nå¦å¤– subscribe æ—¶ï¼Œè¿˜å¯ä»¥æŒ‡å®šé”™è¯¯çš„å›è°ƒå¤„ç†ï¼Œä»¥åŠæ•°æ®å¤„ç†å®Œçš„å®Œæˆå›è°ƒ\n\n\n![](https://pic1.zhimg.com/80/v2-8a63e0f1cde490621e947f31466278ac_1440w.jpg)\n\n\næ‰€ä»¥å¯ä»¥è¿™æ ·å†™\n\n\n```text\nFlux.error(new Exception(\"error\")).subscribe(        System.out::println,        System.err::println,        () -> System.out.println(\"Completed!\"));\n\n```\n\n\næµç¨‹ï¼š\n\n\n![](https://pic3.zhimg.com/80/v2-f7bb37cd9efec5a597c5f432e20d0142_1440w.jpg)\n\n\n### æµé‡æ§åˆ¶ï¼ˆèƒŒå‹ï¼‰\n\n\nä¸Šé¢æåˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå½“ç”Ÿäº§è€…ç”Ÿäº§çš„é€Ÿåº¦è¿œè¿œå¤§äºæ¶ˆè´¹è€…æ¶ˆè´¹çš„çš„é€Ÿåº¦çš„æ—¶å€™ï¼Œä¼šå¼•å‘ä»»åŠ¡å¤§é‡å †ç§¯çš„æƒ…å†µï¼Œæœ€ç»ˆå‹å®æ•´ä¸ªç®¡é“ã€‚\n\n\n![](https://pic2.zhimg.com/80/v2-ebcf6e57fce02a882ea9f8fe9880aa35_1440w.jpg)\n\n\né‚£ä¹ˆå“åº”å¼æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œé€šè¿‡èƒŒå‹ï¼ˆback pressureï¼‰çš„æœºåˆ¶ï¼Œå¦‚ä¸‹å›¾\n\n\n![](https://pic4.zhimg.com/80/v2-24e321527e474779b4090ffc46d2deb3_1440w.jpg)\n\n\nè¿™ç§ä¸‹æ¸¸å¯ä»¥å‘ä¸Šæ¸¸åé¦ˆè‡ªå·±æ¶ˆè´¹èƒ½åŠ›çš„æœºåˆ¶å°±å«åšèƒŒå‹ï¼Œå…·ä½“èƒŒå‹çš„åŸç†å’Œè¿è¡Œæœºåˆ¶ä¼šåœ¨åé¢çš„å®æˆ˜ä¸­å¸¦å…¥ï¼Œå› ä¸ºå¾ˆå¤šåˆšæ¥è§¦è¿™ç§æ¦‚å¿µçš„åŒå­¦åªå¬ç†è®ºçš„è¯ä¼šä¸€æ—¶å¾ˆéš¾ç†è§£ã€‚\n\n\né€šè¿‡ Reactoræä¾›çš„BaseSubscriberæ¥è¿›è¡Œè‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±æµé‡æ§åˆ¶çš„subscriber\n\n\n```text\n        Flux.just(1,2)                .doOnRequest(s->System.out.println(\"no. \"+s))                .subscribe(new BaseSubscriber<Integer>() {                    @Override                    protected void hookOnSubscribe(Subscription subscription) {                        System.out.println(\"è®¢é˜…å¼€å§‹äº†ï¼Œæˆ‘è¦è¯·æ±‚å‡ ä¸ªå…ƒç´ \");                        request(1);                    }                    @Override                    protected void hookOnNext(Integer value) {                        System.out.println(\"æ”¶åˆ°ä¸€ä¸ªå…ƒç´ ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚å‡ ä¸ªå…ƒç´ \");                        request(1);                    }                });\n\n```\n\n\n### Reactorä¸­çš„å¤šçº¿ç¨‹\n\n\nåœ¨æˆ‘ä»¬javaçš„ä¼ ç»Ÿçš„ç¼–ç¨‹ä¸­ï¼Œå¯¹äºçº¿ç¨‹ä¹‹é—´çš„è°ƒåº¦æœ‰å°è£…å¥½çš„çº¿ç¨‹æ± å·¥å…·ç±»ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥é€šè¿‡çº¿ç¨‹æ± çš„æ„é€ å‡½æ•°å®šä¹‰è‡ªå·±çš„çº¿ç¨‹æ± ï¼Œè¿™ä¸€åˆ‡éƒ½è®©å¤šçº¿ç¨‹çš„è°ƒåº¦éƒ½å˜å¾—å¾ˆå®¹æ˜“ï¼Œé‚£ä¹ˆåœ¨reactorä¸­æ€ä¹ˆå¤„ç†çº¿ç¨‹çš„è°ƒåº¦\n\n\n**4.1 Schedulers**\n\n\nåœ¨reactorä¸­å¤„ç†çº¿ç¨‹è°ƒåº¦çš„ä¸å«thread poolï¼Œè€Œæ˜¯Schedulersï¼ˆè°ƒåº¦å™¨ï¼‰ï¼Œé€šè¿‡è°ƒåº¦å™¨å°±å¯ä»¥åˆ›å»ºå‡ºä¾›æˆ‘ä»¬ç›´æ¥ä½¿ç”¨çš„å¤šçº¿ç¨‹ç¯å¢ƒã€‚\n\n\n**4.1.1 Schedulers.immediate()**\n\n\nåœ¨å½“å‰çº¿ç¨‹ä¸­ä½¿ç”¨\n\n\n**4.1.2 Schedulers.single()**\n\n\nåˆ›å»ºä¸€ä¸ªå¯é‡ç”¨çš„å•çº¿ç¨‹ç¯å¢ƒï¼Œè¯¥æ–¹æ³•çš„æ‰€æœ‰è°ƒç”¨è€…éƒ½ä¼šé‡å¤ä½¿ç”¨åŒä¸€ä¸ªçº¿ç¨‹ã€‚\n\n\n**4.1.3 Schedulers.elastic()**\n\n\nåˆ›å»ºä¸€ä¸ªå¼¹æ€§çº¿ç¨‹æ± ï¼Œä¼šé‡ç”¨ç©ºé—²çº¿ç¨‹ï¼Œå½“çº¿ç¨‹æ± ç©ºé—²æ—¶é—´è¿‡é•¿å°±ä¼šè‡ªåŠ¨åºŸå¼ƒæ‰ã€‚é€šå¸¸ä½¿ç”¨çš„åœºæ™¯æ˜¯ç»™ä¸€ä¸ªé˜»å¡çš„ä»»åŠ¡åˆ†é…è‡ªå·±çš„çº¿ç¨‹ï¼Œä»è€Œä¸ä¼šå½±å“åˆ°å…¶ä»–ä»»åŠ¡çš„æ‰§è¡Œã€‚\n\n\n**4.1.4 Schedulers.parallel()**\n\n\nåˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± å¤§å°å’Œcpuä¸ªæ•°ç›¸ç­‰ã€‚\n\n\næ¥çœ‹ä¸€ä¸ªå…·ä½“ä½¿ç”¨çš„å®ä¾‹ï¼Œé€šè¿‡ Schedulers.elastic() å°†ä¸€ä¸ªåŒæ­¥é˜»å¡çš„æ–¹æ³•æ”¹å†™æˆå¼‚æ­¥çš„ã€‚\n\n\n```text\n private Integer syncMethod(){         try {             TimeUnit.SECONDS.sleep(2);         } catch (InterruptedException e) {             e.printStackTrace();         }        return 123456;     }     @Test     public void switchSyncToAsyncTest(){         CountDownLatch countDownLatch = new CountDownLatch(1);         Mono.fromCallable(()->syncMethod())                 .subscribeOn(Schedulers.elastic())                 .subscribe(System.out::println,null,countDownLatch::countDown);         try {             countDownLatch.await();         } catch (InterruptedException e) {             e.printStackTrace();         }     }\n\n```\n\n\nç®€å•åˆ†æä¸Šè¿°ä»£ç ï¼Œé€šè¿‡fromCallableå£°æ˜ ä¸€ä¸ªcallable çš„monoï¼Œç„¶åé€šè¿‡subscribeOn åˆ‡æ¢ç¯å¢ƒï¼Œè°ƒåº¦ä»»åŠ¡åˆ°å•ç‹¬çš„å¼¹æ€§çº¿ç¨‹æ± å·¥ä½œã€‚\n\n\n### é”™è¯¯å¤„ç†\n\n\nåœ¨ä¼ ç»Ÿçš„ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¤„ç†å•ä¸ªæ¥å£é”™è¯¯çš„æ–¹å¼ï¼Œå¯èƒ½æ˜¯ try-catch-finallyçš„æ–¹å¼ï¼Œä¹Ÿå¯èƒ½æ˜¯try-winth-resourceçš„è¯­æ³•ç³–ï¼Œè¿™äº›åœ¨reactorä¸­å˜å¾—ä¸å¤ªä¸€æ ·ã€‚ä¸‹é¢æ¥è¯´ä¸€è¯´reactorä¸­çš„å‡ ç§é”™è¯¯å¤„ç†æ–¹å¼ã€‚\n\n\n**5.1 onErrorReturn**\n\n\nonErrorReturnåœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ï¼Œä¼šæä¾›ä¸€ä¸ªç¼ºçœå€¼ï¼Œç±»ä¼¼äºå®‰å…¨å–å€¼çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªåœ¨å“åº”å¼æµé‡Œé¢ä¼šæ›´åŠ å®ç”¨ã€‚\n\n\n```text\n Flux.just(1,2,0)              .map(v->2/v)              .onErrorReturn(0)              .map(v->v*2)              .subscribe(System.out::println,System.err::println);\n\n```\n\n\nè¿™æ ·å°±å¯ä»¥åœ¨å¤„ç†ä¸€äº›æœªçŸ¥å…ƒç´ çš„æ—¶å€™ï¼Œåˆä¸æƒ³è®©æœªçŸ¥å› ç´ ä¸­æ­¢ç¨‹åºçš„ç»§ç»­è¿è¡Œï¼Œå°±å¯ä»¥é‡‡å–è¿™ç§æ–¹å¼ã€‚\n\n\n**5.2 onErrorResume**\n\n\nåœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ï¼Œæä¾›ä¸€ä¸ªæ–°çš„æµæˆ–è€…å€¼è¿”å›ï¼Œè¿™æ ·è¯´å¯èƒ½ä¸å¤ªæ¸…æ¥šï¼Œçœ‹ä»£ç ã€‚\n\n\n```text\n        Flux.just(1,2,0)                 //è°ƒç”¨redisæœåŠ¡è·å–æ•°æ®                .flatMap(id->redisService.getUserByid(id))                //å½“å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œä»DBç”¨æˆ·æœåŠ¡è·å–æ•°æ®                .onErrorResume(v->userService.getUserByCache(id));\n\n```\n\n\nç±»ä¼¼äºé”™è¯¯çš„ä¸€ä¸ªcallbackï¼›\n\n\n**5.3 onErrorMap**\n\n\nä¸Šé¢çš„éƒ½æ˜¯æˆ‘ä»¬å»æä¾›ç¼ºçœçš„æ–¹æ³•æˆ–å€¼å¤„ç†é”™è¯¯ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŠ›å‡ºé”™è¯¯ï¼Œä½†æ˜¯éœ€è¦å°†é”™è¯¯åŒ…è£…ä¸€ä¸‹ï¼Œå¯è¯»æ€§å¥½ä¸€ç‚¹ï¼Œä¹Ÿå°±æ˜¯æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ã€‚\n\n\n```text\n                Flux.just(1,2,0)                .flatMap(id->getUserByid(id))                .onErrorMap(v->new CustomizeExcetion(\"æœåŠ¡å™¨å¼€å°å·®äº†\",v));\n\n```\n\n\n**5.4 doOnError** **è®°å½•é”™è¯¯æ—¥å¿—**\n\n\nåœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æˆ‘ä»¬éœ€è¦è®°å½•æ—¥å¿—ï¼Œåœ¨reactoré‡Œé¢ä¸“é—¨ç‹¬ç«‹å‡ºapiè®°å½•é”™è¯¯æ—¥å¿—\n\n\n```text\n        Flux.just(1,2,0)                .flatMap(id->getUserByid(id))                .doOnError(e-> Log.error(\"this occur something error\"))                .onErrorMap(v->new CustomizeExcetion(\"æœåŠ¡å™¨å¼€å°å·®äº†\",v));\n\n```\n\n\ndoOnError å¯¹äºæµé‡Œé¢çš„å…ƒç´ åªè¯»ï¼Œä¹Ÿå°±æ˜¯ä»–ä¸ä¼šå¯¹æµé‡Œé¢çš„ä»»åŠ¡å…ƒç´ æ“ä½œï¼Œè®°å½•æ—¥å¿—åï¼Œä¼šè®²é”™è¯¯ä¿¡å·ç»§ç»­æŠ›åˆ°åé¢ï¼Œè®©åé¢å»å¤„ç†ã€‚\n\n\n**5.5 finally ç¡®ä¿åšä¸€äº›äº‹æƒ…**\n\n\næœ‰çš„æ—¶å€™æˆ‘ä»¬æƒ³è¦åƒä¼ ç»Ÿçš„åŒæ­¥ä»£ç é‚£æ ·ä½¿ç”¨finallyå»åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚å…³é—­httpè¿æ¥ï¼Œæ¸…ç†èµ„æºï¼Œé‚£ä¹ˆåœ¨reactorä¸­æ€ä¹ˆå»åšfinally\n\n\n```text\n        Flux.just(1,2,0)                .flatMap(id->getUserByid(id))                .doOnError(e-> Log.error(\"this occur something error\"))                .onErrorMap(v->new CustomizeExcetion(\"æœåŠ¡å™¨å¼€å°å·®äº†\",v))                .doFinally(System.out.println(\"æˆ‘ä¼šç¡®ä¿åšä¸€äº›äº‹æƒ…\"))        ;\n\n```\n\n\næˆ–è€…å½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªè¿æ¥éœ€è¦å…³é—­èµ„æºçš„æ—¶å€™ï¼Œè¿˜å¯ä»¥è¿™æ ·å†™\n\n\n```text\n        Flux.using(                () -> createHttpClient(),                client -> Flux.just(client.sendRequest()),                createHttpClient::close        );\n\n```\n\n\nä½¿ç”¨usingå‡½æ•°çš„ä¸‰ä¸ªå‚æ•°ï¼Œè·å–clientï¼Œå‘é€è¯·æ±‚ï¼Œå…³é—­èµ„æºã€‚\n\n\n**5.6 retry é‡è¯•æœºåˆ¶**\n\n\nå½“é‡åˆ°ä¸€äº›ä¸å¯æ§å› ç´ å¯¼è‡´çš„ç¨‹åºå¤±è´¥ï¼Œä½†æ˜¯ä»£ç é€»è¾‘ç¡®å®æ˜¯æ­£ç¡®çš„ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦é‡è¯•æœºåˆ¶ã€‚\n\n\n```text\n      Flux.just(1,2,0)              .map(v->2/v)              .retry(1)              .subscribe(System.out::println,System.err::println);\n\n```\n\n\nä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯é‡è¯•ä¸æ˜¯ä»é”™è¯¯çš„åœ°æ–¹å¼€å§‹é‡è¯•ï¼Œç›¸å½“äºå¯¹publisher çš„é‡è®¢é˜…ï¼Œä¹Ÿå°±æ˜¯ä»é›¶å¼€å§‹é‡æ–°æ‰§è¡Œä¸€éï¼Œæ‰€ä»¥æ— æ³•è¾¾åˆ°ç±»ä¼¼äºæ–­ç‚¹ç»­ä¼ çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä½¿ç”¨åœºæ™¯è¿˜æ˜¯æœ‰é™åˆ¶ã€‚\n\n\n### **å¦‚ä½•è°ƒè¯•reactor**\n\n\nåœ¨æˆ‘ä»¬ä¼ ç»Ÿé˜»å¡ä»£ç é‡Œé¢ï¼Œè°ƒè¯•ï¼ˆDebugï¼‰çš„æ—¶å€™æ˜¯ä¸€ä»¶éå¸¸ç®€å•çš„äº‹æƒ…ï¼Œé€šè¿‡æ‰“æ–­ç‚¹ï¼Œå¾—åˆ°ç›¸å…³çš„stack çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“é”™è¯¯ä¿¡æ¯ï¼ˆä¸è¿‡åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹å»æ‰“æ–­ç‚¹ï¼Œéœ€è¦åˆ‡æ¢çº¿ç¨‹ç¯å¢ƒï¼Œä¹Ÿæœ‰ç‚¹éº»çƒ¦ï¼‰ã€‚\n\n\n> ä½†æ˜¯åœ¨reactor ç¯å¢ƒä¸‹å»è°ƒè¯•ä»£ç å¹¶ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ ä¸€ä¸ª Fluxæµï¼Œæ€ä¹ˆå»å¾—åˆ°æ¯ä¸ªå…ƒç´ ä¿¡æ¯ï¼Œæ€ä¹ˆå»çŸ¥é“åœ¨ç®¡é“é‡Œé¢ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯ä»€ä¹ˆï¼Œæ¯ä¸ªå…ƒç´ æ˜¯å¦åƒæœŸæœ›çš„é‚£æ ·åšäº†æ“ä½œã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä»ä¼ ç»Ÿç¼–ç¨‹åˆ‡æ¢åˆ°å“åº”å¼ç¼–ç¨‹çš„éš¾ç‚¹ï¼Œå¼€å‘äººå‘˜éœ€è¦èŠ±æ—¶é—´å»å­¦ä¹ è¿™ä¸ªæ“ä½œï¼Œä½†æ˜¯æ„Ÿè§‰éš¾å—æ€»æ˜¯å¥½çš„ï¼Œå› ä¸ºåšä»€ä¹ˆéƒ½å¤ªå®¹æ˜“çš„è¯ï¼Œè‡ªå·±ä¼šé•¿æœŸæ­¢æ­¥äºæ­¤ï¼Œåƒæ—©æœŸçš„EJBåˆ°j2eeï¼Œssh -> ssm -> spring boot -> spring cloud ï¼Œä»å¾®æœåŠ¡->service mesh -> serve less ,åˆ°ç°åœ¨ä¸€äº›ä¸€çº¿å¤§å‚ç››è¡Œçš„ä¸­å°ã€‚ä¹Ÿè®¸è¿™ä¸€æ¬¡å°±æ˜¯æ”¹å˜è‡ªå·±çš„æ—¶å€™ã€‚\n\n\nè¨€å½’æ­£ä¼ ï¼Œå…³äºæ¯”è¾ƒå¤æ‚çš„è°ƒè¯•åæœŸå†è¯´ï¼Œæˆ‘ä»¬å…ˆä»æœ€åŸºæœ¬çš„å•å…ƒæµ‹è¯•å¼€å§‹ã€‚å®˜æ–¹æ¨èçš„å·¥å…·æ˜¯ **StepVerifier**\n\n\n```text\n    @Test    public void reactorTest(){        StepVerifier.create(Flux.just(1,2)) //1              .expectNext(1,2) //2               .expectComplete() //3               .verify(); //4     }\n\n```\n\n1. åˆ›å»ºæµ‹è¯•çš„å¼‚æ­¥æµ\n2. æµ‹è¯•æœŸæœ›çš„å€¼\n3. æµ‹è¯•æ˜¯å¦å®Œæˆ\n4. éªŒè¯\n\n> æˆ‘ä»¬é€šå¸¸ä½¿ç”¨createæ–¹æ³•åˆ›å»ºåŸºäºFluxæˆ–Monoçš„StepVerifierï¼Œç„¶åå°±å¯ä»¥è¿›è¡Œä»¥ä¸‹æµ‹è¯•ï¼š\n\n- æµ‹è¯•æœŸæœ›å‘å‡ºçš„ä¸‹ä¸€ä¸ªä¿¡å·ã€‚å¦‚æœæ”¶åˆ°å…¶ä»–ä¿¡å·ï¼ˆæˆ–è€…ä¿¡å·ä¸æœŸæœ›ä¸åŒ¹é…ï¼‰ï¼Œæ•´ä¸ªæµ‹è¯•å°±ä¼š å¤±è´¥ï¼ˆAssertionErrorï¼‰ï¼Œå¦‚expectNext(T...)æˆ–expectNextCount(long)ã€‚`\n- å¤„ç†ï¼ˆconsumeï¼‰ä¸‹ä¸€ä¸ªä¿¡å·ã€‚å½“ä½ æƒ³è¦è·³è¿‡éƒ¨åˆ†åºåˆ—æˆ–è€…å½“ä½ æƒ³å¯¹ä¿¡å·å†…å®¹è¿›è¡Œè‡ªå®šä¹‰çš„æ ¡éªŒçš„æ—¶å€™ä¼šç”¨åˆ°å®ƒï¼Œå¯ä»¥ä½¿ç”¨consumeNextWith(Consumer<T>)ã€‚\n- å…¶ä»–æ“ä½œï¼Œæ¯”å¦‚æš‚åœæˆ–è¿è¡Œä¸€æ®µä»£ç ã€‚æ¯”å¦‚ï¼Œä½ æƒ³å¯¹æµ‹è¯•çŠ¶æ€æˆ–å†…å®¹è¿›è¡Œè°ƒæ•´æˆ–å¤„ç†ï¼Œ ä½ å¯èƒ½ä¼šç”¨åˆ°thenAwait(Duration)å’Œthen(Runnable)ã€‚\n\n>       å¯¹äºç»ˆæ­¢äº‹ä»¶ï¼Œç›¸åº”çš„æœŸæœ›æ–¹æ³•ï¼ˆå¦‚expectComplete()ã€expectError()ï¼ŒåŠå…¶æ‰€æœ‰çš„å˜ä½“æ–¹æ³•ï¼‰ ä½¿ç”¨ä¹‹åå°±ä¸èƒ½å†ç»§ç»­å¢åŠ åˆ«çš„æœŸæœ›æ–¹æ³•äº†ã€‚æœ€åä½ åªèƒ½å¯¹ StepVerifier è¿›è¡Œä¸€äº›é¢å¤–çš„é…ç½®å¹¶ è§¦å‘æ ¡éªŒï¼ˆé€šå¸¸è°ƒç”¨verify()åŠå…¶å˜ä½“æ–¹æ³•ï¼‰ã€‚\n\n\n>        ä»StepVerifierå†…éƒ¨å®ç°æ¥çœ‹ï¼Œå®ƒè®¢é˜…äº†å¾…æµ‹è¯•çš„ Flux æˆ– Monoï¼Œç„¶åå°†åºåˆ—ä¸­çš„æ¯ä¸ªä¿¡å·ä¸æµ‹è¯• åœºæ™¯çš„æœŸæœ›è¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœåŒ¹é…çš„è¯ï¼Œæµ‹è¯•æˆåŠŸã€‚å¦‚æœæœ‰ä¸åŒ¹é…çš„æƒ…å†µï¼Œåˆ™æŠ›å‡ºAssertionErrorå¼‚å¸¸ã€‚\n\n\n>       å“åº”å¼æµæ˜¯ä¸€ç§åŸºäºæ—¶é—´çš„æ•°æ®æµã€‚è®¸å¤šæ—¶å€™ï¼Œå¾…æµ‹è¯•çš„æ•°æ®æµå­˜åœ¨å»¶è¿Ÿï¼Œä»è€ŒæŒç»­ä¸€æ®µæ—¶é—´ã€‚å¦‚æœè¿™ç§åœºæ™¯æ¯”è¾ƒå¤šçš„è¯ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œæ—¶é—´è¾ƒé•¿ã€‚å› æ­¤StepVerifieræä¾›äº†å¯ä»¥æ“ä½œâ€œè™šæ‹Ÿæ—¶é—´â€çš„æµ‹è¯•æ–¹å¼ï¼Œè¿™æ—¶å€™éœ€è¦ä½¿ç”¨StepVerifier.withVirtualTimeæ¥æ„é€ ã€‚\n\n\nä¸ºäº†æé«˜ StepVerifier æ­£å¸¸èµ·ä½œç”¨çš„æ¦‚ç‡ï¼Œå®ƒä¸€èˆ¬ä¸æ¥æ”¶ä¸€ä¸ªç®€å•çš„ Flux ä½œä¸ºè¾“å…¥ï¼Œè€Œæ˜¯æ¥æ”¶ ä¸€ä¸ªSupplierï¼Œä»è€Œå¯ä»¥åœ¨é…ç½®å¥½è®¢é˜…è€…ä¹‹å â€œæ‡’åˆ›å»ºâ€å¾…æµ‹è¯•çš„ fluxï¼Œå¦‚ï¼š\n\n\n> StepVerifier.withVirtualTime(() -> Mono.delay(Duration.ofDays(1))) //... ç»§ç»­è¿½åŠ æœŸæœ›æ–¹æ³•\n\n\n**æœ‰ä¸¤ç§å¤„ç†æ—¶é—´çš„æœŸæœ›æ–¹æ³•ï¼Œæ— è®ºæ˜¯å¦é…ç½®è™šæ‹Ÿæ—¶é—´éƒ½æ˜¯å¯ç”¨çš„ï¼š**\n\n- thenAwait(Duration)ä¼šæš‚åœæ ¡éªŒæ­¥éª¤ï¼ˆå…è®¸ä¿¡å·å»¶è¿Ÿå‘å‡ºï¼‰ã€‚\n- expectNoEvent(Duration)åŒæ ·è®©åºåˆ—æŒç»­ä¸€å®šçš„æ—¶é—´ï¼ŒæœŸé—´å¦‚æœæœ‰ä»»ä½•ä¿¡å·å‘å‡ºåˆ™æµ‹è¯•å¤±è´¥ã€‚\nåœ¨æ™®é€šçš„æµ‹è¯•ä¸­ï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šåŸºäºç»™å®šçš„æŒç»­æ—¶é—´æš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚è€Œå¦‚æœæ˜¯åœ¨è™šæ‹Ÿæ—¶é—´æ¨¡å¼ä¸‹å°±ç›¸åº”åœ°ä½¿ç”¨è™šæ‹Ÿæ—¶é—´ã€‚\n\n```text\nStepVerifier.withVirtualTime(() -> Mono.delay(Duration.ofDays(1)))    .expectSubscription()   // 1    .expectNoEvent(Duration.ofDays(1))  // 2    .expectNext(0L)    .verifyComplete();  // 3\n\n```\n\n1. expectNoEvent å°†è®¢é˜…ï¼ˆsubscriptionï¼‰ä¹Ÿè®¤ä½œä¸€ä¸ªäº‹ä»¶ã€‚å‡è®¾ä½ ç”¨å®ƒä½œä¸ºç¬¬ä¸€æ­¥ï¼Œå¦‚æœæ£€æµ‹ åˆ°æœ‰è®¢é˜…ä¿¡å·ï¼Œä¹Ÿä¼šå¤±è´¥ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨expectSubscription().expectNoEvent(duration) æ¥ä»£æ›¿ï¼›\n2. æœŸå¾…â€œä¸€å¤©â€å†…æ²¡æœ‰ä¿¡å·å‘ç”Ÿï¼›\n3. verifyæˆ–å˜ä½“æ–¹æ³•æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªDurationï¼Œè¿™æ˜¯å®é™…çš„æµ‹è¯•æ—¶é•¿ã€‚\n\n**3.1 map**\n\n\nè¿™é‡Œçš„mapå’Œjava 8 streamçš„mapæ˜¯åŒä¸€ä¸ªæ„æ€ï¼Œç”¨äºå…ƒç´ çš„è½¬æ¢ï¼Œåƒè¿™æ ·\n\n\n```text\n    @Test    public void reactorMapTest(){        StepVerifier.create(Flux.just(1,2)                .map(v->v+1))                .expectNext(2,3)                .expectComplete()                .verify();    }\n\n```\n\n\nè¿˜æ˜¯ä¹‹å‰çš„ä»£ç ï¼Œåªæ˜¯å¯¹æ¯ä¸€ä¸ªå…ƒç´ éƒ½è‡ªå¢åŠ ä¸€ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œå¯¹lambadaç†Ÿæ‚‰çš„åŒå­¦éƒ½äº†è§£ã€‚\n\n\n**3.2 flatmap**\n\n\nflatmapä¹Ÿæ˜¯å¯¹å…ƒç´ çš„è½¬æ¢ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯flatmapæ˜¯å°†å…ƒç´ è½¬æ¢ä¸ºæµï¼Œå†å°†æµåˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„æµã€‚\n\n\n```text\n    @Test    public void reactorFlatMapTest(){        StepVerifier.create(Flux.just(\"crabman\",\"is\",\"hero\")                .flatMap(v->Flux.fromArray(v.split(\"\")))                .doOnNext(System.out::println))                .expectNextCount(13)                .verifyComplete();    }\n\n```\n\n\n> tips ï¼šflatmap å’Œ mapçš„åŒºåˆ«  \n> ä»æºç ä¸Šæ¥çœ‹ mapå°±æ˜¯ä¸€ä¸ªfunctionå‡½æ•°ï¼Œè¾“å…¥ä¸€ä¸ªè¾“å‡ºä¸€ä¸ªï¼Œå¯¹äºflatmapæ¥è®²å®ƒæ¥å—çš„æ˜¯è¾“å‡ºä¸ºPublisherçš„functionï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºflatmapæ¥è®² è¾“å…¥ä¸€ä¸ªå€¼ï¼Œè¾“å‡ºçš„æ˜¯ä¸€ä¸ªPublisherï¼Œæ‰€ä»¥mapæ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œè€Œflatmap æ˜¯ä¸€å¯¹å¤šæˆ–è€…å¤šå¯¹å¤šçš„å…³ç³»ï¼Œå¹¶ä¸”ä¸¤è€…è¾“å‡ºä¹Ÿä¸ä¸€æ ·ã€‚é‚£flatmap çš„åº”ç”¨åœºæ™¯åœ¨å“ªé‡Œï¼Œä¾‹å¦‚ä¸€ä¸ªæ¥å£ï¼Œå…¥å‚æ˜¯List<id>,ç”¨æˆ·id çš„é›†åˆï¼Œéœ€æ±‚æ˜¯è¿”å›æ¯ä¸ªid å¯¹åº”çš„å…·ä½“ä¿¡æ¯ï¼Œæ‰€ä»¥ä»£ç çœ‹èµ·æ¥å°±æ˜¯è¿™æ · xx.flatmap(id->getUserInfoById(id))\n\n\n**3.3 filter**\n\n\nreactor çš„filterå’Œjava 8 stream çš„filteræ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œè¿™é‡Œè¿‡æ»¤æ‰å€¼ä¸º2 çš„\n\n\n```text\n    @Test    public void reactorFilterTest(){        StepVerifier.create(Flux.just(1,2)                .map(v->v+1)                .filter(s->s!=2)                .doOnNext(System.out::println))                .expectNext(3)                .expectComplete()                .verify();    }\n\n```\n\n\n**3.4 zip**\n\n\nè¿™ä¸ªæ˜¯æ“ä½œå¯èƒ½çœ‹èµ·æ¥æ¯”è¾ƒé™Œç”Ÿï¼Œé¡¾åæ€ä¹‰ï¼Œâ€œå‹ç¼©â€å°±æ˜¯å°†å¤šä¸ªæµä¸€å¯¹ä¸€çš„åˆå¹¶èµ·æ¥ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› ï¼Œå› ä¸ºåœ¨æ¯ä¸ªfluxæµæˆ–è€…monoæµé‡Œé¢ï¼Œå„ä¸ªæµçš„é€Ÿåº¦æ˜¯ä¸ä¸€æ ·ï¼Œzipè¿˜æœ‰ä¸ªä½œç”¨å°±æ˜¯å°†ä¸¤ä¸ªæµè¿›è¡ŒåŒæ­¥å¯¹é½ã€‚ä¾‹å¦‚æˆ‘ä»¬è¿™é‡Œåœ¨åŠ å…¥å¦ä¸€ä¸ªæµï¼Œè¿™ä¸ªæµä¼šä¸åœçš„å‘å‡ºå…ƒç´ ï¼Œä¸ºäº†è®©å¤§å®¶å¯ä»¥æ„Ÿå—åˆ°åŒï¼Œè¿™é‡Œé™åˆ¶å¦ä¸€ä¸ªæµçš„é€Ÿåº¦ä¸ºæ²¡1ç§’å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ ·åˆå¹¶çš„æµä¹Ÿä¼šå‘å¦ä¸€ä¸ªæµå¯¹é½ã€‚\n\n\n```text\n    @Test    public void reactorZipTest(){        //å®šä¹‰ä¸€ä¸ªFluxæµ        Flux<String> stringFlux = Flux.just(\"a\", \"b\", \"c\", \"d\");        //è¿™é‡Œä½¿ç”¨è®¡æ—¶å™¨ï¼Œå› ä¸ºåœ¨å•å…ƒæµ‹è¯•é‡Œé¢ï¼Œå¯èƒ½å…ƒç´ æ²¡æ‰§è¡Œå®Œï¼Œä»–å°±ä¼šç›´æ¥è¿”å›        CountDownLatch countDownLatch = new CountDownLatch(1);  // 2        Flux.zip(stringFlux,Flux.interval(Duration.ofSeconds(1)))                .subscribe(t->System.out.println(t.getT1())                        ,System.err::println                        ,countDownLatch::countDown);        try {            countDownLatch.await();        } catch (InterruptedException e) {            e.printStackTrace();        }    }\n\n```\n\n\nä¸Šé¢è®²çš„è¿™å››ä¸ªæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œè¿˜æœ‰å¾ˆå¤šã€‚\n\n\n## jdk9çš„å“åº”å¼è§„èŒƒ\n\n\nJDK 9æä¾›äº†å¯¹äºReactiveçš„å®Œæ•´æ”¯æŒï¼ŒJDK9ä¹Ÿå®šä¹‰äº†ä¸Šè¿°æåˆ°çš„å››ä¸ªæ¥å£ï¼Œåœ¨`java.util.concurrent`åŒ…ä¸Š\n\n\nFlowçš„æºç \n\n\n```text\npublic final class Flow {    private Flow() {} // uninstantiable    //å‘å¸ƒè€…    @FunctionalInterface    public static interface Publisher<T> {                public void subscribe(Subscriber<? super T> subscriber);    }    //è®¢é˜…è€…    public static interface Subscriber<T> {        public void onNext(T item);        public void onError(Throwable throwable);        public void onComplete();    }  //è®¢é˜…æ¶ˆè´¹å¯¹è±¡    public static interface Subscription {        public void request(long n);        public void cancel();    }    //æ•°æ®è½¬æ¢    public static interface Processor<T,R> extends Subscriber<T>, Publisher<R> {    }    static final int DEFAULT_BUFFER_SIZE = 256;    public static int defaultBufferSize() {        return DEFAULT_BUFFER_SIZE;    }}\n\n```\n\n\n## webFlux\n\n- WebFluxæ˜¯Springæ¨å‡ºå“åº”å¼ç¼–ç¨‹çš„ä¸€éƒ¨åˆ†(webç«¯)\n\n\t> å“åº”å¼ç¼–ç¨‹æ˜¯å¼‚æ­¥éé˜»å¡çš„(æ˜¯ä¸€ç§åŸºäºæ•°æ®æµï¼ˆdata streamï¼‰å’Œå˜åŒ–ä¼ é€’ï¼ˆpropagation of changeï¼‰çš„å£°æ˜å¼ï¼ˆdeclarativeï¼‰çš„ç¼–ç¨‹èŒƒå¼)\n\n\n![](https://pic1.zhimg.com/v2-5be72cbcf804dc2953f1198a1365ed9d_r.jpg?source=172ae18b)\n\n\n> ä»¥å¾€æ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯é€‰æ‹©ä¸åŒçš„æŠ€æœ¯ï¼Œæœ‰çš„åœºæ™¯é€‚åˆç”¨äºåŒæ­¥é˜»å¡çš„ï¼Œæœ‰çš„åœºæ™¯é€‚åˆç”¨äºå¼‚æ­¥éé˜»å¡çš„ã€‚è€ŒSpring5æä¾›äº†ä¸€æ•´å¥—å“åº”å¼(éé˜»å¡)çš„æŠ€æœ¯æ ˆä¾›æˆ‘ä»¬ä½¿ç”¨(åŒ…æ‹¬Webæ§åˆ¶å™¨ã€æƒé™æ§åˆ¶ã€æ•°æ®è®¿é—®å±‚ç­‰ç­‰)ã€‚\n\n\nå“åº”å¼ä¸€èˆ¬ç”¨Nettyæˆ–è€…Servlet 3.1çš„å®¹å™¨(å› ä¸ºæ”¯æŒå¼‚æ­¥éé˜»å¡)ï¼Œè€ŒServletæŠ€æœ¯æ ˆç”¨çš„æ˜¯Servletå®¹å™¨\n\n\n![](https://spring.io/images/diagram-reactive-dark-31d740ed8e454af5f1b8d55ae716525d.svg)\n\n\nSpringå®˜æ–¹ä¸ºäº†è®©æˆ‘ä»¬æ›´åŠ **å¿«é€Ÿ/å¹³æ»‘**åˆ°WebFluxä¸Šï¼Œä¹‹å‰SpringMVCé‚£å¥—éƒ½æ˜¯æ”¯æŒçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š**æˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨SpringMVCä¸€æ ·ä½¿ç”¨ç€WebFlux**ã€‚\n\n\nWebFluxä½¿ç”¨çš„å“åº”å¼æµå¹¶ä¸æ˜¯ç”¨JDK9å¹³å°çš„ï¼Œè€Œæ˜¯**Reactor**å“åº”å¼æµåº“ä¸ºå•¥ï¼Ÿå› ä¸ºäººå®¶æ˜¯å…„å¼Ÿå…¬å¸ï¼\n\n\n### ä¸¤ç§è·¯ç”±æ–¹å¼\n\n- **åŸºäºSpring webçš„æ³¨è§£å£°æ˜**\n- **åŸºäºrouting functionçš„å‡½æ•°å¼å¼€å‘**\n\n```text\n/**     * é˜»å¡5ç§’é’Ÿ     * @return     */    private String createStr() {        try {            TimeUnit.SECONDS.sleep(5);        } catch (InterruptedException e) {        }        return \"â€¦â€¦^ - ^\";    }    /**     *  åŸmvc     *     * @return {@link String}     */    @GetMapping(\"/mvc\")    private String mvc() {        long millis = System.currentTimeMillis();        log.info(\"è¯·æ±‚1:{}\",millis);        String result = createStr();        log.info(\"ç»“æŸ1:{}\",System.currentTimeMillis() - millis);        return result;    }    /**     *  web flux     *     * @return {@link Mono<String>}     */    @GetMapping(\"/flux\")    private Mono<String> flux() {        long millis = System.currentTimeMillis();        log.info(\"è¯·æ±‚2:{}\",millis);        Mono<String> result = Mono.fromSupplier(() -> createStr());        log.info(\"ç»“æŸ2:{}\",System.currentTimeMillis() - millis);        return result;    }\n\n```\n\n\nä»è°ƒç”¨è€…(æµè§ˆå™¨)çš„è§’åº¦è€Œè¨€ï¼Œæ˜¯æ„ŸçŸ¥ä¸åˆ°æœ‰ä»€ä¹ˆå˜åŒ–çš„ï¼Œå› ä¸ºéƒ½æ˜¯å¾—ç­‰å¾…5sæ‰è¿”å›æ•°æ®ã€‚ä½†æ˜¯ï¼Œä»æœåŠ¡ç«¯çš„æ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒWebFluxæ˜¯**ç›´æ¥è¿”å›Monoå¯¹è±¡çš„**(è€Œä¸æ˜¯åƒSpringMVCä¸€ç›´åŒæ­¥é˜»å¡5sï¼Œçº¿ç¨‹æ‰è¿”å›)ã€‚\n\n\nè¿™æ­£æ˜¯WebFluxçš„å¥½å¤„ï¼šèƒ½å¤Ÿä»¥**å›ºå®šçš„çº¿ç¨‹æ¥å¤„ç†é«˜å¹¶å‘**ï¼ˆå……åˆ†å‘æŒ¥æœºå™¨çš„æ€§èƒ½ï¼‰ã€‚\n\n\nWebFluxè¿˜æ”¯æŒ**æœåŠ¡å™¨æ¨é€**(SSE - >Server Send Event)ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š\n\n\n```text\n/**     *     * å®šæ—¶ è¿”å›0-nä¸ªå…ƒç´      * æ³¨ï¼šéœ€è¦æŒ‡å®šMediaType     *     * @return {@link Flux<String>}     */    @GetMapping(value = \"/timing\", produces = MediaType.TEXT_EVENT_STREAM_VALUE)    private Flux<String> timing() {        Flux<String> result = Flux            .fromStream(IntStream.range(1, 5).mapToObj(i -> {                try {                    TimeUnit.SECONDS.sleep(1);                } catch (InterruptedException e) {                }                return \"å¤§å†…å¯†æ¢00\" + i;            }));        return result;    }\n\n```\n\n\næ•ˆæœå°±æ˜¯**æ¯ç§’**ä¼šç»™æµè§ˆå™¨æ¨é€æ•°æ®ï¼š\n\n\n### æ ¸å¿ƒç»„ä»¶\n\n\n1.HttpHandler\n\n\næ˜¯ä¸€ç§å¸¦æœ‰å¤„ç† HTTP è¯·æ±‚å’Œå“åº”æ–¹æ³•çš„ç®€å•å¥‘çº¦ã€‚\n\n\n2.WebHandler\n\n\n![](https://img-blog.csdnimg.cn/20190610181144939.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpeWFudGlhbm1pbg==,size_16,color_FFFFFF,t_70)\n\n\nwebHandleræ˜¾å¾—æœ‰ä¸€äº›æŠ½è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹æ¯”SpringMVCçš„ä¸€äº›ç»„ä»¶å¸®åŠ©å¤§å®¶ç†è§£ä¸€ä¸‹åœ¨WebFluxä¸­å„ä¸ªç»„ä»¶çš„ä½œç”¨ï¼š\n\n\n![](https://img-blog.csdnimg.cn/20190610181202340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpeWFudGlhbm1pbg==,size_16,color_FFFFFF,t_70)\n\n\n![](https://img-blog.csdnimg.cn/20190303103722917.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pa2V6em1lcmlj,size_16,color_FFFFFF,t_70)\n\n\n### è¯·æ±‚å¤„ç†æµç¨‹\n\n\n![](https://img-blog.csdnimg.cn/20190302175319337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pa2V6em1lcmlj,size_16,color_FFFFFF,t_70)\n\n\n> RouterFunctionMappingä¸­æœ‰private RouterFunction<?> routerFunction;è¿™é‡Œé¢è¡¨é¢çœ‹èµ·æ¥åªæœ‰ä¸€ä¸ªBeanï¼Œå…¶å®å®ƒé‡Œé¢ç»„åˆäº†éå¸¸å¤šçš„RouterFunctionï¼Œå®ƒæ˜¯å¦‚ä½•æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚æ‰¾åˆ°å¯¹åº”çš„Functionçš„å‘¢ï¼Ÿ\n\n\n```text\n  // æŸ¥è¯¢å¤„ç†å™¨  @Override\tprotected Mono<?> getHandlerInternal(ServerWebExchange exchange) {    // è·¯ç”±å‡½æ•°æ˜¯å¦å­˜åœ¨\t\tif (this.routerFunction != null) {      // åˆ›å»ºè¯·æ±‚ï¼Œå¹¶ç»‘å®š\t\t\tServerRequest request = ServerRequest.create(exchange, this.messageReaders);\t\t\treturn this.routerFunction.route(request)\t\t\t\t\t.doOnNext(handler -> setAttributes(exchange.getAttributes(), request, handler));\t\t}\t\telse {      // æ²¡æœ‰ç›´æ¥ç©º\t\t\treturn Mono.empty();\t\t}\t}\n\n```\n\n\n> å…³é”®éƒ¨åˆ†å°±æ˜¯é€šè¿‡å®ƒçš„æˆå‘˜å˜é‡routerFunctionçš„routeæ–¹æ³•æ¥æ‰¾ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ç”¨æˆ·å†™çš„predicateæ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç›¸ç¬¦åˆï¼Œå¦‚æœç¬¦åˆå°±è¿”å›ä¸€ä¸ªMono<HandlerFunction<T>>\n\n\n```text\n\t\tpublic Mono<HandlerFunction<T>> route(ServerRequest request) {\t\t\t // routerFunction ä¸­çš„è·¯ç”±è°“è¯åŒ¹é…      if (this.predicate.test(request)) {\t\t\t\tif (logger.isTraceEnabled()) {\t\t\t\t\tString logPrefix = request.exchange().getLogPrefix();\t\t\t\t\tlogger.trace(logPrefix + String.format(\"Matched %s\", this.predicate));\t\t\t\t}\t\t\t\treturn Mono.just(this.handlerFunction);\t\t\t}\t\t\telse {\t\t\t\treturn Mono.empty();\t\t\t}\t\t}\n\n```\n\n\n![](https://img-blog.csdnimg.cn/20190303103821980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pa2V6em1lcmlj,size_16,color_FFFFFF,t_70)\n\n\n### æ€»ç»“\n\n\nååº”å¼ç¼–ç¨‹æ¡†æ¶ä¸»è¦é‡‡ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè€Œ Spring Reactorçš„æ ¸å¿ƒåˆ™æ˜¯å¯¹è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§è¡ä¼¸ã€‚å…³äºè§‚å¯Ÿè€…æ¨¡å¼çš„æ¶æ„ä¸­è¢«è§‚å¯Ÿè€…(Observable)å’Œè§‚å¯Ÿè€…(Subscriber)å¤„åœ¨ä¸åŒçš„çº¿ç¨‹ç¯å¢ƒä¸­æ—¶ï¼Œç”±äºè€…å„è‡ªçš„å·¥ä½œé‡ä¸ä¸€æ ·ï¼Œå¯¼è‡´å®ƒä»¬äº§ç”Ÿäº‹ä»¶å’Œå¤„ç†äº‹ä»¶çš„é€Ÿåº¦ä¸ä¸€æ ·ï¼Œè¿™æ—¶å°±å‡ºç°äº†ä¸¤ç§æƒ…å†µï¼š\n\n- è¢«è§‚å¯Ÿè€…äº§ç”Ÿäº‹ä»¶æ…¢ä¸€äº›ï¼Œè§‚å¯Ÿè€…å¤„ç†äº‹ä»¶å¾ˆå¿«ã€‚é‚£ä¹ˆè§‚å¯Ÿè€…å°±ä¼šç­‰ç€è¢«è§‚å¯Ÿè€…å‘é€äº‹ä»¶å¥½æ¯”è§‚å¯Ÿè€…åœ¨ç­‰ç±³ä¸‹é”…ï¼Œç¨‹åºç­‰å¾…ï¼‰ã€‚\n- è¢«è§‚å¯Ÿè€…äº§ç”Ÿäº‹ä»¶çš„é€Ÿåº¦å¾ˆå¿«ï¼Œè€Œè§‚å¯Ÿè€…å¤„ç†å¾ˆæ…¢ã€‚é‚£å°±å‡ºé—®é¢˜äº†ï¼Œå¦‚æœä¸ä½œå¤„ç†çš„è¯ï¼Œäº‹ä»¶ä¼šå †ç§¯èµ·æ¥ï¼Œæœ€ç»ˆæŒ¤çˆ†ä½ çš„å†…å­˜ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚ï¼ˆå¥½æ¯”è¢«è§‚å¯Ÿè€…ç”Ÿäº§çš„å¤§ç±³æ²¡äººåƒï¼Œå †ç§¯æœ€åå°±ä¼šçƒ‚æ‰ï¼‰ã€‚ä¸ºäº†æ–¹ä¾¿ä¸‹é¢ç†è§£Monoå’ŒFluxï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºPublisherï¼ˆå‘å¸ƒè€…ä¹Ÿå¯ä»¥ç†è§£ä¸ºè¢«è§‚å¯Ÿè€…ï¼‰ä¸»åŠ¨æ¨é€æ•°æ®ç»™Subscriberï¼ˆè®¢é˜…è€…ä¹Ÿå¯ä»¥å«è§‚å¯Ÿè€…ï¼‰ï¼Œå¦‚æœPublisherå‘å¸ƒæ¶ˆæ¯å¤ªå¿«ï¼Œè¶…è¿‡äº†Subscriberçš„å¤„ç†é€Ÿåº¦ï¼Œå¦‚ä½•å¤„ç†ã€‚è¿™æ—¶å°±å‡ºç°äº†Backpressureï¼ˆèƒŒå‹â€”â€“æŒ‡åœ¨å¼‚æ­¥åœºæ™¯ä¸­ï¼Œè¢«è§‚å¯Ÿè€…å‘é€äº‹ä»¶é€Ÿåº¦è¿œå¿«äºè§‚å¯Ÿè€…çš„å¤„ç†é€Ÿåº¦çš„æƒ…å†µä¸‹ï¼Œä¸€ç§å‘Šè¯‰ä¸Šæ¸¸çš„è¢«è§‚å¯Ÿè€…é™ä½å‘é€é€Ÿåº¦çš„ç­–ç•¥ï¼‰\n- WebFluxæå‡çš„å…¶å®å¾€å¾€æ˜¯ç³»ç»Ÿçš„ä¼¸ç¼©æ€§ï¼Œå¯¹äºé€Ÿåº¦çš„æå‡æ²¡æœ‰å¤ªå¤šçš„æ˜æ˜¾ã€‚\n- Reactive ç¼–ç¨‹å°½ç®¡æ²¡æœ‰æ–°å¢å¤§é‡çš„ä»£ç ï¼Œç„¶è€Œç¼–ç ï¼ˆå’Œè°ƒè¯•ï¼‰å´æ˜¯å˜å¾—æ›´ä¸ºå¤æ‚\n- ç°åœ¨é¢ä¸´çš„æœ€å¤§é—®é¢˜æ˜¯ç¼ºå°‘æ–‡æ¡£ã€‚åœ¨å¼€å‘åº”ç”¨ä¸­ç»™æˆ‘ä»¬é€ æˆäº†æœ€å¤§éšœç¢ã€‚ä¸”Spring WebFlux å°šæœªè¯æ˜è‡ªèº«æ˜æ˜¾åœ°ä¼˜äºSpring MVC\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2021-04-10",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "21",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "Java",
          "å“åº”å¼",
          "å¼‚æ­¥ç¼–ç¨‹",
          "WebFlux"
        ],
        "summary": "webFlux åˆè¯†LambdaLambda è¡¨è¾¾å¼ï¼Œæœ‰æ—¶å€™ä¹Ÿç§°ä¸ºåŒ¿åå‡½æ•°æˆ–ç®­å¤´å‡½æ•°ï¼Œå‡ ä¹åœ¨å½“å‰çš„å„ç§ä¸»æµçš„ç¼–ç¨‹è¯­è¨€ä¸­éƒ½æœ‰å®ƒçš„èº«å½±ã€‚Java8 ä¸­å¼•å…¥ Lambda è¡¨è¾¾å¼ï¼Œä½¿åŸæœ¬éœ€è¦ç”¨åŒ¿åç±»å®ç°æ¥å£",
        "sort": "",
        "title": "å“åº”å¼å¼€å‘ä¹‹webFlux & Reactor",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "a1eb98de-4986-46c0-b1ac-6846629d0819"
        }
      ],
      "body": "",
      "realName": "å“åº”å¼å¼€å‘ä¹‹webFlux & Reactor",
      "relativePath": "/archives/å“åº”å¼å¼€å‘ä¹‹webFlux & Reactor.md"
    },
    {
      "id": "807ec69b-8970-4659-8443-d224934a8e7f",
      "doc_id": "807ec69b-8970-4659-8443-d224934a8e7f",
      "title": "807ec69b-8970-4659-8443-d224934a8e7f",
      "updated": 1696747320000,
      "body_original": "\n# springBoot ä¸‰æ¿æ–§\n\n\n## AOP\n\n\n> aopæ˜¯ä¸€ç§é¢å‘åˆ‡é¢ç¼–ç¨‹ èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆç¼“å­˜ï¼Œé”ï¼‰ å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§\n\n\n> Spring AOPå°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„ï¼Œå¦‚æœè¦ä»£ç†çš„å¯¹è±¡ï¼Œå®ç°äº†æŸä¸ªæ¥å£ï¼Œé‚£ä¹ˆSpring AOPä¼šä½¿ç”¨JDK Proxyï¼Œå»åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè€Œå¯¹äºæ²¡æœ‰å®ç°æ¥å£çš„å¯¹è±¡ï¼Œå°±æ— æ³•ä½¿ç”¨ JDK Proxy å»è¿›è¡Œä»£ç†äº†ï¼Œè¿™æ—¶å€™Spring AOPä¼šä½¿ç”¨Cglib ï¼Œè¿™æ—¶å€™Spring AOPä¼šä½¿ç”¨ Cglib ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»æ¥ä½œä¸ºä»£ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![](https://blog-file.hehouhui.cn/SpringAOPProcess.jpg)\n\n\n## beanä½œç”¨åŸŸ\n\n- singleton : å”¯ä¸€ bean å®ä¾‹ï¼ŒSpring ä¸­çš„ bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚\n- prototype : æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚\n- request : æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„beanï¼Œè¯¥beanä»…åœ¨å½“å‰HTTP requestå†…æœ‰æ•ˆã€‚\n- session : æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼Œè¯¥beanä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚\n- global-sessionï¼š å…¨å±€sessionä½œç”¨åŸŸï¼Œä»…ä»…åœ¨åŸºäºportletçš„webåº”ç”¨ä¸­æ‰æœ‰æ„ä¹‰ï¼ŒSpring5å·²ç»æ²¡æœ‰äº†ã€‚Portletæ˜¯èƒ½å¤Ÿç”Ÿæˆè¯­ä¹‰ä»£ç (ä¾‹å¦‚ï¼šHTML)ç‰‡æ®µçš„å°å‹Java Webæ’ä»¶ã€‚å®ƒä»¬åŸºäºportletå®¹å™¨ï¼Œå¯ä»¥åƒservletä¸€æ ·å¤„ç†HTTPè¯·æ±‚ã€‚ä½†æ˜¯ï¼Œä¸ servlet ä¸åŒï¼Œæ¯ä¸ª portlet éƒ½æœ‰ä¸åŒçš„ä¼šè¯\n\n### beanæ˜¯å¦çº¿ç¨‹å®‰å…¨\n\n\nçš„ç¡®æ˜¯å­˜åœ¨å®‰å…¨é—®é¢˜çš„ã€‚å› ä¸ºï¼Œå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è¿™ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡çš„å†™æ“ä½œä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\n\n\nä½†æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ `Controller`ã€`Service`ã€`Dao` è¿™äº› Bean æ˜¯æ— çŠ¶æ€çš„ã€‚æ— çŠ¶æ€çš„ Bean ä¸èƒ½ä¿å­˜æ•°æ®ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\n\n\nå¸¸è§çš„æœ‰ 2 ç§è§£å†³åŠæ³•ï¼š\n\n1. åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ª `ThreadLocal` æˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ `ThreadLocal` ä¸­ï¼ˆæ¨èçš„ä¸€ç§æ–¹å¼ï¼‰ã€‚\n2. æ”¹å˜ Bean çš„ä½œç”¨åŸŸä¸º â€œprototypeâ€ï¼šæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ï¼Œè‡ªç„¶ä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\n\n### ç”Ÿå‘½å‘¨æœŸ\n\n- Bean å®¹å™¨æ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­ Spring Bean çš„å®šä¹‰ã€‚\n- Bean å®¹å™¨åˆ©ç”¨ Java Reflection API åˆ›å»ºä¸€ä¸ªBeançš„å®ä¾‹ã€‚\n- å¦‚æœæ¶‰åŠåˆ°ä¸€äº›å±æ€§å€¼ åˆ©ç”¨ `set()`æ–¹æ³•è®¾ç½®ä¸€äº›å±æ€§å€¼ã€‚\n- å¦‚æœ Bean å®ç°äº† `BeanNameAware` æ¥å£ï¼Œè°ƒç”¨ `setBeanName()`æ–¹æ³•ï¼Œä¼ å…¥Beançš„åå­—ã€‚\n- å¦‚æœ Bean å®ç°äº† `BeanClassLoaderAware` æ¥å£ï¼Œè°ƒç”¨ `setBeanClassLoader()`æ–¹æ³•ï¼Œä¼ å…¥ `ClassLoader`å¯¹è±¡çš„å®ä¾‹ã€‚\n- ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œå¦‚æœå®ç°äº†å…¶ä»– `.Aware`æ¥å£ï¼Œå°±è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚\n- å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Bean çš„ Spring å®¹å™¨ç›¸å…³çš„ `BeanPostProcessor` å¯¹è±¡ï¼Œæ‰§è¡Œ`postProcessBeforeInitialization()` æ–¹æ³•\n- å¦‚æœBeanå®ç°äº†`InitializingBean`æ¥å£ï¼Œæ‰§è¡Œ`afterPropertiesSet()`æ–¹æ³•ã€‚\n- å¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« init-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚\n- å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Beançš„ Spring å®¹å™¨ç›¸å…³çš„ `BeanPostProcessor` å¯¹è±¡ï¼Œæ‰§è¡Œ`postProcessAfterInitialization()` æ–¹æ³•\n- å½“è¦é”€æ¯ Bean çš„æ—¶å€™ï¼Œå¦‚æœ Bean å®ç°äº† `DisposableBean` æ¥å£ï¼Œæ‰§è¡Œ `destroy()` æ–¹æ³•ã€‚\n- å½“è¦é”€æ¯ Bean çš„æ—¶å€™ï¼Œå¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« destroy-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚\n\n![](https://blog-file.hehouhui.cn/48376272.jpg)\n\n\n![](https://blog-file.hehouhui.cn/5496407.jpg)\n\n\n## MVC\n\n\n![](https://blog-file.hehouhui.cn/49790288.jpg)\n\n\n**æµç¨‹è¯´æ˜ï¼ˆé‡è¦ï¼‰ï¼š**\n\n1. å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ï¼Œç›´æ¥è¯·æ±‚åˆ° `DispatcherServlet`ã€‚\n2. `DispatcherServlet` æ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨ `HandlerMapping`ï¼Œè§£æè¯·æ±‚å¯¹åº”çš„ `Handler`ã€‚\n3. è§£æåˆ°å¯¹åº”çš„ `Handler`ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„ `Controller` æ§åˆ¶å™¨ï¼‰åï¼Œå¼€å§‹ç”± `HandlerAdapter` é€‚é…å™¨å¤„ç†ã€‚\n4. `HandlerAdapter` ä¼šæ ¹æ® `Handler` æ¥è°ƒç”¨çœŸæ­£çš„å¤„ç†å™¨æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶å¤„ç†ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚\n5. å¤„ç†å™¨å¤„ç†å®Œä¸šåŠ¡åï¼Œä¼šè¿”å›ä¸€ä¸ª `ModelAndView` å¯¹è±¡ï¼Œ`Model` æ˜¯è¿”å›çš„æ•°æ®å¯¹è±¡ï¼Œ`View` æ˜¯ä¸ªé€»è¾‘ä¸Šçš„ `View`ã€‚\n6. `ViewResolver` ä¼šæ ¹æ®é€»è¾‘ `View` æŸ¥æ‰¾å®é™…çš„ `View`ã€‚\n7. `DispaterServlet` æŠŠè¿”å›çš„ `Model` ä¼ ç»™ `View`ï¼ˆè§†å›¾æ¸²æŸ“ï¼‰ã€‚\n8. æŠŠ `View` è¿”å›ç»™è¯·æ±‚è€…ï¼ˆæµè§ˆå™¨ï¼‰\n\n## æœ‰å“ªäº›è®¾è®¡æ¨¡å¼\n\n- **å·¥å‚è®¾è®¡æ¨¡å¼** : Springä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ `BeanFactory`ã€`ApplicationContext` åˆ›å»º bean å¯¹è±¡ã€‚\n- **ä»£ç†è®¾è®¡æ¨¡å¼** : Spring AOP åŠŸèƒ½çš„å®ç°ã€‚\n- **å•ä¾‹è®¾è®¡æ¨¡å¼** : Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚\n- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼** : Spring ä¸­ `jdbcTemplate`ã€`hibernateTemplate` ç­‰ä»¥ Template ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚\n- **åŒ…è£…å™¨è®¾è®¡æ¨¡å¼** : æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œè€Œä¸”ä¸åŒçš„å®¢æˆ·åœ¨æ¯æ¬¡è®¿é—®ä¸­æ ¹æ®éœ€è¦ä¼šå»è®¿é—®ä¸åŒçš„æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è®©æˆ‘ä»¬å¯ä»¥æ ¹æ®å®¢æˆ·çš„éœ€æ±‚èƒ½å¤ŸåŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºã€‚\n- **è§‚å¯Ÿè€…æ¨¡å¼:** Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚\n- **é€‚é…å™¨æ¨¡å¼** :Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é…`Controller`ã€‚\n\n## äº‹åŠ¡\n\n\n### äº‹åŠ¡æ–¹å¼\n\n1. ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œåœ¨ä»£ç ä¸­ç¡¬ç¼–ç ã€‚(ä¸æ¨èä½¿ç”¨)\n2. å£°æ˜å¼äº‹åŠ¡ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼ˆæ¨èä½¿ç”¨ï¼‰\n\n**å£°æ˜å¼äº‹åŠ¡åˆåˆ†ä¸ºä¸¤ç§ï¼š**\n\n1. åŸºäºXMLçš„å£°æ˜å¼äº‹åŠ¡\n2. åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡\n\n### éš”ç¦»çº§åˆ«\n\n\n**ransactionDefinition æ¥å£ä¸­å®šä¹‰äº†äº”ä¸ªè¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å¸¸é‡ï¼š**\n\n- **TransactionDefinition.ISOLATION_DEFAULT:** ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ŒMysql é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READéš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTEDéš”ç¦»çº§åˆ«.\n- **TransactionDefinition.ISOLATION_READ_UNCOMMITTED:** æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ**å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»**\n- **TransactionDefinition.ISOLATION_READ_COMMITTED:** å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ**å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ**\n- **TransactionDefinition.ISOLATION_REPEATABLE_READ:** å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ**å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚**\n- **TransactionDefinition.ISOLATION_SERIALIZABLE:** æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»**ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚\n\n### ä¼ æ’­è¡Œä¸º\n\n\n**æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µï¼š**\n\n- **TransactionDefinition.PROPAGATION_REQUIREDï¼š** å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚\n- **TransactionDefinition.PROPAGATION_SUPPORTSï¼š** å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚\n- **TransactionDefinition.PROPAGATION_MANDATORYï¼š** å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ï¼ˆmandatoryï¼šå¼ºåˆ¶æ€§ï¼‰\n\n**ä¸æ”¯æŒå½“å‰äº‹åŠ¡çš„æƒ…å†µï¼š**\n\n- **TransactionDefinition.PROPAGATION_REQUIRES_NEWï¼š** åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚\n- **TransactionDefinition.PROPAGATION_NOT_SUPPORTEDï¼š** ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚\n- **TransactionDefinition.PROPAGATION_NEVERï¼š** ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚\n\n**å…¶ä»–æƒ…å†µï¼š**\n\n- **TransactionDefinition.PROPAGATION_NESTEDï¼š** å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™è¯¥å–å€¼ç­‰ä»·äºTransactionDefinition.PROPAGATION_REQUIREDã€‚\n\n## IOC\n\n\n> IOCæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå®ƒæœ‰ä¸€ä¸ªå®¹å™¨ç”¨æ¥å­˜æ”¾å¯¹è±¡å¼•ç”¨ã€‚IoC å®¹å™¨æ˜¯ Spring ç”¨æ¥å®ç° IoC çš„è½½ä½“ å°†åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒï¼Œäº¤ç”±Springæ¡†æ¶æ¥ç®¡ç† IoC å®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ªMapï¼ˆkeyï¼Œvalueï¼‰,Map ä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡ã€‚\n\n\n> Spring IoCçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š\n\n\n![](https://blog-file.hehouhui.cn/SpringIOC%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B.png)\n\n\n### springæ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–\n\n\nSpringæ•´ä¸ªè§£å†³å¾ªç¯ä¾èµ–é—®é¢˜çš„å®ç°æ€è·¯å·²ç»æ¯”è¾ƒæ¸…æ¥šäº†ã€‚å¯¹äºæ•´ä½“è¿‡ç¨‹ï¼Œè¯»è€…æœ‹å‹åªè¦ç†è§£ä¸¤ç‚¹ï¼š\n\n- Springæ˜¯é€šè¿‡é€’å½’çš„æ–¹å¼è·å–ç›®æ ‡beanåŠå…¶æ‰€ä¾èµ–çš„beançš„ï¼›\n- Springå®ä¾‹åŒ–ä¸€ä¸ªbeançš„æ—¶å€™ï¼Œæ˜¯åˆ†ä¸¤æ­¥è¿›è¡Œçš„ï¼Œé¦–å…ˆå®ä¾‹åŒ–ç›®æ ‡beanï¼Œç„¶åä¸ºå…¶æ³¨å…¥å±æ€§ã€‚\n\nç»“åˆè¿™ä¸¤ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒSpringåœ¨å®ä¾‹åŒ–ä¸€ä¸ªbeançš„æ—¶å€™ï¼Œæ˜¯é¦–å…ˆé€’å½’çš„å®ä¾‹åŒ–å…¶æ‰€ä¾èµ–çš„æ‰€æœ‰beanï¼Œç›´åˆ°æŸä¸ªbeanæ²¡æœ‰ä¾èµ–å…¶ä»–beanï¼Œæ­¤æ—¶å°±ä¼šå°†è¯¥å®ä¾‹è¿”å›ï¼Œç„¶ååé€’å½’çš„å°†è·å–åˆ°çš„beanè®¾ç½®ä¸ºå„ä¸ªä¸Šå±‚beançš„å±æ€§çš„ã€‚\n\n\n**ä¸‰çº§ç¼“å­˜**\n\n\n> å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼ŒSpringä¸»è¦çš„æ€è·¯å°±æ˜¯ä¾æ®ä¸‰çº§ç¼“å­˜ï¼Œåœ¨å®ä¾‹åŒ–Aæ—¶è°ƒç”¨doGetBeanï¼Œå‘ç°Aä¾èµ–çš„Bçš„å®ä¾‹ï¼Œæ­¤æ—¶è°ƒç”¨doGetBeanå»å®ä¾‹Bï¼Œå®ä¾‹åŒ–çš„Bçš„æ—¶å€™å‘ç°åˆä¾èµ–Aï¼Œå¦‚æœä¸è§£å†³è¿™ä¸ªå¾ªç¯ä¾èµ–çš„è¯æ­¤æ—¶çš„doGetBeanå°†ä¼šæ— é™å¾ªç¯ä¸‹å»ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œç¨‹åºå¥”æºƒã€‚springå¼•ç”¨äº†ä¸€ä¸ªæ—©æœŸå¯¹è±¡ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ª\"æ—©æœŸå¼•ç”¨\"å¹¶å°†å…¶æ³¨å…¥åˆ°å®¹å™¨ä¸­ï¼Œè®©Bå…ˆå®Œæˆå®ä¾‹åŒ–ï¼Œæ­¤æ—¶Aå°±è·å–Bçš„å¼•ç”¨ï¼Œå®Œæˆå®ä¾‹åŒ–ã€‚\n\n\nSpringèƒ½å¤Ÿè½»æ¾çš„è§£å†³å±æ€§çš„å¾ªç¯ä¾èµ–æ­£å¼ç”¨åˆ°äº†ä¸‰çº§ç¼“å­˜ï¼Œåœ¨AbstractBeanFactoryä¸­æœ‰è¯¦ç»†çš„æ³¨é‡Šã€‚\n\n\n![](https://blog-file.hehouhui.cn/267f9e2f07082838a8dc0415ac9cc8074d08f1ee.jpeg)\n\n\nä¸€çº§ç¼“å­˜ï¼šsingletonObjectsï¼Œå­˜æ”¾å®Œå…¨å®ä¾‹åŒ–å±æ€§èµ‹å€¼å®Œæˆçš„Beanï¼Œç›´æ¥å¯ä»¥ä½¿ç”¨ã€‚äºŒçº§ç¼“å­˜ï¼šearlySingletonObjectsï¼Œå­˜æ”¾æ—©æœŸBeançš„å¼•ç”¨ï¼Œå°šæœªå±æ€§è£…é…çš„Beanä¸‰çº§ç¼“å­˜ï¼šsingletonFactoriesï¼Œä¸‰çº§ç¼“å­˜ï¼Œå­˜æ”¾å®ä¾‹åŒ–å®Œæˆçš„Beanå·¥å‚ã€‚\n\n\næ ¹æ®ä»¥ä¸Šçš„åˆ†æï¼Œå¤§æ¦‚æ¸…æ¥šäº†Springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„ã€‚å‡è®¾Aä¾èµ–Bï¼ŒBä¾èµ–Aï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ˜¯setå±æ€§ä¾èµ–ï¼‰åˆ†ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œï¼šAä¾æ¬¡æ‰§è¡Œ**doGetBean**ã€æŸ¥è¯¢ç¼“å­˜ã€**createBean**åˆ›å»ºå®ä¾‹ï¼Œå®ä¾‹åŒ–å®Œæˆæ”¾å…¥ä¸‰çº§ç¼“å­˜singletonFactoriesä¸­ï¼Œæ¥ç€æ‰§è¡Œ**populateBean**æ–¹æ³•è£…é…å±æ€§ï¼Œä½†æ˜¯å‘ç°æœ‰ä¸€ä¸ªå±æ€§æ˜¯Bçš„å¯¹è±¡ã€‚å› æ­¤å†æ¬¡è°ƒç”¨doGetBeanæ–¹æ³•åˆ›å»ºBçš„å®ä¾‹ï¼Œä¾æ¬¡æ‰§è¡ŒdoGetBeanã€æŸ¥è¯¢ç¼“å­˜ã€createBeanåˆ›å»ºå®ä¾‹ï¼Œå®ä¾‹åŒ–å®Œæˆä¹‹åæ”¾å…¥ä¸‰çº§ç¼“å­˜singletonFactoriesä¸­ï¼Œæ‰§è¡ŒpopulateBeanè£…é…å±æ€§ï¼Œä½†æ˜¯æ­¤æ—¶å‘ç°æœ‰ä¸€ä¸ªå±æ€§æ˜¯Aå¯¹è±¡ã€‚å› æ­¤å†æ¬¡è°ƒç”¨doGetBeanåˆ›å»ºAçš„å®ä¾‹ï¼Œä½†æ˜¯æ‰§è¡Œåˆ°getSingletonæŸ¥è¯¢ç¼“å­˜çš„æ—¶å€™ï¼Œä»ä¸‰çº§ç¼“å­˜ä¸­æŸ¥è¯¢åˆ°äº†Açš„å®ä¾‹(æ—©æœŸå¼•ç”¨ï¼Œæœªå®Œæˆå±æ€§è£…é…)ï¼Œæ­¤æ—¶ç›´æ¥è¿”å›Aï¼Œä¸ç”¨æ‰§è¡Œåç»­çš„æµç¨‹åˆ›å»ºAäº†ï¼Œé‚£ä¹ˆBå°±å®Œæˆäº†å±æ€§è£…é…ï¼Œæ­¤æ—¶æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡æ”¾å…¥åˆ°ä¸€çº§ç¼“å­˜singletonObjectsä¸­ã€‚Båˆ›å»ºå®Œæˆäº†ï¼Œåˆ™Aè‡ªç„¶å®Œæˆäº†å±æ€§è£…é…ï¼Œä¹Ÿåˆ›å»ºå®Œæˆæ”¾å…¥äº†ä¸€çº§ç¼“å­˜singletonObjectsä¸­ã€‚Springä¸‰çº§ç¼“å­˜çš„åº”ç”¨å®Œç¾çš„è§£å†³äº†å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Œä¸‹é¢æ˜¯å¾ªç¯ä¾èµ–çš„è§£å†³æµç¨‹å›¾ã€‚\n\n\n![](https://blog-file.hehouhui.cn/3b292df5e0fe9925237cd9d720ad3fd98cb171d4.jpeg)\n\n\n## SPIï¼ˆè‡ªåŠ¨è£…é…)\n\n\n1ï¼‰SPIæ€æƒ³\n\n- SPIçš„å…¨åä¸ºService Provider Interface.è¿™ä¸ªæ˜¯é’ˆå¯¹å‚å•†æˆ–è€…æ’ä»¶çš„ã€‚\n- SPIçš„æ€æƒ³ï¼šç³»ç»Ÿé‡ŒæŠ½è±¡çš„å„ä¸ªæ¨¡å—ï¼Œå¾€å¾€æœ‰å¾ˆå¤šä¸åŒçš„å®ç°æ–¹æ¡ˆï¼Œæ¯”å¦‚æ—¥å¿—æ¨¡å—çš„æ–¹æ¡ˆï¼Œxmlè§£ææ¨¡å—ã€jdbcæ¨¡å—çš„æ–¹æ¡ˆç­‰ã€‚é¢å‘çš„å¯¹è±¡çš„è®¾è®¡é‡Œï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¨èæ¨¡å—ä¹‹é—´åŸºäºæ¥å£ç¼–ç¨‹ï¼Œæ¨¡å—ä¹‹é—´ä¸å¯¹å®ç°ç±»è¿›è¡Œç¡¬ç¼–ç ã€‚ä¸€æ—¦ä»£ç é‡Œæ¶‰åŠå…·ä½“çš„å®ç°ç±»ï¼Œå°±è¿åäº†å¯æ‹”æ’çš„åŸåˆ™ï¼Œå¦‚æœéœ€è¦æ›¿æ¢ä¸€ç§å®ç°ï¼Œå°±éœ€è¦ä¿®æ”¹ä»£ç ã€‚ä¸ºäº†å®ç°åœ¨æ¨¡å—è£…é…çš„æ—¶å€™èƒ½ä¸åœ¨ç¨‹åºé‡ŒåŠ¨æ€æŒ‡æ˜ï¼Œè¿™å°±éœ€è¦ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ã€‚**java spiå°±æ˜¯æä¾›è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ï¼šä¸ºæŸä¸ªæ¥å£å¯»æ‰¾æœåŠ¡å®ç°çš„æœºåˆ¶**\n\nï¼ˆ2ï¼‰SPIçº¦å®š\n\n- å½“æœåŠ¡çš„æä¾›è€…ï¼Œæä¾›äº†æœåŠ¡æ¥å£çš„ä¸€ç§å®ç°ä¹‹åï¼Œåœ¨jaråŒ…çš„META-INF/services/ç›®å½•é‡ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªä»¥æœåŠ¡æ¥å£å‘½åçš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶é‡Œå°±æ˜¯å®ç°è¯¥æœåŠ¡æ¥å£çš„å…·ä½“å®ç°ç±»ã€‚è€Œå½“å¤–éƒ¨ç¨‹åºè£…é…è¿™ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œå°±èƒ½é€šè¿‡è¯¥jaråŒ…META-INF/services/é‡Œçš„é…ç½®æ–‡ä»¶æ‰¾åˆ°å…·ä½“çš„å®ç°ç±»åï¼Œå¹¶è£…è½½å®ä¾‹åŒ–ï¼Œå®Œæˆæ¨¡å—çš„æ³¨å…¥ã€‚é€šè¿‡è¿™ä¸ªçº¦å®šï¼Œå°±ä¸éœ€è¦æŠŠæœåŠ¡æ”¾åœ¨ä»£ç ä¸­äº†ï¼Œé€šè¿‡æ¨¡å—è¢«è£…é…çš„æ—¶å€™å°±å¯ä»¥å‘ç°æœåŠ¡ç±»äº†ã€‚\n\n> springbootæœ€é‡è¦çš„ç‰¹æ€§å°±æ˜¯è‡ªåŠ¨é…ç½®ï¼Œè®¸å¤šåŠŸèƒ½ä¸éœ€è¦æ‰‹åŠ¨å¼€å¯ï¼Œä¼šè‡ªåŠ¨å¸®åŠ©ç¨‹åºå‘˜å¼€å¯ï¼Œå¦‚æœæƒ³æ‰©å±•æŸäº›\n\n\n\tç¬¬ä¸‰æ–¹ç»„ä»¶çš„åŠŸèƒ½ï¼Œä¾‹å¦‚mybatisï¼Œåªéœ€è¦é…ç½®ä¾èµ–ï¼Œå°±å¯ä»¥äº†ï¼Œè¿™å…¶ä¸­éƒ½æ˜¯éœ€è¦SPIæ”¯æŒå®ç°çš„ï¼Œä¸‹é¢æˆ‘ä»¬ä»æºç \n\n\n\tå±‚é¢çœ‹çœ‹springbootå¦‚ä½•é€šè¿‡spiæœºåˆ¶å®ç°è‡ªåŠ¨é…ç½®çš„ã€‚\n\n\n### spring.factories\n\n\n`åŠ è½½æ‰€æœ‰å·¥ç¨‹ä¸­META-INF/spring.factoriesæ–‡ä»¶ä¸­çš„é…ç½®`\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710172626394-125453546.png)\n\n\nåˆ›å»ºSpringApplicationå¯¹è±¡ï¼š\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710172809055-563196645.png)\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710174643727-898888706.png)\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710174806671-2008924729.png)\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710174910758-1821038900.png)\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710175407768-329869967.png)\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710175505244-1271936908.png)\n\n\næˆ‘ä»¬éšä¾¿çœ‹ä¸€ä¸ªå·¥ç¨‹çš„ç›®å½•ï¼šspring-boot-autoconfigure å·¥ç¨‹ä¸‹META-INF ç›®å½•ä¸‹çš„spring.factoriesæ–‡ä»¶çš„å†…å®¹ï¼Œ é…ç½®ç±»ä¼¼map ï¼Œkeyä¸ºæŸä¸€é¡¹ï¼Œvalueä¸ºå®ç°é›†åˆ\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710175629357-1831178468.png)\n\n\nè¿™å°±æ˜¯Spiçš„åŠ è½½æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„æ–¹å¼å®ç°å’Œä¸šåŠ¡ä»£ç çš„è§£è€¦ï¼Œéœ€è¦å¢åŠ æ—¶ç›´æ¥é…ç½®åˆ°æ–‡ä»¶å†…ã€‚\n\n\nè¿™ä¸€æ­¥æ˜¯åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼ŒåŠ è½½æ‰€æœ‰çš„factorynameçš„å€¼åˆ°ç¼“å­˜ï¼ŒåŒ…æ‹¬è‡ªåŠ¨é…ç½®çš„ã€‚\n\n\n### å¦‚ä½•å¯»æ‰¾å¹¶æ³¨å†Œ\n\n\nçœ‹ä¸€ä¸‹è¿™ä¸ªæ³¨è§£@SpringBootApplication\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710182840439-1132246697.png)\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710183026874-1157551085.png)\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710183110415-288019503.png)\n\n\nçœ‹ä¸€ä¸‹è¿™ä¸ªç±»çš„å†…å®¹ï¼šç±»é‡Œé¢æœ‰è·å–è‡ªåŠ¨é…ç½®çš„æ–¹æ³•getAutoConfigrationEntry\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710183217611-972487277.png)\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710183307950-573299482-20211227103446740.png)\n\n\n![](https://blog-file.hehouhui.cn/822721-20200710183320075-132538192.png)\n\n\nå°±æ˜¯ä»ä¸Šä¸€æ­¥ç¼“å­˜resultä¸­æŸ¥è¯¢æ‰€æœ‰çš„EnableAutoConfigurationçš„valueé›†åˆï¼Œ\n\n\nè¿™ä¸€èŠ‚ä¸»è¦åˆ†æspiæœºåˆ¶åŠ è½½spring.factoriesçš„é…ç½®é¡¹ï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬æ¥åˆ†æè‡ªåŠ¨é…ç½®çš„åŠ è½½æµç¨‹\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2021-12-27",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "24",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "Java"
        ],
        "summary": "springBoot ä¸‰æ¿æ–§AOPaopæ˜¯ä¸€ç§é¢å‘åˆ‡é¢ç¼–ç¨‹ èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆç¼“å­˜ï¼Œé”ï¼‰ å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯",
        "sort": "",
        "title": "springBootä¸‰å‰‘å®¢",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "807ec69b-8970-4659-8443-d224934a8e7f"
        }
      ],
      "body": "",
      "realName": "springBootä¸‰å‰‘å®¢",
      "relativePath": "/archives/springBootä¸‰å‰‘å®¢.md"
    },
    {
      "id": "f81c2940-d22e-4782-9d95-d16b57f6d3f4",
      "doc_id": "f81c2940-d22e-4782-9d95-d16b57f6d3f4",
      "title": "f81c2940-d22e-4782-9d95-d16b57f6d3f4",
      "updated": 1696747320000,
      "body_original": "\n## ä¸€è‡´æ€§hash\n\n\n> åœ¨Redis é›†ç¾¤æ¨¡å¼Clusterä¸­ï¼ŒRedisé‡‡ç”¨çš„æ˜¯åˆ†ç‰‡Shardingçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®é‡‡ç”¨ä¸€å®šçš„åˆ†åŒºç­–ç•¥ï¼Œåˆ†å‘åˆ°ç›¸åº”çš„é›†ç¾¤èŠ‚ç‚¹ä¸­ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°HASHç®—æ³•è¿›è¡Œç¼“å­˜æ—¶ï¼Œä¼šå‡ºç°ä¸€äº›ç¼ºé™·ï¼Œä¸»è¦ä½“ç°åœ¨æœåŠ¡å™¨æ•°é‡å˜åŠ¨çš„æ—¶å€™ï¼Œæ‰€æœ‰ç¼“å­˜çš„ä½ç½®éƒ½è¦å‘ç”Ÿæ”¹å˜ï¼å…·ä½“æ¥è®²å°±æ˜¯è¯´ç¬¬ä¸€å½“ç¼“å­˜æœåŠ¡å™¨æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå¼•èµ·ç¼“å­˜çš„é›ªå´©ï¼Œå¯èƒ½ä¼šå¼•èµ·æ•´ä½“ç³»ç»Ÿå‹åŠ›è¿‡å¤§è€Œå´©æºƒï¼ˆå¤§é‡ç¼“å­˜åŒä¸€æ—¶é—´å¤±æ•ˆï¼‰ã€‚ç¬¬äºŒå½“ç¼“å­˜æœåŠ¡å™¨æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‡ ä¹æ‰€æœ‰ç¼“å­˜çš„ä½ç½®éƒ½ä¼šå‘ç”Ÿæ”¹å˜ã€‚\n\n\nä¸€è‡´æ€§Hashç®—æ³•ä¹Ÿæ˜¯ä½¿ç”¨å–æ¨¡çš„æ–¹æ³•ï¼Œåªæ˜¯ï¼Œåˆšæ‰æè¿°çš„å–æ¨¡æ³•æ˜¯å¯¹æœåŠ¡å™¨çš„æ•°é‡è¿›è¡Œå–æ¨¡ï¼Œè€Œä¸€è‡´æ€§Hashç®—æ³•æ˜¯å¯¹232å–æ¨¡ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œä¸€è‡´æ€§Hashç®—æ³•å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œå¦‚å‡è®¾æŸå“ˆå¸Œå‡½æ•°Hçš„å€¼ç©ºé—´ä¸º0-232-1ï¼ˆå³å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å½¢ï¼‰ï¼Œæ•´ä¸ªå“ˆå¸Œç¯å¦‚ä¸‹ï¼š\n\n\næ•´ä¸ªç©ºé—´æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ï¼Œåœ†ç¯çš„æ­£ä¸Šæ–¹çš„ç‚¹ä»£è¡¨0ï¼Œ0ç‚¹å³ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨1ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ2ã€3ã€4ã€5ã€6â€¦â€¦ç›´åˆ°232-1ï¼Œä¹Ÿå°±æ˜¯è¯´0ç‚¹å·¦ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨232-1ï¼Œ 0å’Œ232-1åœ¨é›¶ç‚¹ä¸­æ–¹å‘é‡åˆï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç”±232ä¸ªç‚¹ç»„æˆçš„åœ†ç¯ç§°ä¸ºHashç¯ã€‚\n\n\né‚£ä¹ˆï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸ä¸Šå›¾ä¸­çš„åœ†ç¯æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­èŠï¼Œä»ç„¶ä»¥ä¹‹å‰æè¿°çš„åœºæ™¯ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰4å°ç¼“å­˜æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨Aã€æœåŠ¡å™¨Bã€æœåŠ¡å™¨Cï¼ŒæœåŠ¡å™¨Dï¼Œé‚£ä¹ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™4å°æœåŠ¡å™¨è‚¯å®šæœ‰è‡ªå·±çš„IPåœ°å€æˆ–ä¸»æœºåï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒä»¬å„è‡ªçš„IPåœ°å€æˆ–ä¸»æœºåä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œä½¿ç”¨å“ˆå¸Œåçš„ç»“æœå¯¹2^32å–æ¨¡ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å…¬å¼ç¤ºæ„ï¼š\n\n\nhashï¼ˆæœåŠ¡å™¨Açš„IPåœ°å€ï¼‰ %  2^32\n\n\né€šè¿‡ä¸Šè¿°å…¬å¼ç®—å‡ºçš„ç»“æœä¸€å®šæ˜¯ä¸€ä¸ª0åˆ°232-1ä¹‹é—´çš„ä¸€ä¸ªæ•´æ•°ï¼Œæˆ‘ä»¬å°±ç”¨ç®—å‡ºçš„è¿™ä¸ªæ•´æ•°ï¼Œä»£è¡¨æœåŠ¡å™¨Aï¼Œæ—¢ç„¶è¿™ä¸ªæ•´æ•°è‚¯å®šå¤„äº0åˆ°232-1ä¹‹é—´ï¼Œé‚£ä¹ˆï¼Œä¸Šå›¾ä¸­çš„hashç¯ä¸Šå¿…å®šæœ‰ä¸€ä¸ªç‚¹ä¸è¿™ä¸ªæ•´æ•°å¯¹åº”ï¼Œè€Œæˆ‘ä»¬åˆšæ‰å·²ç»è¯´æ˜ï¼Œä½¿ç”¨è¿™ä¸ªæ•´æ•°ä»£è¡¨æœåŠ¡å™¨Aï¼Œé‚£ä¹ˆï¼ŒæœåŠ¡å™¨Aå°±å¯ä»¥æ˜ å°„åˆ°è¿™ä¸ªç¯ä¸Šã€‚\n\n\nä»¥æ­¤ç±»æ¨ï¼Œä¸‹ä¸€æ­¥å°†å„ä¸ªæœåŠ¡å™¨ä½¿ç”¨ç±»ä¼¼çš„Hashç®—å¼è¿›è¡Œä¸€ä¸ªå“ˆå¸Œï¼Œè¿™æ ·æ¯å°æœºå™¨å°±èƒ½ç¡®å®šå…¶åœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ï¼Œè¿™é‡Œå‡è®¾å°†ä¸Šæ–‡ä¸­å››å°æœåŠ¡å™¨ä½¿ç”¨IPåœ°å€å“ˆå¸Œååœ¨ç¯ç©ºé—´çš„ä½ç½®å¦‚ä¸‹ï¼š\n\n\næ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹ç®—æ³•å®šä½æ•°æ®è®¿é—®åˆ°ç›¸åº”æœåŠ¡å™¨ï¼š å°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œå¹¶ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨ï¼\n\n\n### Hashç®—æ³•çš„å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§\n\n\nç°å‡è®¾Node Cä¸å¹¸å®•æœºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å¯¹è±¡Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Cå¯¹è±¡è¢«é‡å®šä½åˆ°Node Dã€‚ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§Hashç®—æ³•ä¸­ï¼Œå¦‚æœä¸€å°æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒä¸ä¼šå—åˆ°å½±å“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n\n![image-20210228225729174](/Users/hehui/Library/Application Support/typora-user-images/image-20210228225729174.png)\n\n\nä¸‹é¢è€ƒè™‘å¦å¤–ä¸€ç§æƒ…å†µï¼Œå¦‚æœåœ¨ç³»ç»Ÿä¸­å¢åŠ ä¸€å°æœåŠ¡å™¨Node Xï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![image-20210228225716137](/Users/hehui/Library/Application Support/typora-user-images/image-20210228225716137.png)\n\n\næ­¤æ—¶å¯¹è±¡Object Aã€Bã€Dä¸å—å½±å“ï¼Œåªæœ‰å¯¹è±¡Céœ€è¦é‡å®šä½åˆ°æ–°çš„Node X ï¼ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§Hashç®—æ³•ä¸­ï¼Œå¦‚æœå¢åŠ ä¸€å°æœåŠ¡å™¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ–°æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒæ•°æ®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚\n\n\nç»¼ä¸Šæ‰€è¿°ï¼Œä¸€è‡´æ€§Hashç®—æ³•å¯¹äºèŠ‚ç‚¹çš„å¢å‡éƒ½åªéœ€é‡å®šä½ç¯ç©ºé—´ä¸­çš„ä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œå…·æœ‰è¾ƒå¥½çš„å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§ã€‚\n\n\n### æ•°æ®å€¾æ–œé—®é¢˜\n\n\nä¸€è‡´æ€§Hashç®—æ³•åœ¨æœåŠ¡èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†éƒ¨ä¸å‡åŒ€è€Œé€ æˆæ•°æ®å€¾æ–œï¼ˆè¢«ç¼“å­˜çš„å¯¹è±¡å¤§éƒ¨åˆ†é›†ä¸­ç¼“å­˜åœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šï¼‰é—®é¢˜ï¼Œä¾‹å¦‚ç³»ç»Ÿä¸­åªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œå…¶ç¯åˆ†å¸ƒå¦‚ä¸‹ï¼š\n\n\n![image-20210228225828563](/Users/hehui/Library/Application Support/typora-user-images/image-20210228225828563.png)\n\n\næ­¤æ—¶å¿…ç„¶é€ æˆå¤§é‡æ•°æ®é›†ä¸­åˆ°Node Aä¸Šï¼Œè€Œåªæœ‰æå°‘é‡ä¼šå®šä½åˆ°Node Bä¸Šï¼Œä»è€Œå‡ºç°hashç¯åæ–œçš„æƒ…å†µï¼Œå½“hashç¯åæ–œä»¥åï¼Œç¼“å­˜å¾€å¾€ä¼šæåº¦ä¸å‡è¡¡çš„åˆ†å¸ƒåœ¨å„æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœæƒ³è¦å‡è¡¡çš„å°†ç¼“å­˜åˆ†å¸ƒåˆ°2å°æœåŠ¡å™¨ä¸Šï¼Œæœ€å¥½èƒ½è®©è¿™2å°æœåŠ¡å™¨å°½é‡å¤šçš„ã€å‡åŒ€çš„å‡ºç°åœ¨hashç¯ä¸Šï¼Œä½†æ˜¯ï¼ŒçœŸå®çš„æœåŠ¡å™¨èµ„æºåªæœ‰2å°ï¼Œæˆ‘ä»¬æ€æ ·å‡­ç©ºçš„è®©å®ƒä»¬å¤šèµ·æ¥å‘¢ï¼Œæ²¡é”™ï¼Œå°±æ˜¯å‡­ç©ºçš„è®©æœåŠ¡å™¨èŠ‚ç‚¹å¤šèµ·æ¥ï¼Œæ—¢ç„¶æ²¡æœ‰å¤šä½™çš„çœŸæ­£çš„ç‰©ç†æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°±åªèƒ½å°†ç°æœ‰çš„ç‰©ç†èŠ‚ç‚¹é€šè¿‡è™šæ‹Ÿçš„æ–¹æ³•å¤åˆ¶å‡ºæ¥ã€‚\n\n\nè¿™äº›ç”±å®é™…èŠ‚ç‚¹è™šæ‹Ÿå¤åˆ¶è€Œæ¥çš„èŠ‚ç‚¹è¢«ç§°ä¸º\"è™šæ‹ŸèŠ‚ç‚¹\"ï¼Œå³å¯¹æ¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªæ­¤æœåŠ¡èŠ‚ç‚¹ï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚å…·ä½“åšæ³•å¯ä»¥åœ¨æœåŠ¡å™¨IPæˆ–ä¸»æœºåçš„åé¢å¢åŠ ç¼–å·æ¥å®ç°ã€‚\n\n\nä¾‹å¦‚ä¸Šé¢çš„æƒ…å†µï¼Œå¯ä»¥ä¸ºæ¯å°æœåŠ¡å™¨è®¡ç®—ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œäºæ˜¯å¯ä»¥åˆ†åˆ«è®¡ç®— â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ã€â€œNode B#1â€ã€â€œNode B#2â€ã€â€œNode B#3â€çš„å“ˆå¸Œå€¼ï¼Œäºæ˜¯å½¢æˆå…­ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼š\n\n\n![image-20210228225807543](/Users/hehui/Library/Application Support/typora-user-images/image-20210228225807543.png)\n\n\nåŒæ—¶æ•°æ®å®šä½ç®—æ³•ä¸å˜ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥è™šæ‹ŸèŠ‚ç‚¹åˆ°å®é™…èŠ‚ç‚¹çš„æ˜ å°„ï¼Œä¾‹å¦‚å®šä½åˆ°â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®å‡å®šä½åˆ°Node Aä¸Šã€‚è¿™æ ·å°±è§£å†³äº†æœåŠ¡èŠ‚ç‚¹å°‘æ—¶æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸å°†è™šæ‹ŸèŠ‚ç‚¹æ•°è®¾ç½®ä¸º32ç”šè‡³æ›´å¤§ï¼Œå› æ­¤å³ä½¿å¾ˆå°‘çš„æœåŠ¡èŠ‚ç‚¹ä¹Ÿèƒ½åšåˆ°ç›¸å¯¹å‡åŒ€çš„æ•°æ®åˆ†å¸ƒã€‚\n\n\n## é›†ç¾¤æƒ…å†µä¸‹ä»€ä¹ˆæ—¶å€™ä¸å¯ç”¨\n\n- å¦‚æœé›†ç¾¤ä»»æ„_master_æŒ‚æ‰*,_ä¸”å½“å‰_master_æ²¡æœ‰_slave._é›†ç¾¤è¿›å…¥_fail*çŠ¶æ€\n- æœ‰A,B,Cä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œåœ¨æ²¡æœ‰å¤åˆ¶æ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œå¦‚æœèŠ‚ç‚¹Bå¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±ä¼šä»¥ä¸ºç¼ºå°‘5501-11000è¿™ä¸ªèŒƒå›´çš„æ§½è€Œä¸å¯ç”¨ã€‚\n- å¦‚æœé›†ç¾¤è¶…è¿‡åŠæ•°ä»¥ä¸Š_master_æŒ‚æ‰ï¼Œæ— è®ºæ˜¯å¦æœ‰_slave_é›†ç¾¤è¿›å…¥_fail_çŠ¶æ€\n- é›†ç¾¤æŸä¸€èŠ‚ç‚¹çš„ä¸»ä»å…¨æ•°å®•æœº ï¼ˆä¸2ç›¸ä¼¼ï¼‰\n\n## æ•…éšœçš„å¤„ç†è¿‡ç¨‹\n\n1. æŸ¥çœ‹ä¸šåŠ¡æ—¥å¿—ï¼ˆå¾®æœåŠ¡ï¼‰\n2. é¦–å…ˆæŸ¥çœ‹redisé›†ç¾¤çŠ¶æ€ã€‚\n3. ç»§ç»­æŸ¥çœ‹redisé›†ç¾¤èŠ‚ç‚¹çš„çŠ¶æ€ã€‚\n\n\t**å¤„ç†è¿‡ç¨‹**\n\n\n1ã€å…ˆåœæ­¢æ‰€æœ‰redisèŠ‚ç‚¹ã€‚\n2ã€åˆ é™¤æ¯ä¸ªèŠ‚ç‚¹çš„ç¼“å­˜æ–‡ä»¶ï¼ŒåŒ…æ‹¬node-6380.conf dump.rdpç­‰æ–‡ä»¶ã€‚\n3ã€é‡å¯æ¯ä¸ªredisèŠ‚ç‚¹ã€‚\n4ã€é‡æ–°åˆ›å»ºredisé›†ç¾¤ã€‚\n\n\n## é›†ç¾¤\n\n\n> å‘ç°æˆ‘ä»¬å½“å‰é¡¹ç›®ç”¨çš„redisæ˜¯ä¸»ä»ï¼Œä½†æ˜¯è·Ÿå•ç‚¹å…¶å®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨åº”ç”¨å±‚é¢æ²¡æœ‰åšè¯»å†™åˆ†ç¦»ï¼Œæ‰€ä»¥å…¶å®ä»æœåŠ¡å™¨åªæ˜¯åšäº†ä¸€ä¸ªä¸»ä»å¤åˆ¶çš„å·¥ä½œï¼Œå…¶ä»–çš„ä»€ä¹ˆéƒ½æ²¡æœ‰åšã€‚\n\n\n\té‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿå‡çº§ï¼Œç”¨æˆ·é‡ä¸Šå‡ï¼Œé‚£ä¹ˆä¸€ä¸»ä¸€ä»å¯èƒ½æ‰›ä¸ä½é‚£ä¹ˆå¤§çš„å‹åŠ›ï¼Œå¯èƒ½éœ€è¦ä¸€ä¸»å¤šä»åšå¤‡æœºï¼Œé‚£ä¹ˆå‡å¦‚ä¸»æœåŠ¡å™¨å®•æœºäº†ï¼Œé€‰ä¸¾å“ªå°ä»æœåŠ¡å™¨åšä¸»å‘¢ï¼Ÿè¿™å°±æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦ä¸€ä¸ªç¬¬ä¸‰ä¸ªäººæ¥è§£å†³ï¼Œæ‰€ä»¥æˆ‘æŸ¥äº†ä¸€ä¸‹ï¼Œå“¨å…µæ¨¡å¼å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å“¨å…µæ¨¡å¼çš„ç»†èŠ‚ä¸‹é¢ä¼šè®²åˆ°ã€‚\n\n\n\tç„¶åæˆ‘åˆæƒ³äº†ï¼Œé‚£å¦‚æœå•å°æœåŠ¡å™¨æ— æ³•æ‰¿å—100%çš„å­˜å‚¨å‹åŠ›ï¼Œé‚£å°±åº”è¯¥å°†å­˜å‚¨å‹åŠ›åˆ†æ•£å¼€æ¥ï¼Œæ‰€ä»¥é›†ç¾¤å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨6å°æœåŠ¡å™¨åšé›†ç¾¤ï¼Œ3ä¸»3ä»ï¼Œé‚£ä¹ˆæ¯å°æœåŠ¡å™¨åªéœ€è¦å­˜å‚¨1/3å³å¯ã€‚å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥è¯¦ç»†çœ‹ä¸€ä¸‹è¿™äº›å…·ä½“æ€ä¹ˆåšçš„ã€‚\n\n\n### å•ç‚¹ä¸»ä»\n\n\nåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œæˆ‘ä»¬åº”ç”¨å±‚ä¸»è¦ä½¿ç”¨çš„æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹çš„ä¸»è¦å·¥ä½œæ˜¯ä»ä¸»èŠ‚ç‚¹åšä¸»ä»å¤åˆ¶ã€‚å…³é”®æ—¶åˆ»ï¼Œå¦‚æœä¸»æœåŠ¡å™¨æŒ‚æ‰ï¼Œå¯ä»¥æ‰‹åŠ¨å¯åŠ¨ä»æœåŠ¡å™¨ï¼Œç„¶åæ›´æ”¹åº”ç”¨å±‚çš„redisçš„ipå³å¯\n\n\n> å®ç°ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave Replicationï¼‰çš„å·¥ä½œåŸç†ï¼šSlaveä»èŠ‚ç‚¹æœåŠ¡å¯åŠ¨å¹¶è¿æ¥åˆ°Masterä¹‹åï¼Œå®ƒå°†ä¸»åŠ¨å‘é€ä¸€ä¸ªSYNCå‘½ä»¤ã€‚MasteræœåŠ¡ä¸»èŠ‚ç‚¹æ”¶åˆ°åŒæ­¥å‘½ä»¤åå°†å¯åŠ¨åå°å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†çš„å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼ŒMasterå°†ä¼ é€æ•´ä¸ªæ•°æ®åº“æ–‡ä»¶åˆ°Slaveï¼Œä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚è€ŒSlaveä»èŠ‚ç‚¹æœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®ä¹‹åå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æ­¤åï¼ŒMasterä¸»èŠ‚ç‚¹ç»§ç»­å°†æ‰€æœ‰å·²ç»æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ï¼Œå’Œæ–°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ é€ç»™Slavesï¼ŒSlaveå°†åœ¨æœ¬æ¬¡æ‰§è¡Œè¿™äº›æ•°æ®ä¿®æ”¹å‘½ä»¤ï¼Œä»è€Œè¾¾åˆ°æœ€ç»ˆçš„æ•°æ®åŒæ­¥ã€‚\n\n\nå¦‚æœMasterå’ŒSlaveä¹‹é—´çš„é“¾æ¥å‡ºç°æ–­è¿ç°è±¡ï¼ŒSlaveå¯ä»¥è‡ªåŠ¨é‡è¿Masterï¼Œä½†æ˜¯åœ¨è¿æ¥æˆåŠŸä¹‹åï¼Œä¸€æ¬¡å®Œå…¨åŒæ­¥å°†è¢«è‡ªåŠ¨æ‰§è¡Œã€‚\n\n\n**ä¸»ä»å¤åˆ¶é…ç½®**\n\n\nä¿®æ”¹ä»èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼šslaveof masterip masterport\nå¦‚æœè®¾ç½®äº†å¯†ç ï¼Œå°±è¦è®¾ç½®ï¼šmasterauth master-password\n\n\nä¸»ä»æ¨¡å¼çš„ä¼˜ç¼ºç‚¹\n\n\n**ä¼˜ç‚¹ï¼š**\n\n- åŒä¸€ä¸ªMasterå¯ä»¥åŒæ­¥å¤šä¸ªSlavesã€‚\n- SlaveåŒæ ·å¯ä»¥æ¥å—å…¶å®ƒSlavesçš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„åˆ†è½½Masterçš„åŒæ­¥å‹åŠ›ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å°†Redisçš„Replicationæ¶æ„è§†ä¸ºå›¾ç»“æ„ã€‚\n- Master Serveræ˜¯ä»¥éé˜»å¡çš„æ–¹å¼ä¸ºSlavesæä¾›æœåŠ¡ã€‚æ‰€ä»¥åœ¨Master-SlaveåŒæ­¥æœŸé—´ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æäº¤æŸ¥è¯¢æˆ–ä¿®æ”¹è¯·æ±‚ã€‚\n- Slave ServeråŒæ ·æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼å®Œæˆæ•°æ®åŒæ­¥ã€‚åœ¨åŒæ­¥æœŸé—´ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯æäº¤æŸ¥è¯¢è¯·æ±‚ï¼ŒRedisåˆ™è¿”å›åŒæ­¥ä¹‹å‰çš„æ•°æ®\n- ä¸ºäº†åˆ†è½½Masterçš„è¯»æ“ä½œå‹åŠ›ï¼ŒSlaveæœåŠ¡å™¨å¯ä»¥ä¸ºå®¢æˆ·ç«¯æä¾›åªè¯»æ“ä½œçš„æœåŠ¡ï¼Œå†™æœåŠ¡ä»ç„¶å¿…é¡»ç”±Masteræ¥å®Œæˆã€‚å³ä¾¿å¦‚æ­¤ï¼Œç³»ç»Ÿçš„ä¼¸ç¼©æ€§è¿˜æ˜¯å¾—åˆ°äº†å¾ˆå¤§çš„æé«˜ã€‚\n- Masterå¯ä»¥å°†æ•°æ®ä¿å­˜æ“ä½œäº¤ç»™Slaveså®Œæˆï¼Œä»è€Œé¿å…äº†åœ¨Masterä¸­è¦æœ‰ç‹¬ç«‹çš„è¿›ç¨‹æ¥å®Œæˆæ­¤æ“ä½œã€‚\næ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚\n\n**ç¼ºç‚¹ï¼š**\n\n- Redisä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„IPæ‰èƒ½æ¢å¤ã€‚\n- ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢IPåè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚\n- Redisçš„ä¸»ä»å¤åˆ¶é‡‡ç”¨å…¨é‡å¤åˆ¶ï¼Œå¤åˆ¶è¿‡ç¨‹ä¸­ä¸»æœºä¼šforkå‡ºä¸€ä¸ªå­è¿›ç¨‹å¯¹å†…å­˜åšä¸€ä»½å¿«ç…§ï¼Œå¹¶å°†å­è¿›ç¨‹çš„å†…å­˜å¿«ç…§ä¿å­˜ä¸ºæ–‡ä»¶å‘é€ç»™ä»æœºï¼Œè¿™ä¸€è¿‡ç¨‹éœ€è¦ç¡®ä¿ä¸»æœºæœ‰è¶³å¤Ÿå¤šçš„ç©ºä½™å†…å­˜ã€‚è‹¥å¿«ç…§æ–‡ä»¶è¾ƒå¤§ï¼Œå¯¹é›†ç¾¤çš„æœåŠ¡èƒ½åŠ›ä¼šäº§ç”Ÿè¾ƒå¤§çš„å½±å“ï¼Œè€Œä¸”å¤åˆ¶è¿‡ç¨‹æ˜¯åœ¨ä»æœºæ–°åŠ å…¥é›†ç¾¤æˆ–è€…ä»æœºå’Œä¸»æœºç½‘ç»œæ–­å¼€é‡è¿æ—¶éƒ½ä¼šè¿›è¡Œï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œæ³¢åŠ¨éƒ½ä¼šé€ æˆä¸»æœºå’Œä»æœºé—´çš„ä¸€æ¬¡å…¨é‡çš„æ•°æ®å¤åˆ¶ï¼Œè¿™å¯¹å®é™…çš„ç³»ç»Ÿè¿è¥é€ æˆäº†ä¸å°çš„éº»çƒ¦ã€‚\n- Redisè¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ä¸ºé¿å…è¿™ä¸€é—®é¢˜ï¼Œè¿ç»´äººå‘˜åœ¨ç³»ç»Ÿä¸Šçº¿æ—¶å¿…é¡»ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œè¿™å¯¹èµ„æºé€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚\n- å…¶å®redisçš„ä¸»ä»æ¨¡å¼å¾ˆç®€å•ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯å¾ˆå°‘ä½¿ç”¨çš„ï¼Œæˆ‘ä¹Ÿä¸å»ºè®®åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¸»ä»æ¨¡å¼æ¥æä¾›ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œä¹‹æ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨éƒ½æ˜¯ç”±å®ƒçš„ç¼ºç‚¹é€ æˆçš„ï¼Œåœ¨æ•°æ®é‡éå¸¸å¤§çš„æƒ…å†µï¼Œæˆ–è€…å¯¹ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§è¦æ±‚å¾ˆé«˜çš„æƒ…å†µä¸‹ï¼Œä¸»ä»æ¨¡å¼ä¹Ÿæ˜¯ä¸ç¨³å®šçš„ã€‚\n\n### è¯»å†™åˆ†ç¦»\n\n\n> å¯¹äºè¯»å æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œå¯ä»¥é€šè¿‡æŠŠä¸€éƒ¨åˆ†æµé‡åˆ†æ‘Šå¯¼å‡ºä»èŠ‚ç‚¹(salve) æ¥å‡è½»ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰å‹åŠ›ï¼ŒåŒæ—¶éœ€è¦ä¸»è¦åªå¯¹ä¸»èŠ‚ç‚¹æ‰§è¡Œå†™æ“ä½œã€‚\n\n\nå¸¸è§çš„åº”ç”¨åœºæ™¯ä¸‹æˆ‘è§‰å¾—redisæ²¡å¿…è¦è¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚\n\n\nå…ˆæ¥è®¨è®ºä¸€ä¸‹ä¸ºä»€ä¹ˆè¦è¯»å†™åˆ†ç¦»ï¼š\n\n\n> è¯»å†™åˆ†ç¦»ä½¿ç”¨äºå¤§é‡è¯»è¯·æ±‚çš„æƒ…å†µï¼Œé€šè¿‡å¤šä¸ªslaveåˆ†æ‘Šäº†è¯»çš„å‹åŠ›ï¼Œä»è€Œå¢åŠ äº†è¯»çš„æ€§èƒ½ã€‚è¿‡å¤šçš„selectä¼šé˜»å¡ä½æ•°æ®åº“ï¼Œä½¿ä½ å¢åˆ æ”¹ä¸èƒ½æ‰§è¡Œï¼Œè€Œä¸”åˆ°å¹¶å‘é‡è¿‡å¤§æ—¶ï¼Œæ•°æ®åº“ä¼šæ‹’ç»æœåŠ¡ã€‚\n\n\n\tå› è€Œé€šè¿‡è¯»å†™åˆ†ç¦»ï¼Œä»è€Œå¢åŠ æ€§èƒ½ï¼Œé¿å…æ‹’ç»æœåŠ¡çš„å‘ç”Ÿã€‚\n\n\n\tæˆ‘è®¤ä¸ºéœ€è¦è¯»å†™åˆ†ç¦»çš„åº”ç”¨åœºæ™¯æ˜¯ï¼šå†™è¯·æ±‚åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œä½†è¯»è¯·æ±‚è¦è¿œå¤§äºå†™è¯·æ±‚çš„åœºæ™¯ã€‚\n\n\nå†æ¥è®¨è®ºä¸€ä¸‹rediså¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š\n\n1. ç¼“å­˜\n2. æ’åå‹çš„åº”ç”¨ï¼Œè®¿é—®è®¡æ•°å‹åº”ç”¨\n3. å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ\n\né¦–å…ˆè¯´ä¸€ä¸‹ç¼“å­˜é›†ç¾¤ï¼Œè¿™ä¹Ÿæ˜¯éå¸¸å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š\n\n1. ç¼“å­˜ä¸»è¦è§£å†³çš„æ˜¯ç”¨æˆ·è®¿é—®æ—¶ï¼Œæ€ä¹ˆä»¥æ›´å¿«çš„é€Ÿåº¦å¾—åˆ°æ•°æ®ã€‚\n2. å•æœºçš„å†…å­˜èµ„æºæ˜¯å¾ˆæœ‰é™çš„ï¼Œæ‰€ä»¥ç¼“å­˜é›†ç¾¤ä¼šé€šè¿‡æŸç§ç®—æ³•å°†ä¸åŒçš„æ•°æ®æ”¾å…¥åˆ°ä¸åŒçš„æœºå™¨ä¸­ã€‚\n3. ä¸åŒæŒä¹…åŒ–æ•°æ®åº“ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå†…å­˜æ•°æ®åº“å•æœºå¯ä»¥æ”¯æŒå¤§é‡çš„å¢åˆ æŸ¥æ”¹ã€‚\n4. å¦‚æœä¸€å°æœºå™¨æ”¯æŒä¸ä½ï¼Œå¯ä»¥ç”¨ä¸»ä»å¤åˆ¶ï¼Œè¿›è¡Œç¼“å­˜çš„æ–¹æ³•è§£å†³ã€‚\n5. ç»¼ä¸Šï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹åº”ç”¨redis è¿›è¡Œè¯»å†™åˆ†ç¦»ï¼Œå®Œå…¨å°±å¤±å»äº†è¯»å†™åˆ†ç¦»çš„æ„ä¹‰ã€‚\n\n> å½“ç„¶ï¼Œä¹Ÿæœ‰å¯èƒ½è€ƒè™‘ä¸åˆ°çš„åœ°æ–¹éœ€è¦è¯»å†™åˆ†ç¦»ï¼Œæ¯•ç«Ÿâ€œå­˜åœ¨å³åˆç†â€å˜›ï¼Œé‚£ä¹ˆå°±æ¥ä»‹ç»ä¸€ä¸‹è¿™ä¸ªè¯»å†™åˆ†ç¦»å§ã€‚\n\n\n`å½“ä½¿ç”¨ä»èŠ‚ç‚¹å“åº”è¯»è¯·æ±‚æ—¶ï¼Œä¸šåŠ¡ç«¯å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜`\n\n- å¤åˆ¶æ•°æ®å»¶è¿Ÿ\n- è¯»åˆ°è¿‡æœŸæ•°æ®\n- ä»èŠ‚ç‚¹æ•…éšœ\n\n**æ•°æ®å»¶è¿Ÿ**\n\n\n> Redis å¤åˆ¶æ•°çš„å»¶è¿Ÿç”±äºå¼‚æ­¥å¤åˆ¶ç‰¹æ€§æ˜¯æ— æ³•é¿å…çš„ï¼Œå»¶è¿Ÿå–å†³äºç½‘ç»œå¸¦å®½å’Œå‘½ä»¤é˜»å¡æƒ…å†µï¼Œå¯¹äºæ— æ³•å®¹å¿å¤§é‡å»¶è¿Ÿåœºæ™¯ï¼Œå¯ä»¥ç¼–å†™å¤–éƒ¨ç›‘æ§ç¨‹åºç›‘å¬ä¸»ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ï¼Œå½“å»¶è¿Ÿè¾ƒå¤§æ—¶è§¦å‘æŠ¥è­¦æˆ–è€…é€šçŸ¥å®¢æˆ·ç«¯é¿å…è¯»å–å»¶è¿Ÿè¿‡é«˜çš„ä»èŠ‚ç‚¹ï¼Œå®ç°é€»è¾‘å¦‚ä¸‹ï¼š\n\n1. ç›‘æ§ç¨‹åº(monitor) å®šæœŸæ£€æŸ¥ä¸»ä»èŠ‚ç‚¹çš„åç§»é‡ï¼Œä¸»èŠ‚ç‚¹åç§»é‡åœ¨info replication çš„master_repl_offset æŒ‡æ ‡è®°å½•ï¼Œä»èŠ‚ç‚¹ åç§»é‡å¯ä»¥æŸ¥è¯¢ä¸»èŠ‚ç‚¹çš„slave0 å­—æ®µçš„offsetæŒ‡æ ‡ï¼Œå®ƒä»¬çš„å·®å€¼å°±æ˜¯ä¸»ä»èŠ‚ç‚¹å»¶è¿Ÿçš„å­—èŠ‚ é‡ã€‚\n2. å½“å»¶è¿Ÿå­—èŠ‚é‡è¿‡é«˜æ—¶ï¼Œæ¯”å¦‚è¶…è¿‡10Mã€‚ç›‘æ§ç¨‹åºè§¦å‘æŠ¥è­¦å¹¶é€šçŸ¥å®¢æˆ·ç«¯ä»èŠ‚ç‚¹å»¶è¿Ÿè¿‡é«˜ã€‚å¯ä»¥é‡‡ç”¨Zookeeperçš„ç›‘å¬å›è°ƒæœºåˆ¶å®ç°å®¢æˆ·ç«¯é€šçŸ¥ã€‚\n3. å®¢æˆ·ç«¯æ¥åˆ°å…·ä½“çš„ä»èŠ‚ç‚¹é«˜å»¶è¿Ÿé€šçŸ¥åï¼Œä¿®æ”¹è¯»å‘½ä»¤è·¯ç”±åˆ°å…¶ä»–ä»èŠ‚ç‚¹æˆ–ä¸»èŠ‚ç‚¹ä¸Šã€‚å½“å»¶è¿Ÿå›å¤åï¼Œå†æ¬¡é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå›å¤ä»èŠ‚ç‚¹çš„è¯»å‘½ä»¤è¯·æ±‚ã€‚\n\nè¿™ç§æ–¹æ¡ˆæˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦å•ç‹¬ä¿®æ”¹é€‚é…Redisçš„å®¢æˆ·ç«¯ç±»åº“ã€‚\n\n\n**è¯»åˆ°è¿‡æœŸæ•°æ®**\n\n\nå½“ä¸»èŠ‚ç‚¹å­˜å‚¨å¤§é‡è®¾ç½®è¶…æ—¶çš„æ•°æ®æ—¶ï¼Œå¦‚ç¼“å­˜æ•°æ®ï¼ŒRediså†…éƒ¨éœ€è¦ç»´æŠ¤è¿‡æœŸæ•°æ®åˆ é™¤ç­–ç•¥ï¼Œåˆ é™¤ç­–ç•¥ä¸»è¦æœ‰ä¸¤ç§ï¼š`æƒ°æ€§åˆ é™¤å’Œå®šæ—¶åˆ é™¤`ã€‚\n\n\n`æƒ°æ€§åˆ é™¤`ï¼šä¸»èŠ‚ç‚¹æ¯æ¬¡å¤„ç†è¯»å–å‘½ä»¤æ—¶ï¼Œéƒ½ä¼šæ£€æŸ¥é”®æ˜¯å¦è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶åˆ™æ‰§è¡Œdelå‘½ä»¤åˆ é™¤é”®å¯¹è±¡é‚£ä¸ªï¼Œä¹‹ådelå‘½ä»¤ä¹Ÿä¼šå¼‚æ­¥ å‘é€ç»™ ä»èŠ‚ç‚¹\n\n\n> éœ€è¦æ³¨æ„çš„æ˜¯ä¸ºäº†ä¿è¯å¤åˆ¶çš„ä¸€è‡´æ€§ï¼Œä»èŠ‚ç‚¹è‡ªèº«æ°¸è¿œä¸ä¼šä¸»åŠ¨åˆ é™¤è¶…æ—¶æ•°æ®ï¼Œ\n\n\n`å®šæ—¶åˆ é™¤`ï¼š\n\n\nRedisä¸»èŠ‚ç‚¹åœ¨å†…éƒ¨å®šæ—¶ä»»åŠ¡ä¼šå¾ªç¯é‡‡æ ·ä¸€å®šæ•°é‡çš„é”®ï¼Œå½“å‘ç°é‡‡æ ·çš„é”®è¿‡æœŸå°±æ‰§è¡Œdelå‘½ä»¤ï¼Œä¹‹åå†åŒæ­¥ç»™ä»èŠ‚ç‚¹\n\n\n> å¦‚æœæ­¤æ—¶ æ•°æ®çš„å¤§é‡è¶…æ—¶ï¼Œä¸»èŠ‚ç‚¹é‡‡æ ·é€Ÿåº¦è·Ÿä¸ä¸Šè¿‡æœŸé€Ÿåº¦ä¸”ä¸»èŠ‚ç‚¹æ²¡æœ‰è¯»å–è¿‡æœŸé”®çš„æ“ä½œï¼Œé‚£ä¹ˆä»èŠ‚ç‚¹å°†æ— æ³•æ”¶åˆ°delå‘½ä»¤ï¼Œè¿™æ—¶åœ¨ä»èŠ‚ç‚¹ ä¸Šå¯ä»¥è¯»å–åˆ°å·²ç»è¶…æ—¶çš„æ•°æ®ã€‚Redisåœ¨3.2 ç‰ˆæœ¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä»èŠ‚ç‚¹ è¯»å–æ•°æ®ä¹‹å‰ä¼šæ£€æŸ¥é”®çš„è¿‡æœŸæ—¶é—´æ¥å†³å®šæ˜¯å¦è¿”å›æ•°æ®ï¼Œå¯ä»¥å‡çº§åˆ°3.2ç‰ˆæœ¬æ¥è§„é¿è¿™ä¸ªé—®é¢˜ã€‚\n\n\n### **å“¨å…µæ¨¡å¼**\n\n\n> è¯¥æ¨¡å¼æ˜¯ä»Redisçš„2.6ç‰ˆæœ¬å¼€å§‹æä¾›çš„ï¼Œä½†æ˜¯å½“æ—¶è¿™ä¸ªç‰ˆæœ¬çš„æ¨¡å¼æ˜¯ä¸ç¨³å®šçš„ï¼Œç›´åˆ°Redisçš„2.8ç‰ˆæœ¬ä»¥åï¼Œè¿™ä¸ªå“¨å…µæ¨¡å¼æ‰ç¨³å®šä¸‹æ¥ï¼Œæ— è®ºæ˜¯ä¸»ä»æ¨¡å¼ï¼Œè¿˜æ˜¯å“¨å…µæ¨¡å¼ï¼Œè¿™ä¸¤ä¸ªæ¨¡å¼éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸èƒ½æ°´å¹³æ‰©å®¹ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªæ¨¡å¼çš„é«˜å¯ç”¨ç‰¹æ€§éƒ½ä¼šå—åˆ°Masterä¸»èŠ‚ç‚¹å†…å­˜çš„é™åˆ¶ã€‚\n\n\nSentinel(å“¨å…µ)è¿›ç¨‹æ˜¯ç”¨äºç›‘æ§redisé›†ç¾¤ä¸­Masterä¸»æœåŠ¡å™¨å·¥ä½œçš„çŠ¶æ€ï¼Œåœ¨Masterä¸»æœåŠ¡å™¨å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥å®ç°Masterå’ŒSlaveæœåŠ¡å™¨çš„åˆ‡æ¢ï¼Œä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ã€‚\n\n\n**Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹çš„ä½œç”¨**\n\n- ç›‘æ§(Monitoring): å“¨å…µ(sentinel) ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„Masterå’ŒSlaveæ˜¯å¦è¿ä½œæ­£å¸¸ã€‚\n- æé†’(Notification)ï¼šå½“è¢«ç›‘æ§çš„æŸä¸ªRedisèŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶, å“¨å…µ(sentinel) å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚\n- è‡ªåŠ¨æ•…éšœè¿ç§»(Automatic failover)ï¼š\n\n\t> å½“ä¸€ä¸ªMasterä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µ(sentinel) ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆMasterçš„å…¶ä¸­ä¸€ä¸ªSlaveå‡çº§ä¸ºæ–°çš„Master, å¹¶è®©å¤±æ•ˆMasterçš„å…¶ä»–Slaveæ”¹ä¸ºå¤åˆ¶æ–°çš„Masterï¼›å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥å¤±æ•ˆçš„Masteræ—¶ï¼Œé›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›æ–°Masterçš„åœ°å€ï¼Œä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨ç°åœ¨çš„Masteræ›¿æ¢å¤±æ•ˆMasterã€‚\n\n\n\t\tMasterå’ŒSlaveæœåŠ¡å™¨åˆ‡æ¢åï¼ŒMasterçš„redis.confã€Slaveçš„redis.confå’Œsentinel.confçš„é…ç½®æ–‡ä»¶çš„å†…å®¹éƒ½ä¼šå‘ç”Ÿç›¸åº”çš„æ”¹å˜ï¼Œå³ï¼ŒMasterä¸»æœåŠ¡å™¨çš„redis.confé…ç½®æ–‡ä»¶ä¸­ä¼šå¤šä¸€è¡Œslaveofçš„é…ç½®ï¼Œsentinel.confçš„ç›‘æ§ç›®æ ‡ä¼šéšä¹‹è°ƒæ¢ã€‚\n\n\n**Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹çš„å·¥ä½œæ–¹å¼**\n\n- æ¯ä¸ªSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘æ•´ä¸ªé›†ç¾¤ä¸­çš„Masterä¸»æœåŠ¡å™¨ï¼ŒSlaveä»æœåŠ¡å™¨ä»¥åŠå…¶ä»–Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ä¸€ä¸ª PING å‘½ä»¤ã€‚\n- å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰\n- å¦‚æœä¸€ä¸ªMasterä¸»æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ªMasterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤Masterä¸»æœåŠ¡å™¨çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€\n- å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤Masterä¸»æœåŠ¡å™¨è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ˆSDOWNï¼‰ï¼Œ åˆ™Masterä¸»æœåŠ¡å™¨ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰\n- åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘é›†ç¾¤ä¸­çš„æ‰€æœ‰Masterä¸»æœåŠ¡å™¨ã€Slaveä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤ã€‚\n- å½“Masterä¸»æœåŠ¡å™¨è¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰æ—¶ï¼ŒSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘ä¸‹çº¿çš„ Masterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Slaveä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚\n- è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹åŒæ„ Masterä¸»æœåŠ¡å™¨ä¸‹çº¿ï¼Œ Masterä¸»æœåŠ¡å™¨çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚è‹¥ Masterä¸»æœåŠ¡å™¨é‡æ–°å‘ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼ŒMasterä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚\nå“¨å…µæ¨¡å¼çš„ä¼˜ç¼ºç‚¹\n\n**ä¼˜ç‚¹:**\n\n- å“¨å…µé›†ç¾¤æ¨¡å¼æ˜¯åŸºäºä¸»ä»æ¨¡å¼çš„ï¼Œæ‰€æœ‰ä¸»ä»çš„ä¼˜ç‚¹ï¼Œå“¨å…µæ¨¡å¼åŒæ ·å…·æœ‰ã€‚\n- ä¸»ä»å¯ä»¥åˆ‡æ¢ï¼Œæ•…éšœå¯ä»¥è½¬ç§»ï¼Œç³»ç»Ÿå¯ç”¨æ€§æ›´å¥½ã€‚\n- å“¨å…µæ¨¡å¼æ˜¯ä¸»ä»æ¨¡å¼çš„å‡çº§ï¼Œç³»ç»Ÿæ›´å¥å£®ï¼Œå¯ç”¨æ€§æ›´é«˜ã€‚\n\n**ç¼ºç‚¹:**\n\n- Redisè¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ä¸ºé¿å…è¿™ä¸€é—®é¢˜ï¼Œè¿ç»´äººå‘˜åœ¨ç³»ç»Ÿä¸Šçº¿æ—¶å¿…é¡»ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œè¿™å¯¹èµ„æºé€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚\n- é…ç½®å¤æ‚\n\n    `å·¥ä½œåŸç†:`\n\n1. ç”¨æˆ·é“¾æ¥æ—¶å…ˆé€šè¿‡å“¨å…µè·å–ä¸»æœºMasterçš„ä¿¡æ¯\n2. è·å–Masterçš„é“¾æ¥åå®ç°redisçš„æ“ä½œ(set/get)\n3. å½“masterå‡ºç°å®•æœºæ—¶,å“¨å…µçš„å¿ƒè·³æ£€æµ‹å‘ç°ä¸»æœºé•¿æ—¶é—´æ²¡æœ‰å“åº”.è¿™æ—¶å“¨å…µä¼šè¿›è¡Œæ¨é€‰.æ¨é€‰å‡ºæ–°çš„ä¸»æœºå®Œæˆä»»åŠ¡.\n4. å½“æ–°çš„ä¸»æœºå‡ºç°æ—¶,å…¶ä½™çš„å…¨éƒ¨æœºå™¨éƒ½å……å½“è¯¥ä¸»æœºçš„ä»æœº\n\n> è¿™å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ·»åŠ å“¨å…µä»¥åï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡å“¨å…µè¯¢é—®å½“å‰çš„ä¸»æœåŠ¡å™¨æ˜¯è°ï¼Œæ‰€ä»¥å¦‚æœå“¨å…µéƒ¨åœ¨ä¸»æœåŠ¡å™¨ä¸Šé¢çš„è¯å¯èƒ½ä¼šå¢åŠ æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯å°†å“¨å…µå•ç‹¬æ”¾åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šé¢ã€‚ä»¥åˆ†è§£å‹åŠ›ã€‚\n\n\n\tç„¶åå¯èƒ½è¿˜æœ‰äººæ‹…å¿ƒå“¨å…µæœåŠ¡å™¨å®•æœºäº†æ€ä¹ˆåŠå•Šï¼Œé¦–å…ˆå“¨å…µæœåŠ¡å™¨å®•æœºçš„å¯èƒ½æ€§å¾ˆå°ï¼Œç„¶åæ˜¯å¦‚æœå“¨å…µæœåŠ¡å™¨å®•æœºäº†ï¼Œä½¿ç”¨äººå·¥å¹²é¢„é‡å¯å³å¯ï¼Œå°±ä¼šå¯¼è‡´ä¸»ä»æœåŠ¡å™¨ç›‘æ§çš„æš‚æ—¶ä¸å¯ç”¨ï¼Œä¸å½±å“ä¸»ä»æœåŠ¡å™¨çš„æ­£å¸¸è¿è¡Œã€‚\n\n\nå…ˆé…ç½®æœåŠ¡å™¨ï¼ˆæœ¬åœ°ï¼‰å“¨å…µæ¨¡å¼ï¼Œç›´æ¥ä»rediså®˜ç½‘ä¸‹è½½å®‰è£…æˆ–è€…è§£å‹ç‰ˆï¼Œå®‰è£…åçš„ç›®å½•ç»“æ„\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629092443832-206225549.png)\n\n\nç„¶åé…ç½®å“¨å…µæ¨¡å¼\n\n\næµ‹è¯•é‡‡ç”¨3ä¸ªå“¨å…µï¼Œ1ä¸ªä¸»redisï¼Œ2ä¸ªä»redisã€‚\n\n\nå¤åˆ¶6ä»½redis.windows.confæ–‡ä»¶å¹¶é‡å‘½åå¦‚ä¸‹ï¼ˆå¼€å‘è€…å¯æ ¹æ®è‡ªå·±çš„å¼€å‘ä¹ æƒ¯è¿›è¡Œé‡å‘½åï¼‰\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629092420294-1751487154.png)\n\n\n**é…ç½®master.6378.conf**\n\n\n```text\nport:6379\n\n\n\n#è®¾ç½®è¿æ¥å¯†ç \n\n\n\nrequirepass:grs\n\n\n\n#è¿æ¥å¯†ç \n\n\n\nmasterauth:grs\n\n```\n\n\n**slave.6380.confé…ç½®**\n\n\n```text\nport:6380\n\n\n\ndbfilename dump6380.rdb\n\n\n\n#é…ç½®master\n\n\n\nslaveof 127.0.0.1 6379\n\n```\n\n\n**slave.6381.confé…ç½®**\n\n\n```text\nport 6381\n\n\n\nslaveof 127.0.0.1 6379\n\n\n\ndbfilename \"dump.rdb\"\n\n```\n\n\n**é…ç½®å“¨å…µsentinel.63791.confï¼ˆå…¶ä»–ä¸¤ä¸ªå“¨å…µé…ç½®æ–‡ä»¶ä¸€è‡´ï¼Œåªä¿®æ”¹ç«¯å£å·ç å³å¯ï¼‰**\n\n\n```text\nport 63791\n\n\n\n#ä¸»masterï¼Œ2ä¸ªsentinelé€‰ä¸¾æˆåŠŸåæ‰æœ‰æ•ˆï¼Œè¿™é‡Œçš„master-1æ˜¯åç§°ï¼Œåœ¨æ•´åˆçš„æ—¶å€™éœ€è¦ä¸€è‡´ï¼Œè¿™é‡Œå¯ä»¥éšä¾¿æ›´æ”¹\n\n\n\nsentinel monitor master-1 127.0.0.1 6379 2\n\n\n\n#åˆ¤æ–­ä¸»masterçš„æŒ‚æœºæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶æœªè¿”å›æ­£ç¡®ä¿¡æ¯åæ ‡è®°ä¸ºsdownçŠ¶æ€\n\n\n\nsentinel down-after-milliseconds master-1 5000\n\n\n\n#è‹¥sentinelåœ¨è¯¥é…ç½®å€¼å†…æœªèƒ½å®Œæˆfailoveræ“ä½œï¼ˆå³æ•…éšœæ—¶master/slaveè‡ªåŠ¨åˆ‡æ¢ï¼‰ï¼Œåˆ™è®¤ä¸ºæœ¬æ¬¡failoverå¤±è´¥ã€‚\n\n\n\nsentinel failover-timeout master-1 18000\n\n\n\n#é€‰é¡¹æŒ‡å®šäº†åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œ æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªä»æœåŠ¡å™¨åŒæ—¶å¯¹æ–°çš„ä¸»æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆæ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿\n\n\n\nsentinel config-epoch master-1 2\n\n```\n\n\n**éœ€è¦æ³¨æ„çš„åœ°æ–¹**\n\n\n1ã€è‹¥é€šè¿‡redis-cli -h 127.0.0.1 -p 6379è¿æ¥ï¼Œæ— éœ€æ”¹å˜é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶é»˜è®¤é…ç½®ä¸ºbind 127.0.0.1(åªå…è®¸127.0.0.1è¿æ¥è®¿é—®ï¼‰è‹¥é€šè¿‡redis-cli -h 192.168.180.78 -p 6379è¿æ¥ï¼Œéœ€æ”¹å˜é…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¿¡æ¯ä¸ºbind 127.0.0.1 192.168.180.78ï¼ˆåªå…è®¸127.0.0.1å’Œ192.168.180.78è®¿é—®ï¼‰æˆ–è€…å°†bind 127.0.0.1æ³¨é‡Šæ‰ï¼ˆå…è®¸æ‰€æœ‰è¿œç¨‹è®¿é—®ï¼‰\n\n\n2ã€masterauthä¸ºæ‰€è¦è¿æ¥çš„masteræœåŠ¡å™¨çš„requirepass,å¦‚æœä¸€ä¸ªredisé›†ç¾¤ä¸­æœ‰ä¸€ä¸ªmasteræœåŠ¡å™¨ï¼Œä¸¤ä¸ªslaveæœåŠ¡å™¨ï¼Œå½“masteræœåŠ¡å™¨æŒ‚æ‰æ—¶ï¼Œsentinelå“¨å…µä¼šéšæœºé€‰æ‹©ä¸€ä¸ªslaveæœåŠ¡å™¨å……å½“masteræœåŠ¡å™¨ï¼Œé‰´äºè¿™ç§æœºåˆ¶ï¼Œè§£å†³åŠæ³•æ˜¯å°†æ‰€æœ‰çš„ä¸»ä»æœåŠ¡å™¨çš„requirepasså’Œmasterauthéƒ½è®¾ç½®ä¸ºä¸€æ ·ã€‚\n\n\n3ã€sentinel monitor master-1 127.0.0.1 6379 2 è¡Œå°¾æœ€åçš„ä¸€ä¸ª2ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæœ‰æ—¶å€™ä¸€ä¸ªsentinelä¼šå› ä¸ºç½‘ç»œå µå¡è€Œè¯¯ä»¥ä¸ºä¸€ä¸ªmaster rediså·²ç»æ­»æ‰äº†ï¼Œå½“sentinelé›†ç¾¤å¼ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å°±å˜å¾—å¾ˆç®€å•ï¼Œåªéœ€è¦å¤šä¸ªsentineläº’ç›¸æ²Ÿé€šæ¥ç¡®è®¤æŸä¸ªmasteræ˜¯å¦çœŸçš„æ­»äº†ï¼Œè¿™ä¸ª2ä»£è¡¨ï¼Œå½“é›†ç¾¤ä¸­æœ‰2ä¸ªsentinelè®¤ä¸ºmasteræ­»äº†æ—¶ï¼Œæ‰èƒ½çœŸæ­£è®¤ä¸ºè¯¥masterå·²ç»ä¸å¯ç”¨äº†ã€‚ï¼ˆsentinelé›†ç¾¤ä¸­å„ä¸ªsentinelä¹Ÿæœ‰äº’ç›¸é€šä¿¡ï¼Œé€šè¿‡gossipåè®®ï¼‰ã€‚\n\n\n**ä¾æ¬¡å¯åŠ¨redis**\n\n\nredis-server master.6379.conf\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629094553158-1599779576.png)\n\n\nredis-server slave.6380.conf\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629094725047-214223016.png)\n\n\nredis-server slave.6381.conf\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629094815575-184254002.png)\n\n\nredis-server sentinel.63791.conf --sentinelï¼ˆlinux:redis-sentinel sentinel.63791.confï¼‰**å…¶ä»–ä¸¤ä¸ªå“¨å…µä¹Ÿè¿™æ ·å¯åŠ¨**\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629095126662-1063517024.png)\n\n\nä½¿ç”¨å®¢æˆ·ç«¯æŸ¥çœ‹ä¸€ä¸‹masterçŠ¶æ€\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629095541491-1901809546.png)\n\n\næŸ¥çœ‹ä¸€ä¸‹å“¨å…µçŠ¶æ€\n\n\n![](https://images2018.cnblogs.com/blog/764785/201806/764785-20180629095632770-302235804.png)\n\n\nç°åœ¨å°±å¯ä»¥åœ¨masteræ’å…¥æ•°æ®ï¼Œæ‰€æœ‰çš„redisæœåŠ¡éƒ½å¯ä»¥è·å–åˆ°ï¼Œslaveåªèƒ½è¯»\n\n\n**æ•´åˆspringï¼Œå¯¼å…¥ä¾èµ–**\n\n\n```text\n<dependency>\n        <groupId>redis.clients</groupId>\n        <artifactId>jedis</artifactId>\n        <version>2.8.0</version>\n    </dependency>\n    <!-- spring-redis -->\n    <dependency>\n        <groupId>org.springframework.data</groupId>\n        <artifactId>spring-data-redis</artifactId>\n        <version>1.6.4.RELEASE</version>\n    </dependency>\n<dependency>\n    <groupId>org.apache.commons</groupId>\n    <artifactId>commons-pool2</artifactId>\n    <version>2.4.2</version>\n</dependency>\n\n\n```\n\n\n**redis.properties**\n\n\n```text\n#redisä¸­å¿ƒ\nredis.host=127.0.0.1\n#redis.host=10.75.202.11\nredis.port=6379\nredis.password=\n#redis.password=123456\nredis.maxTotal=200\nredis.maxIdle=100\nredis.minIdle=8\nredis.maxWaitMillis=100000\nredis.maxActive=300\nredis.testOnBorrow=true\nredis.testOnReturn=true\n#Idleæ—¶è¿›è¡Œè¿æ¥æ‰«æ\nredis.testWhileIdle=true\n#è¡¨ç¤ºidle object evitorä¸¤æ¬¡æ‰«æä¹‹é—´è¦sleepçš„æ¯«ç§’æ•°\nredis.timeBetweenEvictionRunsMillis=30000\n#è¡¨ç¤ºidle object evitoræ¯æ¬¡æ‰«æçš„æœ€å¤šçš„å¯¹è±¡æ•°\nredis.numTestsPerEvictionRun=10\n#è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡è‡³å°‘åœç•™åœ¨idleçŠ¶æ€çš„æœ€çŸ­æ—¶é—´ï¼Œç„¶åæ‰èƒ½è¢«idle object evitoræ‰«æå¹¶é©±é€ï¼›è¿™ä¸€é¡¹åªæœ‰åœ¨timeBetweenEvictionRunsMilliså¤§äº0æ—¶æ‰æœ‰æ„ä¹‰\nredis.minEvictableIdleTimeMillis=60000\nredis.timeout=100000\n\n```\n\n\n### Cluster\n\n\n> Redis3.0ç‰ˆæœ¬ä¹‹åæ”¯æŒCluster.\n\n\n**redis clusterçš„ç°çŠ¶**\n\n\nç›®å‰redisæ”¯æŒçš„clusterç‰¹æ€§ï¼š\n\n\n1):èŠ‚ç‚¹è‡ªåŠ¨å‘ç°\n\n\n2):slave->master é€‰ä¸¾,é›†ç¾¤å®¹é”™\n\n\n3):Hot resharding:åœ¨çº¿åˆ†ç‰‡\n\n\n4):è¿›ç¾¤ç®¡ç†:cluster xxx\n\n\n5):åŸºäºé…ç½®(nodes-port.conf)çš„é›†ç¾¤ç®¡ç†\n\n\n6):ASK è½¬å‘/MOVED è½¬å‘æœºåˆ¶.\n\n\n**redis cluster æ¶æ„**\n\n\n1)redis-clusteræ¶æ„å›¾\n\n\n![](https://images2015.cnblogs.com/blog/17405/201607/17405-20160729120110388-883077606.jpg)\n\n\nåœ¨è¿™ä¸ªå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªè“è‰²çš„åœˆéƒ½ä»£è¡¨ç€ä¸€ä¸ªredisçš„æœåŠ¡å™¨èŠ‚ç‚¹ã€‚å®ƒä»¬ä»»ä½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½æ˜¯ç›¸äº’è¿é€šçš„ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¸ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ç›¸è¿æ¥ï¼Œç„¶åå°±å¯ä»¥è®¿é—®é›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¯¹å…¶è¿›è¡Œå­˜å–å’Œå…¶ä»–æ“ä½œã€‚\n\n\n**æ¶æ„ç»†èŠ‚:**\n\n- æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½.\n- èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆ.\n- å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯\n- redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Š,cluster è´Ÿè´£ç»´æŠ¤node<->slot<->value\n\n\t**redis-clusteré€‰ä¸¾:å®¹é”™**\n\n\n![](https://images2015.cnblogs.com/blog/17405/201607/17405-20160729120154169-1347608301.jpg)\n\n- é¢†ç€é€‰ä¸¾è¿‡ç¨‹æ˜¯é›†ç¾¤ä¸­æ‰€æœ‰masterå‚ä¸,å¦‚æœåŠæ•°ä»¥ä¸ŠmasterèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹é€šä¿¡è¶…è¿‡(cluster-node-timeout),è®¤ä¸ºå½“å‰masterèŠ‚ç‚¹æŒ‚æ‰.\n- ä»€ä¹ˆæ—¶å€™æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨(cluster_state:fail),å½“é›†ç¾¤ä¸å¯ç”¨æ—¶,æ‰€æœ‰å¯¹é›†ç¾¤çš„æ“ä½œåšéƒ½ä¸å¯ç”¨ï¼Œæ”¶åˆ°((error) CLUSTERDOWN The cluster is down)é”™è¯¯\n- å¦‚æœé›†ç¾¤ä»»æ„masteræŒ‚æ‰,ä¸”å½“å‰masteræ²¡æœ‰slave.é›†ç¾¤è¿›å…¥failçŠ¶æ€,ä¹Ÿå¯ä»¥ç†è§£æˆè¿›ç¾¤çš„slotæ˜ å°„[0-16383]ä¸å®Œæˆæ—¶è¿›å…¥failçŠ¶æ€.\n- å¦‚æœè¿›ç¾¤è¶…è¿‡åŠæ•°ä»¥ä¸ŠmasteræŒ‚æ‰ï¼Œæ— è®ºæ˜¯å¦æœ‰slaveé›†ç¾¤è¿›å…¥failçŠ¶æ€.\n\n> å®ƒä»¬ä¹‹é—´é€šè¿‡äº’ç›¸çš„ping-pongåˆ¤æ–­æ˜¯å¦èŠ‚ç‚¹å¯ä»¥è¿æ¥ä¸Šã€‚å¦‚æœæœ‰ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å»pingä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™æ²¡æœ‰å›åº”ï¼Œé›†ç¾¤å°±è®¤ä¸ºè¿™ä¸ªèŠ‚ç‚¹å®•æœºäº†ï¼Œç„¶åå»è¿æ¥å®ƒçš„å¤‡ç”¨èŠ‚ç‚¹ã€‚\n\n\n\tå¦‚æœæŸä¸ªèŠ‚ç‚¹å’Œæ‰€æœ‰ä»èŠ‚ç‚¹å…¨éƒ¨æŒ‚æ‰ï¼Œæˆ‘ä»¬é›†ç¾¤å°±è¿›å…¥faillçŠ¶æ€ã€‚è¿˜æœ‰å°±æ˜¯å¦‚æœæœ‰ä¸€åŠä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹å®•æœºï¼Œé‚£ä¹ˆæˆ‘ä»¬é›†ç¾¤åŒæ ·è¿›å…¥å‘åŠ›äº†çŠ¶æ€ã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„redisçš„æŠ•ç¥¨æœºåˆ¶\n\n\n**Redis 3.0çš„é›†ç¾¤æ–¹æ¡ˆæœ‰ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ã€‚**\n\n\n`ä¸€ä¸ªRediså®ä¾‹å…·å¤‡äº†â€œæ•°æ®å­˜å‚¨â€å’Œâ€œè·¯ç”±é‡å®šå‘â€ï¼Œå®Œå…¨å»ä¸­å¿ƒåŒ–çš„è®¾è®¡ã€‚`\n\n\n> è¿™å¸¦æ¥çš„å¥½å¤„æ˜¯éƒ¨ç½²éå¸¸ç®€å•ï¼Œç›´æ¥éƒ¨ç½²Rediså°±è¡Œï¼Œä¸åƒCodisæœ‰é‚£ä¹ˆå¤šçš„ç»„ä»¶å’Œä¾èµ–ã€‚ä½†å¸¦æ¥çš„é—®é¢˜æ˜¯å¾ˆéš¾å¯¹ä¸šåŠ¡è¿›è¡Œæ— ç—›çš„å‡çº§ï¼Œå¦‚æœå“ªå¤©Redisé›†ç¾¤å‡ºäº†ä»€ä¹ˆä¸¥é‡çš„Bugï¼Œå°±åªèƒ½å›æ»šæ•´ä¸ªRedisé›†ç¾¤ã€‚  \n> å¯¹åè®®è¿›è¡Œäº†è¾ƒå¤§çš„ä¿®æ”¹ï¼Œå¯¹åº”çš„Rediså®¢æˆ·ç«¯ä¹Ÿéœ€è¦å‡çº§ã€‚å‡çº§Rediså®¢æˆ·ç«¯åè°èƒ½ç¡®ä¿æ²¡æœ‰Bugï¼Ÿè€Œä¸”å¯¹äºçº¿ä¸Šå·²ç»å¤§è§„æ¨¡è¿è¡Œçš„ä¸šåŠ¡ï¼Œå‡çº§ä»£ç ä¸­çš„Rediså®¢æˆ·ç«¯ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ã€‚  \n> Redis Clusteræ˜¯Redis 3.0ä»¥åæ‰æ­£å¼æ¨å‡ºï¼Œæ—¶é—´è¾ƒæ™šï¼Œç›®å‰èƒ½è¯æ˜åœ¨å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒä¸‹æˆåŠŸçš„æ¡ˆä¾‹è¿˜ä¸æ˜¯å¾ˆå¤šï¼Œéœ€è¦æ—¶é—´æ£€éªŒã€‚\n\n\n### Jedis sharding\n\n\n> Redis Shardingå¯ä»¥è¯´æ˜¯åœ¨Redis clusterå‡ºæ¥ä¹‹å‰ä¸šç•Œæ™®éçš„é‡‡ç”¨æ–¹å¼ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯é‡‡ç”¨hashç®—æ³•å°†å­˜å‚¨æ•°æ®çš„keyè¿›è¡Œhashæ•£åˆ—ï¼Œè¿™æ ·ç‰¹å®šçš„keyä¼šè¢«å®šä¸ºåˆ°ç‰¹å®šçš„èŠ‚ç‚¹ä¸Šã€‚\n\n\n**åº†å¹¸çš„æ˜¯ï¼ŒJava Rediså®¢æˆ·ç«¯é©±åŠ¨Jediså·²æ”¯æŒRedis ShardingåŠŸèƒ½ï¼Œå³ShardedJedisä»¥åŠç»“åˆç¼“å­˜æ± çš„ShardedJedisPool**\n\n\n`Jedisçš„Redis Shardingå®ç°å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š`\n\n1. é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå°†keyå’ŒèŠ‚ç‚¹nameåŒæ—¶hashingï¼Œç„¶åè¿›è¡Œæ˜ å°„åŒ¹é…ï¼Œé‡‡ç”¨çš„ç®—æ³•æ˜¯MURMUR_HASHã€‚é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œè€Œä¸æ˜¯é‡‡ç”¨ç®€å•ç±»ä¼¼å“ˆå¸Œæ±‚æ¨¡æ˜ å°„çš„ä¸»è¦åŸå› æ˜¯å½“å¢åŠ æˆ–å‡å°‘èŠ‚ç‚¹æ—¶ï¼Œä¸ä¼šäº§ç”Ÿç”±äºé‡æ–°åŒ¹é…é€ æˆçš„rehashingã€‚ä¸€è‡´æ€§å“ˆå¸Œåªå½±å“ç›¸é‚»èŠ‚ç‚¹keyåˆ†é…ï¼Œå½±å“é‡å°ã€‚\n2. ä¸ºäº†é¿å…ä¸€è‡´æ€§å“ˆå¸Œåªå½±å“ç›¸é‚»èŠ‚ç‚¹é€ æˆèŠ‚ç‚¹åˆ†é…å‹åŠ›ï¼ŒShardedJedisä¼šå¯¹æ¯ä¸ªRedisèŠ‚ç‚¹æ ¹æ®åå­—(æ²¡æœ‰ï¼ŒJedisä¼šèµ‹äºˆç¼ºçœåå­—)ä¼šè™šæ‹ŸåŒ–å‡º160ä¸ªè™šæ‹ŸèŠ‚ç‚¹è¿›è¡Œæ•£åˆ—ã€‚æ ¹æ®æƒé‡weightï¼Œä¹Ÿå¯è™šæ‹ŸåŒ–å‡º160å€æ•°çš„è™šæ‹ŸèŠ‚ç‚¹ã€‚ç”¨è™šæ‹ŸèŠ‚ç‚¹åšæ˜ å°„åŒ¹é…ï¼Œå¯ä»¥åœ¨å¢åŠ æˆ–å‡å°‘RedisèŠ‚ç‚¹æ—¶ï¼Œkeyåœ¨å„RedisèŠ‚ç‚¹ç§»åŠ¨å†åˆ†é…æ›´å‡åŒ€ï¼Œè€Œä¸æ˜¯åªæœ‰ç›¸é‚»èŠ‚ç‚¹å—å½±å“ã€‚\n3. ShardedJedisæ”¯æŒkeyTagPatternæ¨¡å¼ï¼Œå³æŠ½å–keyçš„ä¸€éƒ¨åˆ†keyTagåšshardingï¼Œè¿™æ ·é€šè¿‡åˆç†å‘½åkeyï¼Œå¯ä»¥å°†ä¸€ç»„ç›¸å…³è”çš„keyæ”¾å…¥åŒä¸€ä¸ªRedisèŠ‚ç‚¹ï¼Œè¿™åœ¨é¿å…è·¨èŠ‚ç‚¹è®¿é—®ç›¸å…³æ•°æ®æ—¶å¾ˆé‡è¦ã€‚\n\n> å½“ç„¶ï¼ŒRedis Shardingè¿™ç§è½»é‡çµæ´»æ–¹å¼å¿…ç„¶åœ¨é›†ç¾¤å…¶å®ƒèƒ½åŠ›æ–¹é¢åšå‡ºå¦¥åã€‚æ¯”å¦‚æ‰©å®¹ï¼Œå½“æƒ³è¦å¢åŠ RedisèŠ‚ç‚¹æ—¶ï¼Œå°½ç®¡é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œï¼Œæ¯•ç«Ÿè¿˜æ˜¯ä¼šæœ‰keyåŒ¹é…ä¸åˆ°è€Œä¸¢å¤±ï¼Œè¿™æ—¶éœ€è¦é”®å€¼è¿ç§»ã€‚  \n> ä½œä¸ºè½»é‡çº§å®¢æˆ·ç«¯shardingï¼Œå¤„ç†Redisé”®å€¼è¿ç§»æ˜¯ä¸ç°å®çš„ï¼Œè¿™å°±è¦æ±‚åº”ç”¨å±‚é¢å…è®¸Redisä¸­æ•°æ®ä¸¢å¤±æˆ–ä»åç«¯æ•°æ®åº“é‡æ–°åŠ è½½æ•°æ®ã€‚ä½†æœ‰äº›æ—¶å€™ï¼Œå‡»ç©¿ç¼“å­˜å±‚ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“å±‚ï¼Œä¼šå¯¹ç³»ç»Ÿè®¿é—®é€ æˆå¾ˆå¤§å‹åŠ›ã€‚\n\n\n### åˆ©ç”¨ä¸­é—´ä»¶ä»£ç†\n\n\nä¸­é—´ä»¶çš„ä½œç”¨æ˜¯å°†æˆ‘ä»¬éœ€è¦å­˜å…¥redisä¸­çš„æ•°æ®çš„keyé€šè¿‡ä¸€å¥—ç®—æ³•è®¡ç®—å¾—å‡ºä¸€ä¸ªå€¼ã€‚ç„¶åæ ¹æ®è¿™ä¸ªå€¼æ‰¾åˆ°å¯¹åº”çš„redisèŠ‚ç‚¹ï¼Œå°†è¿™äº›æ•°æ®å­˜åœ¨è¿™ä¸ªredisçš„èŠ‚ç‚¹ä¸­ã€‚\n\n\nå¸¸ç”¨çš„ä¸­é—´ä»¶æœ‰è¿™å‡ ç§\n\n- Twemproxy\n- Codis\n- nginx\n\nå…·ä½“ç”¨æ³•å°±ä¸èµ˜è¿°äº†ï¼Œå¯ä»¥è‡ªè¡Œç™¾åº¦ã€‚\n\n\n### æ€»ç»“\n\n1. å®¢æˆ·ç«¯åˆ†ç‰‡ï¼ˆshardingï¼‰éœ€è¦å®¢æˆ·ç«¯ç»´æŠ¤åˆ†ç‰‡ç®—æ³•ï¼Œè¿™æ˜¯ä¸€ç§é™æ€çš„åˆ†ç‰‡æ–¹æ¡ˆï¼Œéœ€è¦å¢åŠ æˆ–è€…å‡å°‘Rediså®ä¾‹çš„æ•°é‡ï¼Œéœ€è¦æ‰‹å·¥è°ƒæ•´åˆ†ç‰‡çš„ç¨‹åºã€‚\n2. åˆ©ç”¨ä¸­é—´ä»¶çš„æƒ…å†µåˆ™ä¼šå½±å“åˆ°redisçš„æ€§èƒ½ï¼Œå…·ä½“çœ‹ä¸­é—´ä»¶è€Œå®šï¼Œæ¯•ç«Ÿæ‰€æœ‰è¯·æ±‚éƒ½è¦ç»è¿‡ä¸­é—´ä»¶ä¸€å±‚è¿‡æ»¤\n3. å®˜æ–¹æä¾›æ–¹æ¡ˆ ï¼ˆClusterï¼‰ï¼Œç°æ—¶ç‚¹æˆåŠŸæ¡ˆä¾‹ä¸å¤šã€‚\n\n## Redisåˆ†ç‰‡\n\n\nRedis çš„åˆ†ç‰‡æ‰¿æ‹…ç€ä¸¤ä¸ªä¸»è¦ç›®æ ‡ï¼š\n\n1. å…è®¸ä½¿ç”¨å¾ˆå¤šç”µè„‘çš„å†…å­˜æ€»å’Œæ¥æ”¯æŒæ›´å¤§çš„æ•°æ®åº“ã€‚æ²¡æœ‰åˆ†ç‰‡ï¼Œä½ å°±è¢«å±€é™äºå•æœºèƒ½æ”¯æŒçš„å†…å­˜å®¹é‡\n2. å…è®¸ä¼¸ç¼©è®¡ç®—èƒ½åŠ›åˆ°å¤šæ ¸æˆ–å¤šæœåŠ¡å™¨ï¼Œä¼¸ç¼©ç½‘ç»œå¸¦å®½åˆ°å¤šæœåŠ¡å™¨æˆ–å¤šç½‘ç»œé€‚é…å™¨\nèŒƒå›´åˆ†ç‰‡çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯å“ˆå¸Œåˆ†ç‰‡(hash partitioning)ã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºä»»ä½•é”®\nå“ˆå¸Œæ§½è®¾ç½®\nkey-->hashcode-->16384\n\n> åœ¨redisçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œéƒ½æœ‰è¿™ä¹ˆä¸¤ä¸ªä¸œè¥¿\n\n\n\t     ä¸€ä¸ªæ˜¯æ’æ§½ï¼ˆslotï¼‰å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå¯ä»¥å­˜å‚¨ä¸¤ä¸ªæ•°å€¼çš„ä¸€ä¸ªå˜é‡è¿™ä¸ªå˜é‡çš„å–å€¼èŒƒå›´æ˜¯ï¼š0-16383ã€‚\n\n\n\t    è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯clusteræˆ‘ä¸ªäººæŠŠè¿™ä¸ªclusterç†è§£ä¸ºæ˜¯ä¸€ä¸ªé›†ç¾¤ç®¡ç†çš„æ’ä»¶ã€‚\n\n\n\tå½“æˆ‘ä»¬çš„å­˜å–çš„keyåˆ°è¾¾çš„æ—¶å€™ï¼Œredisä¼šæ ¹æ®crc16çš„ç®—æ³•å¾—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå¯¹ 16384 æ±‚ä½™æ•°ï¼Œè¿™æ ·æ¯ä¸ª key éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ 0-16383 ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œé€šè¿‡è¿™ä¸ªå€¼ï¼Œå»æ‰¾åˆ°å¯¹åº”çš„æ’æ§½æ‰€å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶åç›´æ¥è‡ªåŠ¨è·³è½¬åˆ°è¿™ä¸ªå¯¹åº”çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå­˜å–æ“ä½œã€‚\n\n\n\tè¿˜æœ‰å°±æ˜¯å› ä¸ºå¦‚æœé›†ç¾¤çš„è¯ï¼Œæ˜¯æœ‰å¥½å¤šä¸ªredisä¸€èµ·å·¥ä½œçš„ï¼Œé‚£ä¹ˆï¼Œå°±éœ€è¦è¿™ä¸ªé›†ç¾¤ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“æŒ‚æ‰ï¼Œæ‰€ä»¥å‘¢ï¼Œç†è®ºä¸Šå°±åº”è¯¥ç»™é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘ä¸€ä¸ªå¤‡ç”¨çš„redisæœåŠ¡ã€‚è¿™ä¸ªå¤‡ç”¨çš„redisç§°ä¸ºä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ã€‚é‚£ä¹ˆè¿™ä¸ªé›†ç¾¤æ˜¯å¦‚ä½•åˆ¤æ–­æ˜¯å¦æœ‰æŸä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†å‘¢ï¼Ÿ\n\n\né¦–å…ˆè¦è¯´çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å­˜æœ‰è¿™ä¸ªé›†ç¾¤æ‰€æœ‰ä¸»èŠ‚ç‚¹ä»¥åŠä»èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚\n\n\n## **RedisæŒä¹…åŒ–**\n\n\n### RDB\n\n\n> Redis Databaseï¼Œå°±æ˜¯å¿«ç…§snapshotsã€‚ç¼ºçœæƒ…å†µæƒ…å†µä¸‹ï¼ŒRedisæŠŠæ•°æ®å¿«ç…§å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åä¸ºdump.rdbã€‚å¯ä»¥é…ç½®Redisçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚æ•°æ®é›†ä¸­æ¯Nç§’é’Ÿæœ‰è¶…è¿‡Mæ¬¡æ›´æ–°ï¼Œå°±å°†æ•°æ®å†™å…¥ç£ç›˜ï¼›æˆ–è€…ä½ å¯ä»¥æ‰‹å·¥è°ƒç”¨å‘½ä»¤SAVEæˆ–BGSAVEã€‚\n\n\nRedisæ˜¯ä½¿ç”¨forkå‡½æ•°å¤åˆ¶ä¸€ä»½å½“å‰è¿›ç¨‹(çˆ¶è¿›ç¨‹)çš„å‰¯æœ¬(å­è¿›ç¨‹) \tå­è¿›ç¨‹å¼€å§‹å°†æ•°æ®å†™åˆ°ä¸´æ—¶RDBæ–‡ä»¶ä¸­ \tå½“å­è¿›ç¨‹å®Œæˆå†™RDBæ–‡ä»¶ï¼Œç”¨æ–°æ–‡ä»¶æ›¿æ¢è€æ–‡ä»¶ \tè¿™ç§æ–¹å¼å¯ä»¥ä½¿Redisä½¿ç”¨copy-on-writeæŠ€æœ¯ã€‚\n\n\n### AOF\n\n\n> Append Only Fileã€‚å¿«ç…§æ¨¡å¼å¹¶ä¸ååˆ†å¥å£®ï¼Œå½“ç³»ç»Ÿåœæ­¢æˆ–è€…æ— æ„ä¸­Redisè¢«killæ‰ï¼Œæœ€åå†™å…¥Redisçš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚è¿™å¯¹æŸäº›åº”ç”¨ä¹Ÿè®¸ä¸æ˜¯å¤§é—®é¢˜ï¼Œä½†å¯¹äºè¦æ±‚é«˜å¯é æ€§çš„åº”ç”¨æ¥è¯´ï¼ŒRediså°±ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚Append-onlyæ–‡ä»¶æ¨¡å¼æ˜¯å¦ä¸€ç§é€‰æ‹©ã€‚å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰“å¼€AOFæ¨¡å¼  \n> Redisä¸­æä¾›äº†3ä¸­åŒæ­¥ç­–ç•¥ï¼Œå³æ¯ç§’åŒæ­¥ã€æ¯ä¿®æ”¹åŒæ­¥å’Œä¸åŒæ­¥ã€‚äº‹å®ä¸Šæ¯ç§’åŒæ­¥ä¹Ÿæ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œå…¶æ•ˆç‡ä¹Ÿæ˜¯éå¸¸é«˜çš„ï¼Œæ‰€å·®çš„æ˜¯ä¸€æ—¦ç³»ç»Ÿå‡ºç°å®•æœºç°è±¡ï¼Œé‚£ä¹ˆè¿™ä¸€ç§’é’Ÿä¹‹å†…ä¿®æ”¹çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚\n\n1. appendfsync alwaysæ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶\n2. appendfsync everysec æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œè¯¥ç­–ç•¥ä¸ºAOFçš„ç¼ºçœç­–ç•¥ã€‚åœ¨æ€§èƒ½å’ŒæŒä¹…åŒ–æ–¹é¢ä½œäº†å¾ˆå¥½çš„æŠ˜ä¸­\n3. appendfsync noä»ä¸åŒæ­¥ã€‚é«˜æ•ˆä½†æ˜¯æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ã€‚\n\n### è™šæ‹Ÿå†…å­˜æ–¹å¼\n\n\n> å½“keyå¾ˆå°è€Œvalueå¾ˆå¤§æ—¶ï¼Œä½¿ç”¨VMçš„æ•ˆæœä¼šæ¯”è¾ƒå¥½ï¼Œå› ä¸ºè¿™æ ·èŠ‚çº¦çš„å†…å­˜æ¯”è¾ƒå¤§ã€‚å½“keyä¸å°æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€äº›éå¸¸æ–¹æ³•å°†å¾ˆå¤§çš„keyå˜æˆå¾ˆå¤§çš„valueï¼Œå¦‚å¯ä»¥è€ƒè™‘å°†key/valueç»„åˆæˆä¸€ä¸ªæ–°value.  \n> vm-max-threadsè¿™ä¸ªå‚æ•°,å¯ä»¥è®¾ç½®è®¿é—®swapæ–‡ä»¶çš„çº¿ç¨‹æ•°,è®¾ç½®æœ€å¥½ä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°,å¦‚æœè®¾ç½®ä¸º0,é‚£ä¹ˆæ‰€æœ‰å¯¹swapæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„.å¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿ,ä½†æ˜¯å¯¹æ•°æ®å®Œæ•´æ€§æœ‰å¾ˆå¥½çš„ä¿è¯.ç”¨è™šæ‹Ÿå†…å­˜æ€§èƒ½ä¹Ÿä¸é”™ã€‚å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå¯ä»¥è€ƒè™‘åˆ†å¸ƒå¼æˆ–è€…å…¶ä»–æ•°æ®åº“\n\n\nredis.windows.conf\ndaemonize noé»˜è®¤æƒ…å†µä¸‹redisä¸æ˜¯ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„ï¼Œå¦‚æœæƒ³è®©å®ƒåœ¨åå°è¿è¡Œï¼Œå°±æŠŠå®ƒæ”¹æˆyesã€‚å½“redisä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šå†™ä¸€ä¸ªpidåˆ°/var/run/redis.pidæ–‡ä»¶é‡Œé¢\n\n\n### å»ºè®®\n\n- æ›´æ–°é¢‘ç¹: ä¸€è‡´æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼ŒAOFç­–ç•¥ä¸ºä¸»\n- æ›´æ–°ä¸é¢‘ç¹: å¯ä»¥å®¹å¿å°‘é‡æ•°æ®ä¸¢å¤±æˆ–é”™è¯¯ï¼Œsnapshotï¼ˆå¿«ç…§ï¼‰ç­–ç•¥ä¸ºä¸»\n\n## **Redisäº‹åŠ¡**\n\n\nredisäº‹åŠ¡æ˜¯é€šè¿‡MULTIï¼ŒEXECï¼ŒDISCARDå’ŒWATCHå››ä¸ªåŸè¯­å®ç°çš„ã€‚\n\n\n```text\nMULTIå‘½ä»¤ç”¨äºå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒæ€»æ˜¯è¿”å›OKã€‚\n\t\tMULTIæ‰§è¡Œä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘æœåŠ¡å™¨å‘é€ä»»æ„å¤šæ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå½“EXECå‘½ä»¤è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚\n\t\tå¦ä¸€æ–¹é¢ï¼Œé€šè¿‡è°ƒç”¨DISCARDï¼Œå®¢æˆ·ç«¯å¯ä»¥æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ï¼Œå¹¶æ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡ã€‚\n\nredisäº‹åŠ¡èŒƒå›´\n\tä»multiå‘½ä»¤å¼€å§‹ï¼Œåˆ°execæˆ–è€…discardä¸ºæ­¢ï¼Œæ•´ä¸ªæ“ä½œè¿‡ç¨‹æ˜¯åŸå­æ€§çš„ï¼Œä¸èƒ½æ‰“ä¹±é¡ºåºï¼Œä¹Ÿä¸èƒ½æ’å…¥æ“ä½œ\n\tä½†æ˜¯å‡ºé”™ä¹‹å‰çš„æ“ä½œä¼šæ­£å¸¸æäº¤\n\nWATCH å‘½ä»¤å¯ä»¥ä¸º Redis äº‹åŠ¡æä¾› check-and-set ï¼ˆCASï¼‰è¡Œä¸ºã€‚\n\tè¢« WATCH çš„é”®ä¼šè¢«ç›‘è§†ï¼Œå¹¶ä¼šå‘è§‰è¿™äº›é”®æ˜¯å¦è¢«æ”¹åŠ¨è¿‡äº†ã€‚ å¦‚æœæœ‰è‡³å°‘ä¸€ä¸ªè¢«ç›‘è§†çš„é”®åœ¨ EXEC æ‰§è¡Œä¹‹å‰\nè¢«ä¿®æ”¹äº†ï¼Œ é‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡éƒ½ä¼šè¢«å–æ¶ˆï¼Œ EXEC è¿”å›ç©ºå¤šæ¡æ‰¹é‡å›å¤ï¼ˆnull multi-bulk replyï¼‰æ¥è¡¨ç¤ºäº‹åŠ¡å·²\nç»å¤±è´¥ã€‚\n\n```\n\n\n### **ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”**\n\n\n```text\n1ã€å‘Redisä¸­å­˜æ”¾å›ºå®škeyçš„å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨åˆ™å®ç°å­˜æ”¾å¹¶è·å–é”ï¼›å¦‚æœkeyå·²ç»å­˜åœ¨åˆ™ä¸èƒ½è·å–é”\n\t\t\tï¼ˆä¾é Redisä¸­çš„åŸå­æ“ä½œè¿›è¡ŒCASæ¯”å¯¹ï¼Œå®ç°é”çš„äº’æ–¥ï¼‰\n2ã€è·å–keyæ‰€å¯¹åº”çš„æ—¶é—´ï¼Œæ—¶é—´æ˜¯é”é¢„æœŸçš„å®æ•ˆæ—¶é—´ï¼Œå¦‚æœå·²ç»å®æ•ˆï¼Œåˆ™å­˜å‚¨æ–°å€¼ï¼Œå¹¶è·å–é”\n3ã€å¦åˆ™è·å–é”å¤±è´¥\n\nè§£é”ï¼š\n\tåˆ é™¤æŒ‡å®škeyçš„redisåˆ—\n\n\n```\n\n\næŠ¢è´­ã€ç§’æ€æ˜¯å¦‚ä»Šå¾ˆå¸¸è§çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œä¸»è¦éœ€è¦è§£å†³çš„é—®é¢˜æœ‰ä¸¤ä¸ªï¼š\n\n1. é«˜å¹¶å‘å¯¹æ•°æ®åº“äº§ç”Ÿçš„å‹åŠ›\n2. ç«äº‰çŠ¶æ€ä¸‹å¦‚ä½•è§£å†³åº“å­˜çš„æ­£ç¡®å‡å°‘ï¼ˆ\"è¶…å–\"é—®é¢˜ï¼‰\n\nå¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå·²ç»å¾ˆå®¹æ˜“æƒ³åˆ°ç”¨ç¼“å­˜æ¥å¤„ç†æŠ¢è´­ï¼Œé¿å…ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œä¾‹å¦‚ä½¿ç”¨Redisã€‚\n\n\n### **Redisä½¿ç”¨watchå®Œæˆç§’æ€æŠ¢è´­åŠŸèƒ½ï¼š**\n\n\nä½¿ç”¨redisä¸­ä¸¤ä¸ªkeyå®Œæˆç§’æ€æŠ¢è´­åŠŸèƒ½ï¼Œmywatchkeyç”¨äºå­˜å‚¨æŠ¢è´­æ•°é‡å’Œmywatchlistç”¨æˆ·å­˜å‚¨æŠ¢è´­åˆ—è¡¨ã€‚\n\n\n```text\nä¼˜ç‚¹ï¼š\n\t1ã€é¦–å…ˆé€‰ç”¨å†…å­˜æ•°æ®åº“æ¥æŠ¢è´­é€Ÿåº¦æå¿«\n\t2ã€é€Ÿåº¦å¿«å¹¶å‘è‡ªç„¶æ²¡ä¸æ˜¯é—®é¢˜\n\t3ã€ä½¿ç”¨æ‚²è§‚é”ï¼Œä¼šè¿…é€Ÿå¢åŠ ç³»ç»Ÿèµ„æº\n\t4ã€æ¯”é˜Ÿåˆ—å¼ºçš„å¤šï¼Œé˜Ÿåˆ—ä¼šä½¿å†…å­˜æ•°æ®åº“èµ„æºç¬é—´çˆ†æ£š\n\t5ã€ä½¿ç”¨ä¹è§‚é”ï¼Œè¾¾åˆ°ç»¼åˆéœ€æ±‚\n\n```\n\n\n## ä¸å…³ç³»å‹æ•°æ®åº“çš„åŒºåˆ«\n\n\n### æ•°æ®baiå­˜å‚¨æ–¹å¼ä¸åŒã€‚\n\n\nå…³ç³»å‹å’Œéå…³ç³»å‹æ•°æ®åº“çš„ä¸»è¦å·®å¼‚æ˜¯æ•°æ®å­˜å‚¨çš„æ–¹å¼ã€‚å…³ç³»å‹æ•°æ®å¤©ç„¶å°±æ˜¯è¡¨æ ¼å¼çš„ï¼Œå› æ­¤å­˜å‚¨åœ¨æ•°æ®è¡¨çš„è¡Œå’Œåˆ—ä¸­ã€‚æ•°æ®è¡¨å¯ä»¥å½¼æ­¤å…³è”åä½œå­˜å‚¨ï¼Œä¹Ÿå¾ˆå®¹æ˜“æå–æ•°æ®ã€‚\n\n\nä¸å…¶ç›¸åï¼Œéå…³ç³»å‹æ•°æ®ä¸é€‚åˆå­˜å‚¨åœ¨æ•°æ®è¡¨çš„è¡Œå’Œåˆ—ä¸­ï¼Œè€Œæ˜¯å¤§å—ç»„åˆåœ¨ä¸€èµ·ã€‚éå…³ç³»å‹æ•°æ®é€šå¸¸å­˜å‚¨åœ¨æ•°æ®é›†ä¸­ï¼Œå°±åƒæ–‡æ¡£ã€é”®å€¼å¯¹æˆ–è€…å›¾ç»“æ„ã€‚ä½ çš„æ•°æ®åŠå…¶ç‰¹æ€§æ˜¯é€‰æ‹©æ•°æ®å­˜å‚¨å’Œæå–æ–¹å¼çš„é¦–è¦å½±å“å› ç´ ã€‚\n\n\n### æ‰©å±•æ–¹å¼ä¸åŒã€‚\n\n\nSQLå’ŒNoSQLæ•°æ®åº“æœ€å¤§çš„å·®åˆ«å¯èƒ½æ˜¯åœ¨æ‰©å±•æ–¹å¼ä¸Šï¼Œè¦æ”¯æŒæ—¥ç›Šå¢é•¿çš„éœ€æ±‚å½“ç„¶è¦æ‰©å±•ã€‚\n\n\nè¦æ”¯æŒæ›´å¤šå¹¶å‘é‡ï¼ŒSQLæ•°æ®åº“æ˜¯çºµå‘æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯è¯´æé«˜å¤„ç†èƒ½åŠ›ï¼Œä½¿ç”¨é€Ÿåº¦æ›´å¿«é€Ÿçš„è®¡ç®—æœºï¼Œè¿™æ ·å¤„ç†ç›¸åŒçš„æ•°æ®é›†å°±æ›´å¿«äº†ã€‚\n\n\nå› ä¸ºæ•°æ®å­˜å‚¨åœ¨å…³ç³»è¡¨ä¸­ï¼Œæ“ä½œçš„æ€§èƒ½ç“¶é¢ˆå¯èƒ½æ¶‰åŠå¾ˆå¤šä¸ªè¡¨ï¼Œè¿™éƒ½éœ€è¦é€šè¿‡æé«˜è®¡ç®—æœºæ€§èƒ½æ¥å®¢æœã€‚è™½ç„¶SQLæ•°æ®åº“æœ‰å¾ˆå¤§æ‰©å±•ç©ºé—´ï¼Œä½†æœ€ç»ˆè‚¯å®šä¼šè¾¾åˆ°çºµå‘æ‰©å±•çš„ä¸Šé™ã€‚è€ŒNoSQLæ•°æ®åº“æ˜¯æ¨ªå‘æ‰©å±•çš„ã€‚\n\n\nè€Œéå…³ç³»å‹æ•°æ®å­˜å‚¨å¤©ç„¶å°±æ˜¯åˆ†å¸ƒå¼çš„ï¼ŒNoSQLæ•°æ®åº“çš„æ‰©å±•å¯ä»¥é€šè¿‡ç»™èµ„æºæ± æ·»åŠ æ›´å¤šæ™®é€šçš„æ•°æ®åº“æœåŠ¡å™¨(èŠ‚ç‚¹)æ¥åˆ†æ‹…è´Ÿè½½ã€‚\n\n\n### å¯¹äº‹åŠ¡æ€§çš„æ”¯æŒä¸åŒã€‚\n\n\nå¦‚æœæ•°æ®æ“ä½œéœ€è¦é«˜äº‹åŠ¡æ€§æˆ–è€…å¤æ‚æ•°æ®æŸ¥è¯¢éœ€è¦æ§åˆ¶æ‰§è¡Œè®¡åˆ’ï¼Œé‚£ä¹ˆä¼ ç»Ÿçš„SQLæ•°æ®åº“ä»æ€§èƒ½å’Œç¨³å®šæ€§æ–¹é¢è€ƒè™‘æ˜¯ä½ çš„æœ€ä½³é€‰æ‹©ã€‚SQLæ•°æ®åº“æ”¯æŒå¯¹äº‹åŠ¡åŸå­æ€§ç»†ç²’åº¦æ§åˆ¶ï¼Œå¹¶ä¸”æ˜“äºå›æ»šäº‹åŠ¡ã€‚\n\n\nè™½ç„¶NoSQLæ•°æ®åº“ä¹Ÿå¯ä»¥ä½¿ç”¨äº‹åŠ¡æ“ä½œï¼Œä½†ç¨³å®šæ€§æ–¹é¢æ²¡æ³•å’Œå…³ç³»å‹æ•°æ®åº“æ¯”è¾ƒï¼Œæ‰€ä»¥å®ƒä»¬çœŸæ­£é—ªäº®çš„ä»·å€¼æ˜¯åœ¨æ“ä½œçš„æ‰©å±•æ€§å’Œå¤§æ•°æ®é‡å¤„ç†æ–¹é¢ã€‚\n\n\n### å…³ç³»å‹\n\n\n**ä¼˜ç‚¹ï¼š**\n\n1. æ˜“äºç»´æŠ¤ï¼šéƒ½æ˜¯ä½¿ç”¨è¡¨ç»“æ„ï¼Œæ ¼å¼ä¸€è‡´ï¼›\n2. ä½¿ç”¨æ–¹ä¾¿ï¼šSQLè¯­è¨€é€šç”¨ï¼Œå¯ç”¨äºå¤æ‚æŸ¥è¯¢ï¼›\n3. å¤æ‚æ“ä½œï¼šæ”¯æŒSQLï¼Œå¯ç”¨äºä¸€ä¸ªè¡¨ä»¥åŠå¤šä¸ªè¡¨ä¹‹é—´éå¸¸å¤æ‚çš„æŸ¥è¯¢ã€‚\n\n**ç¼ºç‚¹ï¼š**\n\n1. è¯»å†™æ€§èƒ½æ¯”è¾ƒå·®ï¼Œå°¤å…¶æ˜¯æµ·é‡æ•°æ®çš„é«˜æ•ˆç‡è¯»å†™ï¼›\n2. å›ºå®šçš„è¡¨ç»“æ„ï¼Œçµæ´»åº¦ç¨æ¬ ï¼›\n3. é«˜å¹¶å‘è¯»å†™éœ€æ±‚ï¼Œä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“æ¥è¯´ï¼Œç¡¬ç›˜I/Oæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç“¶é¢ˆã€‚\n\n### éå…³ç³»å‹\n\n\néå…³ç³»å‹æ•°æ®åº“ä¸¥æ ¼ä¸Šä¸æ˜¯ä¸€ç§æ•°æ®åº“ï¼Œåº”è¯¥æ˜¯ä¸€ç§æ•°æ®ç»“æ„åŒ–å­˜å‚¨æ–¹æ³•çš„é›†åˆï¼Œå¯ä»¥æ˜¯æ–‡æ¡£æˆ–è€…é”®å€¼å¯¹ç­‰ã€‚\n\n\n**ä¼˜ç‚¹ï¼š**\n\n1. æ ¼å¼çµæ´»ï¼šå­˜å‚¨æ•°æ®çš„æ ¼å¼å¯ä»¥æ˜¯key,valueå½¢å¼ã€æ–‡æ¡£å½¢å¼ã€å›¾ç‰‡å½¢å¼ç­‰ç­‰ï¼Œæ–‡æ¡£å½¢å¼ã€å›¾ç‰‡å½¢å¼ç­‰ç­‰ï¼Œä½¿ç”¨çµæ´»ï¼Œåº”ç”¨åœºæ™¯å¹¿æ³›ï¼Œè€Œå…³ç³»å‹æ•°æ®åº“åˆ™åªæ”¯æŒåŸºç¡€ç±»å‹ã€‚\n2. é€Ÿåº¦å¿«ï¼šnosqlå¯ä»¥ä½¿ç”¨ç¡¬ç›˜æˆ–è€…éšæœºå­˜å‚¨å™¨ä½œä¸ºè½½ä½“ï¼Œè€Œå…³ç³»å‹æ•°æ®åº“åªèƒ½ä½¿ç”¨ç¡¬ç›˜ï¼›\n3. é«˜æ‰©å±•æ€§ï¼›\n4. æˆæœ¬ä½ï¼šnosqlæ•°æ®åº“éƒ¨ç½²ç®€å•ï¼ŒåŸºæœ¬éƒ½æ˜¯å¼€æºè½¯ä»¶ã€‚\n\n**ç¼ºç‚¹ï¼š**\n\n1. ä¸æä¾›sqlæ”¯æŒï¼Œå­¦ä¹ å’Œä½¿ç”¨æˆæœ¬è¾ƒé«˜ï¼›\n2. æ— äº‹åŠ¡å¤„ç†ï¼›\n3. æ•°æ®ç»“æ„ç›¸å¯¹å¤æ‚ï¼Œå¤æ‚æŸ¥è¯¢æ–¹é¢ç¨æ¬ ã€‚\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2021-12-18",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "23",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å¾®æœåŠ¡",
          "åˆ†å¸ƒå¼",
          "Redis"
        ],
        "summary": "ä¸€è‡´æ€§hashåœ¨Redis é›†ç¾¤æ¨¡å¼Clusterä¸­ï¼ŒRedisé‡‡ç”¨çš„æ˜¯åˆ†ç‰‡Shardingçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®é‡‡ç”¨ä¸€å®šçš„åˆ†åŒºç­–ç•¥ï¼Œåˆ†å‘åˆ°ç›¸åº”çš„é›†ç¾¤èŠ‚ç‚¹ä¸­ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°HASHç®—æ³•è¿›è¡Œç¼“å­˜æ—¶ï¼Œä¼šå‡º",
        "sort": "",
        "title": "Redisé›†ç¾¤ä¸ç‰¹æ€§",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "f81c2940-d22e-4782-9d95-d16b57f6d3f4"
        }
      ],
      "body": "",
      "realName": "Redisé›†ç¾¤ä¸ç‰¹æ€§",
      "relativePath": "/archives/Redisé›†ç¾¤ä¸ç‰¹æ€§.md"
    },
    {
      "id": "44263dbd-e5d6-4365-a72e-b0ff92bd0220",
      "doc_id": "44263dbd-e5d6-4365-a72e-b0ff92bd0220",
      "title": "44263dbd-e5d6-4365-a72e-b0ff92bd0220",
      "updated": 1696747320000,
      "body_original": "\n# RestTemplate\n\n\nåœ¨`SpringCloud`ä½“ç³»ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æœåŠ¡ä¹‹é—´çš„è°ƒç”¨æ˜¯é€šè¿‡`http`åè®®è¿›è¡Œè°ƒç”¨çš„ã€‚è€Œæ³¨å†Œä¸­å¿ƒçš„ä¸»è¦ç›®çš„å°±æ˜¯ç»´æŠ¤è¿™äº›æœåŠ¡çš„æœåŠ¡åˆ—è¡¨ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨`Spring`ä¸­ï¼Œæä¾›äº†`RestTemplate`ã€‚`RestTemplate`æ˜¯`Spring`æä¾›çš„ç”¨äºè®¿é—®RestæœåŠ¡çš„å®¢æˆ·ç«¯ã€‚è€Œåœ¨`SpringCloud`ä¸­ä¹Ÿæ˜¯ä½¿ç”¨æ­¤æœåŠ¡è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„ã€‚\n\n\nåŒæ—¶åœ¨å¾®æœåŠ¡ä¸­ï¼Œä¸€èˆ¬ä¸ŠæœåŠ¡éƒ½ä¸ä¼šè¿›è¡Œå•ç‚¹éƒ¨ç½²çš„ï¼Œéƒ½ä¼šè‡³å°‘éƒ¨ç½²2å°åŠä»¥ä¸Šçš„ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº†æ³¨å†Œä¸­å¿ƒè¿›è¡ŒæœåŠ¡åˆ—è¡¨çš„ç»´æŠ¤ï¼Œå°±éœ€è¦ä¸€ä¸ªå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æ¥è¿›è¡ŒåŠ¨æ€æœåŠ¡çš„è°ƒç”¨ã€‚\n\n\næ‰€ä»¥å¼€å§‹ç¤ºä¾‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å¤§è‡´äº†è§£ä¸‹å…³äº`è´Ÿè½½å‡è¡¡`å’Œ`RestTemplate`çš„ç›¸å…³çŸ¥è¯†ç‚¹ã€‚å…¶å®åé¢å®ä¾‹çš„`Ribbon`å’Œ`Feign`æœ€åçš„è°ƒç”¨éƒ½æ˜¯åŸºäº`RestTemplate`çš„ã€‚ä½¿ç”¨æ¯”è¾ƒç®€å•~\n\n\n### ä½•ä¸ºè´Ÿè½½å‡è¡¡\n\n\n> è´Ÿè½½å‡è¡¡(Load Balance)æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸­å¿…é¡»è€ƒè™‘çš„å› ç´ ä¹‹ä¸€ï¼Œå®ƒé€šå¸¸æ˜¯æŒ‡ï¼Œå°†è¯·æ±‚/æ•°æ®**ã€å‡åŒ€ã€‘åˆ†æ‘Š**åˆ°å¤šä¸ªæ“ä½œå•å…ƒä¸Šæ‰§è¡Œï¼Œè´Ÿè½½å‡è¡¡çš„å…³é”®åœ¨äºã€å‡åŒ€ã€‘ã€‚\n\n\n### å®ç°çš„æ–¹å¼\n\n\nå®ç°è´Ÿè½½å‡è¡¡çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸‹å‡ ç§æ–¹å¼ï¼Œå¹¶æœªè¿‡å¤šæ·±å…¥ã€‚\n\n\n**æ³¨æ„ï¼šä»¥ä¸‹éƒ¨åˆ†å†…å®¹è½¬è‡³**[**å‡ ç§è´Ÿè½½å‡è¡¡æŠ€æœ¯çš„å®ç°**](https://blog.csdn.net/mengdonghui123456/article/details/53981976)**ã€‚**\n\n\n1.HTTPé‡å®šå‘è´Ÿè½½å‡è¡¡\n\n\n> æ ¹æ®ç”¨æˆ·çš„httpè¯·æ±‚è®¡ç®—å‡ºä¸€ä¸ªçœŸå®çš„webæœåŠ¡å™¨åœ°å€ï¼Œå¹¶å°†è¯¥webæœåŠ¡å™¨åœ°å€å†™å…¥httpé‡å®šå‘å“åº”ä¸­è¿”å›ç»™æµè§ˆå™¨ï¼Œç”±æµè§ˆå™¨é‡æ–°è¿›è¡Œè®¿é—®\n\n\n![](http://qiniu.xds123.cn/18-9-20/60217159.jpg)\n\n\n**ä¼˜ç¼ºç‚¹ï¼šå®ç°èµ·æ¥å¾ˆç®€å•ï¼Œè€Œç¼ºç‚¹ä¹Ÿæ˜¾è€Œæ˜“è§äº†ï¼šè¯·æ±‚ä¸¤æ¬¡æ‰èƒ½å®Œæˆä¸€æ¬¡è®¿é—®ï¼›æ€§èƒ½å·®;é‡å®šå‘æœåŠ¡å™¨ä¼šæˆä¸ºç“¶é¢ˆ**\n\n\n2.DNSåŸŸåè§£æè´Ÿè½½å‡è¡¡\n\n\n> åœ¨DNSæœåŠ¡å™¨ä¸Šé…ç½®å¤šä¸ªåŸŸåå¯¹åº”IPçš„è®°å½•ã€‚ä¾‹å¦‚ä¸€ä¸ªåŸŸåwww.baidu.comå¯¹åº”ä¸€ç»„webæœåŠ¡å™¨IPåœ°å€ï¼ŒåŸŸåè§£ææ—¶ç»è¿‡DNSæœåŠ¡å™¨çš„ç®—æ³•å°†ä¸€ä¸ªåŸŸåè¯·æ±‚åˆ†é…åˆ°åˆé€‚çš„çœŸå®æœåŠ¡å™¨ä¸Šã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/60831825.jpg)\n\n\n**ä¼˜ç¼ºç‚¹ï¼šåŠ å¿«è®¿é—®é€Ÿåº¦,æ”¹å–„æ€§èƒ½ã€‚åŒæ—¶ç”±äºDNSè§£ææ˜¯å¤šçº§è§£æï¼Œæ¯ä¸€çº§DNSéƒ½å¯èƒ½åŒ–ç¼“å­˜è®°å½•Aï¼Œå½“æŸä¸€æœåŠ¡å™¨ä¸‹çº¿åï¼Œè¯¥æœåŠ¡å™¨å¯¹åº”çš„DNSè®°å½•Aå¯èƒ½ä»ç„¶å­˜åœ¨ï¼Œå¯¼è‡´åˆ†é…åˆ°è¯¥æœåŠ¡å™¨çš„ç”¨æˆ·è®¿é—®å¤±è´¥ï¼Œè€Œä¸”DNSè´Ÿè½½å‡è¡¡é‡‡ç”¨çš„æ˜¯ç®€å•çš„è½®è¯¢ç®—æ³•ï¼Œä¸èƒ½åŒºåˆ†æœåŠ¡å™¨ä¹‹é—´çš„å·®å¼‚ï¼Œä¸èƒ½åæ˜ æœåŠ¡å™¨å½“å‰è¿è¡ŒçŠ¶æ€ã€‚**\n\n\n3.åå‘ä»£ç†è´Ÿè½½å‡è¡¡\n\n\n> åå‘ä»£ç†å¤„äºwebæœåŠ¡å™¨è¿™è¾¹ï¼Œåå‘ä»£ç†æœåŠ¡å™¨æä¾›è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼ŒåŒæ—¶ç®¡ç†ä¸€ç»„webæœåŠ¡å™¨ï¼Œå®ƒæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚çš„æµè§ˆå™¨è®¿é—®è½¬å‘åˆ°ä¸åŒçš„webæœåŠ¡å™¨å¤„ç†ï¼Œå¤„ç†ç»“æœç»è¿‡åå‘æœåŠ¡å™¨è¿”å›ç»™æµè§ˆå™¨ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/44882339.jpg)\n\n\n**ä¼˜ç¼ºç‚¹ï¼šå®ç°ç®€å•ï¼Œå¯åˆ©ç”¨åå‘ä»£ç†ç¼“å­˜èµ„æº(è¿™æ˜¯æœ€å¸¸ç”¨çš„äº†)åŠæ”¹å–„ç½‘ç«™æ€§èƒ½ã€‚åŒæ—¶å› ä¸ºæ˜¯æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„ä¸­è½¬ç«™ï¼Œæ‰€ä»¥åå‘ä»£ç†æœåŠ¡å™¨å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚**\n\n\n**ä»¥ä¸Šä»…ä»…æ˜¯éƒ¨åˆ†å®ç°æ–¹å¼ï¼Œè¿˜æœ‰æ¯”å¦‚****`IPè´Ÿè½½å‡è¡¡`****ã€****`æ•°æ®é“¾è·¯å±‚è´Ÿè½½å‡è¡¡`****ç­‰ç­‰ï¼Œè¿™äº›å¯èƒ½æ¶‰åŠåˆ°ç›¸å…³ç½‘ç»œæ–¹é¢çš„çŸ¥è¯†ç‚¹äº†ï¼Œä¸æ˜¯å¾ˆäº†è§£ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥è‡ªè¡Œæœç´¢ä¸‹å§ã€‚**\n\n\n### å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡\n\n\nå®ç°è´Ÿè½½å‡è¡¡ä¹ŸåˆåŒºåˆ†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹åˆ†ï¼Œ`Ribbon`å°±æ˜¯åŸºäºå®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚\nå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-20/49529849.jpg)\n\n\næœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-20/19525388.jpg)\n\n\næœåŠ¡ç«¯å®ç°è´Ÿè½½å‡è¡¡æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š`ç¡¬ä»¶F5`ã€`Nginx`ã€`HA Proxy`ç­‰ç­‰ï¼Œè¿™äº›åº”è¯¥å®æ–½ç›¸å…³äººå‘˜åº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œæœ¬äººå¯èƒ½ä¹Ÿå°±å¯¹`Nginx`äº†è§£ä¸‹ï¼ŒâŠ™ï¹âŠ™â€–âˆ£\n\n\n### RestTemplateç®€å•ä»‹ç»\n\n\n> RestTemplateæ˜¯Springæä¾›çš„ç”¨äºè®¿é—®RestæœåŠ¡çš„å®¢æˆ·ç«¯ï¼ŒRestTemplateæä¾›äº†å¤šç§ä¾¿æ·è®¿é—®è¿œç¨‹HttpæœåŠ¡çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿå¤§å¤§æé«˜å®¢æˆ·ç«¯çš„ç¼–å†™æ•ˆç‡ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/9663891.jpg)\n\n\nç®€å•æ¥è¯´ï¼Œ`RestTemplate`é‡‡ç”¨äº†`æ¨¡ç‰ˆè®¾è®¡`çš„è®¾è®¡æ¨¡å¼ï¼Œå°†è¿‡ç¨‹ä¸­ä¸ç‰¹å®šå®ç°ç›¸å…³çš„éƒ¨åˆ†å§”æ‰˜ç»™æ¥å£,è€Œè¿™ä¸ªæ¥å£çš„ä¸åŒå®ç°å®šä¹‰äº†æ¥å£çš„ä¸åŒè¡Œä¸º,æ‰€ä»¥å¯ä»¥å¾ˆå®¹æ˜“çš„ä½¿ç”¨ä¸åŒçš„ç¬¬ä¸‰æ–¹httpæœåŠ¡ï¼Œå¦‚`okHttp`ã€`httpclient`ç­‰ã€‚\n\n\n`RestTemplate`å®šä¹‰äº†å¾ˆå¤šçš„ä¸RESTèµ„æºäº¤äº’ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸‹ä¸€äº›å¸¸ç”¨çš„è¯·æ±‚æ–¹å¼çš„ä½¿ç”¨ã€‚\n\n\n### exchange\n\n\nåœ¨URLä¸Šæ‰§è¡Œç‰¹å®šçš„HTTPæ–¹æ³•ï¼Œè¿”å›åŒ…å«å¯¹è±¡çš„`ResponseEntity`ã€‚å…¶ä»–çš„å¦‚`GET`ã€`POST`ç­‰æ–¹æ³•åº•å±‚éƒ½æ˜¯åŸºäºæ­¤æ–¹æ³•çš„ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/91101426.jpg)\n\n\nå¦‚ï¼š\n\n- getè¯·æ±‚\n\n```text\nRequestEntity requestEntity = RequestEntity.get(new URI(uri)).build();\nResponseEntity<User> responseEntity2 = this.restTemplate.exchange(requestEntity, User.class);\n\n```\n\n- postè¯·æ±‚\n\n```text\nRequestEntity<User> requestEntity = RequestEntity.post(new URI(uri)).body(user);\nResponseEntity<User> responseEntity2 = this.restTemplate.exchange(requestEntity, User.class);\n\n```\n\n\n### GETè¯·æ±‚\n\n\n> getè¯·æ±‚å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šgetForEntity() å’Œ getForObject().\n\n\n![](http://qiniu.xds123.cn/18-9-20/50274746.jpg)\n\n\n```text\n// 1-getForObject()\nUser user1 = this.restTemplate.getForObject(uri, User.class);\n\n// 2-getForEntity()\nResponseEntity<User> responseEntity1 = this.restTemplate.getForEntity(uri, User.class);\nHttpStatus statusCode = responseEntity1.getStatusCode();\nHttpHeaders header = responseEntity1.getHeaders();\nUser user2 = responseEntity1.getBody();\n\n```\n\n\nå…¶ä»–çš„æ–¹æ³•éƒ½å¤§åŒå°å¼‚äº†ï¼Œå¯ä»¥æ ¹æ®å®é™…çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè°ƒç”¨ã€‚\n\n\n### POSTè¯·æ±‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/94233042.jpg)\n\n\nç®€å•ç¤ºä¾‹ï¼š\n\n\n```text\n// 1-postForObject()\nUser user1 = this.restTemplate.postForObject(uri, user, User.class);\n\n// 2-postForEntity()\nResponseEntity<User> responseEntity1 = this.restTemplate.postForEntity(uri, user, User.class);\n\n```\n\n\n**å…³äº****`postForLocation()`****ï¼Œç”¨çš„æ¯”è¾ƒå°‘ï¼Œä½œç”¨æ˜¯è¿”å›æ–°åˆ›å»ºèµ„æºçš„URIï¼Œå‰é¢ä»‹ç»çš„ä¸¤è€…æ˜¯è¿”å›èµ„æºæœ¬èº«ï¼Œä¹Ÿå°±æ˜¯ç»“æœé›†äº†ã€‚**\n\n\nå…³äºå…¶ä»–çš„è¯·æ±‚ç±»å‹ç›¸å…³ç”¨æ³•ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†é˜è¿°äº†ï¼Œéƒ½æ˜¯ç±»ä¼¼çš„ã€‚å¯ä»¥æŸ¥çœ‹ä¸‹æ­¤æ–‡ç« ï¼š[è¯¦è§£ RestTemplate æ“ä½œ](https://blog.csdn.net/itguangit/article/details/78825505)ï¼Œè®²çš„è›®è¯¦ç»†äº†ã€‚\n\n- *ç‰¹åˆ«è¯´æ˜ï¼šç³»åˆ—æ•™ç¨‹ä¸ºäº†æ–¹ä¾¿ï¼Œgithubä¸Šåˆ†åˆ«åˆ›å»ºäº†ä¸€ä¸ªå•ä½“çš„`Eureka`æ³¨å†Œä¸­å¿ƒå’Œé«˜å¯ç”¨çš„`Eureka`æ³¨å†Œä¸­å¿ƒï¼Œæ— ç‰¹æ®Šè¯´æ˜ï¼Œéƒ½æ˜¯ä½¿ç”¨å•ä½“çš„`Eureka`æ³¨å†Œä¸­å¿ƒè¿›è¡ŒæœåŠ¡æ³¨å†Œä¸å‘ç°çš„ï¼Œå·¥ç¨‹åä¸ºï¼š`spring-cloud-eureka-server`ï¼Œç«¯å£å·ä¸ºï¼š1000ã€‚æœåŠ¡æä¾›æ–¹å·¥ç¨‹åä¸ºï¼š`spring-cloud-eureka-client`,åº”ç”¨åç§°ä¸ºï¼š`eureka-client`,ç«¯å£å·ä¸ºï¼š2000ï¼Œæä¾›äº†ä¸€ä¸ªæ¥å£ï¼š[http://127.0.0.1:2000/hello**](http://127.0.0.1:2000/hello**)\n\n![](http://qiniu.xds123.cn/18-9-20/67366013.jpg)\n\n\nspring-cloud-eureka-serverç¤ºä¾‹ï¼š[spring-cloud-eureka-server](https://github.com/xie19900123/spring-cloud-learning/tree/master/spring-cloud-eureka-server)\n\n\nspring-cloud-eureka-clientç¤ºä¾‹ï¼š[spring-cloud-eureka-client](https://github.com/xie19900123/spring-cloud-learning/tree/master/spring-cloud-eureka-client)\n\n\n## LoadBalancerClientå®ä¾‹\n\n\næ­¤ç±»æ˜¯å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å…³é”®ã€‚æœ¬èº«å®ƒæ˜¯ä¸ªæ¥å£ç±»ï¼Œä½äº`spring-cloud-commons`åŒ…ä¸‹ï¼Œæ­¤åŒ…åŒ…å«äº†å¤§é‡çš„æœåŠ¡æ²»ç†ç›¸å…³çš„æŠ½è±¡æ¥å£ï¼Œæ¯”å¦‚å·²ç»ä»‹ç»è¿‡çš„`DiscoveryClient`ã€`ServiceRegistry`ä»¥åŠ`LoadBalancerClientå®ä¾‹`ç­‰ç­‰ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/74317604.jpg)\n\n\né¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€åŸç”Ÿçš„æ–¹å¼å»è·å–è°ƒç”¨æœåŠ¡æ¥å£ã€‚\n\n\n**åˆ›å»ºä¸ªå·¥ç¨‹:****`spring-cloud-eureka-consumer`**\n\n\n0.å¼•å…¥pomæ–‡ä»¶ä¾èµ–ã€‚\n\n\n```text\n<!-- å®¢æˆ·ç«¯ä¾èµ– -->\n    <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-web</artifactId>\n    </dependency>\n\n```\n\n\n1.é…ç½®æ–‡ä»¶æ·»åŠ ç›¸å…³æ³¨å†Œä¸­å¿ƒç­‰ä¿¡æ¯ã€‚\n\n\n```text\n## æœåŠ¡åç§°\nspring.application.name=eureka-consumer\n## ç«¯å£å·\nserver.port=8008\n\n#æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€\neureka.client.service-url.defaultZone=http://127.0.0.1:1000/eureka\n# å¯ç”¨ipé…ç½® è¿™æ ·åœ¨æ³¨å†Œä¸­å¿ƒåˆ—è¡¨ä¸­çœ‹è§çš„æ˜¯ä»¥ip+ç«¯å£å‘ˆç°çš„\neureka.instance.prefer-ip-address=true\n# å®ä¾‹åç§°  æœ€åå‘ˆç°åœ°å€ï¼šip:2000\neureka.instance.instance-id=${spring.cloud.client.ip-address}:${server.port}\n\n```\n\n\n2.ç¼–å†™å¯åŠ¨ç±»ï¼ŒåŠ å…¥`@EnableDiscoveryClient`,ç”³æ˜ä¸ºä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨,åŒæ—¶ç”³æ˜ä¸€ä¸ª`RestTemplate`ï¼Œæœ€åæ˜¯ä½¿ç”¨`RestTemplate`æ¥å®ŒæˆrestæœåŠ¡è°ƒç”¨çš„ã€‚\n\n\n```text\n@SpringBootApplication\n@EnableDiscoveryClient\n@Slf4j\npublic class EurekaConsumerApplication {\n\n    public static void main(String[] args) throws Exception {\n        SpringApplication.run(EurekaConsumerApplication.class, args);\n        log.info(\"spring-cloud-eureka-consumerå¯åŠ¨!\");\n    }\n\n    @Bean\n    public RestTemplate restTemplate() {\n        return new RestTemplate();\n    }\n}\n\n```\n\n\n3.ç¼–å†™ä¸€ä¸ªè°ƒç”¨ç±»ï¼Œè°ƒç”¨`spring-cloud-eureka-client`æœåŠ¡æä¾›è€…æä¾›çš„æœåŠ¡ã€‚\n\n\n```text\n/**\n * è®¿é—®å®¢æˆ·ç«¯ç¤ºä¾‹\n * @author Hehui\n *\n */\n@RestController\n@Slf4j\npublic class DemoController {\n\n    @Autowired\n    LoadBalancerClient loadBalancerClient;\n\n    @Autowired\n    RestTemplate restTemplate;\n\n    @GetMapping(\"/hello\")\n    public String hello(String name) {\n        ServiceInstance serviceInstance = loadBalancerClient.choose(\"eureka-client\");\n        String url = \"http://\" + serviceInstance.getHost() + \":\" + serviceInstance.getPort() + \"/hello?name=\" + name;\n        log.info(\"urlåœ°å€ä¸ºï¼š{}\", url);\n        return restTemplate.getForObject(url, String.class);\n    }\n}\n\n```\n\n\n4.å¯åŠ¨åº”ç”¨ï¼Œè®¿é—®ï¼š[http://127.0.0.1:8008/hell0?name=oKong](http://127.0.0.1:8008/hell0?name=oKong) ï¼Œå¯ä»¥çœ‹è§æ§åˆ¶å°è¾“å‡ºäº†åˆ©ç”¨`LoadBalancerClient`çš„`choose`æ–¹æ³•ï¼Œè·å–åˆ°äº†å¯¹åº”`eureka-client`æœåŠ¡IDçš„æœåŠ¡åœ°å€ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/2558852.jpg)\n\n\næœ€åé€šè¿‡èŒƒå›´å¯¹åº”çš„httpåœ°å€è¿›è¡ŒæœåŠ¡è¯·æ±‚ï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-20/15565028.jpg)\n\n\næœ€åæµè§ˆå™¨ä¸Šå¯ä»¥çœ‹è§ï¼Œè¿›è¡Œäº†æ­£ç¡®çš„è®¿é—®äº†ï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-20/65199797.jpg)\n\n\næ­¤æ—¶ï¼Œåˆ‡æ¢åˆ°æœåŠ¡æä¾›è€…\n\n\n```text\nspring-cloud-eureka-client\n```\n\n\næ§åˆ¶å°ï¼Œå¯ä»¥çœ‹è§æ—¥å¿—è¾“å‡ºï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-20/70647514.jpg)\n\n\næ­¤æ—¶æˆ‘ä»¬å·²ç»è°ƒç”¨æˆåŠŸäº†ï¼Œé€šè¿‡`LoadBalancerClient`è·å–åˆ°äº†æœåŠ¡æä¾›è€…å®é™…æœåŠ¡åœ°å€ï¼Œæœ€åè¿›è¡Œè°ƒç”¨ã€‚\n\n\nå¤§å®¶å¯ä»¥åˆ›å»ºå¤šä¸ªçš„`spring-cloud-eureka-client`æœåŠ¡æä¾›è€…ï¼Œå†å»è°ƒç”¨ä¸‹ï¼Œå¯ä»¥çœ‹è§ä¼šè°ƒç”¨ä¸åŒçš„æœåŠ¡åœ°å€çš„ã€‚\n\n\n## å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡Ribbonå®ä¾‹\n\n\n> Spring Cloud Ribbonæ˜¯ä¸€ä¸ªåŸºäºHttpå’ŒTCPçš„å®¢æœç«¯è´Ÿè½½å‡è¡¡å·¥å…·ï¼Œå®ƒæ˜¯åŸºäºNetflix Ribbonå®ç°çš„ã€‚ä¸Eurekaé…åˆä½¿ç”¨æ—¶ï¼ŒRibbonå¯è‡ªåŠ¨ä»Eureka Server (æ³¨å†Œä¸­å¿ƒ)è·å–æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ï¼Œå¹¶åŸºäºè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€šè¿‡åœ¨å®¢æˆ·ç«¯ä¸­é…ç½®ribbonServerListæ¥è®¾ç½®æœåŠ¡ç«¯åˆ—è¡¨å»è½®è¯¢è®¿é—®ä»¥è¾¾åˆ°å‡è¡¡è´Ÿè½½çš„ä½œç”¨ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/86401854.jpg)\n\n\nä¸Šå°èŠ‚ï¼Œç®€å•çš„ä½¿ç”¨`LoadBalancerClient`è¿›è¡Œäº†æœåŠ¡å®ä¾‹è·å–æœ€åè°ƒç”¨ï¼Œä¹Ÿè¯´äº†å…¶å®`LoadBalancerClient`æ˜¯ä¸ªæ¥å£ç±»ã€‚è€Œ`Ribbon`å®ç°äº†æ­¤æ¥å£ï¼Œå¯¹åº”å®ç°ç±»ä¸ºï¼š`RibbonLoadBalancerClient`.\n\n\n![](http://qiniu.xds123.cn/18-9-20/40970081.jpg)\n\n\n### Ribbonå®ä¾‹\n\n\nç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹ï¼Œä½¿ç”¨`Ribbon`çš„æ–¹å¼å¦‚ä½•è¿›è¡Œæ›´åŠ ä¼˜é›…çš„æ–¹å¼è¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚\n\n\n**åˆ›å»ºä¸€ä¸ªå·¥ç¨‹ï¼š****`spring-cloud-eureka-consumer-ribbon`**\n(å…¶å®è¿™ä¸ªå·¥ç¨‹å’Œ`spring-cloud-eureka-consumer`æ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯æœ‰äº›è®¸ä¸åŒã€‚)\n\n\n0.åŠ å…¥pomä¾èµ–\n\n\n```text\n<!-- å®¢æˆ·ç«¯ä¾èµ– -->\n    <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-web</artifactId>\n    </dependency>\n\n```\n\n\n1.é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼Œæ·»åŠ æ³¨å†Œä¸­å¿ƒç­‰ç›¸å…³ä¿¡æ¯ã€‚\n\n\n```text\nspring.application.name=eureka-consumer-ribbon\nserver.port=8018\n\n#æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€\neureka.client.service-url.defaultZone=http://127.0.0.1:1000/eureka\n# å¯ç”¨ipé…ç½® è¿™æ ·åœ¨æ³¨å†Œä¸­å¿ƒåˆ—è¡¨ä¸­çœ‹è§çš„æ˜¯ä»¥ip+ç«¯å£å‘ˆç°çš„\neureka.instance.prefer-ip-address=true\n# å®ä¾‹åç§°  æœ€åå‘ˆç°åœ°å€ï¼šip:2000\neureka.instance.instance-id=${spring.cloud.client.ip-address}:${server.port}\n\n```\n\n\n2.ç¼–å†™å¯åŠ¨ç±»ï¼ŒåŠ å…¥`@EnableDiscoveryClient`ï¼ŒåŒæ—¶ç”³æ˜ä¸€ä¸ª`RestTemplate`ï¼Œ**è¿™é‡Œå’ŒåŸå…ˆä¸åŒï¼Œå°±åœ¨äºåŠ å…¥äº†****`@LoadBalanced`****æ³¨è§£è¿›è¡Œä¿®é¥°****`RestTemplate`****ç±»ï¼Œç¨åä¼šå¤§è‡´è®²è§£ä¸‹æ˜¯å¦‚ä½•è¿›è¡Œå®ç°çš„ã€‚**\n\n\n```text\n@SpringBootApplication\n@EnableDiscoveryClient\n@Slf4j\npublic class EurekaConsumerRibbonApplication {\n\n    public static void main(String[] args) throws Exception {\n        SpringApplication.run(EurekaConsumerRibbonApplication.class, args);\n        log.info(\"spring-cloud-eureka-consumer-ribbonå¯åŠ¨!\");\n    }\n\n    //æ·»åŠ  @LoadBalanced ä½¿å…¶å…·å¤‡äº†ä½¿ç”¨LoadBalancerClient è¿›è¡Œè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›\n    @Bean\n    @LoadBalanced\n    public RestTemplate restTemplage() {\n        return new RestTemplate();\n    }\n}\n\n```\n\n\n3.ç¼–å†™æµ‹è¯•ç±»ï¼Œè¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚\n\n\n```text\n/**\n * ribbonè®¿é—®å®¢æˆ·ç«¯ç¤ºä¾‹\n * @author Hehui\n *\n */\n@RestController\n@Slf4j\npublic class DemoController {\n\n    @Autowired\n    RestTemplate restTemplate;\n\n    @GetMapping(\"/hello\")\n    public String hello(String name) {\n        //ç›´æ¥ä½¿ç”¨æœåŠ¡åè¿›è¡Œè®¿é—®\n        log.info(\"è¯·æ±‚å‚æ•°name:{}\", name);\n        return restTemplate.getForObject(\"<http://eureka-client/hello?name=>\" + name, String.class);\n    }\n}\n\n```\n\n\nå¯ä»¥çœ‹è§ï¼Œå¯ä»¥ç›´æ¥æ³¨å…¥`RestTemplate`ï¼Œé€šè¿‡æœåŠ¡åç›´æ¥è°ƒç”¨.\n\n\n4.å¯åŠ¨åº”ç”¨ï¼Œè®¿é—®:[http://127.0.0.1:8018/hello?name=oKong](http://127.0.0.1:8018/hello?name=oKong) ,å¯ä»¥çœ‹è§è°ƒç”¨æˆåŠŸï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-20/20652450.jpg)\n\n\næ§åˆ¶å°è¾“å‡ºï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-20/75877117.jpg)\n\n\n### ç®€å•èŠèŠLoadBalancedæ³¨è§£\n\n\n> å¯ä»¥ä»ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å°±åŠ äº†ä¸€ä¸ª@LoadBalancedæ³¨è§£ä¿®é¥°RestTemplatebeanç±»ï¼Œå°±å®ç°äº†æœåŠ¡çš„è°ƒç”¨ã€‚ç°åœ¨æ¥ç®€å•çœ‹çœ‹å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ã€‚\n\n\né¦–å…ˆï¼Œæˆ‘ä»¬çœ‹çœ‹æ­¤æ³¨è§£çš„ä»£ç è¯´æ˜ï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-20/55952682.jpg)\n\n\nä»æ³¨é‡Šå¯ä»¥çœ‹å‡ºï¼Œè¯¥æ³¨è§£ç”¨æ¥ç»™RestTemplateåšæ ‡è®°ï¼Œä»¥ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„å®¢æˆ·ç«¯`LoadBalancerClient`ã€‚\n\n\nç°åœ¨æ¥çœ‹ä¸€çœ¼ç›¸åŒåŒ…ä¸‹çš„ç±»çš„æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸ª`LoadBalancerAutoConfiguration`,å­—é¢æ„æ€å¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼Œæ­¤ç±»å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…³é”®ç±»äº†ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/33505933.jpg)\n\n\n`LoadBalancerAutoConfiguration`,æ­¤ç±»ä¸é•¿ï¼Œä¸€ç™¾æ¥è¡Œï¼Œè¿™é‡Œå°±ä¸è´´äº†ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-20/6039671.jpg)\n\n\nç®€å•è¯´æ˜ä¸‹ï¼š\né¦–å…ˆï¼Œæ­¤ç±»ç”Ÿæ•ˆçš„æ¡ä»¶æ˜¯\n\n\n```text\n@ConditionalOnClass(RestTemplate.class)\n@ConditionalOnBean(LoadBalancerClient.class)\n\n```\n\n- `RestTemplate`ç±»å¿…é¡»å­˜åœ¨äºå½“å‰å·¥ç¨‹çš„ç¯å¢ƒä¸­ã€‚\n- åœ¨Springçš„Beanå·¥ç¨‹ä¸­æœ‰å¿…é¡»æœ‰`LoadBalancerClient`çš„å®ç°Beanã€‚\n\nè¯¥è‡ªåŠ¨åŒ–é…ç½®ç±»ä¸­ï¼Œä¸»è¦åšäº†å‡ ä»¶äº‹æƒ…ï¼š\n\n- ç»´æŠ¤äº†ä¸€ä¸ªè¢«@LoadBalancedæ³¨è§£ä¿®é¥°çš„RestTemplateå¯¹è±¡åˆ—è¡¨\n\n```text\n@LoadBalanced\n    @Autowired(required = false)\n    private List<RestTemplate> restTemplates = Collections.emptyList();\n\n```\n\n\nåŒæ—¶ä¸ºå…¶æ¯ä¸ªå¯¹è±¡é€šè¿‡è°ƒç”¨`RestTemplateCustomizer`æ·»åŠ äº†ä¸€ä¸ª`LoadBalancerInterceptor`å’Œ`RetryLoadBalancerInterceptor`æ‹¦æˆªå™¨(æœ‰ç”Ÿæ•ˆæ¡ä»¶)ï¼Œå…¶ä¸º`ClientHttpRequestInterceptor`æ¥å£çš„å®ç°ç±»ï¼Œ`ClientHttpRequestInterceptor`æ˜¯`RestTemplate`çš„è¯·æ±‚æ‹¦æˆªå™¨\n\n\n![](http://qiniu.xds123.cn/18-9-20/75808703.jpg)\n\n\n**RetryLoadBalancerInterceptoræ‹¦æˆªå™¨**\n\n\n![](http://qiniu.xds123.cn/18-9-20/63370995.jpg)\n\n\n**LoadBalancerInterceptoræ‹¦æˆªå™¨**\n\n\n![](http://qiniu.xds123.cn/18-9-20/84887976.jpg)\n\n\næˆ‘ä»¬ä¸»è¦çœ‹ä¸‹`LoadBalancerInterceptor`ï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-21/73056978.jpg)\n\n\nå¯ä»¥çœ‹è§ï¼Œæœ€åæ˜¯å®ç°äº†`ClientHttpRequestInterceptor`æ¥å£çš„å®ç°ç±»æ‰§è¡Œ`execute`æ–¹æ³•è¿›è¡Œ.\n\n\n![](http://qiniu.xds123.cn/18-9-21/82979252.jpg)\n\n\nä»ç»§æ‰¿å…³ç³»é‡Œï¼Œæ­¤å®ç°ç±»å°±æ˜¯`RibbonLoadBalancerClient`ç±»äº†ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-21/59541189.jpg)\n\n\n```text\nRibbonLoadBalancerClient\n```\n\n\nç±»ï¼š\n\n\n![](http://qiniu.xds123.cn/18-9-21/13645724.jpg)\n\n\nç®€å•æ¥è¯´ï¼šæœ€åè¿˜æ˜¯é€šè¿‡`loadBalancerClient.choose()`è·å–åˆ°æœåŠ¡å®ä¾‹ï¼Œæœ€é€šè¿‡æ‹¼å‡‘httpåœ°å€æ¥è¿›è¡Œæœ€åçš„æœåŠ¡è°ƒç”¨ã€‚\n\n\n**æ€»ä½“æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡ä¸ºåŠ å…¥****`@LoadBalanced`****æ³¨è§£çš„****`RestTemplate`****æ·»åŠ ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå™¨ï¼Œåœ¨è¯·æ±‚å‰é€šè¿‡æ‹¦æˆªå™¨è·å–çœŸæ­£çš„è¯·æ±‚åœ°å€ï¼Œæœ€åè¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚**\n\n\né‡Œé¢çš„ç»†èŠ‚å°±ä¸é˜è¿°äº†ï¼Œæ¯•ç«Ÿæºç åˆ†æä¸æ˜¯å¾ˆåœ¨è¡Œå‘€ï¼Œå¤§å®¶å¯ä»¥è·Ÿè¸ªè¿›å»ä¸€æ¢ç©¶ç«Ÿå§ã€‚\n\n\n**å‹æƒ…æé†’ï¼šè‹¥è¢«****`@LoadBalanced`****æ³¨è§£çš„****`RestTemplate`****è®¿é—®æ­£å¸¸çš„æœåŠ¡åœ°å€ï¼Œå¦‚****`http://127.0.0.1:8080/hello`****æ—¶ï¼Œæ˜¯ä¼šæç¤ºæ— æ³•æ‰¾åˆ°æ­¤æœåŠ¡çš„ã€‚**\n\n\nå…·ä½“åŸå› ï¼š`serverid`å¿…é¡»æ˜¯æˆ‘ä»¬è®¿é—®çš„`æœåŠ¡åç§°` ï¼Œå½“æˆ‘ä»¬ç›´æ¥è¾“å…¥`ip`çš„æ—¶å€™è·å–çš„`server`æ˜¯`null`ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-21/95656166.jpg)\n\n\næ­¤æ—¶ï¼Œ**è‹¥æ˜¯éœ€è¦è°ƒç”¨éæ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸è¢«****`@LoadBalanced`****æ³¨è§£çš„****`RestTemplate`****,åŒæ—¶æŒ‡å®šbeançš„åç§°ï¼Œä½¿ç”¨æ—¶ï¼Œä½¿ç”¨****`@Qualifier`****æŒ‡å®šnameæ³¨å…¥æ­¤****`RestTemplate`****ã€‚**\n\n\n```text\n    @Bean(\"normalRestTemplage\")\n    public RestTemplate normalRestTemplage() {\n        return new RestTemplate();\n    }\n\n    //ä½¿ç”¨\n    @Autowired\n    @Qualifier(\"normalRestTemplage\")\n    RestTemplate normalRestTemplate;\n\n     @GetMapping(\"/ip\")\n    public String ip(String name) {\n        //ç›´æ¥ä½¿ç”¨æœåŠ¡åè¿›è¡Œè®¿é—®\n        log.info(\"ä½¿ç”¨ipè¯·æ±‚ï¼Œè¯·æ±‚å‚æ•°name:{}\", name);\n        return normalRestTemplate.getForObject(\"<http://127.0.0.1:2000/hello?name=>\" + name, String.class);\n    }\n\n```\n\n\n### è´Ÿè½½å‡è¡¡å™¨\n\n\nç›®å‰è¿˜æœªè¿›è¡Œè¿‡è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ï¼Œè¿™é‡Œå°±ç®€å•çš„ä¸¾ä¾‹ä¸‹ï¼Œä¸Šæ¬¡æ•´ç†pptæ—¶æœ‰è®²è¿‡ä¸€äº›ï¼Œä½†æœªæ·±å…¥äº†è§£è¿‡âŠ™ï¹âŠ™â€–âˆ£ï¼Œ\n\n\n![](http://qiniu.xds123.cn/18-9-21/6181280.jpg)\n\n\nå¯ä»¥ä»ç»§æ‰¿å…³ç³»çœ‹å‡ºï¼Œæ˜¯é€šè¿‡ç»§æ‰¿`IRule`æ¥å®ç°çš„ã€‚\n\n\n![](http://qiniu.xds123.cn/18-9-21/39759685.jpg)\n\n\n**å¯ç»§æ‰¿ClientConfigEnabledRoundRobinRuleï¼Œæ¥å®ç°è‡ªå·±è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚**\n\n\n## å£°æ˜å¼æœåŠ¡Feignå®ä¾‹\n\n\nä»ä¸Šä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå½“æˆ‘ä»¬è¦è°ƒç”¨ä¸€ä¸ªæœåŠ¡æ—¶ï¼Œéœ€è¦çŸ¥é“æœåŠ¡åå’Œapiåœ°å€ï¼Œè¿™æ ·æ‰èƒ½è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼ŒæœåŠ¡å°‘æ—¶ï¼Œè¿™æ ·å†™è§‰å¾—æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†å½“æœåŠ¡ä¸€å¤šï¼Œæ¥å£å‚æ•°å¾ˆå¤šæ—¶ï¼Œä¸Šé¢çš„å†™æ³•å°±æ˜¾å¾—ä¸å¤Ÿä¼˜é›…äº†ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ï¼Œæ¥è¯´è¯´ä¸€ç§æ›´å¥½æ›´ä¼˜é›…çš„è°ƒç”¨æœåŠ¡çš„æ–¹å¼ï¼š**Feign**ã€‚\n\n\n> Feignæ˜¯Netflixå¼€å‘çš„å£°æ˜å¼ã€æ¨¡å—åŒ–çš„HTTPå®¢æˆ·ç«¯ã€‚Feignå¯å¸®åŠ©æˆ‘ä»¬æ›´å¥½æ›´å¿«çš„ä¾¿æ·ã€ä¼˜é›…åœ°è°ƒç”¨HTTP APIã€‚\n\n\nåœ¨`Spring Cloud`ä¸­ï¼Œä½¿ç”¨`Feign`éå¸¸ç®€å•â€”â€”åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå¹¶åœ¨æ¥å£ä¸Šæ·»åŠ ä¸€äº›æ³¨è§£ã€‚`Feign`æ”¯æŒå¤šç§æ³¨é‡Šï¼Œä¾‹å¦‚Feignè‡ªå¸¦çš„æ³¨è§£æˆ–è€…JAX-RSæ³¨è§£ç­‰\nSpring Cloudå¯¹Feignè¿›è¡Œäº†å¢å¼ºï¼Œä½¿Feignæ”¯æŒäº†Spring MVCæ³¨è§£ï¼Œå¹¶æ•´åˆäº†Ribbonå’Œ Eureka,ä»è€Œè®©Feign çš„ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚**åªéœ€è¦é€šè¿‡åˆ›å»ºæ¥å£å¹¶ç”¨æ³¨è§£æ¥é…ç½®å®ƒæ—¢å¯å®Œæˆå¯¹WebæœåŠ¡æ¥å£çš„ç»‘å®šã€‚**\n\n\n### Feignå®ä¾‹\n\n\n**åˆ›å»ºä¸ª****`spring-cloud-eureka-consumer-ribbon`****å·¥ç¨‹é¡¹ç›®ã€‚**\n\n\n0.åŠ å…¥`feigin`ä¾èµ–\n\n\n```text\n        <!-- feign -->\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-openfeign</artifactId>\n        </dependency>\n        <!-- eurekaå®¢æˆ·ç«¯ä¾èµ– -->\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n        </dependency>\n        <!-- rest api -->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n\n```\n\n\n1.é…ç½®æ–‡ä»¶\n\n\n```text\nspring.application.name=eureka-consumer-feign\nserver.port=8028\n\n#æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€\neureka.client.service-url.defaultZone=http://127.0.0.1:1000/eureka\n# å¯ç”¨ipé…ç½® è¿™æ ·åœ¨æ³¨å†Œä¸­å¿ƒåˆ—è¡¨ä¸­çœ‹è§çš„æ˜¯ä»¥ip+ç«¯å£å‘ˆç°çš„\neureka.instance.prefer-ip-address=true\n# å®ä¾‹åç§°  æœ€åå‘ˆç°åœ°å€ï¼šip:2000\neureka.instance.instance-id=${spring.cloud.client.ip-address}:${server.port}\n\n```\n\n\n2.åˆ›å»ºå¯åŠ¨ç±»ï¼ŒåŠ å…¥æ³¨è§£`@EnableFeignClients`ï¼Œå¼€å¯`feign`æ”¯æŒã€‚\n\n\n```text\n@SpringBootApplication\n@EnableFeignClients\n@Slf4j\npublic class EurekaConsumerFeignApplication {\n\n    public static void main(String[] args) throws Exception {\n        SpringApplication.run(EurekaConsumerFeignApplication.class, args);\n        log.info(\"spring-cloud-eureka-consumer-feignå¯åŠ¨\");\n    }\n\n}\n\n```\n\n\n3.åˆ›å»ºä¸€ä¸ªæ¥å£ç±»`IHelloClient`,åŠ å…¥æ³¨è§£`@FeignClient`æ¥æŒ‡å®šè¿™ä¸ªæ¥å£æ‰€è¦è°ƒç”¨çš„æœåŠ¡åç§°ã€‚\n\n\n```text\n@FeignClient(name=\"eureka-client\")\npublic interface IHelloClient {\n\n    /**\n     * å®šä¹‰æ¥å£\n     * @param name\n     * @return\n     */\n    @RequestMapping(value=\"/hello\", method=RequestMethod.GET)\n    public String hello(@RequestParam(\"name\") String name);\n}\n\n```\n\n\n4.åˆ›å»ºä¸€ä¸ªdemoæ§åˆ¶å±‚ï¼Œå¼•å…¥æ­¤æ¥å£ç±»ã€‚\n\n\n```text\n/**\n * feign ç¤ºä¾‹\n * @author Hehui\n *\n */\n@RestController\n@Slf4j\npublic class DemoController {\n\n    @Autowired\n    IHelloClient helloClient;\n\n    @GetMapping(\"/hello\")\n    public String hello(String name) {\n        log.info(\"ä½¿ç”¨feignè°ƒç”¨æœåŠ¡ï¼Œå‚æ•°name:{}\", name);\n        return helloClient.hello(name);\n    }\n}\n\n```\n\n\n5.å¯åŠ¨åº”ç”¨ï¼Œè®¿é—®ï¼š[http://127.0.0.1:8028/hello?name=Hehui-feign](http://127.0.0.1:8028/hello?name=Hehui-feign)\n\n\n![](http://qiniu.xds123.cn/18-9-21/99970618.jpg)\n\n\n**æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œå’Œè°ƒç”¨æœ¬åœ°æœåŠ¡æ˜¯ä¸€æ ·çš„äº†ï¼**\n\n\n### Feignç»§æ‰¿ç‰¹æ€§\n\n\n> Feignæ”¯æŒç»§æ‰¿ï¼Œä½†ä¸æ”¯æŒå¤šç»§æ‰¿ã€‚ä½¿ç”¨ç»§æ‰¿ï¼Œå¯å°†ä¸€äº›å…¬å…±æ“ä½œåˆ†ç»„åˆ°ä¸€äº›çˆ¶ç±»æ¥å£ä¸­ï¼Œä»è€Œç®€åŒ–Feignçš„å¼€å‘ã€‚\n\n\n**æ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­ï¼Œè°ƒç”¨æœåŠ¡æ¥å£æ—¶ï¼Œå¯ç›´æ¥æŒ‰æ¥å£ç±»å’Œå®ç°ç±»è¿›è¡Œç¼–å†™ï¼Œè°ƒç”¨æ–¹å¼•å…¥æ¥å£ä¾èµ–ï¼Œç»§æ‰¿ä¸€ä¸ªæœ¬åœ°æ¥å£ï¼Œè¿™æ ·æ¥å£æ–¹æ³•é»˜è®¤éƒ½æ˜¯å®šä¹‰å¥½çš„ï¼Œä¹Ÿå°‘äº†å¾ˆå¤šç¼–ç é‡ã€‚ç”¨èµ·æ¥å°±æ›´çˆ½äº†ï¼Œå°±æ˜¯æœ‰ç‚¹ä¾èµ–æ€§ï¼Œå¯¹æ–¹æœåŠ¡ä¿®æ”¹åéœ€è¦åŒæ­¥æ›´æ–°ä¸‹ï¼Œä½†è¿™ä¸ªå›¢é˜Ÿå†…éƒ¨çº¦å®šä¸‹é—®é¢˜ä¸å¤§çš„**\n\n\nè¿™é‡Œç®€å•å®ä¾‹ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª`spring-cloud-eureka-client-api`å·¥ç¨‹ã€‚\n\n\n0.åŠ å…¥ä¾èµ–ï¼Œæ³¨æ„æ­¤ä¾èµ–çš„ä½œç”¨èŒƒå›´ï¼š\n\n\n```text\n    <!--apiæ¥å£ä¾èµ–-->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n            <scope>provided</scope>\n        </dependency>\n\n```\n\n\n1.ç¼–å†™ä¸€ä¸ªæ¥å£ç±»`IHellpApi`ï¼š\n\n\n```text\npublic interface IHelloApi {\n    //å®šä¹‰æä¾›è€…æœåŠ¡å\n    public static final String SERVICE_NAME = \"eureka-client\";\n\n    /**\n     * å®šä¹‰æ¥å£\n     * @param name\n     * @return\n     */\n    @RequestMapping(value=\"/hello\", method=RequestMethod.GET)\n    public String hello(@RequestParam(\"name\") String name);\n}\n\n```\n\n\n**ä¿®æ”¹****`spring-cloud-eureka-client`****å·¥ç¨‹**\n\n\n0.å¼•å…¥apiä¾èµ–\n\n\n```text\n    <!-- å¯¼å…¥æ¥å£ä¾èµ– -->\n    <dependency>\n       <groupId>cn.lqdev.learning</groupId>\n       <artifactId>spring-cloud-eureka-client-api</artifactId>\n       <version>0.0.1-SNAPSHOT</version>\n    </dependency>\n\n```\n\n\n1.åˆ›å»ºä¸€ä¸ª`HelloApiImpl`ç±»ï¼Œå®ç°`IHelloApi`:\n\n\n```text\n/**\n * ä½¿ç”¨æ¥å£æ–¹å¼è¿›è¡Œæ¥å£ç¼–å†™\n * @author Hehui\n *\n */\n@RestController\n@Slf4j\npublic class HelloApiImpl implements IHelloApi {\n\n    @Override\n    public String helloApi(@RequestParam(\"name\") String name) {\n        log.info(\"[spring-cloud-eureka-client]æœåŠ¡[helloApi]è¢«è°ƒç”¨ï¼Œå‚æ•°nameå€¼ä¸ºï¼š{}\", name);\n        return name + \",helloApiè°ƒç”¨!\";\n    }\n}\n\n```\n\n\n**æ­¤æ—¶ï¼Œ****`HelloApiImpl`****æ˜¯ä¸ªæ§åˆ¶å±‚ä¹Ÿæ˜¯ä¸ªæ¥å£å®ç°ç±»äº†ã€‚**\n\n\n**ä¿®æ”¹****`spring-cloud-eureka-consumer-feign`****å·¥ç¨‹ã€‚**\n0.å¼•å…¥apiä¾èµ–\n\n\n```text\n    <!-- å¯¼å…¥æ¥å£ä¾èµ– -->\n    <dependency>\n       <groupId>cn.lqdev.learning</groupId>\n       <artifactId>spring-cloud-eureka-client-api</artifactId>\n       <version>0.0.1-SNAPSHOT</version>\n    </dependency>\n\n```\n\n\n1.åŒæ ·åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œä½¿å…¶ç»§æ‰¿`IHelloApi`:\n\n\n```text\n/**\n * ç›´æ¥ç»§æ‰¿æ¥å£\n * @author Hehui\n *\n */\n@FeignClient(name = IHelloApi.SERVICE_NAME)\npublic interface HelloApi extends IHelloApi{\n\n}\n\n```\n\n\n**å°æŠ€å·§ï¼šå¯ä»¥åœ¨****`IHelloApi`****å®šä¹‰ä¸€ä¸ªæœåŠ¡åå˜é‡ï¼Œå¦‚ï¼šSERVICE_NAMEï¼Œè¿™æ ·è®©æä¾›è€…è¿›è¡Œå˜é‡çš„èµ‹å€¼ï¼Œå¯ä»¥é¿å…ä¸€äº›ä¸å¿…è¦çš„äº¤æµæˆæœ¬çš„ï¼Œè‹¥æœ‰å˜åŒ–ï¼ŒæœåŠ¡è°ƒç”¨æ–¹ä¹Ÿæ— éœ€å…³å¿ƒçš„ã€‚ä¸€åˆ‡éƒ½æ˜¯çº¦å®šç¼–ç¨‹ï¼**\n\n\n2.ä¿®æ”¹ä¸‹`DemoController`ç±»ï¼Œæ³¨å…¥`HelloApi`ï¼š\n\n\n```text\n    @Autowired\n    HelloApi helloApi;\n\n    @GetMapping(\"hello2\")\n    public String hello2(String name) {\n        log.info(\"ä½¿ç”¨feignç»§æ‰¿æ–¹å¼è°ƒç”¨æœåŠ¡ï¼Œå‚æ•°name:{}\", name);\n        return helloApi.helloApi(name);\n    }\n\n```\n\n\n3.åˆ†åˆ«å¯åŠ¨å„æœåŠ¡ï¼Œè®¿é—®ï¼š[http://127.0.0.1:8028/hello2?name=oKong-api](http://127.0.0.1:8028/hello2?name=oKong-api)\n\n\n![](http://qiniu.xds123.cn/18-9-21/10151632.jpg)\n\n\nä½¿ç”¨èµ·æ¥æ²¡å•¥å·®åˆ«çš„ï¼Œä¸€æ ·çš„è°ƒç”¨ï¼Œ**ä½†å¯¹äºè°ƒç”¨æ–¹è€Œè¨€ï¼Œå¯ä»¥æ— éœ€å»ç†ä¼šå…·ä½“ç»†èŠ‚äº†ï¼Œç…§ç€æ¥å£æ–¹æ³•å»ä¼ å‚å°±å¥½äº†ã€‚**\n\n\n**è¿™ç§æ–¹å¼ï¼Œå’ŒåŸæ¥çš„****`dubbo`****è°ƒç”¨çš„æ–¹å¼æ˜¯ç±»ä¼¼çš„ï¼Œç®€å•æ–¹ä¾¿ã€‚å¤§å®¶å¯ä»¥æŠŠæ¥å£å’Œå®ä½“æ”¾å…¥ä¸€ä¸ªåŒ…ä¸­ï¼Œè°ƒç”¨è€…å’Œæä¾›è€…éƒ½è¿›è¡Œä¾èµ–å³å¯ã€‚**\n\n\n### æ³¨æ„äº‹é¡¹\n\n\nåœ¨ä½¿ç”¨`Feign`æ—¶ï¼Œä¼šç¢°è§ä¸€äº›é—®é¢˜ï¼Œä¸ºäº†é¿å…ä¸å¿…è¦çš„é”™è¯¯ï¼Œä»¥ä¸‹è¿™äº›éœ€è¦é¢å¤–æ³¨æ„ä¸‹ã€‚\n\n- GETè¯·æ±‚å¤šä¸ªå‚æ•°æ—¶ï¼Œéœ€è¦ä½¿ç”¨@RequestParam\n- GETè¯·æ±‚å‚æ•°ä¸ºå®ä½“æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬æ¢æˆPOSTè¯·æ±‚\n- POSTè¯·æ±‚ä½¿ç”¨@RequestBodyæ³¨è§£å‚æ•°\n- ä¸å»ºè®®ç›´æ¥å°†@RequestMappingæ³¨è§£åœ¨ç±»ä¸Šï¼Œç›´æ¥å†™åœ¨æ–¹æ³•ä¸Š\n\n## å‚è€ƒèµ„æ–™\n\n1. [https://blog.csdn.net/mengdonghui123456/article/details/53981976](https://blog.csdn.net/mengdonghui123456/article/details/53981976)\n2. [https://cloud.spring.io/spring-cloud-static/Finchley.SR1/single/spring-cloud.html#_spring_cloud_openfeign](https://cloud.spring.io/spring-cloud-static/Finchley.SR1/single/spring-cloud.html#_spring_cloud_openfeign)\n\n## æ€»ç»“\n\n\n> æœ¬ç« èŠ‚ä¸»è¦è®²è§£äº†ä¸‹æœåŠ¡æ¶ˆè´¹è€…å¦‚ä½•åˆ©ç”¨åŸç”Ÿã€ribbonã€feginä¸‰ç§æ–¹å¼è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„ï¼Œå…¶å®æ¯ç§è°ƒç”¨æ–¹å¼éƒ½æ˜¯ä½¿ç”¨ribbonæ¥è¿›è¡Œè°ƒç”¨çš„ï¼Œåªæ˜¯æœ‰äº›è¿›è¡Œäº†å¢å¼ºï¼Œæ˜¯çš„ä½¿ç”¨èµ·æ¥æ›´ç®€å•é«˜æ•ˆè€Œå·²ã€‚å¯¹äºå…¶åŸç†çš„å®ç°ï¼Œæœ¬æ–‡æœªè¿›è¡Œè¯¦ç»†é˜è¿°ï¼Œå¤§å®¶å¯ä»¥è°·æ­Œæƒ³ç›¸å…³çŸ¥è¯†ï¼Œè·Ÿè¸ªä¸‹æºç äº†è§£ä¸‹ï¼Œæœ¬äººä¹Ÿå°šæœªæ·±å…¥ç ”ç©¶è¿‡ï¼Œè¿˜æ˜¯åœç•™åœ¨ä½¿ç”¨é˜¶æ®µï¼Œä¹‹åæœ‰æ—¶é—´äº†çœ‹ä¸€çœ‹ï¼Œæœ‰å•¥å¿ƒå¾—å†æ¥åˆ†äº«å§ã€‚æ­¤æ—¶è‹¥æœåŠ¡ä¸Šçº¿ä¸‹çº¿ï¼Œè°ƒç”¨è€…è°ƒç”¨å¯èƒ½ä¼šå‡ºç°çŸ­æš‚çš„è°ƒç”¨å¼‚å¸¸ï¼Œæœ€å¸¸è§çš„å°±æ˜¯æ‰¾ä¸åˆ°æœåŠ¡ï¼Œæ­¤æ—¶æœåŠ¡å®¹é”™ä¿æŠ¤å°±æ’ä¸Šç”¨åœºäº†ï¼Œæ‰€ä»¥ä¸‹ä¸€ç« èŠ‚ï¼Œå°±æ¥è¯´è¯´å…³äºæœåŠ¡å®¹é”™ä¿æŠ¤ç›¸å…³çŸ¥è¯†ç‚¹~\n\n\n# @LoadBalancedæ³¨è§£ä¸RestTemplate\n\n\nåœ¨`Spring Cloud`å¾®æœåŠ¡åº”ç”¨ä½“ç³»ä¸­ï¼Œè¿œç¨‹è°ƒç”¨éƒ½åº”è´Ÿè½½å‡è¡¡ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨`RestTemplate`ä½œä¸ºè¿œç¨‹è°ƒç”¨å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œå¼€å¯è´Ÿè½½å‡è¡¡æå…¶ç®€å•ï¼š**ä¸€ä¸ª****`@LoadBalanced`****æ³¨è§£å°±æå®šäº†**ã€‚\nç›¸ä¿¡å¤§å®¶å¤§éƒ½ä½¿ç”¨è¿‡`Ribbon`åš**Clientç«¯**çš„è´Ÿè½½å‡è¡¡ï¼Œä¹Ÿè®¸ä½ æœ‰å’Œæˆ‘ä¸€æ ·çš„æ„Ÿå—ï¼š**Ribbonè™½å¼ºå¤§ä½†ä¸æ˜¯ç‰¹åˆ«çš„å¥½ç”¨**ã€‚æˆ‘ç ”ç©¶äº†ä¸€ç•ªï¼Œå…¶å®æ ¹æºè¿˜æ˜¯æˆ‘ä»¬å¯¹å®ƒå†…éƒ¨çš„åŸç†ä¸å¤Ÿäº†è§£ï¼Œå¯¼è‡´å¯¹ä¸€äº›ç°è±¡æ— æ³•ç»™å‡ºåˆç†è§£é‡Šï¼ŒåŒæ—¶ä¹Ÿå½±å“äº†æˆ‘ä»¬å¯¹å®ƒçš„**å®šåˆ¶å’Œæ‰©å±•**ã€‚æœ¬æ–‡å°±é’ˆå¯¹æ­¤åšå‡ºæ¢³ç†ï¼Œå¸Œæœ›å¤§å®¶é€šè¿‡æœ¬æ–‡ä¹Ÿèƒ½å¤Ÿå¯¹`Ribbon`æœ‰ä¸€ä¸ªè¾ƒä¸ºæ¸…æ™°çš„ç†è§£ï¼ˆæœ¬æ–‡åªè§£é‡Šå®ƒ`@LoadBalanced`è¿™ä¸€å°å—å†…å®¹ï¼‰ã€‚\n\n\nå¼€å¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡åªéœ€è¦ä¸€ä¸ªæ³¨è§£å³å¯ï¼Œå½¢å¦‚è¿™æ ·ï¼š\n\n\n```text\n@LoadBalanced // æ ‡æ³¨æ­¤æ³¨è§£åï¼ŒRestTemplateå°±å…·æœ‰äº†å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡èƒ½åŠ›\n@Bean\npublic RestTemplate restTemplate(){\n    return new RestTemplate();\n}\n\n```\n\n\nè¯´`Spring`æ˜¯Javaç•Œæœ€ä¼˜ç§€ã€æœ€æ°å‡ºçš„é‡å¤å‘æ˜è½®å­ä½œå“ä¸€ç‚¹éƒ½ä¸ä¸ºè¿‡ã€‚æœ¬æ–‡å°±ä»£é¢†ä½ ä¸€æ¢ç©¶ç«Ÿï¼Œä¸ºä½•å¼€å¯`RestTemplate`çš„è´Ÿè½½å‡è¡¡å¦‚æ­¤ç®€å•ã€‚\n\n\n> è¯´æ˜ï¼šæœ¬æ–‡å»ºç«‹åœ¨ä½ å·²ç»ç†Ÿç»ƒä½¿ç”¨RestTemplateï¼Œå¹¶ä¸”äº†è§£RestTemplateå®ƒç›¸å…³ç»„ä»¶çš„åŸç†çš„åŸºç¡€ä¸Šåˆ†æã€‚è‹¥å¯¹è¿™éƒ¨åˆ†è¿˜æ¯”è¾ƒæ¨¡ç³Šï¼Œå¼ºè¡Œæ¨èä½ å…ˆå‚çœ‹æˆ‘å‰é¢è¿™ç¯‡æ–‡ç« ï¼šRestTemplateçš„ä½¿ç”¨å’ŒåŸç†ä½ éƒ½çƒ‚ç†Ÿäºèƒ¸äº†å—ï¼Ÿã€äº«å­¦Spring MVCã€‘\n\n\n## RibbonAutoConfiguration\n\n\nè¿™æ˜¯`Spring Boot/Cloud`å¯åŠ¨`Ribbon`çš„å…¥å£è‡ªåŠ¨é…ç½®ç±»ï¼Œéœ€è¦å…ˆæœ‰ä¸ªå¤§æ¦‚çš„äº†è§£ï¼š\n\n\n```text\n@Configuration\n// ç±»è·¯å¾„å­˜åœ¨com.netflix.client.IClientã€RestTemplateç­‰æ—¶ç”Ÿæ•ˆ\n@Conditional(RibbonAutoConfiguration.RibbonClassesConditions.class)\n// // å…è®¸åœ¨å•ä¸ªç±»ä¸­ä½¿ç”¨å¤šä¸ª@RibbonClient\n@RibbonClients\n// è‹¥æœ‰Eurekaï¼Œé‚£å°±åœ¨Eurekaé…ç½®å¥½åå†é…ç½®å®ƒ~~~ï¼ˆå¦‚æœæ˜¯åˆ«çš„æ³¨å†Œä¸­å¿ƒå‘¢ï¼Œribbonè¿˜èƒ½ç©å—ï¼Ÿï¼‰\n@AutoConfigureAfter(name = \"org.springframework.cloud.netflix.eureka.EurekaClientAutoConfiguration\")\n@AutoConfigureBefore({ LoadBalancerAutoConfiguration.class, AsyncLoadBalancerAutoConfiguration.class })\n// åŠ è½½é…ç½®ï¼šribbon.eager-load --> trueçš„è¯ï¼Œé‚£ä¹ˆé¡¹ç›®å¯åŠ¨çš„æ—¶å€™å°±ä¼šæŠŠClientåˆå§‹åŒ–å¥½ï¼Œé¿å…ç¬¬ä¸€æ¬¡æƒ©ç½š\n@EnableConfigurationProperties({ RibbonEagerLoadProperties.class, ServerIntrospectorProperties.class })\npublic class RibbonAutoConfiguration {\n\n    @Autowired\n    private RibbonEagerLoadProperties ribbonEagerLoadProperties;\n    // Ribbonçš„é…ç½®æ–‡ä»¶ä»¬~~~~~~~ï¼ˆå¤æ‚ä¸”é‡è¦ï¼‰\n    @Autowired(required = false)\n    private List<RibbonClientSpecification> configurations = new ArrayList<>();\n\n    // ç‰¹å¾ï¼ŒFeaturesEndpointè¿™ä¸ªç«¯ç‚¹(`/actuator/features`)ä¼šä½¿ç”¨å®ƒorg.springframework.cloud.client.actuator.HasFeatures\n    @Bean\n    public HasFeatures ribbonFeature() {\n        return HasFeatures.namedFeature(\"Ribbon\", Ribbon.class);\n    }\n\n\n    // å®ƒæ˜¯æœ€ä¸ºé‡è¦çš„ï¼Œæ˜¯ä¸€ä¸ªorg.springframework.cloud.context.named.NamedContextFactory  æ­¤å·¥å‚ç”¨äºåˆ›å»ºå‘½åçš„Springå®¹å™¨\n    // è¿™é‡Œä¼ å…¥é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªä¸åŒå‘½åç©ºé—´å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ˆå’ŒFeignç‰¹åˆ«åƒï¼‰ è®¾ç½®å½“å‰å®¹å™¨ä¸ºçˆ¶å®¹å™¨\n    @Bean\n    public SpringClientFactory springClientFactory() {\n        SpringClientFactory factory = new SpringClientFactory();\n        factory.setConfigurations(this.configurations);\n        return factory;\n    }\n\n    // è¿™ä¸ªBeanæ˜¯å…³é”®ï¼Œè‹¥ä½ æ²¡å®šä¹‰ï¼Œå°±ç”¨ç³»ç»Ÿé»˜è®¤æä¾›çš„Clientäº†~~~\n    // å†…éƒ¨ä½¿ç”¨å’ŒæŒæœ‰äº†SpringClientFactoryã€‚ã€‚ã€‚\n    @Bean\n    @ConditionalOnMissingBean(LoadBalancerClient.class)\n    public LoadBalancerClient loadBalancerClient() {\n        return new RibbonLoadBalancerClient(springClientFactory());\n    }\n    ...\n}\n\n```\n\n\nè¿™ä¸ªé…ç½®ç±»æœ€é‡è¦çš„æ˜¯å®Œæˆäº†`Ribbon`ç›¸å…³ç»„ä»¶çš„è‡ªåŠ¨é…ç½®ï¼Œæœ‰äº†`LoadBalancerClient`æ‰èƒ½åšè´Ÿè½½å‡è¡¡ï¼ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯å®ƒçš„å”¯ä¸€å®ç°ç±»`RibbonLoadBalancerClient`ï¼‰\n\n\n---\n\n\n## @LoadBalanced\n\n\næ³¨è§£æœ¬èº«åŠå…¶ç®€å•ï¼ˆä¸€ä¸ªå±æ€§éƒ½æœ¨æœ‰ï¼‰ï¼š\n\n\n```text\n// æ‰€åœ¨åŒ…æ˜¯org.springframework.cloud.client.loadbalancer\n// èƒ½æ ‡æ³¨åœ¨å­—æ®µã€æ–¹æ³•å‚æ•°ã€æ–¹æ³•ä¸Š\n// JavaDocä¸Šè¯´å¾—å¾ˆæ¸…æ¥šï¼šå®ƒåªèƒ½æ ‡æ³¨åœ¨RestTemplateä¸Šæ‰æœ‰æ•ˆ\n@Target({ ElementType.FIELD, ElementType.PARAMETER, ElementType.METHOD })\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Inherited\n@Qualifier\npublic @interface LoadBalanced {\n}\n\n```\n\n\nå®ƒæœ€å¤§çš„ç‰¹ç‚¹ï¼šå¤´ä¸Šæ ‡æ³¨æœ‰`@Qualifier`æ³¨è§£ï¼Œè¿™æ˜¯å®ƒç”Ÿæ•ˆçš„æœ€é‡è¦å› ç´ ä¹‹ä¸€ï¼Œæœ¬æ–‡ååŠå•¦æˆ‘èŠ±äº†å¤§ç¯‡å¹…ä»‹ç»å®ƒçš„ç”Ÿæ•ˆæ—¶æœºã€‚\nå…³äº`@LoadBalanced`è‡ªåŠ¨ç”Ÿæ•ˆçš„é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦æ¥åˆ°è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼š`LoadBalancerAutoConfiguration`\n\n\n### LoadBalancerAutoConfiguration\n\n\n```text\n// Auto-configuration for Ribbon (client-side load balancing).\n// å®ƒçš„è´Ÿè½½å‡è¡¡æŠ€æœ¯ä¾èµ–äºçš„æ˜¯Ribbonç»„ä»¶~\n// å®ƒæ‰€åœ¨çš„åŒ…æ˜¯ï¼šorg.springframework.cloud.client.loadbalancer\n@Configuration\n@ConditionalOnClass(RestTemplate.class) //å¯è§å®ƒåªå¯¹RestTemplateç”Ÿæ•ˆ\n@ConditionalOnBean(LoadBalancerClient.class) // Springå®¹å™¨å†…å¿…é¡»å­˜åœ¨è¿™ä¸ªæ¥å£çš„Beanæ‰ä¼šç”Ÿæ•ˆï¼ˆå‚è§ï¼šRibbonAutoConfigurationï¼‰\n@EnableConfigurationProperties(LoadBalancerRetryProperties.class) // retryçš„é…ç½®æ–‡ä»¶\npublic class LoadBalancerAutoConfiguration {\n\n    // æ‹¿åˆ°å®¹å™¨å†…æ‰€æœ‰çš„æ ‡æ³¨æœ‰@LoadBalancedæ³¨è§£çš„Beanä»¬\n    // æ³¨æ„ï¼šå¿…é¡»æ ‡æ³¨æœ‰@LoadBalancedæ³¨è§£çš„æ‰è¡Œ\n    @LoadBalanced\n    @Autowired(required = false)\n    private List<RestTemplate> restTemplates = Collections.emptyList();\n    // LoadBalancerRequestTransformeræ¥å£ï¼šå…è®¸ä½¿ç”¨è€…æŠŠrequest + ServiceInstance --> æ”¹é€ ä¸€ä¸‹\n    // Springå†…éƒ¨é»˜è®¤æ˜¯æ²¡æœ‰æä¾›ä»»ä½•å®ç°ç±»çš„ï¼ˆåŒ¿åçš„éƒ½æœ¨æœ‰ï¼‰\n    @Autowired(required = false)\n    private List<LoadBalancerRequestTransformer> transformers = Collections.emptyList();\n\n    // é…ç½®ä¸€ä¸ªåŒ¿åçš„SmartInitializingSingleton æ­¤æ¥å£æˆ‘ä»¬åº”è¯¥æ˜¯ç†Ÿæ‚‰çš„\n    // å®ƒçš„afterSingletonsInstantiated()æ–¹æ³•ä¼šåœ¨æ‰€æœ‰çš„å•ä¾‹Beanåˆå§‹åŒ–å®Œæˆä¹‹åï¼Œå†è°ƒç”¨ä¸€ä¸ªä¸€ä¸ªçš„å¤„ç†BeanName~\n    // æœ¬å¤„ï¼šä½¿ç”¨é…ç½®å¥½çš„æ‰€æœ‰çš„RestTemplateCustomizerå®šåˆ¶å™¨ä»¬ï¼Œå¯¹æ‰€æœ‰çš„`RestTemplate`å®šåˆ¶å¤„ç†\n    // RestTemplateCustomizerä¸‹é¢æœ‰ä¸ªlambdaçš„å®ç°ã€‚è‹¥è°ƒç”¨è€…æœ‰éœ€è¦å¯ä»¥ä¹¦å†™ç„¶åæ‰”è¿›å®¹å™¨é‡Œæ—¢ç”Ÿæ•ˆ\n    // è¿™ç§å®šåˆ¶å™¨ï¼šè‹¥ä½ é¡¹ç›®ä¸­æœ‰å¤šä¸ªRestTempalteï¼Œéœ€è¦ç»Ÿä¸€å¤„ç†çš„è¯ã€‚å†™ä¸€ä¸ªå®šåˆ¶å™¨æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©\n    // ï¼ˆæ¯”å¦‚ç»Ÿä¸€è¦æ”¾ç½®ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå™¨ï¼šè¾“å‡ºæ—¥å¿—ä¹‹ç±»çš„ï¼‰\n    @Bean\n    public SmartInitializingSingleton loadBalancedRestTemplateInitializerDeprecated(final ObjectProvider<List<RestTemplateCustomizer>> restTemplateCustomizers) {\n        return () -> restTemplateCustomizers.ifAvailable(customizers -> {\n            for (RestTemplate restTemplate : LoadBalancerAutoConfiguration.this.restTemplates) {\n                for (RestTemplateCustomizer customizer : customizers) {\n                    customizer.customize(restTemplate);\n                }\n            }\n        });\n    }\n\n    // è¿™ä¸ªå·¥å‚ç”¨äºcreateRequest()åˆ›å»ºå‡ºä¸€ä¸ªLoadBalancerRequest\n    // è¿™ä¸ªè¯·æ±‚é‡Œé¢æ˜¯åŒ…å«LoadBalancerClientä»¥åŠHttpRequest requestçš„\n    @Bean\n    @ConditionalOnMissingBean\n    public LoadBalancerRequestFactory loadBalancerRequestFactory(LoadBalancerClient loadBalancerClient) {\n        return new LoadBalancerRequestFactory(loadBalancerClient, this.transformers);\n    }\n\n    // =========åˆ°ç›®å‰ä¸ºæ­¢è¿˜å’Œè´Ÿè½½å‡è¡¡æ²¡å•¥å…³ç³»==========\n    // =========æ¥ä¸‹æ¥çš„é…ç½®æ‰å’Œè´Ÿè½½å‡è¡¡æœ‰å…³ï¼ˆå½“ç„¶ä¸Šé¢æ˜¯åŸºç¡€é¡¹ï¼‰==========\n\n    // è‹¥æœ‰Retryçš„åŒ…ï¼Œå°±æ˜¯å¦å¤–ä¸€ä»½é…ç½®ï¼Œå’Œè¿™å·®ä¸å¤š~~\n    @Configuration\n    @ConditionalOnMissingClass(\"org.springframework.retry.support.RetryTemplate\")\n    static class LoadBalancerInterceptorConfig {ã€\n\n        // è¿™ä¸ªBeançš„åç§°å«`loadBalancerClient`ï¼Œæˆ‘ä¸ªäººè§‰å¾—å«`loadBalancerInterceptor`æ›´åˆé€‚å§ï¼ˆè™½ç„¶ribbonæ˜¯å”¯ä¸€å®ç°ï¼‰\n        // è¿™é‡Œç›´æ¥ä½¿ç”¨çš„æ˜¯requestFactoryå’ŒClientæ„å»ºä¸€ä¸ªæ‹¦æˆªå™¨å¯¹è±¡\n        // LoadBalancerInterceptorå¯æ˜¯`ClientHttpRequestInterceptor`ï¼Œå®ƒä¼šä»‹å…¥åˆ°http.clienté‡Œé¢å»\n        // LoadBalancerInterceptorä¹Ÿæ˜¯å®ç°è´Ÿè½½å‡è¡¡çš„å…¥å£ï¼Œä¸‹é¢è¯¦è§£\n        // Tips:è¿™é‡Œå¯æ²¡æœ‰@ConditionalOnMissingBeanå“¦~~~~\n        @Bean\n        public LoadBalancerInterceptor ribbonInterceptor(LoadBalancerClient loadBalancerClient, LoadBalancerRequestFactory requestFactory) {\n            return new LoadBalancerInterceptor(loadBalancerClient, requestFactory);\n        }\n\n\n        // å‘å®¹å™¨å†…æ”¾å…¥ä¸€ä¸ªRestTemplateCustomizer å®šåˆ¶å™¨\n        // è¿™ä¸ªå®šåˆ¶å™¨çš„ä½œç”¨ä¸Šé¢å·²ç»è¯´äº†ï¼šåœ¨RestTemplateåˆå§‹åŒ–å®Œæˆåï¼Œåº”ç”¨æ­¤å®šåˆ¶åŒ–å™¨åœ¨**æ‰€æœ‰çš„å®ä¾‹ä¸Š**\n        // è¿™ä¸ªåŒ¿åå®ç°çš„é€»è¾‘è¶…çº§ç®€å•ï¼šå‘æ‰€æœ‰çš„RestTemplateéƒ½å¡å…¥ä¸€ä¸ªloadBalancerInterceptor è®©å…¶å…·å¤‡æœ‰è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›\n\n        // Tipsï¼šæ­¤å¤„æœ‰æ³¨è§£@ConditionalOnMissingBeanã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœè°ƒç”¨è€…è‡ªå·±å®šä¹‰è¿‡RestTemplateCustomizerç±»å‹çš„Beanï¼Œæ­¤å¤„æ˜¯ä¸ä¼šæ‰§è¡Œçš„\n        // è¯·åŠ¡å¿…æ³¨æ„è¿™ç‚¹ï¼šå®¹æ˜“è®©ä½ çš„è´Ÿè½½å‡è¡¡ä¸ç”Ÿæ•ˆå“¦~~~~\n        @Bean\n        @ConditionalOnMissingBean\n        public RestTemplateCustomizer restTemplateCustomizer(final LoadBalancerInterceptor loadBalancerInterceptor) {\n            return restTemplate -> {\n                List<ClientHttpRequestInterceptor> list = new ArrayList<>(restTemplate.getInterceptors());\n                list.add(loadBalancerInterceptor);\n                restTemplate.setInterceptors(list);\n            };\n        }\n    }\n    ...\n}\n\n```\n\n\nè¿™æ®µé…ç½®ä»£ç ç¨å¾®æœ‰ç‚¹é•¿ï¼Œæˆ‘æŠŠæµç¨‹æ€»ç»“ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š\n\n1. `LoadBalancerAutoConfiguration`è¦æƒ³ç”Ÿæ•ˆç±»è·¯å¾„å¿…é¡»æœ‰`RestTemplate`ï¼Œä»¥åŠSpringå®¹å™¨å†…å¿…é¡»æœ‰`LoadBalancerClient`çš„å®ç°Bean\n\\1. `LoadBalancerClient`çš„å”¯ä¸€å®ç°ç±»æ˜¯ï¼š`org.springframework.cloud.netflix.ribbon.RibbonLoadBalancerClient`\n2. `LoadBalancerInterceptor`æ˜¯ä¸ª`ClientHttpRequestInterceptor`å®¢æˆ·ç«¯è¯·æ±‚æ‹¦æˆªå™¨ã€‚å®ƒçš„ä½œç”¨æ˜¯åœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ä¹‹å‰æ‹¦æˆªï¼Œ**è¿›è€Œå®ç°å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡**\n3. `restTemplateCustomizer()`è¿”å›çš„åŒ¿åå®šåˆ¶å™¨`RestTemplateCustomizer`å®ƒç”¨æ¥ç»™æ‰€æœ‰çš„`RestTemplate`åŠ ä¸Šè´Ÿè½½å‡è¡¡æ‹¦æˆªå™¨ï¼ˆéœ€è¦æ³¨æ„å®ƒçš„`@ConditionalOnMissingBean`æ³¨è§£~ï¼‰\n\nä¸éš¾å‘ç°ï¼Œè´Ÿè½½å‡è¡¡å®ç°çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå°±æ˜¯è¿™ä¸ªæ‹¦æˆªå™¨è®©ä¸€ä¸ªæ™®é€šçš„`RestTemplate`é€†è¢­æˆä¸ºäº†ä¸€ä¸ªå…·æœ‰è´Ÿè½½å‡è¡¡åŠŸèƒ½çš„è¯·æ±‚å™¨\n\n\n### `LoadBalancerInterceptor`\n\n\nè¯¥ç±»å”¯ä¸€è¢«ä½¿ç”¨çš„åœ°æ–¹å°±æ˜¯`LoadBalancerAutoConfiguration`é‡Œé…ç½®ä¸Šå»~\n\n\n```text\npublic class LoadBalancerInterceptor implements ClientHttpRequestInterceptor {\n\n    // è¿™ä¸ªå‘½åéƒ½ä¸å«Clientäº†ï¼Œè€Œå«loadBalancer~~~\n    private LoadBalancerClient loadBalancer;\n    // ç”¨äºæ„å»ºå‡ºä¸€ä¸ªRequest\n    private LoadBalancerRequestFactory requestFactory;\n    ... // çœç•¥æ„é€ å‡½æ•°ï¼ˆç»™è¿™ä¸¤ä¸ªå±æ€§èµ‹å€¼ï¼‰\n\n    @Override\n    public ClientHttpResponse intercept(final HttpRequest request, final byte[] body, final ClientHttpRequestExecution execution) throws IOException {\n        final URI originalUri = request.getURI();\n        String serviceName = originalUri.getHost();\n        Assert.state(serviceName != null, \"Request URI does not contain a valid hostname: \" + originalUri);\n        return this.loadBalancer.execute(serviceName, this.requestFactory.createRequest(request, body, execution));\n    }\n}\n\n```\n\n\næ­¤æ‹¦æˆªå™¨æ‹¦æˆªè¯·æ±‚åæŠŠå®ƒçš„`serviceName`å§”æ‰˜ç»™äº†`LoadBalancerClient`å»æ‰§è¡Œï¼Œæ ¹æ®`ServiceName`å¯èƒ½å¯¹åº”Nå¤šä¸ªå®é™…çš„`Server`ï¼Œå› æ­¤å°±å¯ä»¥ä»ä¼—å¤šçš„Serverä¸­è¿ç”¨å‡è¡¡ç®—æ³•ï¼ŒæŒ‘é€‰å‡ºä¸€ä¸ªæœ€ä¸ºåˆé€‚çš„`Server`åšæœ€ç»ˆçš„è¯·æ±‚ï¼ˆå®ƒæŒæœ‰çœŸæ­£çš„è¯·æ±‚æ‰§è¡Œå™¨`ClientHttpRequestExecution`ï¼‰ã€‚\n\n\n---\n\n\n### LoadBalancerClient\n\n\nè¯·æ±‚è¢«æ‹¦æˆªåï¼Œæœ€ç»ˆéƒ½æ˜¯å§”æ‰˜ç»™äº†`LoadBalancerClient`å¤„ç†ã€‚\n\n\n```text\n// ç”±ä½¿ç”¨è´Ÿè½½å¹³è¡¡å™¨é€‰æ‹©è¦å‘å…¶å‘é€è¯·æ±‚çš„æœåŠ¡å™¨çš„ç±»å®ç°\npublic interface ServiceInstanceChooser {\n\n    // ä»è´Ÿè½½å¹³è¡¡å™¨ä¸­ä¸ºæŒ‡å®šçš„æœåŠ¡é€‰æ‹©ServiceæœåŠ¡å®ä¾‹ã€‚\n    // ä¹Ÿå°±æ˜¯æ ¹æ®è°ƒç”¨è€…ä¼ å…¥çš„serviceIdï¼Œè´Ÿè½½å‡è¡¡çš„é€‰æ‹©å‡ºä¸€ä¸ªå…·ä½“çš„å®ä¾‹å‡ºæ¥\n    ServiceInstance choose(String serviceId);\n}\n\n// å®ƒè‡ªå·±å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•\npublic interface LoadBalancerClient extends ServiceInstanceChooser {\n\n    // æ‰§è¡Œè¯·æ±‚\n    <T> T execute(String serviceId, LoadBalancerRequest<T> request) throws IOException;\n    <T> T execute(String serviceId, ServiceInstance serviceInstance, LoadBalancerRequest<T> request) throws IOException;\n\n    // é‡æ–°æ„é€ urlï¼šæŠŠurlä¸­åŸæ¥å†™çš„æœåŠ¡å æ¢æ‰ æ¢æˆå®é™…çš„\n    URI reconstructURI(ServiceInstance instance, URI original);\n}\n\n```\n\n\nå®ƒåªæœ‰ä¸€ä¸ªå®ç°ç±»`RibbonLoadBalancerClient`ï¼ˆ`ServiceInstanceChooser`æ˜¯æœ‰å¤šä¸ªå®ç°ç±»çš„~ï¼‰ã€‚\n\n\n### `RibbonLoadBalancerClient`\n\n\né¦–å…ˆæˆ‘ä»¬åº”å½“å…³æ³¨å®ƒçš„`choose()`æ–¹æ³•ï¼š\n\n\n```text\npublic class RibbonLoadBalancerClient implements LoadBalancerClient {\n\n    @Override\n    public ServiceInstance choose(String serviceId) {\n        return choose(serviceId, null);\n    }\n    // hintï¼šä½ å¯ä»¥ç†è§£æˆåˆ†ç»„ã€‚è‹¥æŒ‡å®šäº†ï¼Œåªä¼šåœ¨è¿™ä¸ªåå¥½çš„åˆ†ç»„é‡Œé¢å»å‡è¡¡é€‰æ‹©\n    // å¾—åˆ°ä¸€ä¸ªServeråï¼Œä½¿ç”¨RibbonServeræŠŠserveré€‚é…èµ·æ¥~~~\n    // è¿™æ ·ä¸€ä¸ªå®ä¾‹å°±é€‰å¥½äº†~~~çœŸæ­£è¯·æ±‚ä¼šè½åœ¨è¿™ä¸ªå®ä¾‹ä¸Š~\n    public ServiceInstance choose(String serviceId, Object hint) {\n        Server server = getServer(getLoadBalancer(serviceId), hint);\n        if (server == null) {\n            return null;\n        }\n        return new RibbonServer(serviceId, server, isSecure(server, serviceId),\n                serverIntrospector(serviceId).getMetadata(server));\n    }\n\n    // æ ¹æ®ServiceIdå»æ‰¾åˆ°ä¸€ä¸ªå±äºå®ƒçš„è´Ÿè½½å‡è¡¡å™¨\n    protected ILoadBalancer getLoadBalancer(String serviceId) {\n        return this.clientFactory.getLoadBalancer(serviceId);\n    }\n\n}\n\n```\n\n\n`chooseæ–¹æ³•`ï¼šä¼ å…¥serviceIdï¼Œç„¶åé€šè¿‡`SpringClientFactory`è·å–è´Ÿè½½å‡è¡¡å™¨`com.netflix.loadbalancer.ILoadBalancer`ï¼Œæœ€ç»ˆå§”æ‰˜ç»™å®ƒçš„`chooseServer()`æ–¹æ³•é€‰å–åˆ°ä¸€ä¸ª`com.netflix.loadbalancer.Server`å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´çœŸæ­£å®Œæˆ`Server`é€‰å–çš„æ˜¯`ILoadBalancer`ã€‚\n\n\n> ILoadBalancerä»¥åŠå®ƒç›¸å…³çš„ç±»æ˜¯ä¸€ä¸ªè¾ƒä¸ºåºå¤§çš„ä½“ç³»ï¼Œæœ¬æ–‡ä¸åšæ›´å¤šçš„å±•å¼€ï¼Œè€Œæ˜¯åªèšç„¦åœ¨æˆ‘ä»¬çš„æµç¨‹ä¸Š\n\n\n`LoadBalancerInterceptor`æ‰§è¡Œçš„æ—¶å€™æ˜¯ç›´æ¥å§”æ‰˜æ‰§è¡Œçš„`loadBalancer.execute()`è¿™ä¸ªæ–¹æ³•ï¼š\n\n\n```text\nRibbonLoadBalancerClientï¼š\n\n    // hintæ­¤å¤„ä¼ å€¼ä¸ºnullï¼šä¸€è§†åŒä»\n    // è¯´æ˜ï¼šLoadBalancerRequestæ˜¯é€šè¿‡LoadBalancerRequestFactory.createRequest(request, body, execution)åˆ›å»ºå‡ºæ¥çš„\n    // å®ƒå®ç°LoadBalancerRequestæ¥å£æ˜¯ç”¨çš„ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œæ³›å‹ç±»å‹æ˜¯ClientHttpResponse\n    // å› ä¸ºæœ€ç»ˆæ‰§è¡Œçš„æ˜¾ç„¶è¿˜æ˜¯æ‰§è¡Œå™¨ï¼šClientHttpRequestExecution.execute()\n    @Override\n    public <T> T execute(String serviceId, LoadBalancerRequest<T> request) throws IOException {\n        return execute(serviceId, request, null);\n    }\n    // publicæ–¹æ³•ï¼ˆéæ¥å£æ–¹æ³•ï¼‰\n    public <T> T execute(String serviceId, LoadBalancerRequest<T> request, Object hint) throws IOException {\n        // åŒä¸Šï¼šæ‹¿åˆ°è´Ÿè½½å‡è¡¡å™¨ï¼Œç„¶åæ‹¿åˆ°ä¸€ä¸ªserverInstanceå®ä¾‹\n        ILoadBalancer loadBalancer = getLoadBalancer(serviceId);\n        Server server = getServer(loadBalancer, hint);\n        if (server == null) { // è‹¥æ²¡æ‰¾åˆ°å°±ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯IllegalStateExceptionè¿™ä¸ªå¼‚å¸¸\n            throw new IllegalStateException(\"No instances available for \" + serviceId);\n        }\n\n        // æŠŠServeré€‚é…ä¸ºRibbonServer  isSecureï¼šå®¢æˆ·ç«¯æ˜¯å¦å®‰å…¨\n        // serverIntrospectorå†…çœ  å‚è€ƒé…ç½®æ–‡ä»¶ï¼šServerIntrospectorProperties\n        RibbonServer ribbonServer = new RibbonServer(serviceId, server,\n                isSecure(server, serviceId), serverIntrospector(serviceId).getMetadata(server));\n\n        //è°ƒç”¨æœ¬ç±»çš„é‡è½½æ¥å£æ–¹æ³•~~~~~\n        return execute(serviceId, ribbonServer, request);\n    }\n\n    // æ¥å£æ–¹æ³•ï¼šå®ƒçš„å‚æ•°æ˜¯ServiceInstance --> å·²ç»ç¡®å®šäº†å”¯ä¸€çš„Serverå®ä¾‹~~~\n    @Override\n    public <T> T execute(String serviceId, ServiceInstance serviceInstance, LoadBalancerRequest<T> request) throws IOException {\n\n        // æ‹¿åˆ°Serverï¼‰ï¼ˆè¯´ç™½äº†ï¼ŒRibbonServeræ˜¯executeæ—¶çš„å”¯ä¸€å®ç°ï¼‰\n        Server server = null;\n        if (serviceInstance instanceof RibbonServer) {\n            server = ((RibbonServer) serviceInstance).getServer();\n        }\n        if (server == null) {\n            throw new IllegalStateException(\"No instances available for \" + serviceId);\n        }\n\n        // è¯´æ˜ï¼šæ‰§è¡Œçš„ä¸Šä¸‹æ–‡æ˜¯å’ŒserviceIdç»‘å®šçš„\n        RibbonLoadBalancerContext context = this.clientFactory.getLoadBalancerContext(serviceId);\n        ...\n        // çœŸæ­£çš„å‘serverå‘é€è¯·æ±‚ï¼Œå¾—åˆ°è¿”å›å€¼\n        // å› ä¸ºæœ‰æ‹¦æˆªå™¨ï¼Œæ‰€ä»¥è¿™é‡Œè‚¯å®šè¯´æ‰§è¡Œçš„æ˜¯InterceptingRequestExecution.execute()æ–¹æ³•\n        // soä¼šè°ƒç”¨ServiceRequestWrapper.getURI()ï¼Œä»è€Œå°±ä¼šè°ƒç”¨reconstructURI()æ–¹æ³•\n            T returnVal = request.apply(serviceInstance);\n            return returnVal;\n        ... // å¼‚å¸¸å¤„ç†\n    }\n\n```\n\n\n`returnVal`æ˜¯ä¸€ä¸ª`ClientHttpResponse`ï¼Œæœ€åäº¤ç»™`handleResponse()`æ–¹æ³•æ¥å¤„ç†å¼‚å¸¸æƒ…å†µï¼ˆè‹¥å­˜åœ¨çš„è¯ï¼‰ï¼Œè‹¥æ— å¼‚å¸¸å°±äº¤ç»™æå–å™¨æå€¼ï¼š`responseExtractor.extractData(response)`ï¼Œè¿™æ ·æ•´ä¸ªè¯·æ±‚å°±ç®—å…¨éƒ¨å®Œæˆäº†ã€‚\n\n\n### ä½¿ç”¨ç»†èŠ‚\n\n\né’ˆå¯¹`@LoadBalanced`ä¸‹çš„`RestTemplate`çš„ä½¿ç”¨ï¼Œæˆ‘æ€»ç»“å¦‚ä¸‹ç»†èŠ‚ä¾›ä»¥å‚è€ƒï¼š\n\n1. ä¼ å…¥çš„`String`ç±»å‹çš„urlå¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼ˆ`http://...`ï¼‰ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼š`java.lang.IllegalArgumentException: URI is not absolute`\n2. `serviceId`ä¸åŒºåˆ†å¤§å°å†™ï¼ˆ`http://user/...æ•ˆæœåŒhttp://USER/...`ï¼‰\n3. `serviceId`åè¯·ä¸è¦è·Ÿportç«¯å£å·äº†~~~\n\næœ€åï¼Œéœ€è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼šæ ‡æ³¨æœ‰`@LoadBalanced`çš„`RestTemplate`åªèƒ½ä¹¦å†™`serviceId`è€Œä¸èƒ½å†å†™`IPåœ°å€/åŸŸå`å»å‘é€è¯·æ±‚äº†ã€‚è‹¥ä½ çš„é¡¹ç›®ä¸­ä¸¤ç§caseéƒ½æœ‰éœ€è¦ï¼Œè¯·å®šä¹‰å¤šä¸ª`RestTemplate`åˆ†åˆ«åº”å¯¹ä¸åŒçš„ä½¿ç”¨åœºæ™¯~\n\n\n### æœ¬åœ°æµ‹è¯•\n\n\näº†è§£äº†å®ƒçš„æ‰§è¡Œæµç¨‹åï¼Œè‹¥éœ€è¦æœ¬åœ°æµ‹è¯•ï¼ˆä¸ä¾èµ–äºæ³¨å†Œä¸­å¿ƒï¼‰ï¼Œå¯ä»¥è¿™ä¹ˆæ¥åšï¼š\n\n\n```text\n// å› ä¸ºè‡ªåŠ¨é…ç½®å¤´ä¸Šæœ‰@ConditionalOnMissingBeanæ³¨è§£ï¼Œæ‰€ä»¥è‡ªå®šä¹‰ä¸€ä¸ªè¦†ç›–å®ƒçš„è¡Œä¸ºå³å¯\n// æ­¤å¤„å¤å†™å®ƒçš„getServer()æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå›ºå®šçš„ï¼ˆè®¿é—®ç™¾åº¦é¦–é¡µï¼‰å³å¯ï¼Œæ–¹ä¾¿æµ‹è¯•\n@Bean\npublic LoadBalancerClient loadBalancerClient(SpringClientFactory factory) {\n    return new RibbonLoadBalancerClient(factory) {\n        @Override\n        protected Server getServer(ILoadBalancer loadBalancer, Object hint) {\n            return new Server(\"www.baidu.com\", 80);\n        }\n    };\n}\n\n```\n\n\nè¿™ä¹ˆä¸€æ¥ï¼Œä¸‹é¢è¿™ä¸ªè®¿é—®ç»“æœå°±æ˜¯ç™¾åº¦é¦–é¡µçš„htmlå†…å®¹å–½ã€‚\n\n\n```text\n@Test\npublic void contextLoads() {\n    String obj = restTemplate.getForObject(\"<http://my-serviceId>\", String.class);\n    System.out.println(obj);\n}\n\n```\n\n\n> æ­¤å¤„my-serviceIdè‚¯å®šæ˜¯ä¸å­˜åœ¨çš„ï¼Œä½†å¾—ç›Šäºæˆ‘ä¸Šé¢è‡ªå®šä¹‰é…ç½®çš„LoadBalancerClient\n\n\nä»€ä¹ˆï¼Œå†™æ­»`return`ä¸€ä¸ª`Server`å®ä¾‹ä¸ä¼˜é›…ï¼Ÿç¡®å®ï¼Œæ€»ä¸èƒ½æ¯æ¬¡ä¸Šçº¿å‰è¿˜æŠŠè¿™éƒ¨åˆ†ä»£ç ç»™æ³¨é‡Šæ‰å§ï¼Œè‹¥æœ‰å¤šä¸ªå®ä¾‹å‘¢ï¼Ÿè¿˜å¾—è‡ªå·±å†™è´Ÿè½½å‡è¡¡ç®—æ³•å—ï¼Ÿå¾ˆæ˜¾ç„¶`Spring Cloud`æ—©æ—©å°±ä¸ºæˆ‘ä»¬è€ƒè™‘åˆ°äº†è¿™ä¸€ç‚¹ï¼š**è„±ç¦»Eurekaä½¿ç”¨é…ç½®listOfServersè¿›è¡Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡è°ƒåº¦ï¼ˆ****`<clientName>.<nameSpace>.listOfServers=<comma delimited hostname:port strings>`****ï¼‰**\n\n\nå¯¹äºä¸Šä¾‹æˆ‘åªéœ€è¦åœ¨ä¸»é…ç½®æ–‡ä»¶é‡Œè¿™ä¹ˆé…ç½®ä¸€ä¸‹ï¼š\n\n\n```text\n# ribbon.eureka.enabled=false # è‹¥æ²¡ç”¨eurakaï¼Œæ­¤é…ç½®å¯çœç•¥ã€‚å¦åˆ™ä¸å¯ä»¥\nmy-serviceId.ribbon.listOfServers=www.baidu.com # è‹¥æœ‰å¤šä¸ªå®ä¾‹è¯·ç”¨é€—å·åˆ†éš”\n\n```\n\n\næ•ˆæœå®Œå…¨åŒä¸Šã€‚\n\n\n> Tipsï¼šè¿™ç§é…ç½®æ³•ä¸éœ€è¦æ˜¯å®Œæ•´çš„ç»å¯¹è·¯å¾„ï¼Œhttp://æ˜¯å¯ä»¥çœç•¥çš„ï¼ˆnew Server()æ–¹å¼äº¦å¯ï¼‰\n\n\n### è‡ªå·±æ·»åŠ ä¸€ä¸ªè®°å½•è¯·æ±‚æ—¥å¿—çš„æ‹¦æˆªå™¨å¯è¡Œå—ï¼Ÿ\n\n\næ˜¾ç„¶æ˜¯å¯è¡Œçš„ï¼Œæˆ‘ç»™å‡ºç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n\n```text\n@LoadBalanced\n@Bean\npublic RestTemplate restTemplate() {\n    RestTemplate restTemplate = new RestTemplate();\n    List<ClientHttpRequestInterceptor> list = new ArrayList<>();\n    list.add((request, body, execution) -> {\n        System.out.println(\"å½“å‰è¯·æ±‚çš„URLæ˜¯ï¼š\" + request.getURI().toString());\n        return execution.execute(request, body);\n    });\n    restTemplate.setInterceptors(list);\n    return restTemplate;\n}\n\n```\n\n\nè¿™æ ·æ¯æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½ä¼šæ‰“å°è¿™å¥è¯ï¼š`å½“å‰è¯·æ±‚çš„URIæ˜¯ï¼š<http://my-serviceId`>ï¼Œä¸€èˆ¬æƒ…å†µï¼ˆç¼ºçœæƒ…å†µï¼‰è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨éƒ½ä¼šåœ¨è´Ÿè½½å‡è¡¡æ‹¦æˆªå™¨å‰é¢æ‰§è¡Œï¼ˆå› ä¸ºå®ƒè¦æ‰§è¡Œæœ€ç»ˆçš„è¯·æ±‚ï¼‰ã€‚è‹¥ä½ æœ‰å¿…è¦å®šä¹‰å¤šä¸ªæ‹¦æˆªå™¨ä¸”è¦æ§åˆ¶é¡ºåºï¼Œå¯é€šè¿‡`Ordered`ç³»åˆ—æ¥å£æ¥å®ç°~\n\n\n---\n\n\n**æœ€åçš„æœ€åï¼Œæˆ‘æŠ›å‡ºä¸€ä¸ªéå¸¸éå¸¸é‡è¦çš„é—®é¢˜ï¼š**\n\n\n```text\n    @LoadBalanced\n    @Autowired(required = false)\n    private List<RestTemplate> restTemplates = Collections.emptyList();\n\n```\n\n\n`@Autowired` + `@LoadBalanced`èƒ½æŠŠä½ é…ç½®çš„`RestTemplate`è‡ªåŠ¨æ³¨å…¥è¿›æ¥æ‹¿æ¥å®šåˆ¶å‘¢ï¼Ÿï¼Ÿï¼Ÿæ ¸å¿ƒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\n\n\n## > æç¤ºï¼šæœ¬åŸç†å†…å®¹å±äº`Spring Framwork`æ ¸å¿ƒæŠ€æœ¯ï¼Œå»ºè®®æ·±å…¥æ€è€ƒè€Œä¸å›«å›µåæ£ã€‚æœ‰ç–‘é—®çš„å¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä¹Ÿå°†ä¼šåœ¨ä¸‹ç¯‡æ–‡ç« ç»™å‡ºè¯¦ç»†è§£ç­”ï¼ˆå»ºè®®å…ˆæ€è€ƒï¼‰\n\n\n### æ¨èé˜…è¯»\n\n\n[RestTemplateçš„ä½¿ç”¨å’ŒåŸç†ä½ éƒ½çƒ‚ç†Ÿäºèƒ¸äº†å—ï¼Ÿã€äº«å­¦Spring MVCã€‘](https://fangshixiang.blog.csdn.net/article/details/100753981)[@Qualifieré«˜çº§åº”ç”¨---æŒ‰ç±»åˆ«æ‰¹é‡ä¾èµ–æ³¨å…¥ã€äº«å­¦Springã€‘](https://fangshixiang.blog.csdn.net/article/details/100890879)\n\n\n\\------------------------------------------------------\n\n\n# Ribbonæ˜¯å¦‚ä½•é€šè¿‡ä¸€ä¸ª@LoadBalancedæ³¨è§£å°±å®ç°è´Ÿè½½å‡è¡¡çš„\n\n\nåŸåˆ›[ç»…å£«jiejie](https://me.csdn.net/weixin_38106322) æœ€åå‘å¸ƒäº2019-11-08 15:09:04 é˜…è¯»æ•° 94 æ”¶è—\n\n\nå‘å¸ƒäº2019-11-06 16:14:45\n\n\nåˆ†ç±»ä¸“æ ï¼š [Spring Cloud](https://blog.csdn.net/weixin_38106322/category_9431347.html)\n\n\nç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œéµå¾ª[ CC 4.0 BY-SA ](http://creativecommons.org/licenses/by-sa/4.0/)ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚\n\n\næœ¬æ–‡é“¾æ¥ï¼š[https://blog.csdn.net/weixin_38106322/article/details/102937313](https://blog.csdn.net/weixin_38106322/article/details/102937313)\n\n\nå±•å¼€\n\n\nä¸€.ä»‹ç»ä¸‹æµ‹è¯•ç”¨åˆ°çš„æœåŠ¡\n\n\n![](https://img-blog.csdnimg.cn/20191106161350811.png)\n\n\nä»Eurekaæ³¨å†Œä¸­å¿ƒä¸­å¯ä»¥å¯ä»¥çœ‹å‡ºæœ‰EUREKA-CLIENTå’ŒRIBBON-CLIENTçš„æœåŠ¡ï¼Œå…¶ä¸­EUREKA-CLIENTæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œè€ŒRIBBON-CLIENTåˆ™æ˜¯æœåŠ¡æ¶ˆè´¹è€…ï¼Œé€šè¿‡RestTemplateæ¥æ¶ˆè´¹EUREKA-CLIENTçš„æœåŠ¡ã€‚\n\n\nä¸‹é¢ä»£ç å°±æ˜¯ç®€å•å®ç°Ribbonè´Ÿè½½å‡è¡¡çš„é…ç½®ç±»ï¼š\n\n\n```text\n@Configuration\npublic class RibbonConfig {\n\n    @Bean\n    @LoadBalanced\n    RestTemplate getRestTemlate() {\n        return new RestTemplate();\n    }\n}\n\n```\n\n\nè¿™æ ·ç®€å•çš„é€šè¿‡ä¸€ä¸ª@LoadBalancedæ³¨è§£åœ¨RestTemplateä¸Š ï¼Œåœ¨RestTemplate è¿œç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°è´Ÿè½½å‡è¡¡çš„æ•ˆæœã€‚\n\n\näºŒ.ä¸€æ­¥ä¸€æ­¥ç†æ¸…Ribbonè´Ÿè½½å‡è¡¡çš„é€»è¾‘\n\n1. é¦–å…ˆå…¨å±€æœç´¢@LoadBalancedè¿™ä¸ªæ³¨è§£ï¼Œå‘ç°åœ¨LoadBalancerAutoConfigurationç±»æœ‰ç”¨åˆ°è¯¥æ³¨è§£ï¼š\n\n```text\n@Configuration\n@ConditionalOnClass(RestTemplate.class)\n@ConditionalOnBean(LoadBalancerClient.class)\n@EnableConfigurationProperties(LoadBalancerRetryProperties.class)\npublic class LoadBalancerAutoConfiguration {\n\n    /**\n    *  è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å°†æœ‰ç”¨@LoadBalancedæ³¨è§£çš„RestTemplateæ³¨å…¥\n    */\n\t@LoadBalanced\n\t@Autowired(required = false)\n\tprivate List<RestTemplate> restTemplates = Collections.emptyList();\n}\n\n```\n\n\nåˆ†æä»¥ä¸Šä»£ç ï¼š\n\n- é€šè¿‡@Configurationè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»\n- é€šè¿‡@ConditionalOnClass(RestTemplate.class)å¯ä»¥çŸ¥é“RestTemplateç±»è¦åœ¨ç±»è·¯å¾„ä¸Šå­˜åœ¨æ‰ä¼šå®ä¾‹åŒ–LoadBalancerAutoConfiguration\n- é€šè¿‡@ConditionalOnBean(LoadBalancerClient.class)å¯ä»¥çŸ¥é“LoadBalancerClientç±»è¦å­˜åœ¨æ‰ä¼šå®ä¾‹åŒ–LoadBalancerAutoConfiguration\n- @EnableConfigurationProperties(LoadBalancerRetryProperties.class)æ˜¯ç”¨æ¥ä½¿ç”¨@ConfigurationPropertiesæ³¨è§£çš„ç±»LoadBalancerRetryPropertiesç”Ÿæ•ˆï¼Œè´´ä¸Šéƒ¨åˆ†LoadBalancerRetryPropertiesç±»çš„ä»£ç ï¼Œä¼šæ›´æ¸…æ™°ï¼š\n\n```text\n@ConfigurationProperties(\"spring.cloud.loadbalancer.retry\")\npublic class LoadBalancerRetryProperties {\n\n\tprivate boolean enabled = true;\n\n\t/**\n\t * Returns true if the load balancer should retry failed requests.\n\t * @return True if the load balancer should retry failed requests; false otherwise.\n\t */\n\tpublic boolean isEnabled() {\n\t\treturn this.enabled;\n\t}\n\n```\n\n1. æ‰€ä»¥é‡å¯ä¸‹RIBBON-CLIENTæœåŠ¡ï¼ŒDebugç»§ç»­çœ‹LoadBalancerAutoConfiguration ç±»çš„ä»£ç ï¼Œå‘ç°åœ¨å¯åŠ¨æ—¶ä¼šå…ˆè¿›å…¥LoadBalancerAutoConfiguration çš„loadBalancerRequestFactoryæ–¹æ³•ï¼Œå®ä¾‹åŒ–å‡ºLoadBalancerRequestFactory\n\n```text\n    @Bean\n\t@ConditionalOnMissingBean\n\tpublic LoadBalancerRequestFactory loadBalancerRequestFactory(\n\t\t\tLoadBalancerClient loadBalancerClient) {\n\t\treturn new LoadBalancerRequestFactory(loadBalancerClient, this.transformers);\n\t}\n\n```\n\n\næ¥ä¸‹å»æ–­ç‚¹è¿›å…¥LoadBalancerAutoConfiguration ç±»ä¸­çš„é™æ€å†…éƒ¨ç±»LoadBalancerInterceptorConfigçš„ribbonInterceptoræ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸ºäº†å®ä¾‹åŒ–å‡ºLoadBalancerInterceptor æ‹¦æˆªå™¨\n\n\n```text\n    @Configuration\n\t@ConditionalOnMissingClass(\"org.springframework.retry.support.RetryTemplate\")\n\tstatic class LoadBalancerInterceptorConfig {\n\n\t\t@Bean\n\t\tpublic LoadBalancerInterceptor ribbonInterceptor(\n\t\t\t\tLoadBalancerClient loadBalancerClient,\n\t\t\t\tLoadBalancerRequestFactory requestFactory) {\n\t\t\treturn new LoadBalancerInterceptor(loadBalancerClient, requestFactory);\n\t\t}\n\n```\n\n\nç»§ç»­è·Ÿæ–­ç‚¹ï¼Œè¿›å…¥äº†loadBalancedRestTemplateInitializerDeprecatedæ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºè¿™ä¸ªæ–¹æ³•é‡Œä¸»è¦çš„é€»è¾‘ä»£ç æ˜¯customizer.customize(restTemplate)\n\n\n```text\n    @Bean\n\tpublic SmartInitializingSingleton loadBalancedRestTemplateInitializerDeprecated(\n\t\t\tfinal ObjectProvider<List<RestTemplateCustomizer>> restTemplateCustomizers) {\n\t\treturn () -> restTemplateCustomizers.ifAvailable(customizers -> {\n\t\t\tfor (RestTemplate restTemplate : LoadBalancerAutoConfiguration.this.restTemplates) {\n\t\t\t\tfor (RestTemplateCustomizer customizer : customizers) {\n\t\t\t\t\tcustomizer.customize(restTemplate);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n```\n\n\nç»§ç»­Debug,æ–­ç‚¹è¿›å…¥LoadBalancerAutoConfigurationç±»ä¸­çš„é™æ€å†…éƒ¨ç±»LoadBalancerInterceptorConfigï¼š\n\n\n```text\n@Configuration\n@ConditionalOnMissingClass(\"org.springframework.retry.support.RetryTemplate\")\n\tstatic class LoadBalancerInterceptorConfig {\n\t\t@Bean\n\t\t@ConditionalOnMissingBean\n\t\tpublic RestTemplateCustomizer restTemplateCustomizer(\n\t\t\t\tfinal LoadBalancerInterceptor loadBalancerInterceptor) {\n\t\t\treturn restTemplate -> {\n\t\t\t\tList<ClientHttpRequestInterceptor> list = new ArrayList<>(\n\t\t\t\t\t\trestTemplate.getInterceptors());\n\t\t\t\tlist.add(loadBalancerInterceptor);\n\t\t\t\trestTemplate.setInterceptors(list);\n\t\t\t};\n\t\t}\n\t}\n\n```\n\n\né€šè¿‡ list.add(loadBalancerInterceptor)å’ŒrestTemplate.setInterceptors(list)ä¸¤æ®µä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯è¦ç»™restTemplateåŠ ä¸ŠloadBalancerInterceptoræ‹¦æˆªå™¨ã€‚\n\n\né‚£ä¹ˆæ¥ä¸‹æ¥çœ‹çœ‹loadBalancerInterceptoræ‹¦æˆªå™¨é‡Œåšäº†ä»€ä¹ˆ,é€šè¿‡é¡µé¢å‘èµ·ä¸€ä¸ªhttpè¯·æ±‚,æ–­ç‚¹è¿›å…¥åˆ°LoadBalancerInterceptorç±»çš„interceptæ–¹æ³•ï¼Œ\n\n\n```text\n@Override\n\tpublic ClientHttpResponse intercept(final HttpRequest request, final byte[] body,\n\t\t\tfinal ClientHttpRequestExecution execution) throws IOException {\n\t\tfinal URI originalUri = request.getURI();\n\t\tString serviceName = originalUri.getHost();\n\t\tAssert.state(serviceName != null,\n\t\t\t\t\"Request URI does not contain a valid hostname: \" + originalUri);\n\t\treturn this.loadBalancer.execute(serviceName,\n\t\t\t\tthis.requestFactory.createRequest(request, body, execution));\n\t}\n\n```\n\n\næˆªå›¾çœ‹ä¸‹ä¿¡æ¯ï¼š\n\n\n![](https://img-blog.csdnimg.cn/20191107162815756.png)\n\n\nå¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•å–å¾—äº†requesté‡Œçš„urlå’ŒservicNameï¼Œç„¶åå°†è¿™äº›å‚æ•°äº¤ç»™loadBalancer.executeå»æ‰§è¡Œæ–¹æ³•ã€‚è€ŒloadBalanceræ˜¯LoadBalancerClientç±»çš„å®ä¾‹ã€‚\nçœ‹ä¸‹LoadBalancerClientçš„ç±»å›¾ï¼Œå¯ä»¥çœ‹åˆ°LoadBalancerClientç»§æ‰¿äº†ServiceInstanceChooserï¼ŒLoadBalancerClientçš„å®ç°ç±»æ˜¯RibbonLoadBalancerClient\n\n\n![](https://img-blog.csdnimg.cn/20191107163802485.png)\n\n\né€»è¾‘ç»§ç»­ï¼Œæ–­ç‚¹è¿›å…¥äº†RibbonLoadBalancerClientçš„executeæ–¹æ³•\n\n\n```text\npublic <T> T execute(String serviceId, LoadBalancerRequest<T> request, Object hint)\n\t\t\tthrows IOException {\n\t\tILoadBalancer loadBalancer = getLoadBalancer(serviceId);\n\t\tServer server = getServer(loadBalancer, hint);\n\t\tif (server == null) {\n\t\t\tthrow new IllegalStateException(\"No instances available for \" + serviceId);\n\t\t}\n\t\tRibbonServer ribbonServer = new RibbonServer(serviceId, server,\n\t\t\t\tisSecure(server, serviceId),\n\t\t\t\tserverIntrospector(serviceId).getMetadata(server));\n\n\t\treturn execute(serviceId, ribbonServer, request);\n\t}\n\n```\n\n\nè·Ÿç€æ–­ç‚¹ä¸€æ­¥ä¸€æ­¥çœ‹æ–¹æ³•ï¼š\n\n- ILoadBalancer loadBalancer = getLoadBalancer(serviceId);\n\nç»è¿‡è¿™ä¸ªæ–¹æ³•ï¼Œå¾—åˆ°loadBalancerï¼Œä»æˆªå›¾é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒloadBalanceré‡Œæœ‰ä¸ªallServerListé›†åˆï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼Œç«¯å£å·åˆ†åˆ«æ˜¯8763å’Œ8762ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æä¾›çš„æœåŠ¡èŠ‚ç‚¹ã€‚\n\n\t![](https://img-blog.csdnimg.cn/20191107172116799.png)\n\n- Server server = getServer(loadBalancer, hint)\n\nä»å›¾é‡Œå¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡è¿™ä¸ªgetServeræ–¹æ³•ï¼Œä¼šè¿”å›ç»™æˆ‘ä»¬ä¸€ä¸ªå½“å‰å¯è°ƒç”¨çš„æœåŠ¡èŠ‚ç‚¹ï¼Œè€Œè‡³äºæ€ä¹ˆè¿”å›æœåŠ¡èŠ‚ç‚¹ï¼Œä¼šå†å†™ä¸€ç¯‡åˆ†æï¼Œå†™å®Œåä¼šæ›´æ–°é“¾æ¥åˆ°è¯¥ç¯‡ã€‚\n\n\t![](https://img-blog.csdnimg.cn/20191107172537248.png)\n\n- ç”ŸæˆRibbonServer ä½œä¸ºå‚æ•°ä¼ å…¥executeæ–¹æ³•\n- è¿è¡Œexecuteæ–¹æ³•\n\næ¥ç€è·Ÿè¿›executeæ–¹æ³•\n\n\n![](https://img-blog.csdnimg.cn/20191108111558612.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODEwNjMyMg==,size_16,color_FFFFFF,t_70)\n\n\nå¯ä»¥çœ‹è¯¥æ–¹æ³•é‡Œçš„å…³é”®æ‰§è¡Œæ–¹æ³•æ˜¯ï¼š\nT returnVal = request.apply(serviceInstance);\næ¥ç€çœ‹applyæ–¹æ³•ï¼Œå‘ç°å®ƒæ˜¯LoadBalancerRequestæ¥å£çš„æ–¹æ³•ï¼Œè¯¥æ¥å£å´æ²¡æœ‰å…·ä½“çš„å®ç°ç±»ï¼š\n\n\n```text\npublic interface LoadBalancerRequest<T> {\n\n\tT apply(ServiceInstance instance) throws Exception;\n\n}\n\n```\n\n\næ€è·¯å›æº¯ï¼Œæ˜¯requestå¯¹è±¡è°ƒç”¨çš„applyæ–¹æ³•ï¼Œè€Œrequestå…¶å®æ˜¯executeæ–¹æ³•ä¼ è¿›æ¥çš„å‚æ•°ï¼Œè¿½æº¯åˆ°æºå¤´ï¼Œå‘ç°æ˜¯LoadBalancerInterceptorç±»çš„interceptæ–¹æ³•é‡Œthis.requestFactory.createRequest(request, body, execution)ç”Ÿæˆäº†LoadBalancerRequestï¼Œç„¶åä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä¹‹åå†è°ƒç”¨äº†applyæ–¹æ³•\n\n\n```text\n@Override\n\tpublic ClientHttpResponse intercept(final HttpRequest request, final byte[] body,\n\t\t\tfinal ClientHttpRequestExecution execution) throws IOException {\n\t\tfinal URI originalUri = request.getURI();\n\t\tString serviceName = originalUri.getHost();\n\t\tAssert.state(serviceName != null,\n\t\t\t\t\"Request URI does not contain a valid hostname: \" + originalUri);\n\t\treturn this.loadBalancer.execute(serviceName,\n\t\t\t\tthis.requestFactory.createRequest(request, body, execution));\n\t}\n\n```\n\n\nè·Ÿè¿›createRequestæ–¹æ³•é‡Œï¼š\n\n\n![](https://img-blog.csdnimg.cn/20191108143112594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODEwNjMyMg==,size_16,color_FFFFFF,t_70)\n\n\nå¯ä»¥ä»å›¾ä¸­çœ‹åˆ°ï¼Œç»è¿‡ä¸€äº›æ“ä½œåï¼Œç”Ÿæˆçš„serviceRequestå¯¹è±¡é‡Œçš„serviceIdæ˜¯eureka-clientï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„æœåŠ¡èŠ‚ç‚¹åï¼Œè€Œserveræ˜¯localhost:8763ï¼Œè¿™æ˜¯å…·ä½“çš„æœåŠ¡èŠ‚ç‚¹ipï¼Œä¹‹åä½œä¸ºå‚æ•°è°ƒç”¨org.springframework.http.clientåŒ…ä¸‹çš„InterceptingClientHttpRequestç±»ä¸­çš„executeæ–¹æ³•æ–­ç‚¹è¿›å…¥è¯¥æ–¹æ³•ï¼š\n\n\n![](https://img-blog.csdnimg.cn/20191108145133749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODEwNjMyMg==,size_16,color_FFFFFF,t_70)\n\n\nå¯ä»¥çœ‹å‡ºé€šè¿‡requestFactory.createRequest(request.getURI(), method)æ–¹æ³•ç”Ÿæˆäº†ClientHttpRequestç±»çš„å®ä¾‹delegateï¼Œå®ƒçš„urlå°±æ˜¯æˆ‘ä»¬æœ€åçœŸæ­£è¦è¯·æ±‚çš„ï¼Œæœ€åæ­£å¸¸è°ƒç”¨delegate.execute()æ–¹æ³•å–å¾—è¿”å›ClientHttpResponseå°±å¥½äº†ã€‚\n\n\nè€Œè¿™é‡Œäº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼Œurlæ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿé‡æ–°å‘èµ·è¯·æ±‚æ–­ç‚¹è¯•ä¸‹\nå‘ç°å…³é”®åœ¨LoadBalancerRequestFactoryç±»ä¸­çš„createRequestæ–¹æ³•ä¸­çš„è¿™å¥ï¼š\n\n\n```text\nHttpRequest serviceRequest = new ServiceRequestWrapper(request, instance,his.loadBalancer);\n\n```\n\n\nè·Ÿè¿›ServiceRequestWrapperç±»ä¸­ï¼Œå‘ç°å®ƒç»§æ‰¿äº†HttpRequestWrapper ç±»ï¼ŒåŒæ—¶é‡å†™äº†getURIæ–¹æ³•\n\n\n```text\npublic class ServiceRequestWrapper extends HttpRequestWrapper {\n\n\tprivate final ServiceInstance instance;\n\n\tprivate final LoadBalancerClient loadBalancer;\n\n\tpublic ServiceRequestWrapper(HttpRequest request, ServiceInstance instance,\n\t\t\tLoadBalancerClient loadBalancer) {\n\t\tsuper(request);\n\t\tthis.instance = instance;\n\t\tthis.loadBalancer = loadBalancer;\n\t}\n\n\t@Override\n\tpublic URI getURI() {\n\t\tURI uri = this.loadBalancer.reconstructURI(this.instance, getRequest().getURI());\n\t\treturn uri;\n\t}\n\n}\n\n```\n\n\næ–­ç‚¹æ‰“åœ¨getURIæ–¹æ³•é‡Œï¼š\n\n\n![](https://img-blog.csdnimg.cn/201911081504477.png)\n\n\nå¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•è¿”å›äº†æˆ‘ä»¬æœ€åéœ€è¦çš„urlã€‚\n\n\næœ€åï¼Œå…³äºRibbonæ˜¯å¦‚ä½•é€šè¿‡ä¸€ä¸ª@LoadBalancedæ³¨è§£å°±å®ç°è´Ÿè½½å‡è¡¡çš„åˆ†æå°±åˆ°è¿™äº†ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šç–æ¼çš„åœ°æ–¹ï¼Œä½†æ˜¯å¤§è‡´çš„é€»è¾‘å°±æ˜¯è¿™æ ·çš„äº†ï¼Œè¿˜æœ‰ä¸€äº›æ›´æ·±å±‚çš„æ¯”å¦‚å¦‚ä½•æ ¹æ®ç­–ç•¥é€‰å‡ºå½“å‰æä¾›æœåŠ¡çš„èŠ‚ç‚¹ç­‰ï¼Œç•™å¾…åç»­è¡¥å……ï¼Œæ¥æ—¥æ–¹é•¿~\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2021-08-27",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "20",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "å¾®æœåŠ¡",
          "åˆ†å¸ƒå¼",
          "Redis"
        ],
        "summary": "åœ¨SpringCloudä½“ç³»ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æœåŠ¡ä¹‹é—´çš„è°ƒç”¨æ˜¯é€šè¿‡httpåè®®è¿›è¡Œè°ƒç”¨çš„ã€‚è€Œæ³¨å†Œä¸­å¿ƒçš„ä¸»è¦ç›®çš„å°±æ˜¯ç»´æŠ¤è¿™äº›æœåŠ¡çš„æœåŠ¡åˆ—è¡¨ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Springä¸­ï¼Œæä¾›äº†RestTemplateã€‚RestTemplateæ˜¯Springæä¾›çš„ç”¨äºè®¿é—®RestæœåŠ¡çš„å®¢æˆ·ç«¯ã€‚è€Œåœ¨SpringCloudä¸­ä¹Ÿæ˜¯ä½¿ç”¨æ­¤æœåŠ¡è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„ã€‚",
        "sort": "",
        "title": "RestTemplateä¸OpenFeign",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "44263dbd-e5d6-4365-a72e-b0ff92bd0220"
        }
      ],
      "body": "",
      "realName": "RestTemplateä¸OpenFeign",
      "relativePath": "/archives/RestTemplateä¸OpenFeign.md"
    },
    {
      "id": "747841e4-eeac-4349-88b0-63fc6421cf0c",
      "doc_id": "747841e4-eeac-4349-88b0-63fc6421cf0c",
      "title": "747841e4-eeac-4349-88b0-63fc6421cf0c",
      "updated": 1696747320000,
      "body_original": "\n### synchronized\n\n\n**`synchronized`** **å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œ****`synchronized`****å…³é”®å­—å¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚**\n\n\nå¦å¤–ï¼Œåœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ`synchronized` å±äº **é‡é‡çº§é”**ï¼Œæ•ˆç‡ä½ä¸‹ã€‚\n\n\n**ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ**\n\n\nå› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ `Mutex Lock` æ¥å®ç°çš„ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚\n\n\nåº†å¹¸çš„æ˜¯åœ¨ Java 6 ä¹‹å Java å®˜æ–¹å¯¹ä» JVM å±‚é¢å¯¹ `synchronized` è¾ƒå¤§ä¼˜åŒ–ï¼Œæ‰€ä»¥ç°åœ¨çš„ `synchronized` é”æ•ˆç‡ä¹Ÿä¼˜åŒ–å¾—å¾ˆä¸é”™äº†ã€‚JDK1.6 å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚\n\n\næ‰€ä»¥ï¼Œä½ ä¼šå‘ç°ç›®å‰çš„è¯ï¼Œä¸è®ºæ˜¯å„ç§å¼€æºæ¡†æ¶è¿˜æ˜¯ JDK æºç éƒ½å¤§é‡ä½¿ç”¨äº† `synchronized` å…³é”®å­—ã€‚\n\n\n### ä½¿ç”¨æ–¹å¼\n\n\n**synchronized å…³é”®å­—æœ€ä¸»è¦çš„ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š**\n\n\n**1.ä¿®é¥°å®ä¾‹æ–¹æ³•:** ä½œç”¨äºå½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— **å½“å‰å¯¹è±¡å®ä¾‹çš„é”**\n\n\n```text\nsynchronized void method() {\n  //ä¸šåŠ¡ä»£ç \n}Copy to clipboardErrorCopied\n\n```\n\n\n**2.ä¿®é¥°é™æ€æ–¹æ³•:** ä¹Ÿå°±æ˜¯ç»™å½“å‰ç±»åŠ é”ï¼Œä¼šä½œç”¨äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— **å½“å‰ class çš„é”**ã€‚å› ä¸ºé™æ€æˆå‘˜ä¸å±äºä»»ä½•ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯ç±»æˆå‘˜ï¼ˆ _static è¡¨æ˜è¿™æ˜¯è¯¥ç±»çš„ä¸€ä¸ªé™æ€èµ„æºï¼Œä¸ç®¡ new äº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œåªæœ‰ä¸€ä»½_ï¼‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹ A è°ƒç”¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„éé™æ€ `synchronized` æ–¹æ³•ï¼Œè€Œçº¿ç¨‹ B éœ€è¦è°ƒç”¨è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±ç±»çš„é™æ€ `synchronized` æ–¹æ³•ï¼Œæ˜¯å…è®¸çš„ï¼Œä¸ä¼šå‘ç”Ÿäº’æ–¥ç°è±¡ï¼Œ**å› ä¸ºè®¿é—®é™æ€** **`synchronized`** **æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰ç±»çš„é”ï¼Œè€Œè®¿é—®éé™æ€** **`synchronized`** **æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡é”**ã€‚\n\n\n```text\nsynchronized void staic method() {\n  //ä¸šåŠ¡ä»£ç \n}Copy to clipboardErrorCopied\n\n```\n\n\n**3.ä¿®é¥°ä»£ç å—** ï¼šæŒ‡å®šåŠ é”å¯¹è±¡ï¼Œå¯¹ç»™å®šå¯¹è±¡/ç±»åŠ é”ã€‚`synchronized(this|object)` è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾—**ç»™å®šå¯¹è±¡çš„é”**ã€‚`synchronized(ç±».class)` è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— **å½“å‰ class çš„é”**\n\n\n```text\nsynchronized(this) {\n  //ä¸šåŠ¡ä»£ç \n}Copy to clipboardErrorCopied\n\n```\n\n\n**æ€»ç»“ï¼š**\n\n- `synchronized` å…³é”®å­—åŠ åˆ° `static` é™æ€æ–¹æ³•å’Œ `synchronized(class)` ä»£ç å—ä¸Šéƒ½æ˜¯æ˜¯ç»™ Class ç±»ä¸Šé”ã€‚\n- `synchronized` å…³é”®å­—åŠ åˆ°å®ä¾‹æ–¹æ³•ä¸Šæ˜¯ç»™å¯¹è±¡å®ä¾‹ä¸Šé”ã€‚\n- å°½é‡ä¸è¦ä½¿ç”¨ `synchronized(String a)` å› ä¸º JVM ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å…·æœ‰ç¼“å­˜åŠŸèƒ½ï¼\n\nä¸‹é¢æˆ‘ä»¥ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ä¸ºä¾‹è®²è§£ä¸€ä¸‹ `synchronized` å…³é”®å­—çš„å…·ä½“ä½¿ç”¨ã€‚\n\n\né¢è¯•ä¸­é¢è¯•å®˜ç»å¸¸ä¼šè¯´ï¼šâ€œå•ä¾‹æ¨¡å¼äº†è§£å—ï¼Ÿæ¥ç»™æˆ‘æ‰‹å†™ä¸€ä¸‹ï¼ç»™æˆ‘è§£é‡Šä¸€ä¸‹åŒé‡æ£€éªŒé”æ–¹å¼å®ç°å•ä¾‹æ¨¡å¼çš„åŸç†å‘—ï¼â€\n\n\n**åŒé‡æ ¡éªŒé”å®ç°å¯¹è±¡å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰**\n\n\n```text\npublic class Singleton {\n\n    private volatile static Singleton uniqueInstance;\n\n    private Singleton() {\n    }\n\n    public  static Singleton getUniqueInstance() {\n       //å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç \n        if (uniqueInstance == null) {\n            //ç±»å¯¹è±¡åŠ é”\n            synchronized (Singleton.class) {\n                if (uniqueInstance == null) {\n                    uniqueInstance = new Singleton();\n                }\n            }\n        }\n        return uniqueInstance;\n    }\n}Copy to clipboardErrorCopied\n\n```\n\n\nå¦å¤–ï¼Œéœ€è¦æ³¨æ„ `uniqueInstance` é‡‡ç”¨ `volatile` å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦ã€‚\n\n\n`uniqueInstance` é‡‡ç”¨ `volatile` å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ `uniqueInstance = new Singleton();` è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š\n\n1. ä¸º `uniqueInstance` åˆ†é…å†…å­˜ç©ºé—´\n2. åˆå§‹åŒ– `uniqueInstance`\n3. å°† `uniqueInstance` æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€\n\nä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1->3->2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ `getUniqueInstance`() åå‘ç° `uniqueInstance` ä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å› `uniqueInstance`ï¼Œä½†æ­¤æ—¶ `uniqueInstance` è¿˜æœªè¢«åˆå§‹åŒ–ã€‚\n\n\nä½¿ç”¨ `volatile` å¯ä»¥ç¦æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚\n\n\n### åº•å±‚åŸç†\n\n\n**synchronized å…³é”®å­—åº•å±‚åŸç†å±äº JVM å±‚é¢ã€‚**\n\n\n**`ä»£ç å—`**\n\n\n```text\npublic class SynchronizedDemo {\n    public void method() {\n        synchronized (this) {\n            System.out.println(\"synchronized ä»£ç å—\");\n        }\n    }\n}\n\n```\n\n\né€šè¿‡ JDK è‡ªå¸¦çš„ `javap` å‘½ä»¤æŸ¥çœ‹ `SynchronizedDemo` ç±»çš„ç›¸å…³å­—èŠ‚ç ä¿¡æ¯ï¼šé¦–å…ˆåˆ‡æ¢åˆ°ç±»çš„å¯¹åº”ç›®å½•æ‰§è¡Œ `javac SynchronizedDemo.java` å‘½ä»¤ç”Ÿæˆç¼–è¯‘åçš„ .class æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ`javap -c -s -v -l SynchronizedDemo.class`ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203508.png)\n\n\nä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š\n\n\n**`synchronized`** **åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯** **`monitorenter`** **å’Œ** **`monitorexit`** **æŒ‡ä»¤ï¼Œå…¶ä¸­** **`monitorenter`** **æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œ****`monitorexit`** **æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚**\n\n\nå½“æ‰§è¡Œ `monitorenter` æŒ‡ä»¤æ—¶ï¼Œçº¿ç¨‹è¯•å›¾è·å–é”ä¹Ÿå°±æ˜¯è·å– **å¯¹è±¡ç›‘è§†å™¨** **`monitor`** çš„æŒæœ‰æƒã€‚\n\n\n> åœ¨ Java è™šæ‹Ÿæœº(HotSpot)ä¸­ï¼ŒMonitor æ˜¯åŸºäº C++å®ç°çš„ï¼Œç”±ObjectMonitorå®ç°çš„ã€‚æ¯ä¸ªå¯¹è±¡ä¸­éƒ½å†…ç½®äº†ä¸€ä¸ª ObjectMonitorå¯¹è±¡ã€‚\n\n\n\tå¦å¤–ï¼Œ**`wait/notify`****ç­‰æ–¹æ³•ä¹Ÿä¾èµ–äº****`monitor`****å¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåªæœ‰åœ¨åŒæ­¥çš„å—æˆ–è€…æ–¹æ³•ä¸­æ‰èƒ½è°ƒç”¨****`wait/notify`****ç­‰æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡º****`java.lang.IllegalMonitorStateException`****çš„å¼‚å¸¸çš„åŸå› ã€‚**\n\n\nåœ¨æ‰§è¡Œ`monitorenter`æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡çš„é”ï¼Œå¦‚æœé”çš„è®¡æ•°å™¨ä¸º 0 åˆ™è¡¨ç¤ºé”å¯ä»¥è¢«è·å–ï¼Œè·å–åå°†é”è®¡æ•°å™¨è®¾ä¸º 1 ä¹Ÿå°±æ˜¯åŠ  1ã€‚\n\n\nåœ¨æ‰§è¡Œ `monitorexit` æŒ‡ä»¤åï¼Œå°†é”è®¡æ•°å™¨è®¾ä¸º 0ï¼Œè¡¨æ˜é”è¢«é‡Šæ”¾ã€‚å¦‚æœè·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£å½“å‰çº¿ç¨‹å°±è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°é”è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚\n\n\n**ä¿®é¥°æ–¹æ³•**\n\n\n```text\npublic class SynchronizedDemo2 {\n    public synchronized void method() {\n        System.out.println(\"synchronized æ–¹æ³•\");\n    }\n}\nCopy to clipboardErrorCopied\n\n```\n\n\n![](https://blog-file.hehouhui.cn/202203222128189.png)\n\n\n`synchronized` ä¿®é¥°çš„æ–¹æ³•å¹¶æ²¡æœ‰ `monitorenter` æŒ‡ä»¤å’Œ `monitorexit` æŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„ç¡®å®æ˜¯ `ACC_SYNCHRONIZED` æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€‚JVM é€šè¿‡è¯¥ `ACC_SYNCHRONIZED` è®¿é—®æ ‡å¿—æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚\n\n\n### é”\n\n\n### ä¹è§‚é”å’Œæ‚²è§‚é”\n\n\n> ä¹è§‚é”å¯¹åº”äºç”Ÿæ´»ä¸­ä¹è§‚çš„äººæ€»æ˜¯æƒ³ç€äº‹æƒ…å¾€å¥½çš„æ–¹å‘å‘å±•ï¼Œæ‚²è§‚é”å¯¹åº”äºç”Ÿæ´»ä¸­æ‚²è§‚çš„äººæ€»æ˜¯æƒ³ç€äº‹æƒ…å¾€åçš„æ–¹å‘å‘å±•ã€‚è¿™ä¸¤ç§äººå„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸èƒ½ä¸ä»¥åœºæ™¯è€Œå®šè¯´ä¸€ç§äººå¥½äºå¦å¤–ä¸€ç§äººã€‚\n\n\n**æ‚²è§‚é”**\n\n\n> æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚Javaä¸­synchronizedå’ŒReentrantLockç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚\n\n\n**ä¹è§‚é”**\n\n\n> æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®ç°ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äºwrite_conditionæœºåˆ¶ï¼Œå…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚åœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CASå®ç°çš„ã€‚\n\n\n### ä½¿ç”¨åœºæ™¯\n\n\nä»ä¸Šé¢å¯¹ä¸¤ç§é”çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ä¸¤ç§é”å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸å¯è®¤ä¸ºä¸€ç§å¥½äºå¦ä¸€ç§ï¼Œåƒ**ä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼‰**ï¼Œå³å†²çªçœŸçš„å¾ˆå°‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™æ ·å¯ä»¥çœå»äº†é”çš„å¼€é”€ï¼ŒåŠ å¤§äº†ç³»ç»Ÿçš„æ•´ä¸ªååé‡ã€‚ä½†å¦‚æœæ˜¯å¤šå†™çš„æƒ…å†µï¼Œä¸€èˆ¬ä¼šç»å¸¸äº§ç”Ÿå†²çªï¼Œè¿™å°±ä¼šå¯¼è‡´ä¸Šå±‚åº”ç”¨ä¼šä¸æ–­çš„è¿›è¡Œretryï¼Œè¿™æ ·åå€’æ˜¯é™ä½äº†æ€§èƒ½ï¼Œæ‰€ä»¥**ä¸€èˆ¬å¤šå†™çš„åœºæ™¯ä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚**\n\n\n### ä¹è§‚é”\n\n\n### ç‰ˆæœ¬å·æœºåˆ¶\n\n\nä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å·versionå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œversionå€¼ä¼šåŠ ä¸€ã€‚å½“çº¿ç¨‹Aè¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å–versionå€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„versionå€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„versionå€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚\n\n\n**ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š** å‡è®¾æ•°æ®åº“ä¸­å¸æˆ·ä¿¡æ¯è¡¨ä¸­æœ‰ä¸€ä¸ª version å­—æ®µï¼Œå½“å‰å€¼ä¸º 1 ï¼›è€Œå½“å‰å¸æˆ·ä½™é¢å­—æ®µï¼ˆ balance ï¼‰ä¸º $100 ã€‚\n\n1. æ“ä½œå‘˜ A æ­¤æ—¶å°†å…¶è¯»å‡ºï¼ˆ version=1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ $50ï¼ˆ $100-$50 ï¼‰ã€‚\n2. åœ¨æ“ä½œå‘˜ A æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæ“ä½œå‘˜B ä¹Ÿè¯»å…¥æ­¤ç”¨æˆ·ä¿¡æ¯ï¼ˆ version=1 ï¼‰ï¼Œå¹¶ä»å…¶å¸æˆ·ä½™é¢ä¸­æ‰£é™¤ $20 ï¼ˆ $100-$20 ï¼‰ã€‚\n3. æ“ä½œå‘˜ A å®Œæˆäº†ä¿®æ”¹å·¥ä½œï¼Œå°†æ•°æ®ç‰ˆæœ¬å·ï¼ˆ version=1 ï¼‰ï¼Œè¿åŒå¸æˆ·æ‰£é™¤åä½™é¢ï¼ˆ balance=$50 ï¼‰ï¼Œæäº¤è‡³æ•°æ®åº“æ›´æ–°ï¼Œæ­¤æ—¶ç”±äºæäº¤æ•°æ®ç‰ˆæœ¬ç­‰äºæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ï¼Œæ•°æ®è¢«æ›´æ–°ï¼Œæ•°æ®åº“è®°å½• version æ›´æ–°ä¸º 2 ã€‚\n4. æ“ä½œå‘˜ B å®Œæˆäº†æ“ä½œï¼Œä¹Ÿå°†ç‰ˆæœ¬å·ï¼ˆ version=1 ï¼‰è¯•å›¾å‘æ•°æ®åº“æäº¤æ•°æ®ï¼ˆ balance=$80 ï¼‰ï¼Œä½†æ­¤æ—¶æ¯”å¯¹æ•°æ®åº“è®°å½•ç‰ˆæœ¬æ—¶å‘ç°ï¼Œæ“ä½œå‘˜ B æäº¤çš„æ•°æ®ç‰ˆæœ¬å·ä¸º 1 ï¼Œæ•°æ®åº“è®°å½•å½“å‰ç‰ˆæœ¬ä¹Ÿä¸º 2 ï¼Œä¸æ»¡è¶³ â€œ æäº¤ç‰ˆæœ¬å¿…é¡»ç­‰äºå½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–° â€œ çš„ä¹è§‚é”ç­–ç•¥ï¼Œå› æ­¤ï¼Œæ“ä½œå‘˜ B çš„æäº¤è¢«é©³å›ã€‚\n\nè¿™æ ·ï¼Œå°±é¿å…äº†æ“ä½œå‘˜ B ç”¨åŸºäº version=1 çš„æ—§æ•°æ®ä¿®æ”¹çš„ç»“æœè¦†ç›–æ“ä½œå‘˜A çš„æ“ä½œç»“æœçš„å¯èƒ½\n\n\n### CASç®—æ³•\n\n\nå³**compare and swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰**ï¼Œæ˜¯ä¸€ç§æœ‰åçš„**æ— é”ç®—æ³•**ã€‚æ— é”ç¼–ç¨‹ï¼Œå³ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡çš„æƒ…å†µä¸‹å®ç°å˜é‡çš„åŒæ­¥ï¼Œæ‰€ä»¥ä¹Ÿå«éé˜»å¡åŒæ­¥ï¼ˆNon-blocking Synchronizationï¼‰ã€‚**CASç®—æ³•**æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°\n\n- éœ€è¦è¯»å†™çš„å†…å­˜å€¼ V\n- è¿›è¡Œæ¯”è¾ƒçš„å€¼ A\n- æ‹Ÿå†™å…¥çš„æ–°å€¼ B\n\nå½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº Aæ—¶ï¼ŒCASé€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼Bæ¥æ›´æ–°Vçš„å€¼ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼ˆæ¯”è¾ƒå’Œæ›¿æ¢æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ª**è‡ªæ—‹æ“ä½œ**ï¼Œå³**ä¸æ–­çš„é‡è¯•**ã€‚\n\n\nå…³äºè‡ªæ—‹é”ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œéå¸¸ä¸é”™ï¼š[ã€Š é¢è¯•å¿…å¤‡ä¹‹æ·±å…¥ç†è§£è‡ªæ—‹é”ã€‹](https://blog.csdn.net/qq_34337272/article/details/81252853)\n\n\n### ç¼ºç‚¹\n\n\n> ABA é—®é¢˜æ˜¯ä¹è§‚é”ä¸€ä¸ªå¸¸è§çš„é—®é¢˜\n\n\n### ABA é—®é¢˜\n\n\nå¦‚æœä¸€ä¸ªå˜é‡Våˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯Aå€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯Aå€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å›Aï¼Œé‚£CASæ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸ºCASæ“ä½œçš„ **\"ABA\"é—®é¢˜ã€‚**\n\n\nJDK 1.5 ä»¥åçš„ `AtomicStampedReference ç±»`å°±æä¾›äº†æ­¤ç§èƒ½åŠ›ï¼Œå…¶ä¸­çš„ `compareAndSet æ–¹æ³•`å°±æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚\n\n\n### å¼€é”€å¤§\n\n\n**è‡ªæ—‹CASï¼ˆä¹Ÿå°±æ˜¯ä¸æˆåŠŸå°±ä¸€ç›´å¾ªç¯æ‰§è¡Œç›´åˆ°æˆåŠŸï¼‰å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚** å¦‚æœJVMèƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„pauseæŒ‡ä»¤é‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ï¼ŒpauseæŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œç¬¬ä¸€å®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼ˆde-pipelineï¼‰,ä½¿CPUä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ã€‚ç¬¬äºŒå®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªï¼ˆmemory order violationï¼‰è€Œå¼•èµ·CPUæµæ°´çº¿è¢«æ¸…ç©ºï¼ˆCPU pipeline flushï¼‰ï¼Œä»è€Œæé«˜CPUçš„æ‰§è¡Œæ•ˆç‡ã€‚\n\n\n### åªèƒ½ä¸€ä¸ªå˜é‡åŸå­æ“ä½œ\n\n\nCAS åªå¯¹å•ä¸ªå…±äº«å˜é‡æœ‰æ•ˆï¼Œå½“æ“ä½œæ¶‰åŠè·¨å¤šä¸ªå…±äº«å˜é‡æ—¶ CAS æ— æ•ˆã€‚ä½†æ˜¯ä» JDK 1.5å¼€å§‹ï¼Œæä¾›äº†`AtomicReferenceç±»`æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œ.æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é”æˆ–è€…åˆ©ç”¨`AtomicReferenceç±»`æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚\n\n\nCASä¸`synchronized`çš„ä½¿ç”¨æƒ…æ™¯\n\n\n> ç®€å•çš„æ¥è¯´CASé€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼Œå†²çªä¸€èˆ¬è¾ƒå°‘ï¼‰ï¼Œsynchronizedé€‚ç”¨äºå†™æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼ˆå¤šå†™åœºæ™¯ï¼Œå†²çªä¸€èˆ¬è¾ƒå¤šï¼‰\n\n1. å¯¹äºèµ„æºç«äº‰è¾ƒå°‘ï¼ˆçº¿ç¨‹å†²çªè¾ƒè½»ï¼‰çš„æƒ…å†µï¼Œä½¿ç”¨`synchronized`åŒæ­¥é”è¿›è¡Œçº¿ç¨‹é˜»å¡å’Œå”¤é†’åˆ‡æ¢ä»¥åŠç”¨æˆ·æ€å†…æ ¸æ€é—´çš„åˆ‡æ¢æ“ä½œé¢å¤–æµªè´¹æ¶ˆè€—cpuèµ„æºï¼›è€ŒCASåŸºäºç¡¬ä»¶å®ç°ï¼Œä¸éœ€è¦è¿›å…¥å†…æ ¸ï¼Œä¸éœ€è¦åˆ‡æ¢çº¿ç¨‹ï¼Œæ“ä½œè‡ªæ—‹å‡ ç‡è¾ƒå°‘ï¼Œå› æ­¤å¯ä»¥è·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚\n2. å¯¹äºèµ„æºç«äº‰ä¸¥é‡ï¼ˆçº¿ç¨‹å†²çªä¸¥é‡ï¼‰çš„æƒ…å†µï¼ŒCASè‡ªæ—‹çš„æ¦‚ç‡ä¼šæ¯”è¾ƒå¤§ï¼Œä»è€Œæµªè´¹æ›´å¤šçš„CPUèµ„æºï¼Œæ•ˆç‡ä½äºsynchronizedã€‚\n\nè¡¥å……ï¼š Javaå¹¶å‘ç¼–ç¨‹è¿™ä¸ªé¢†åŸŸä¸­`synchronized`å…³é”®å­—ä¸€ç›´éƒ½æ˜¯å…ƒè€çº§çš„è§’è‰²ï¼Œå¾ˆä¹…ä¹‹å‰å¾ˆå¤šäººéƒ½ä¼šç§°å®ƒä¸º **â€œé‡é‡çº§é”â€** ã€‚ä½†æ˜¯ï¼Œåœ¨JavaSE 1.6ä¹‹åè¿›è¡Œäº†ä¸»è¦åŒ…æ‹¬ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—è€Œå¼•å…¥çš„ **åå‘é”** å’Œ **è½»é‡çº§é”** ä»¥åŠå…¶å®ƒ**å„ç§ä¼˜åŒ–**ä¹‹åå˜å¾—åœ¨æŸäº›æƒ…å†µä¸‹å¹¶ä¸æ˜¯é‚£ä¹ˆé‡äº†ã€‚`synchronized`çš„åº•å±‚å®ç°ä¸»è¦ä¾é  **Lock-Free** çš„é˜Ÿåˆ—ï¼ŒåŸºæœ¬æ€è·¯æ˜¯ **è‡ªæ—‹åé˜»å¡**ï¼Œ**ç«äº‰åˆ‡æ¢åç»§ç»­ç«äº‰é”**ï¼Œ**ç¨å¾®ç‰ºç‰²äº†å…¬å¹³æ€§ï¼Œä½†è·å¾—äº†é«˜ååé‡**ã€‚åœ¨çº¿ç¨‹å†²çªè¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è·å¾—å’ŒCASç±»ä¼¼çš„æ€§èƒ½ï¼›è€Œçº¿ç¨‹å†²çªä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½è¿œé«˜äºCASã€‚\n\n\n### æ­»é”\n\n\nçº¿ç¨‹æ­»é”æè¿°çš„æ˜¯è¿™æ ·ä¸€ç§æƒ…å†µï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«é˜»å¡ï¼Œå®ƒä»¬ä¸­çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨éƒ½åœ¨ç­‰å¾…æŸä¸ªèµ„æºè¢«é‡Šæ”¾ã€‚ç”±äºçº¿ç¨‹è¢«æ— é™æœŸåœ°é˜»å¡ï¼Œå› æ­¤ç¨‹åºä¸å¯èƒ½æ­£å¸¸ç»ˆæ­¢ã€‚\n\n\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¿ç¨‹ A æŒæœ‰èµ„æº 2ï¼Œçº¿ç¨‹ B æŒæœ‰èµ„æº 1ï¼Œä»–ä»¬åŒæ—¶éƒ½æƒ³ç”³è¯·å¯¹æ–¹çš„èµ„æºï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šäº’ç›¸ç­‰å¾…è€Œè¿›å…¥æ­»é”çŠ¶æ€ã€‚\n\n\n![](https://blog-file.hehouhui.cn/202203222203695.png)\n\n\nçº¿ç¨‹ A é€šè¿‡ synchronized (resource1) è·å¾— resource1 çš„ç›‘è§†å™¨é”ï¼Œç„¶åé€šè¿‡`Thread.sleep(1000);`è®©çº¿ç¨‹ A ä¼‘çœ  1s ä¸ºçš„æ˜¯è®©çº¿ç¨‹ B å¾—åˆ°æ‰§è¡Œç„¶åè·å–åˆ° resource2 çš„ç›‘è§†å™¨é”ã€‚çº¿ç¨‹ A å’Œçº¿ç¨‹ B ä¼‘çœ ç»“æŸäº†éƒ½å¼€å§‹ä¼å›¾è¯·æ±‚è·å–å¯¹æ–¹çš„èµ„æºï¼Œç„¶åè¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šé™·å…¥äº’ç›¸ç­‰å¾…çš„çŠ¶æ€ï¼Œè¿™ä¹Ÿå°±äº§ç”Ÿäº†æ­»é”ã€‚ä¸Šé¢çš„ä¾‹å­ç¬¦åˆäº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ã€‚\n\n\nå­¦è¿‡æ“ä½œç³»ç»Ÿçš„æœ‹å‹éƒ½çŸ¥é“äº§ç”Ÿæ­»é”å¿…é¡»å…·å¤‡ä»¥ä¸‹`å››ä¸ªæ¡ä»¶`ï¼š\n\n1. äº’æ–¥æ¡ä»¶ï¼šè¯¥èµ„æºä»»æ„ä¸€ä¸ªæ—¶åˆ»åªç”±ä¸€ä¸ªçº¿ç¨‹å ç”¨ã€‚\n2. è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚\n3. ä¸å‰¥å¤ºæ¡ä»¶:çº¿ç¨‹å·²è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¼ºè¡Œå‰¥å¤ºï¼Œåªæœ‰è‡ªå·±ä½¿ç”¨å®Œæ¯•åæ‰é‡Šæ”¾èµ„æºã€‚\n4. å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚\n\n### å¦‚ä½•é¿å…æ­»é”\n\n\næˆ‘ä¸Šé¢è¯´äº†äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼Œä¸ºäº†é¿å…æ­»é”ï¼Œæˆ‘ä»¬åªè¦ç ´åäº§ç”Ÿæ­»é”çš„å››ä¸ªæ¡ä»¶ä¸­çš„å…¶ä¸­ä¸€ä¸ªå°±å¯ä»¥äº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥æŒ¨ä¸ªåˆ†æä¸€ä¸‹ï¼š\n\n1. **ç ´åäº’æ–¥æ¡ä»¶** ï¼šè¿™ä¸ªæ¡ä»¶æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç ´åï¼Œå› ä¸ºæˆ‘ä»¬ç”¨é”æœ¬æ¥å°±æ˜¯æƒ³è®©ä»–ä»¬äº’æ–¥çš„ï¼ˆä¸´ç•Œèµ„æºéœ€è¦äº’æ–¥è®¿é—®ï¼‰ã€‚\n2. **ç ´åè¯·æ±‚ä¸ä¿æŒæ¡ä»¶** ï¼šä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰çš„èµ„æºã€‚\n3. **ç ´åä¸å‰¥å¤ºæ¡ä»¶** ï¼šå ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æºã€‚\n4. **ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶** ï¼šé æŒ‰åºç”³è¯·èµ„æºæ¥é¢„é˜²ã€‚æŒ‰æŸä¸€é¡ºåºç”³è¯·èµ„æºï¼Œé‡Šæ”¾èµ„æºåˆ™ååºé‡Šæ”¾ã€‚ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ã€‚\n\n### AQS\n\n\n> AQS ï¼ŒAbstractQueuedSynchronizer ï¼Œå³é˜Ÿåˆ—åŒæ­¥å™¨ã€‚å®ƒæ˜¯æ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶ï¼ˆå¦‚ ReentrantLockã€ReentrantReadWriteLockã€Semaphore ç­‰ï¼‰ï¼ŒJ.U.C å¹¶å‘åŒ…çš„ä½œè€…ï¼ˆDoug Leaï¼‰æœŸæœ›å®ƒèƒ½å¤Ÿæˆä¸ºå®ç°å¤§éƒ¨åˆ†åŒæ­¥éœ€æ±‚çš„åŸºç¡€ã€‚\n\n\n> å®ƒæ˜¯ J.U.C å¹¶å‘åŒ…ä¸­çš„æ ¸å¿ƒåŸºç¡€ç»„ä»¶ã€‚  \n> åœ¨ä»‹ç» Lock ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†Ÿæ‚‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„ä»¶ï¼ŒæŒæ¡äº†è¯¥ç»„ä»¶ J.U.C åŒ…ä¸‹é¢å¾ˆå¤šé—®é¢˜éƒ½ä¸åœ¨æ˜¯é—®é¢˜äº†ã€‚è¯¥ç»„ä»¶å°±æ˜¯ AQS ã€‚\n\n\n**AQS æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ AQS æ˜¯ç”¨ CLH é˜Ÿåˆ—é”å®ç°çš„ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚**\n\n\n> CLH(Craig,Landin,and Hagersten)é˜Ÿåˆ—æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—ï¼ˆè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—å³ä¸å­˜åœ¨é˜Ÿåˆ—å®ä¾‹ï¼Œä»…å­˜åœ¨ç»“ç‚¹ä¹‹é—´çš„å…³è”å…³ç³»ï¼‰ã€‚AQS æ˜¯å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ª CLH é”é˜Ÿåˆ—çš„ä¸€ä¸ªç»“ç‚¹ï¼ˆNodeï¼‰æ¥å®ç°é”çš„åˆ†é…ã€‚\n\n\nçœ‹ä¸ª AQS(AbstractQueuedSynchronizer)åŸç†å›¾ï¼š\n\n\n![](https://blog-file.hehouhui.cn/image-1648381455274.png)\n\n\nAQS ä½¿ç”¨ä¸€ä¸ª int æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„ FIFO é˜Ÿåˆ—æ¥å®Œæˆè·å–èµ„æºçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚AQS ä½¿ç”¨ CAS å¯¹è¯¥åŒæ­¥çŠ¶æ€è¿›è¡ŒåŸå­æ“ä½œå®ç°å¯¹å…¶å€¼çš„ä¿®æ”¹ã€‚\n\n\n```text\nprivate volatile int state;//å…±äº«å˜é‡ï¼Œä½¿ç”¨volatileä¿®é¥°ä¿è¯çº¿ç¨‹å¯è§æ€§Copy to clipboardErrorCopied\n\n```\n\n\nçŠ¶æ€ä¿¡æ¯é€šè¿‡ protected ç±»å‹çš„`getState`ï¼Œ`setState`ï¼Œ`compareAndSetState`è¿›è¡Œæ“ä½œ\n\n\n```text\n//è¿”å›åŒæ­¥çŠ¶æ€çš„å½“å‰å€¼\nprotected final int getState() {\n        return state;\n}\n // è®¾ç½®åŒæ­¥çŠ¶æ€çš„å€¼\nprotected final void setState(int newState) {\n        state = newState;\n}\n//åŸå­åœ°ï¼ˆCASæ“ä½œï¼‰å°†åŒæ­¥çŠ¶æ€å€¼è®¾ç½®ä¸ºç»™å®šå€¼updateå¦‚æœå½“å‰åŒæ­¥çŠ¶æ€çš„å€¼ç­‰äºexpectï¼ˆæœŸæœ›å€¼ï¼‰\nprotected final boolean compareAndSetState(int expect, int update) {\n        return unsafe.compareAndSwapInt(this, stateOffset, expect, update);\n}\n\n```\n\n\n### ä¼˜åŠ¿\n\n\n> AQS è§£å†³äº†åœ¨å®ç°åŒæ­¥å™¨æ—¶æ¶‰åŠå½“çš„å¤§é‡ç»†èŠ‚é—®é¢˜ï¼Œä¾‹å¦‚è·å–åŒæ­¥çŠ¶æ€ã€FIFO åŒæ­¥é˜Ÿåˆ—ã€‚åŸºäº AQS æ¥æ„å»ºåŒæ­¥å™¨å¯ä»¥å¸¦æ¥å¾ˆå¤šå¥½å¤„ã€‚å®ƒä¸ä»…èƒ½å¤Ÿæå¤§åœ°å‡å°‘å®ç°å·¥ä½œï¼Œè€Œä¸”ä¹Ÿä¸å¿…å¤„ç†åœ¨å¤šä¸ªä½ç½®ä¸Šå‘ç”Ÿçš„ç«äº‰é—®é¢˜ã€‚\n\n\nåœ¨åŸºäº AQS æ„å»ºçš„åŒæ­¥å™¨ä¸­ï¼Œåªèƒ½åœ¨ä¸€ä¸ªæ—¶åˆ»å‘ç”Ÿé˜»å¡ï¼Œä»è€Œé™ä½ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œæé«˜äº†ååé‡ã€‚åŒæ—¶åœ¨è®¾è®¡ AQS æ—¶å……åˆ†è€ƒè™‘äº†å¯ä¼¸ç¼©æ€§ï¼Œå› æ­¤ J.U.C ä¸­ï¼Œæ‰€æœ‰åŸºäº AQS æ„å»ºçš„åŒæ­¥å™¨å‡å¯ä»¥è·å¾—è¿™ä¸ªä¼˜åŠ¿ã€‚\n\n\n### åŒæ­¥çŠ¶æ€\n\n\n> AQS çš„ä¸»è¦ä½¿ç”¨æ–¹å¼æ˜¯ç»§æ‰¿ï¼Œå­ç±»é€šè¿‡ç»§æ‰¿åŒæ­¥å™¨ï¼Œå¹¶å®ç°å®ƒçš„æŠ½è±¡æ–¹æ³•æ¥ç®¡ç†åŒæ­¥çŠ¶æ€ã€‚\n\n\nAQS ä½¿ç”¨ä¸€ä¸ª int ç±»å‹çš„æˆå‘˜å˜é‡ state æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼š\n\n\nå½“ state > 0 æ—¶ï¼Œè¡¨ç¤ºå·²ç»è·å–äº†é”ã€‚\nå½“ state = 0 æ—¶ï¼Œè¡¨ç¤ºé‡Šæ”¾äº†é”ã€‚\nå®ƒæä¾›äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œæ¥å¯¹åŒæ­¥çŠ¶æ€ state è¿›è¡Œæ“ä½œï¼Œå¹¶ä¸” AQS å¯ä»¥ç¡®ä¿å¯¹ state çš„æ“ä½œæ˜¯å®‰å…¨çš„ï¼š\n\n\ngetState()\nsetState(int newState)\ncompareAndSetState(int expect, int update)\n\n\n### åŒæ­¥é˜Ÿåˆ—\n\n\nAQS é€šè¿‡å†…ç½®çš„ FIFO åŒæ­¥é˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œï¼š\n\n\nå¦‚æœå½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼ˆé”ï¼‰æ—¶ï¼ŒAQS åˆ™ä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„é€ æˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰å¹¶å°†å…¶åŠ å…¥åŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¼šé˜»å¡å½“å‰çº¿ç¨‹\nå½“åŒæ­¥çŠ¶æ€é‡Šæ”¾æ—¶ï¼Œåˆ™ä¼šæŠŠèŠ‚ç‚¹ä¸­çš„çº¿ç¨‹å”¤é†’ï¼Œä½¿å…¶å†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚å¦‚å›¾ï¼š\n\n\nå®ƒç»´æŠ¤äº†ä¸€ä¸ªvolatile int stateï¼ˆä»£è¡¨å…±äº«èµ„æºï¼‰å’Œä¸€ä¸ªFIFOçº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ï¼ˆå¤šçº¿ç¨‹äº‰ç”¨èµ„æºè¢«é˜»å¡æ—¶ä¼šè¿›å…¥æ­¤é˜Ÿåˆ—ï¼‰ã€‚è¿™é‡Œvolatileæ˜¯æ ¸å¿ƒå…³é”®è¯ï¼Œå…·ä½“volatileçš„è¯­ä¹‰ï¼Œåœ¨æ­¤ä¸è¿°ã€‚stateçš„è®¿é—®æ–¹å¼æœ‰ä¸‰ç§ï¼ˆä¹Ÿå°± ç¬¬3ç‚¹ çš„ä¸‰ä¸ªæ–¹æ³•ï¼‰\n\n\ngetState()\nsetState(int newState)\ncompareAndSetState(int expect, int update)\n\n\n### ä¸»è¦å†…ç½®æ–¹æ³•\n\n\nAQS ä¸»è¦æä¾›äº†å¦‚ä¸‹æ–¹æ³•ï¼š\n\n\ngetState()ï¼šè¿”å›åŒæ­¥çŠ¶æ€çš„å½“å‰å€¼ã€‚\nsetState(int newState)ï¼šè®¾ç½®å½“å‰åŒæ­¥çŠ¶æ€ã€‚\ncompareAndSetState(int expect, int update)ï¼šä½¿ç”¨ CAS è®¾ç½®å½“å‰çŠ¶æ€ï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿä¿è¯çŠ¶æ€è®¾ç½®çš„åŸå­æ€§ã€‚\nã€å¯é‡å†™ã€‘#tryAcquire(int arg)ï¼šç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œè·å–åŒæ­¥çŠ¶æ€æˆåŠŸåï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…è¯¥çº¿ç¨‹é‡Šæ”¾åŒæ­¥çŠ¶æ€æ‰èƒ½è·å–åŒæ­¥çŠ¶æ€ã€‚\nã€å¯é‡å†™ã€‘#tryRelease(int arg)ï¼šç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ã€‚\n-ã€å¯é‡å†™ã€‘#tryAcquireShared(int arg)ï¼šå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œè¿”å›å€¼å¤§äºç­‰äº 0 ï¼Œåˆ™è¡¨ç¤ºè·å–æˆåŠŸï¼›å¦åˆ™ï¼Œè·å–å¤±è´¥ã€‚\nã€å¯é‡å†™ã€‘#tryReleaseShared(int arg)ï¼šå…±äº«å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ã€‚\nã€å¯é‡å†™ã€‘#isHeldExclusively()ï¼šå½“å‰åŒæ­¥å™¨æ˜¯å¦åœ¨ç‹¬å å¼æ¨¡å¼ä¸‹è¢«çº¿ç¨‹å ç”¨ï¼Œä¸€èˆ¬è¯¥æ–¹æ³•è¡¨ç¤ºæ˜¯å¦è¢«å½“å‰çº¿ç¨‹æ‰€ç‹¬å ã€‚\nacquire(int arg)ï¼šç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œåˆ™ç”±è¯¥æ–¹æ³•è¿”å›ï¼›å¦åˆ™ï¼Œå°†ä¼šè¿›å…¥åŒæ­¥é˜Ÿåˆ—ç­‰å¾…ã€‚è¯¥æ–¹æ³•å°†ä¼šè°ƒç”¨å¯é‡å†™çš„ #tryAcquire(int arg) æ–¹æ³•ï¼›\nacquireInterruptibly(int arg)ï¼šä¸ #acquire(int arg) ç›¸åŒï¼Œä½†æ˜¯è¯¥æ–¹æ³•å“åº”ä¸­æ–­ã€‚å½“å‰çº¿ç¨‹ä¸ºè·å–åˆ°åŒæ­¥çŠ¶æ€è€Œè¿›å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­ï¼Œåˆ™è¯¥æ–¹æ³•ä¼šæŠ›å‡ºInterruptedException å¼‚å¸¸å¹¶è¿”å›ã€‚\ntryAcquireNanos(int arg, long nanos)ï¼šè¶…æ—¶è·å–åŒæ­¥çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹åœ¨ nanos æ—¶é—´å†…æ²¡æœ‰è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œé‚£ä¹ˆå°†ä¼šè¿”å› false ï¼Œå·²ç»è·å–åˆ™è¿”å› true ã€‚\nacquireShared(int arg)ï¼šå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æœªè·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œå°†ä¼šè¿›å…¥åŒæ­¥é˜Ÿåˆ—ç­‰å¾…ï¼Œä¸ç‹¬å å¼çš„ä¸»è¦åŒºåˆ«æ˜¯åœ¨åŒä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼›\nacquireSharedInterruptibly(int arg)ï¼šå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œå“åº”ä¸­æ–­ã€‚\ntryAcquireSharedNanos(int arg, long nanosTimeout)ï¼šå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œå¢åŠ è¶…æ—¶é™åˆ¶ã€‚\nrelease(int arg)ï¼šç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€ä¹‹åï¼Œå°†åŒæ­¥é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åŒ…å«çš„çº¿ç¨‹å”¤é†’ã€‚\nreleaseShared(int arg)ï¼šå…±äº«å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ã€‚\n\n\n**ä»ä¸Šé¢çš„æ–¹æ³•çœ‹ä¸‹æ¥ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åˆ†æˆ 3 ç±»ï¼š**\n\n1. ç‹¬å å¼è·å–ä¸é‡Šæ”¾åŒæ­¥çŠ¶æ€\n2. å…±äº«å¼è·å–ä¸é‡Šæ”¾åŒæ­¥çŠ¶æ€\n3. æŸ¥è¯¢åŒæ­¥é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹æƒ…å†µ\n\n### èµ„æºçš„å…±äº«æ–¹å¼\n\n\n**AQS å®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼**\n\n\n**1)Exclusive**ï¼ˆç‹¬å ï¼‰\n\n\nåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ ReentrantLockã€‚åˆå¯åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”,ReentrantLock åŒæ—¶æ”¯æŒä¸¤ç§é”,ä¸‹é¢ä»¥ ReentrantLock å¯¹è¿™ä¸¤ç§é”çš„å®šä¹‰åšä»‹ç»ï¼š\n\n- å…¬å¹³é”ï¼šæŒ‰ç…§çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­çš„æ’é˜Ÿé¡ºåºï¼Œå…ˆåˆ°è€…å…ˆæ‹¿åˆ°é”\n- éå…¬å¹³é”ï¼šå½“çº¿ç¨‹è¦è·å–é”æ—¶ï¼Œå…ˆé€šè¿‡ä¸¤æ¬¡ CAS æ“ä½œå»æŠ¢é”ï¼Œå¦‚æœæ²¡æŠ¢åˆ°ï¼Œå½“å‰çº¿ç¨‹å†åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…å”¤é†’ã€‚\n\n> è¯´æ˜ï¼šä¸‹é¢è¿™éƒ¨åˆ†å…³äº ReentrantLock æºä»£ç å†…å®¹èŠ‚é€‰è‡ªï¼šhttps://www.javadoop.com/post/AbstractQueuedSynchronizer-2 ï¼Œè¿™æ˜¯ä¸€ç¯‡å¾ˆä¸é”™æ–‡ç« ï¼Œæ¨èé˜…è¯»ã€‚\n\n\n**ä¸‹é¢æ¥çœ‹ ReentrantLock ä¸­ç›¸å…³çš„æºä»£ç ï¼š**\n\n\nReentrantLock é»˜è®¤é‡‡ç”¨éå…¬å¹³é”ï¼Œå› ä¸ºè€ƒè™‘è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œé€šè¿‡ boolean æ¥å†³å®šæ˜¯å¦ç”¨å…¬å¹³é”ï¼ˆä¼ å…¥ true ç”¨å…¬å¹³é”ï¼‰ã€‚\n\n\n```text\n/** Synchronizer providing all implementation mechanics */\nprivate final Sync sync;\npublic ReentrantLock() {\n    // é»˜è®¤éå…¬å¹³é”\n    sync = new NonfairSync();\n}\npublic ReentrantLock(boolean fair) {\n    sync = fair ? new FairSync() : new NonfairSync();\n}Copy to clipboardErrorCopied\n\n```\n\n\nReentrantLock ä¸­å…¬å¹³é”çš„ `lock` æ–¹æ³•\n\n\n```text\nstatic final class FairSync extends Sync {\n    final void lock() {\n        acquire(1);\n    }\n    // AbstractQueuedSynchronizer.acquire(int arg)\n    public final void acquire(int arg) {\n        if (!tryAcquire(arg) &&\n            acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n            selfInterrupt();\n    }\n    protected final boolean tryAcquire(int acquires) {\n        final Thread current = Thread.currentThread();\n        int c = getState();\n        if (c == 0) {\n            // 1. å’Œéå…¬å¹³é”ç›¸æ¯”ï¼Œè¿™é‡Œå¤šäº†ä¸€ä¸ªåˆ¤æ–­ï¼šæ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…\n            if (!hasQueuedPredecessors() &&\n                compareAndSetState(0, acquires)) {\n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        }\n        else if (current == getExclusiveOwnerThread()) {\n            int nextc = c + acquires;\n            if (nextc < 0)\n                throw new Error(\"Maximum lock count exceeded\");\n            setState(nextc);\n            return true;\n        }\n        return false;\n    }\n}Copy to clipboardErrorCopied\n\n```\n\n\néå…¬å¹³é”çš„ lock æ–¹æ³•ï¼š\n\n\n```text\nstatic final class NonfairSync extends Sync {\n    final void lock() {\n        // 2. å’Œå…¬å¹³é”ç›¸æ¯”ï¼Œè¿™é‡Œä¼šç›´æ¥å…ˆè¿›è¡Œä¸€æ¬¡CASï¼ŒæˆåŠŸå°±è¿”å›äº†\n        if (compareAndSetState(0, 1))\n            setExclusiveOwnerThread(Thread.currentThread());\n        else\n            acquire(1);\n    }\n    // AbstractQueuedSynchronizer.acquire(int arg)\n    public final void acquire(int arg) {\n        if (!tryAcquire(arg) &&\n            acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n            selfInterrupt();\n    }\n    protected final boolean tryAcquire(int acquires) {\n        return nonfairTryAcquire(acquires);\n    }\n}\n/**\n * Performs non-fair tryLock.  tryAcquire is implemented in\n * subclasses, but both need nonfair try for trylock method.\n */\nfinal boolean nonfairTryAcquire(int acquires) {\n    final Thread current = Thread.currentThread();\n    int c = getState();\n    if (c == 0) {\n        // è¿™é‡Œæ²¡æœ‰å¯¹é˜»å¡é˜Ÿåˆ—è¿›è¡Œåˆ¤æ–­\n        if (compareAndSetState(0, acquires)) {\n            setExclusiveOwnerThread(current);\n            return true;\n        }\n    }\n    else if (current == getExclusiveOwnerThread()) {\n        int nextc = c + acquires;\n        if (nextc < 0) // overflow\n            throw new Error(\"Maximum lock count exceeded\");\n        setState(nextc);\n        return true;\n    }\n    return false;\n}Copy to clipboardErrorCopied\n\n```\n\n\næ€»ç»“ï¼šå…¬å¹³é”å’Œéå…¬å¹³é”åªæœ‰ä¸¤å¤„ä¸åŒï¼š\n\n1. éå…¬å¹³é”åœ¨è°ƒç”¨ lock åï¼Œé¦–å…ˆå°±ä¼šè°ƒç”¨ CAS è¿›è¡Œä¸€æ¬¡æŠ¢é”ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æ°å·§é”æ²¡æœ‰è¢«å ç”¨ï¼Œé‚£ä¹ˆç›´æ¥å°±è·å–åˆ°é”è¿”å›äº†ã€‚\n2. éå…¬å¹³é”åœ¨ CAS å¤±è´¥åï¼Œå’Œå…¬å¹³é”ä¸€æ ·éƒ½ä¼šè¿›å…¥åˆ° tryAcquire æ–¹æ³•ï¼Œåœ¨ tryAcquire æ–¹æ³•ä¸­ï¼Œå¦‚æœå‘ç°é”è¿™ä¸ªæ—¶å€™è¢«é‡Šæ”¾äº†ï¼ˆstate == 0ï¼‰ï¼Œéå…¬å¹³é”ä¼šç›´æ¥ CAS æŠ¢é”ï¼Œä½†æ˜¯å…¬å¹³é”ä¼šåˆ¤æ–­ç­‰å¾…é˜Ÿåˆ—æ˜¯å¦æœ‰çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¦‚æœæœ‰åˆ™ä¸å»æŠ¢é”ï¼Œä¹–ä¹–æ’åˆ°åé¢ã€‚\n\nå…¬å¹³é”å’Œéå…¬å¹³é”å°±è¿™ä¸¤ç‚¹åŒºåˆ«ï¼Œå¦‚æœè¿™ä¸¤æ¬¡ CAS éƒ½ä¸æˆåŠŸï¼Œé‚£ä¹ˆåé¢éå…¬å¹³é”å’Œå…¬å¹³é”æ˜¯ä¸€æ ·çš„ï¼Œéƒ½è¦è¿›å…¥åˆ°é˜»å¡é˜Ÿåˆ—ç­‰å¾…å”¤é†’ã€‚\n\n\nç›¸å¯¹æ¥è¯´ï¼Œéå…¬å¹³é”ä¼šæœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒçš„ååé‡æ¯”è¾ƒå¤§ã€‚å½“ç„¶ï¼Œéå…¬å¹³é”è®©è·å–é”çš„æ—¶é—´å˜å¾—æ›´åŠ ä¸ç¡®å®šï¼Œå¯èƒ½ä¼šå¯¼è‡´åœ¨é˜»å¡é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹é•¿æœŸå¤„äºé¥¥é¥¿çŠ¶æ€ã€‚\n\n\n**2)Share**ï¼ˆå…±äº«ï¼‰\n\n\nå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚ Semaphore/CountDownLatchã€‚Semaphoreã€CountDownLatChã€ CyclicBarrierã€ReadWriteLock æˆ‘ä»¬éƒ½ä¼šåœ¨åé¢è®²åˆ°ã€‚\n\n\nReentrantReadWriteLock å¯ä»¥çœ‹æˆæ˜¯ç»„åˆå¼ï¼Œå› ä¸º ReentrantReadWriteLock ä¹Ÿå°±æ˜¯è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹æŸä¸€èµ„æºè¿›è¡Œè¯»ã€‚\n\n\nä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æº state çš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯ï¼Œè‡³äºå…·ä½“çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—çš„ç»´æŠ¤ï¼ˆå¦‚è·å–èµ„æºå¤±è´¥å…¥é˜Ÿ/å”¤é†’å‡ºé˜Ÿç­‰ï¼‰ï¼ŒAQS å·²ç»åœ¨ä¸Šå±‚å·²ç»å¸®æˆ‘ä»¬å®ç°å¥½äº†ã€‚\n\n\n### åº•å±‚æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼\n\n\nåŒæ­¥å™¨çš„è®¾è®¡æ˜¯åŸºäºæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰åŒæ­¥å™¨ä¸€èˆ¬çš„æ–¹å¼æ˜¯è¿™æ ·ï¼ˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ï¼‰ï¼š\n\n1. ä½¿ç”¨è€…ç»§æ‰¿ AbstractQueuedSynchronizer å¹¶é‡å†™æŒ‡å®šçš„æ–¹æ³•ã€‚ï¼ˆè¿™äº›é‡å†™æ–¹æ³•å¾ˆç®€å•ï¼Œæ— éæ˜¯å¯¹äºå…±äº«èµ„æº state çš„è·å–å’Œé‡Šæ”¾ï¼‰\n2. å°† AQS ç»„åˆåœ¨è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„å®ç°ä¸­ï¼Œå¹¶è°ƒç”¨å…¶æ¨¡æ¿æ–¹æ³•ï¼Œè€Œè¿™äº›æ¨¡æ¿æ–¹æ³•ä¼šè°ƒç”¨ä½¿ç”¨è€…é‡å†™çš„æ–¹æ³•ã€‚\n\nè¿™å’Œæˆ‘ä»¬ä»¥å¾€é€šè¿‡å®ç°æ¥å£çš„æ–¹å¼æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œè¿™æ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªè¿ç”¨ï¼Œä¸‹é¢ç®€å•çš„ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“ç†è§£çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚\n\n\n> æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯åŸºäºâ€ç»§æ‰¿â€œçš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨ä¸æ”¹å˜æ¨¡æ¿ç»“æ„çš„å‰æä¸‹åœ¨å­ç±»ä¸­é‡æ–°å®šä¹‰æ¨¡æ¿ä¸­çš„å†…å®¹ä»¥å®ç°å¤ç”¨ä»£ç ã€‚ä¸¾ä¸ªå¾ˆç®€å•çš„ä¾‹å­å‡å¦‚æˆ‘ä»¬è¦å»ä¸€ä¸ªåœ°æ–¹çš„æ­¥éª¤æ˜¯ï¼šè´­ç¥¨buyTicket()->å®‰æ£€securityCheck()->ä¹˜åæŸæŸå·¥å…·å›å®¶ride()->åˆ°è¾¾ç›®çš„åœ°arrive()ã€‚æˆ‘ä»¬å¯èƒ½ä¹˜åä¸åŒçš„äº¤é€šå·¥å…·å›å®¶æ¯”å¦‚é£æœºæˆ–è€…ç«è½¦ï¼Œæ‰€ä»¥é™¤äº†ride()æ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•çš„å®ç°å‡ ä¹ç›¸åŒã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåŒ…å«äº†è¿™äº›æ–¹æ³•çš„æŠ½è±¡ç±»ï¼Œç„¶åç”¨æˆ·æ ¹æ®è‡ªå·±çš„éœ€è¦ç»§æ‰¿è¯¥æŠ½è±¡ç±»ç„¶åä¿®æ”¹ ride()æ–¹æ³•ã€‚\n\n\n**AQS ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨æ—¶éœ€è¦é‡å†™ä¸‹é¢å‡ ä¸ª AQS æä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼š**\n\n\n```text\nisHeldExclusively()//è¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚\ntryAcquire(int)//ç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚\ntryRelease(int)//ç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚\ntryAcquireShared(int)//å…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚\ntryReleaseShared(int)//å…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚\nCopy to clipboardErrorCopied\n\n```\n\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æŠ›å‡º `UnsupportedOperationException`ã€‚ è¿™äº›æ–¹æ³•çš„å®ç°å¿…é¡»æ˜¯å†…éƒ¨çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”é€šå¸¸åº”è¯¥ç®€çŸ­è€Œä¸æ˜¯é˜»å¡ã€‚AQS ç±»ä¸­çš„å…¶ä»–æ–¹æ³•éƒ½æ˜¯ final ï¼Œæ‰€ä»¥æ— æ³•è¢«å…¶ä»–ç±»ä½¿ç”¨ï¼Œåªæœ‰è¿™å‡ ä¸ªæ–¹æ³•å¯ä»¥è¢«å…¶ä»–ç±»ä½¿ç”¨ã€‚\n\n\nä»¥ ReentrantLock ä¸ºä¾‹ï¼Œstate åˆå§‹åŒ–ä¸º 0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚A çº¿ç¨‹ lock()æ—¶ï¼Œä¼šè°ƒç”¨ tryAcquire()ç‹¬å è¯¥é”å¹¶å°† state+1ã€‚æ­¤åï¼Œå…¶ä»–çº¿ç¨‹å† tryAcquire()æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ° A çº¿ç¨‹ unlock()åˆ° state=0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶å®ƒçº¿ç¨‹æ‰æœ‰æœºä¼šè·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒA çº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆstate ä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼Œè·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šä¹ˆæ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ state æ˜¯èƒ½å›åˆ°é›¶æ€çš„ã€‚\n\n\nå†ä»¥ CountDownLatch ä»¥ä¾‹ï¼Œä»»åŠ¡åˆ†ä¸º N ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œï¼Œstate ä¹Ÿåˆå§‹åŒ–ä¸º Nï¼ˆæ³¨æ„ N è¦ä¸çº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™ N ä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œå countDown()ä¸€æ¬¡ï¼Œstate ä¼š CAS(Compare and Swap)å‡ 1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œå(å³ state=0)ï¼Œä¼š unpark()ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šä» await()å‡½æ•°è¿”å›ï¼Œç»§ç»­åä½™åŠ¨ä½œã€‚\n\n\nä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨è¦ä¹ˆæ˜¯ç‹¬å æ–¹æ³•ï¼Œè¦ä¹ˆæ˜¯å…±äº«æ–¹å¼ï¼Œä»–ä»¬ä¹Ÿåªéœ€å®ç°`tryAcquire-tryRelease`ã€`tryAcquireShared-tryReleaseShared`ä¸­çš„ä¸€ç§å³å¯ã€‚ä½† AQS ä¹Ÿæ”¯æŒè‡ªå®šä¹‰åŒæ­¥å™¨åŒæ—¶å®ç°ç‹¬å å’Œå…±äº«ä¸¤ç§æ–¹å¼ï¼Œå¦‚`ReentrantReadWriteLock`ã€‚\n\n\næ¨èä¸¤ç¯‡ AQS åŸç†å’Œç›¸å…³æºç åˆ†æçš„æ–‡ç« ï¼š\n\n- [http://www.cnblogs.com/waterystone/p/4920797.html](http://www.cnblogs.com/waterystone/p/4920797.html)\n- [https://www.cnblogs.com/chengxiao/archive/2017/07/24/7141160.html](https://www.cnblogs.com/chengxiao/archive/2017/07/24/7141160.html)\n\n### ä¿¡å·é‡ï¼ˆå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼‰\n\n\n**synchronized å’Œ ReentrantLock éƒ½æ˜¯ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æŸä¸ªèµ„æºï¼ŒSemaphore(ä¿¡å·é‡)å¯ä»¥æŒ‡å®šå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æŸä¸ªèµ„æºã€‚**\n\n\nç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n\n```text\n/**\n *\n * @author Snailclimb\n * @date 2018å¹´9æœˆ30æ—¥\n * @Description: éœ€è¦ä¸€æ¬¡æ€§æ‹¿ä¸€ä¸ªè®¸å¯çš„æƒ…å†µ\n */\npublic class SemaphoreExample1 {\n  // è¯·æ±‚çš„æ•°é‡\n  private static final int threadCount = 550;\n\n  public static void main(String[] args) throws InterruptedException {\n    // åˆ›å»ºä¸€ä¸ªå…·æœ‰å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± å¯¹è±¡ï¼ˆå¦‚æœè¿™é‡Œçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ç»™å¤ªå°‘çš„è¯ä½ ä¼šå‘ç°æ‰§è¡Œçš„å¾ˆæ…¢ï¼‰\n    ExecutorService threadPool = Executors.newFixedThreadPool(300);\n    // ä¸€æ¬¡åªèƒ½å…è®¸æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚\n    final Semaphore semaphore = new Semaphore(20);\n\n    for (int i = 0; i < threadCount; i++) {\n      final int threadnum = i;\n      threadPool.execute(() -> {// Lambda è¡¨è¾¾å¼çš„è¿ç”¨\n        try {\n          semaphore.acquire();// è·å–ä¸€ä¸ªè®¸å¯ï¼Œæ‰€ä»¥å¯è¿è¡Œçº¿ç¨‹æ•°é‡ä¸º20/1=20\n          test(threadnum);\n          semaphore.release();// é‡Šæ”¾ä¸€ä¸ªè®¸å¯\n        } catch (InterruptedException e) {\n          // TODO Auto-generated catch block\n          e.printStackTrace();\n        }\n\n      });\n    }\n    threadPool.shutdown();\n    System.out.println(\"finish\");\n  }\n\n  public static void test(int threadnum) throws InterruptedException {\n    Thread.sleep(1000);// æ¨¡æ‹Ÿè¯·æ±‚çš„è€—æ—¶æ“ä½œ\n    System.out.println(\"threadnum:\" + threadnum);\n    Thread.sleep(1000);// æ¨¡æ‹Ÿè¯·æ±‚çš„è€—æ—¶æ“ä½œ\n  }\n}Copy to clipboardErrorCopied\n\n```\n\n\næ‰§è¡Œ `acquire` æ–¹æ³•é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªè®¸å¯è¯å¯ä»¥è·å¾—ç„¶åæ‹¿èµ°ä¸€ä¸ªè®¸å¯è¯ï¼›æ¯ä¸ª `release` æ–¹æ³•å¢åŠ ä¸€ä¸ªè®¸å¯è¯ï¼Œè¿™å¯èƒ½ä¼šé‡Šæ”¾ä¸€ä¸ªé˜»å¡çš„ acquire æ–¹æ³•ã€‚ç„¶è€Œï¼Œå…¶å®å¹¶æ²¡æœ‰å®é™…çš„è®¸å¯è¯è¿™ä¸ªå¯¹è±¡ï¼ŒSemaphore åªæ˜¯ç»´æŒäº†ä¸€ä¸ªå¯è·å¾—è®¸å¯è¯çš„æ•°é‡ã€‚ Semaphore ç»å¸¸ç”¨äºé™åˆ¶è·å–æŸç§èµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚\n\n\nå½“ç„¶ä¸€æ¬¡ä¹Ÿå¯ä»¥ä¸€æ¬¡æ‹¿å–å’Œé‡Šæ”¾å¤šä¸ªè®¸å¯ï¼Œä¸è¿‡ä¸€èˆ¬æ²¡æœ‰å¿…è¦è¿™æ ·åšï¼š\n\n\n```text\nsemaphore.acquire(5);// è·å–5ä¸ªè®¸å¯ï¼Œæ‰€ä»¥å¯è¿è¡Œçº¿ç¨‹æ•°é‡ä¸º20/5=4\ntest(threadnum);\nsemaphore.release(5);// è·å–5ä¸ªè®¸å¯ï¼Œæ‰€ä»¥å¯è¿è¡Œçº¿ç¨‹æ•°é‡ä¸º20/5=4Copy to clipboardErrorCopied\n\n```\n\n\né™¤äº† `acquire`æ–¹æ³•ä¹‹å¤–ï¼Œå¦ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ä¸ä¹‹å¯¹åº”çš„æ–¹æ³•æ˜¯`tryAcquire`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¦‚æœè·å–ä¸åˆ°è®¸å¯å°±ç«‹å³è¿”å› falseã€‚\n\n\nSemaphore æœ‰ä¸¤ç§æ¨¡å¼ï¼Œå…¬å¹³æ¨¡å¼å’Œéå…¬å¹³æ¨¡å¼ã€‚\n\n- **å…¬å¹³æ¨¡å¼ï¼š** è°ƒç”¨ acquire çš„é¡ºåºå°±æ˜¯è·å–è®¸å¯è¯çš„é¡ºåºï¼Œéµå¾ª FIFOï¼›\n- **éå…¬å¹³æ¨¡å¼ï¼š** æŠ¢å å¼çš„ã€‚\n\n**Semaphore å¯¹åº”çš„ä¸¤ä¸ªæ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š**\n\n\n```text\n   public Semaphore(int permits) {\n        sync = new NonfairSync(permits);\n    }\n\n    public Semaphore(int permits, boolean fair) {\n        sync = fair ? new FairSync(permits) : new NonfairSync(permits);\n    }Copy to clipboardErrorCopied\n\n```\n\n\n**è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œéƒ½å¿…é¡»æä¾›è®¸å¯çš„æ•°é‡ï¼Œç¬¬äºŒä¸ªæ„é€ æ–¹æ³•å¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³æ¨¡å¼è¿˜æ˜¯éå…¬å¹³æ¨¡å¼ï¼Œé»˜è®¤éå…¬å¹³æ¨¡å¼ã€‚**\n\n\n[issue645 è¡¥å……å†…å®¹](https://github.com/Snailclimb/JavaGuide/issues/645) ï¼šSemaphore ä¸ CountDownLatch ä¸€æ ·ï¼Œä¹Ÿæ˜¯å…±äº«é”çš„ä¸€ç§å®ç°ã€‚å®ƒé»˜è®¤æ„é€  AQS çš„ state ä¸º permitsã€‚å½“æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°é‡è¶…å‡º permits,é‚£ä¹ˆå¤šä½™çš„çº¿ç¨‹å°†ä¼šè¢«æ”¾å…¥é˜»å¡é˜Ÿåˆ— Park,å¹¶è‡ªæ—‹åˆ¤æ–­ state æ˜¯å¦å¤§äº 0ã€‚åªæœ‰å½“ state å¤§äº 0 çš„æ—¶å€™ï¼Œé˜»å¡çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œ,æ­¤æ—¶å…ˆå‰æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œ release æ–¹æ³•ï¼Œrelease æ–¹æ³•ä½¿å¾— state çš„å˜é‡ä¼šåŠ  1ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„çº¿ç¨‹ä¾¿ä¼šåˆ¤æ–­æˆåŠŸã€‚ å¦‚æ­¤ï¼Œæ¯æ¬¡åªæœ‰æœ€å¤šä¸è¶…è¿‡ permits æ•°é‡çš„çº¿ç¨‹èƒ½è‡ªæ—‹æˆåŠŸï¼Œä¾¿é™åˆ¶äº†æ‰§è¡Œä»»åŠ¡çº¿ç¨‹çš„æ•°é‡ã€‚\n\n\nç”±äºç¯‡å¹…é—®é¢˜ï¼Œå¦‚æœå¯¹ Semaphore æºç æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š[https://juejin.im/post/5ae755366fb9a07ab508adc6](https://juejin.im/post/5ae755366fb9a07ab508adc6)\n\n\n### CountDownLatch å€’è®¡æ—¶å™¨\n\n\n`CountDownLatch` å…è®¸ `count` ä¸ªçº¿ç¨‹é˜»å¡åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç›´è‡³æ‰€æœ‰çº¿ç¨‹çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ã€‚\n\n\n`CountDownLatch` æ˜¯å…±äº«é”çš„ä¸€ç§å®ç°,å®ƒé»˜è®¤æ„é€  AQS çš„ `state` å€¼ä¸º `count`ã€‚å½“çº¿ç¨‹ä½¿ç”¨ `countDown()` æ–¹æ³•æ—¶,å…¶å®ä½¿ç”¨äº†`tryReleaseShared`æ–¹æ³•ä»¥ CAS çš„æ“ä½œæ¥å‡å°‘ `state`,ç›´è‡³ `state` ä¸º 0 ã€‚å½“è°ƒç”¨ `await()` æ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœ `state` ä¸ä¸º 0ï¼Œé‚£å°±è¯æ˜ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œ`await()` æ–¹æ³•å°±ä¼šä¸€ç›´é˜»å¡ï¼Œä¹Ÿå°±æ˜¯è¯´ `await()` æ–¹æ³•ä¹‹åçš„è¯­å¥ä¸ä¼šè¢«æ‰§è¡Œã€‚ç„¶åï¼Œ`CountDownLatch` ä¼šè‡ªæ—‹ CAS åˆ¤æ–­ `state == 0`ï¼Œå¦‚æœ `state == 0` çš„è¯ï¼Œå°±ä¼šé‡Šæ”¾æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œ`await()` æ–¹æ³•ä¹‹åçš„è¯­å¥\n\n\n**`CountDownLatch`****ä¸¤ç§ç»å…¸ç®—æ³•**\n\n1. æŸä¸€çº¿ç¨‹åœ¨å¼€å§‹è¿è¡Œå‰ç­‰å¾… n ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚å°† CountDownLatch çš„è®¡æ•°å™¨åˆå§‹åŒ–ä¸º n ï¼š`new CountDownLatch(n)`ï¼Œæ¯å½“ä¸€ä¸ªä»»åŠ¡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå°±å°†è®¡æ•°å™¨å‡ 1 `countdownlatch.countDown()`ï¼Œå½“è®¡æ•°å™¨çš„å€¼å˜ä¸º 0 æ—¶ï¼Œåœ¨`CountDownLatchä¸Š await()` çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ã€‚ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯å°±æ˜¯å¯åŠ¨ä¸€ä¸ªæœåŠ¡æ—¶ï¼Œä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…å¤šä¸ªç»„ä»¶åŠ è½½å®Œæ¯•ï¼Œä¹‹åå†ç»§ç»­æ‰§è¡Œã€‚\n2. å®ç°å¤šä¸ªçº¿ç¨‹å¼€å§‹æ‰§è¡Œä»»åŠ¡çš„æœ€å¤§å¹¶è¡Œæ€§ã€‚æ³¨æ„æ˜¯å¹¶è¡Œæ€§ï¼Œä¸æ˜¯å¹¶å‘ï¼Œå¼ºè°ƒçš„æ˜¯å¤šä¸ªçº¿ç¨‹åœ¨æŸä¸€æ—¶åˆ»åŒæ—¶å¼€å§‹æ‰§è¡Œã€‚ç±»ä¼¼äºèµ›è·‘ï¼Œå°†å¤šä¸ªçº¿ç¨‹æ”¾åˆ°èµ·ç‚¹ï¼Œç­‰å¾…å‘ä»¤æªå“ï¼Œç„¶ååŒæ—¶å¼€è·‘ã€‚åšæ³•æ˜¯åˆå§‹åŒ–ä¸€ä¸ªå…±äº«çš„ `CountDownLatch` å¯¹è±¡ï¼Œå°†å…¶è®¡æ•°å™¨åˆå§‹åŒ–ä¸º 1 ï¼š`new CountDownLatch(1)`ï¼Œå¤šä¸ªçº¿ç¨‹åœ¨å¼€å§‹æ‰§è¡Œä»»åŠ¡å‰é¦–å…ˆ `coundownlatch.await()`ï¼Œå½“ä¸»çº¿ç¨‹è°ƒç”¨ countDown() æ—¶ï¼Œè®¡æ•°å™¨å˜ä¸º 0ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«å”¤é†’ã€‚\n\n**ä½¿ç”¨ç¤ºèŒƒ**\n\n\n```text\n/**\n *\n * @author SnailClimb\n * @date 2018å¹´10æœˆ1æ—¥\n * @Description: CountDownLatch ä½¿ç”¨æ–¹æ³•ç¤ºä¾‹\n */\npublic class CountDownLatchExample1 {\n  // è¯·æ±‚çš„æ•°é‡\n  private static final int threadCount = 550;\n\n  public static void main(String[] args) throws InterruptedException {\n    // åˆ›å»ºä¸€ä¸ªå…·æœ‰å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± å¯¹è±¡ï¼ˆå¦‚æœè¿™é‡Œçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ç»™å¤ªå°‘çš„è¯ä½ ä¼šå‘ç°æ‰§è¡Œçš„å¾ˆæ…¢ï¼‰\n    ExecutorService threadPool = Executors.newFixedThreadPool(300);\n    final CountDownLatch countDownLatch = new CountDownLatch(threadCount);\n    for (int i = 0; i < threadCount; i++) {\n      final int threadnum = i;\n      threadPool.execute(() -> {// Lambda è¡¨è¾¾å¼çš„è¿ç”¨\n        try {\n          test(threadnum);\n        } catch (InterruptedException e) {\n          // TODO Auto-generated catch block\n          e.printStackTrace();\n        } finally {\n          countDownLatch.countDown();// è¡¨ç¤ºä¸€ä¸ªè¯·æ±‚å·²ç»è¢«å®Œæˆ\n        }\n\n      });\n    }\n    countDownLatch.await();\n    threadPool.shutdown();\n    System.out.println(\"finish\");\n  }\n\n  public static void test(int threadnum) throws InterruptedException {\n    Thread.sleep(1000);// æ¨¡æ‹Ÿè¯·æ±‚çš„è€—æ—¶æ“ä½œ\n    System.out.println(\"threadnum:\" + threadnum);\n    Thread.sleep(1000);// æ¨¡æ‹Ÿè¯·æ±‚çš„è€—æ—¶æ“ä½œ\n  }\n}\nCopy to clipboardErrorCopied\n\n```\n\n\nä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†è¯·æ±‚çš„æ•°é‡ä¸º 550ï¼Œå½“è¿™ 550 ä¸ªè¯·æ±‚è¢«å¤„ç†å®Œæˆä¹‹åï¼Œæ‰ä¼šæ‰§è¡Œ`System.out.println(\"finish\");`ã€‚\n\n\nä¸ CountDownLatch çš„ç¬¬ä¸€æ¬¡äº¤äº’æ˜¯ä¸»çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹å¿…é¡»åœ¨å¯åŠ¨å…¶ä»–çº¿ç¨‹åç«‹å³è°ƒç”¨ `CountDownLatch.await()` æ–¹æ³•ã€‚è¿™æ ·ä¸»çº¿ç¨‹çš„æ“ä½œå°±ä¼šåœ¨è¿™ä¸ªæ–¹æ³•ä¸Šé˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹å®Œæˆå„è‡ªçš„ä»»åŠ¡ã€‚\n\n\nå…¶ä»– N ä¸ªçº¿ç¨‹å¿…é¡»å¼•ç”¨é—­é”å¯¹è±¡ï¼Œå› ä¸ºä»–ä»¬éœ€è¦é€šçŸ¥ `CountDownLatch` å¯¹è±¡ï¼Œä»–ä»¬å·²ç»å®Œæˆäº†å„è‡ªçš„ä»»åŠ¡ã€‚è¿™ç§é€šçŸ¥æœºåˆ¶æ˜¯é€šè¿‡ `CountDownLatch.countDown()`æ–¹æ³•æ¥å®Œæˆçš„ï¼›æ¯è°ƒç”¨ä¸€æ¬¡è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–çš„ count å€¼å°±å‡ 1ã€‚æ‰€ä»¥å½“ N ä¸ªçº¿ç¨‹éƒ½è°ƒ ç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œcount çš„å€¼ç­‰äº 0ï¼Œç„¶åä¸»çº¿ç¨‹å°±èƒ½é€šè¿‡ `await()`æ–¹æ³•ï¼Œæ¢å¤æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ã€‚\n\n\nå†æ’ä¸€å˜´ï¼š`CountDownLatch` çš„ `await()` æ–¹æ³•ä½¿ç”¨ä¸å½“å¾ˆå®¹æ˜“äº§ç”Ÿæ­»é”ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šé¢ä»£ç ä¸­çš„ for å¾ªç¯æ”¹ä¸ºï¼š\n\n\n```text\nfor (int i = 0; i < threadCount-1; i++) {\n.......\n}Copy to clipboardErrorCopied\n\n```\n\n\nè¿™æ ·å°±å¯¼è‡´ `count` çš„å€¼æ²¡åŠæ³•ç­‰äº 0ï¼Œç„¶åå°±ä¼šå¯¼è‡´ä¸€ç›´ç­‰å¾…ã€‚\n\n\nå¦‚æœå¯¹ CountDownLatch æºç æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥æŸ¥çœ‹ï¼š [ã€JUCã€‘JDK1.8 æºç åˆ†æä¹‹ CountDownLatchï¼ˆäº”ï¼‰](https://www.cnblogs.com/leesf456/p/5406191.html)\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-02-08",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "37",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java"
        ],
        "summary": "synchronized å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œsynchronizedå…³é”®å­—å¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å¦å¤–ï¼Œåœ¨ Ja",
        "sort": "",
        "title": "JavaåŸºç¡€-é”",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "747841e4-eeac-4349-88b0-63fc6421cf0c"
        }
      ],
      "body": "",
      "realName": "JavaåŸºç¡€-é”",
      "relativePath": "/archives/JavaåŸºç¡€-é”.md"
    },
    {
      "id": "07c3aa88-08b7-4093-9ac6-0a495a187163",
      "doc_id": "07c3aa88-08b7-4093-9ac6-0a495a187163",
      "title": "07c3aa88-08b7-4093-9ac6-0a495a187163",
      "updated": 1696747320000,
      "body_original": "\n# wkhtmltopdfç²¾è®²\n\n\n([åŸæ–‡](https://www.jianshu.com/p/4d65857ffe5e)) ä½œè€…ï¼šJSON_NULL\n\n\n## æœ¯è¯­å®šä¹‰\n\n\n### æ–‡æ¡£å¯¹è±¡\n\n\nâ€œæ–‡æ¡£å¯¹è±¡â€æ˜¯æŒ‡PDFæ–‡æ¡£ä¸­çš„æ–‡æ¡£å¯¹è±¡ï¼Œå…±æœ‰ä¸‰ç§ç±»å‹çš„â€œæ–‡æ¡£å¯¹è±¡â€ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯â€œé¡µé¢å¯¹è±¡â€ï¼Œâ€œå°é¢å¯¹è±¡â€å’Œâ€œç›®å½•å¯¹è±¡â€ã€‚\n\n\n### é¡µé¢å¯¹è±¡\n\n\nâ€œé¡µé¢å¯¹è±¡â€æ˜¯æŒ‡ä»¥é¡µé¢çš„å½¢å¼åœ¨PDFæ–‡æ¡£ä¸­å‘ˆç°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯ç›¸å¯¹äºâ€œå°é¢å¯¹è±¡â€å’Œâ€œç›®å½•å¯¹è±¡â€æ¥è®²çš„ã€‚æ­¤ç±»å¯¹è±¡ä¼šæˆä¸ºPDFæ–‡æ¡£ä¸­å†…å®¹ã€‚\n\n\n### å°é¢å¯¹è±¡\n\n\nâ€œå°é¢å¯¹è±¡â€æ˜¯æŒ‡ä»¥å°é¢çš„å½¢å¼åœ¨PDFæ–‡æ¡£ä¸­å‘ˆç°çš„å¯¹è±¡ã€‚è¿™ç±»å¯¹è±¡ä¼šæˆä¸ºPDFæ–‡æ¡£ä¸­çš„å°é¢ã€‚\n\n\n### ç›®å½•å¯¹è±¡\n\n\nâ€œç›®å½•å¯¹è±¡â€æ˜¯ä»¥ç›®å½•çš„å½¢å¼åœ¨PDFæ–‡æ¡£ä¸­å‘ˆç°çš„å¯¹è±¡ï¼Œåˆå«â€œTOCå¯¹è±¡â€ã€‚è¿™ç±»å¯¹è±¡ä¼šæˆä¸ºPDFæ–‡æ¡£ä¸­çš„ç›®å½•ã€‚\n\n\n### å¤§çº²\n\n\nâ€œå¤§çº²â€æ˜¯æŒ‡é˜…è¯»PDFæ–‡æ¡£æ—¶çš„ä¹¦ç­¾å¯¼èˆªã€‚\n\n\n### å¤–é“¾\n\n\nâ€œå¤–é“¾â€æ˜¯æŒ‡æ‰€æœ‰åœ¨è¿™ä¸ªé¡µé¢ä¸­ä¸”ä¸æŒ‡å‘å®ƒè‡ªèº«é¡µé¢ä¸­é”šç‚¹çš„è¶…é“¾æ¥ã€‚\n\n\n### å†…é“¾\n\n\nâ€œå†…é“¾â€æ˜¯æŒ‡åœ¨è¿™ä¸ªé¡µé¢ä¸­ä¸”æŒ‡å‘çš„ç›®æ ‡é¡µé¢æ˜¯è¿™ä¸ªé¡µé¢æœ¬èº«ä¸­çš„ä¸€ä¸ªé”šç‚¹çš„è¶…é“¾æ¥ã€‚\n\n\n## å‘½ä»¤æ ¼å¼\n\n\n```text\nwkhtmltopdf [GLOBAL OPTION]... [OBJECT]... <output file>\n\n```\n\n\nä¸Šè¿°ä»£ç å°±æ˜¯ wkhtmltopdf çš„å‘½ä»¤è¡Œæ ¼å¼ï¼Œçœ‹ä¼¼ç®€å•ï¼Œå…¶å®åœ¨ `[GLOBAL OPTION]` å’Œ `[OBJECT]` ä¸­è¿˜åˆ«æœ‰æ´å¤©ã€‚é¢„çŸ¥è¯¦æƒ…ï¼Œä¸”å¬æˆ‘æ…¢æ…¢é“æ¥ã€‚\n\n\n## æ–‡æ¡£å¯¹è±¡ç®€ä»‹\n\n\nwkhtmltopdf èƒ½å¤ŸæŠŠå¤šä¸ªâ€œå¯¹è±¡â€åˆå¹¶ç”Ÿæˆä¸€ä¸ªpdfæ–‡æ¡£ï¼Œè¿™äº›â€œå¯¹è±¡â€å¯ä»¥æ˜¯â€œé¡µé¢å¯¹è±¡â€ã€â€œå°é¢å¯¹è±¡â€ã€æˆ–æ˜¯â€œç›®å½•å¯¹è±¡â€ã€‚è¿™äº›å¯¹è±¡åœ¨pdfæ–‡æ¡£ä¸­çš„é¡ºåºå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ¥æŒ‡å®šã€‚å‘½ä»¤è¡Œå‚æ•°åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œä¸€ç§æ˜¯é’ˆå¯¹æŸä¸€ç‰¹å®šâ€œå¯¹è±¡â€çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå¦ä¸€ç§æ˜¯å…¨å±€çš„å‘½ä»¤è¡Œå‚æ•°ã€‚å¹¶ä¸”å…¨å±€çš„å‘½ä»¤è¡Œå‚æ•°åªèƒ½æ”¾åœ¨å…¨å±€å‚æ•°åŒº([GLOBAL OPTION])ä¸­æŒ‡å®šã€‚\n\n\n### é¡µé¢å¯¹è±¡ç®€ä»‹\n\n\nâ€œé¡µé¢å¯¹è±¡â€ä½œç”¨æ˜¯ç”¨æ¥æŠŠä¸€ä¸ªç½‘é¡µä½œä¸ºå†…å®¹è¾“å‡ºåˆ°PDFæ–‡æ¡£ä¸­ã€‚\n\n\n```text\n(page)? <input url/file name> [PAGE OPTION]...\n\n```\n\n\nâ€œé¡µé¢å¯¹è±¡â€çš„å‚æ•°å¯ä»¥æ”¾åœ¨â€œå…¨å±€å‚æ•°åŸŸ([GLOBAL OPTIONS])â€å’Œâ€œé¡µé¢å‚æ•°åŸŸ([PAGE OPTIONS])â€ã€‚ç¨‹åºä¼šæ ¹æ®å®é™…æƒ…å†µåœ¨æ‰€æœ‰å‚æ•°ä¸­æ‰¾åˆ°åˆé€‚çš„å‚æ•°åº”ç”¨åˆ°é¡µé¢ã€é¡µçœ‰å’Œé¡µè„šã€‚\n\n\n### å°é¢å¯¹è±¡ç®€ä»‹\n\n\nâ€œå°é¢å¯¹è±¡â€ç”¨æ¥æŠŠä¸€ä¸ªç½‘é¡µä½œä¸ºå°é¢è¾“å‡ºåˆ°PDFæ–‡æ¡£ä¸­ï¼Œè¾“å‡ºçš„é¡µé¢ä¸ä¼šåœ¨TOCä¸­å‡ºç°ï¼Œå¹¶ä¸”ä¸ä¼šåŒ…å«é¡µçœ‰å’Œé¡µè„šã€‚\n\n\n```text\ncover <input url/file name> [PAGE OPTION]...\n\n```\n\n\næ‰€æœ‰èƒ½å¤Ÿåœ¨â€œé¡µé¢å¯¹è±¡â€ä¸­ä½¿ç”¨çš„å‚æ•°éƒ½å¯ä»¥ç”¨åˆ°â€œå°é¢å¯¹è±¡â€\n\n\n### ç›®å½•å¯¹è±¡ç®€ä»‹\n\n\nâ€œç›®å½•å¯¹è±¡â€çš„ä½œç”¨æ˜¯è¾“å‡ºä¸€ä¸ªç›®å½•åˆ°PDFæ–‡ä»¶ä¸­ã€‚\n\n\n```text\ntoc [TOC OPTION]...\n\n```\n\n\næ‰€æœ‰èƒ½å¤Ÿåœ¨â€œé¡µé¢å¯¹è±¡â€ä¸­ä½¿ç”¨çš„å‚æ•°éƒ½å¯ä»¥ç”¨åˆ°â€œTOCå¯¹è±¡â€ï¼Œå¹¶ä¸”è¿˜æœ‰è®¸å¤šçš„é’ˆå¯¹â€œTOCå¯¹è±¡â€çš„å‚æ•°å¯ä»¥åº”ç”¨åˆ°â€œTOCå¯¹è±¡â€ä¸­ã€‚ç›®å½•æ˜¯é€šè¿‡ XSLT ç”Ÿæˆçš„ï¼Œè¿™å°±æ„å‘³ç€å®ƒå¯ä»¥è¢«å®šä¹‰æˆä»»ä½•ä½ æƒ³çœ‹åˆ°çš„æ ·å­ã€‚ä½ å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•° `--dump-default-toc-xsl` è¾“å‡ºé»˜è®¤çš„ XSLT æ–‡æ¡£ï¼Œé€šè¿‡ `--dump-outline` å‘½ä»¤è¡Œå‚æ•° å¯æŒ‡å®šä»¥XMLæ ¼å¼è¾“å‡ºå½“å‰å¤„ç†æ–‡æ¡£çš„ç›®å½•åˆ°æŒ‡å®šæ–‡ä»¶ã€‚æ›´å¤šè¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹åé¢ä»‹ç»çš„ **ç›®å½•å¯¹è±¡å‚æ•°**\n\n\n## å‘½ä»¤å‚æ•°\n\n\nå‘½ä»¤å‚æ•°åŒ…å«äº”éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯â€œå…¨å±€å‚æ•°â€ï¼Œâ€œå¤§çº²å‚æ•°é€‰é¡¹â€ï¼Œâ€œé¡µé¢å¯¹è±¡å‚æ•°â€ï¼Œâ€œé¡µçœ‰å’Œé¡µè„šå‚æ•°é€‰é¡¹â€å’Œâ€œç›®å½•å¯¹è±¡å‚æ•°â€ã€‚\n\n\n### å…¨å±€å‚æ•°\n\n\n```text\n    --collate             å½“è¾“å‡ºå¤šä¸ªå‰¯æœ¬æ—¶è¿›è¡Œæ ¡éªŒ(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --no-collate          å½“è¾“å‡ºå¤šä¸ªå‰¯æœ¬æ—¶ä¸è¿›è¡Œæ ¡éªŒ\n    --cookie-jar <path>   ä»æä¾›çš„JARæ–‡ä»¶ä¸­è¯»å†™cookieæ•°æ®\n    --copies <number>     è®¾ç½®è¾“å‡ºå‰¯æœ¬çš„æ•°é‡(é»˜è®¤ä¸»1)ï¼Œå…¶å®ä¸º1å°±å¤Ÿäº†\n-d, --dpi <dpi>           æŒ‡å®šä¸€ä¸ªè¦åˆ†è¾¨ç‡(è¿™åœ¨ X11 ç³»ç»Ÿä¸­å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨)\n-H, --extended-help       ç›¸å¯¹ -h å‚æ•°ï¼Œæ˜¾ç¤ºæ›´è¯¦ç»†çš„è¯´æ˜æ–‡æ¡£\n-g, --grayscale           æŒ‡å®šä»¥ç°åº¦å›¾ç”ŸæˆPDFæ–‡æ¡£ã€‚å ç”¨çš„ç©ºé—´æ›´å°\n-h, --help                æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯\n    --htmldoc             è¾“å‡ºç¨‹åºçš„htmlå¸®åŠ©æ–‡æ¡£\n    --image-dpi <integer> å½“é¡µé¢ä¸­æœ‰å†…åµŒçš„å›¾ç‰‡æ—¶ï¼Œ\n                          ä¼šä¸‹è½½æ­¤å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šå°ºå¯¸çš„å›¾ç‰‡(é»˜è®¤å€¼æ˜¯ 600)\n    --image-quality <interger> å½“ä½¿ç”¨ jpeg ç®—æ³•å‹ç¼©å›¾ç‰‡æ—¶ä½¿ç”¨è¿™ä¸ªå‚æ•°æŒ‡å®šçš„è´¨é‡(é»˜è®¤ä¸º 94)\n    --license             è¾“å‡ºæˆæƒä¿¡æ¯å¹¶é€€å‡º\n-l, --lowquality          ç”Ÿæˆä½è´¨é‡çš„ PDF/PS ,èƒ½å¤Ÿå¾ˆå¥½çš„èŠ‚çº¦æœ€ç»ˆç”Ÿæˆæ–‡æ¡£æ‰€å å­˜å‚¨ç©ºé—´\n    --manpage             è¾“å‡ºç¨‹åºçš„æ‰‹å†Œé¡µ\n-B, --margin-bottom <unitreal> è®¾ç½®é¡µé¢çš„ åº•è¾¹è·\n-L, --margin-left <unitreal>   è®¾ç½®é¡µé¢çš„ å·¦è¾¹è· (é»˜è®¤æ˜¯ 10mm)\n-R, --margin-right <unitreal>  è®¾ç½®é¡µé¢çš„ å³è¾¹è· (é»˜è®¤æ˜¯ 10mm)\n-T, --margin-top <unitreal>    è®¾ç½®é¡µé¢çš„ ä¸Šè¾¹è·\n-O, --orientation <orientation> è®¾ç½®ä¸ºâ€œé£æ™¯(Landscape)â€æˆ–â€œè‚–åƒ(Portrait)â€æ¨¡å¼,\n                                é»˜è®¤æ˜¯è‚–åƒæ¨¡å—(Portrait)\n    --page-height <unitreal>   é¡µé¢é«˜åº¦\n-s, --page-size <Size>         è®¾ç½®é¡µé¢çš„å°ºå¯¸ï¼Œå¦‚ï¼šA4,Letterç­‰ï¼Œé»˜è®¤æ˜¯ï¼šA4\n    --page-width <unitreal>    é¡µé¢å®½åº¦\n    --no-pdf-compression       ä¸å¯¹PDFå¯¹è±¡ä½¿ç”¨ä¸¢å¤±å°‘é‡ä¿¡æ¯çš„å‹ç¼©ç®—æ³•ï¼Œä¸å»ºè®®ä½¿ç”¨äº›å‚æ•°ï¼Œ\n                               å› ä¸ºç”Ÿæˆçš„PDFæ–‡ä»¶ä¼šéå¸¸å¤§ã€‚\n-q, --quiet                    é™æ€æ¨¡å¼ï¼Œä¸åœ¨æ ‡å‡†è¾“å‡ºä¸­æ‰“å°ä»»ä½•ä¿¡æ¯\n    --read-args-from-stdin     ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–å‘½ä»¤è¡Œå‚æ•°ï¼Œåç»­ä¼šæœ‰é’ˆå¯¹æ­¤æŒ‡ä»¤çš„è¯¦ç»†ä»‹ç»ï¼Œ\n                               è¯·å‚è§ **ä»æ ‡å‡†è¾“å…¥è·å–å‚æ•°**\n    --readme                   è¾“å‡ºç¨‹åºçš„ readme æ–‡æ¡£\n    --title <text>             ç”Ÿæˆçš„PDFæ–‡æ¡£çš„æ ‡é¢˜ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªæ–‡æ¡£çš„æ ‡é¢˜\n-V, --version                  è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯åé€€å‡º\n\n```\n\n\nä¸Šè¿°ä»£ç åŒºæ˜¯æ‰€æœ‰å…¨å±€å‚æ•°åŠæ³¨é‡Šï¼Œä¸‹é¢ç®€å•è¯´ä¸€ä¸‹ä¸ªåˆ«å‚æ•°çš„æ„ä¹‰åŠç”¨æ³•ã€‚\n\n\n### -copies N\n\n\nN æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚\n\n\nè¿™ä¸ªé€‰é¡¹å¯ä»¥å…ˆä¸ç”¨å…³å¿ƒäº†ï¼Œå› ä¸ºä½ è¿™è¾ˆå­å¯èƒ½éƒ½ç”¨ä¸åˆ°ã€‚ä»–çš„ä½œç”¨æ˜¯åœ¨ç”Ÿæˆçš„PDFæ–‡æ¡£ä¸­ï¼ŒæŠŠå†…å®¹é‡å¤è¾“å‡º N ä»½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªPDFæ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£ä¸­çš„å¤§å°ã€å†…å®¹é‡éƒ½å°†æ˜¯ä¸ä½¿ç”¨æ­¤å‚æ•°æ—¶çš„ N å€ã€‚ç„¶è€Œé‡å¤çš„å†…å®¹å¯¹ä½ æ¥è¯´å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚\n\n\nå¦‚æœä¸ä½¿ç”¨ `--copies` å‚æ•°ï¼Œé‚£ä¹ˆ `--collate` å’Œ `--no-collate` å‚æ•°å°±ä¸ç”¨äº†è§£äº†ï¼Œå› ä¸ºä»–ä»¬åªåœ¨ `--copies` å‚æ•°ä¸­çš„ N å¤§äº 1 æ—¶æ‰æœ‰æ„ä¹‰ã€‚\n\n\n### g, --grayscale\n\n\nè¿™ä¸ªå‚æ•°éå¸¸æœ‰ç”¨ï¼Œä½¿ç”¨è¿™ä¸ªå‚æ•°å¯ä»¥æœ‰æ•ˆå‹ç¼©ç”Ÿæˆçš„PDFæ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´ã€‚å½“ç„¶è¿™ä¸ªå‹ç¼©æ˜¯è¦ä»˜å‡ºä¸€å®šä»£ä»·çš„ï¼Œé‚£å°±æ˜¯æœ€ç»ˆç”Ÿæˆçš„PDFæ–‡æ¡£å°†æ˜¯ç°åº¦çš„ï¼Œæ²¡æœ‰ä»»ä½•è‰²å½©ã€‚å¦‚æœä½ èƒ½æ¥å—ç°åº¦PDFæ–‡æ¡£ï¼Œå¹¶ä¸å½±å“å®é™…ä½¿ç”¨ï¼Œé‚£å°±è¯·ä½¿ç”¨è¿™ä¸ªå‚æ•°å§ã€‚ç”Ÿæˆçš„PDFæ–‡æ¡£è¶Šå¤§ï¼Œä½¿ç”¨æ­¤å‚æ•°è·å¾—çš„æƒŠå–œå°±è¶Šå¤§ã€‚\n\n\n### l, --lowquality\n\n\nè¿™ä¸ªå‚æ•°ä¸ `-g` å‚æ•°æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œ `-l` å‚æ•°ä¹Ÿä¼šå¤§å¤§å‹ç¼©PDFæ–‡æ¡£æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´ã€‚åªæ˜¯å®ƒæ˜¯é€šè¿‡é™ä½PDFæ–‡æ¡£çš„è´¨é‡æ¥å®Œæˆè¿™ä¸€ä»»åŠ¡çš„ã€‚è¿™ä¸ªå‚æ•°ä¹Ÿå€¼å¾—æ¨èï¼Œä½ æœ€å¥½å…ˆå°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹ä½¿ç”¨æ­¤å‚æ•°åç”Ÿæˆçš„PDFæ–‡æ¡£ä¸ä¸ä½¿ç”¨æ­¤å‚æ•°çš„åŒºåˆ«å†åšå†³å®šã€‚æˆ‘å¯ä»¥å‘Šè¯‰ä½ çš„æ˜¯ï¼Œåœ¨çº¯æ–‡å­—çš„æƒ…å†µä¸‹ä»–ä»¬çš„å·®åˆ«ä¸å¤§ï¼Œæ­¤å‚æ•°åªæ˜¯é™ä½äº†PDFæ–‡æ¡£çš„è´¨é‡ï¼Œçœ‹ä¸Šå»æ˜¯ç³™äº†ä¸€äº›ï¼Œä½†ä¸ä¼šå½±å“é˜…è¯»ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªè¿½æ±‚æ„Ÿå®˜äº«å—ï¼Œæˆ–æ˜¯ä½ ç”Ÿæˆçš„PDFæ–‡æ¡£ä¸­æœ‰å¤§é‡å›¾ç‰‡ï¼Œé‚£å°±ä¸è¦ä½¿ç”¨æ­¤å‚æ•°äº†ã€‚\n\n\n### -no-pdf-compression\n\n\nè¿™ä¸ªå‚æ•°å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ï¼Œæœ€å¥½è¿™è¾ˆå­éƒ½ä¸è¦å»äº†è§£ä»–çš„å¥½ï¼Œå› ä¸ºå¯¹äºä½ æ¥è¯´è‚¯å®šç”¨ä¸åˆ°ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯åœ¨è¾“å‡ºPDFæ–‡æ¡£æ—¶ï¼Œä¸ä½¿ç”¨ä»»ä½•çš„å‹ç¼©ã€‚è¿™å°†ä¼šå¯¼è‡´è¾“å‡ºçš„PDFæ–‡æ¡£ç‰¹åˆ«çš„å¤§ï¼Œè´¨é‡æ˜¯æ— æŸçš„ï¼Œä½†æ˜¯å¯¹äºäººç±»æ¥è¯´ä»æ„Ÿè§‚ä¸Šæ ¹æœ¬å¯Ÿè§‰ä¸åˆ°å‹ç¼©å‰åçš„è´¨é‡å˜åŒ–çš„ã€‚å¦‚æœä½ çš„æ„Ÿè§‚è¶…ä¹äºå¸¸äººï¼Œå‹ç¼©ä¹‹åçš„ä½“éªŒå¯¹ä½ æ¥è¯´æ— æ³•æ¥å—ï¼Œé‚£æˆ‘æ”¶å›å‰é¢çš„è¯ï¼Œä½ å°±å°½æƒ…ä½¿ç”¨æ­¤å‚æ•°å§ã€‚\n\n\n### q, --quiet\n\n\nä½¿ç”¨è¿™ä¸ªå‚æ•°åï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªå¹²å‡€çš„å‘½ä»¤è¡Œè¾“å‡ºï¼Œå°±è¿ç¨‹åºå¤„ç†çš„è¿›åº¦å’ŒçŠ¶æ€éƒ½æ²¡æœ‰ã€‚è¿™ä¸ªå‚æ•°ä¼šæŠ‘åˆ¶æ‰€æœ‰å‘½ä»¤è¡Œè¾“å‡ºï¼Œåœ¨ç¨‹åºçš„å·¥ä½œè¿‡ç¨‹ä¸­ï¼Œä½ çœ‹ä¸åˆ°ä»»ä½•è¾“å‡ºã€‚å»ºè®®ä¸ä¼šä½¿ç”¨æ­¤å‚æ•°ï¼Œå› ä¸ºç¨‹åºè¾“å‡ºä¸€äº›è¿›åº¦å’ŒçŠ¶æ€ä¿¡æ¯è¿˜æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ä¸‡ä¸€ç¨‹åºå·¥ä½œåˆ°æŸå¤„æ­»äº†å‘¢(å˜¿å˜¿)ï¼Œåœ¨ `-q` æ¨¡å¼ä¸‹ä½ æ˜¯æ— æ³•åˆ†è¾¨æ˜¯å¦ç¨‹åºæ­»æ‰äº†çš„ã€‚\n\n\n### å¤§çº²å‚æ•°é€‰é¡¹\n\n\n```text\n--dump-default-toc-xsl     è¾“å‡ºé»˜è®¤çš„ TOC xsl æ ·å¼è¡¨åˆ°æ ‡å‡†è¾“å‡º\n--dump-outline <file>      è¾“å‡ºâ€œå¤§çº²â€åˆ°æŒ‡å®šçš„æ–‡ä»¶(æ–‡ä»¶å†…å®¹ä¸ºxml)\n--outline                  åœ¨ç”Ÿæˆçš„PDFæ–‡æ¡£ä¸­è¾“å‡ºâ€œå¤§çº²â€(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n--no-outline               ä¸åœ¨pdfæ–‡æ¡£ä¸­è¾“å‡ºå¤§çº²\n--outline-depth <level>    è®¾ç½®ç”Ÿæˆå¤§çº²çš„æ·±åº¦(é»˜è®¤ä¸º 4)\n\n```\n\n\nå¤§çº²å‚æ•°ä¸­å”¯ä¸€éœ€è¦ç‰¹åˆ«è¯´ä¸€ä¸‹çš„æ˜¯ `--outline-depth` ï¼Œå…¶ä»–å‚æ•°é»˜è®¤å°±å¥½äº†ã€‚\n\n\n### ä½•ä¸ºå¤§çº²\n\n\n![](https:////upload-images.jianshu.io/upload_images/3060014-05914583ee52091d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1140/format/webp)\n\n\nå¤§çº²\n\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…¶å®æˆ‘æ›´å–œæ¬¢ç§°ä¹‹ä¸ºç›®å½•æˆ–å¯¼èˆªã€‚å¤§çº²æ˜¯æ ¹æ®ä½ HTMLä¸­çš„æ ‡é¢˜(Hnæ ‡ç­¾)è‡ªåŠ¨ç”Ÿæˆçš„ã€‚\n\n\n### -outline-depth\n\n- `-outline-depth` ç”¨æ¥æŒ‡å®šç”Ÿæˆçš„å¤§çº²çš„æ·±åº¦ã€‚é»˜è®¤å€¼ä¸º 4ã€‚ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå¤§ä¸€äº›çš„æ•°å­—ï¼Œä»¥ä¿è¯æ‰€æœ‰åœ¨HTMLä¸­æŒ‡å®šçš„Hæ ‡ç­¾éƒ½èƒ½åœ¨å¤§çº²ä¸­ç”Ÿæˆå¯¹åº”çš„é¡¹ï¼Œæ–¹ä¾¿é˜…è¯»æ—¶å¿«é€Ÿè·³è½¬ã€‚\n\nå½“æŒ‡å®šäº† `--no-outline` å‚æ•°æ—¶ï¼Œ å°†ä¸ä¼šè¾“å‡ºå¤§çº²åˆ°PDFæ–‡æ¡£ï¼Œæ‰€ä»¥å†æŒ‡å®š `--outline-depth` ä¹Ÿå°±æ²¡æœ‰æ„ä¹‰äº†ã€‚\n\n\n### é¡µé¢å¯¹è±¡å‚æ•°\n\n\n```text\n    --allow <path>                æŒ‡å®šåŠ è½½HTMLä¸­ç›¸å¯¹è·¯å¾„æ–‡ä»¶çš„ç›®å½•(å¯é‡å¤ä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šå¤šä¸ª\n                                  ç›®å½•)ï¼Œè¿™ä¸ªå‚æ•°ä¼šåœ¨åé¢è¿›è¡Œæ›´è¯¦ç»†çš„è®²è§£\n    --background                  è¾“å‡ºé¡µé¢èƒŒæ™¯åˆ°PDFæ–‡æ¡£(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --no-background               ä¸è¾“å‡ºé¡µé¢èƒŒæ™¯åˆ°PDFæ–‡æ¡£\n    --cache-dir <path>            ç½‘é¡µçš„ç¼“å­˜ç›®å½•\n    --checkbox-checked-svg <path> ä½¿ç”¨æŒ‡å®šçš„SVGæ–‡ä»¶æ¸²æŸ“é€‰ä¸­çš„å¤é€‰æ¡†\n    --checkbox-svg <path>         ä½¿ç”¨æŒ‡å®šçš„SVGæ–‡ä»¶æ¸²æŸ“æœªé€‰ä¸­çš„ç­›é€‰æ¡†\n    --cookie <name> <value>       è®¾ç½®è®¿é—®ç½‘é¡µæ—¶çš„cookie,value éœ€è¦è¿›è¡Œurlç¼–ç \n                                  (å¯é‡å¤ä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šå¤šä¸ªcookie)\n    --custom-header <name> <value> è®¾ç½®è®¿é—®ç½‘é¡µæ—¶çš„HTTPå¤´(å¯é‡å¤ä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šå¤šä¸ªHTTPå¤´)\n    --custom-header-propagation   ä¸ºæ¯ä¸ªè¦åŠ è½½çš„èµ„æºæ·»åŠ ç”± --custom-header æŒ‡å®šçš„HTTPå¤´\n    --no-custom-header-propagation ä¸ä¸ºæ¯ä¸ªè¦åŠ è½½çš„èµ„æºæ·»åŠ ç”± --custom-header æŒ‡å®šçš„HTTPå¤´\n    --debug-javascript            æ˜¾ç¤ºjavascriptè°ƒè¯•è¾“å‡ºçš„ä¿¡æ¯\n    --no-debug-javascript         ä¸æ˜¾ç¤ºjavascriptè°ƒè¯•è¾“å‡ºçš„ä¿¡æ¯(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --default-header              æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„â€œå¤´â€ï¼Œåœ¨é¡µé¢çš„å·¦å¤´æ˜¾ç¤ºé¡µé¢çš„åå­—ï¼Œ\n                                  åœ¨é¡µé¢çš„å³å¤´æ˜¾ç¤ºé¡µç ï¼Œè¿™ç›¸å¯¹äºè¿›è¡Œäº†å¦‚ä¸‹è®¾ç½®ï¼š\n                                  --header-left='[webpage]'\n                                  --header-right='[page]/[toPage]'\n                                  --top 2cm\n                                  --header-line\n    --encoding <encoding>         ä¸ºè¾“å…¥çš„æ–‡æœ¬è®¾ç½®é»˜è®¤çš„ç¼–ç æ–¹å¼\n    --disable-external-links      ç¦æ­¢é¡µé¢ä¸­çš„å¤–é“¾ç”Ÿæˆè¶…é“¾æ¥\n    --enable-external-links       å…è®¸é¡µé¢ä¸­çš„å¤–é“¾ç”Ÿæˆè¶…é“¾æ¥(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --disable-forms               ä¸è½¬æ¢HTMLè¡¨å•ä¸ºPDFè¡¨å•(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --enable-forms                è½¬æ¢HTMLè¡¨å•ä¸ºPDFè¡¨å•\n    --images                      åŠ è½½å›¾ç‰‡å¹¶è¾“å‡ºåˆ°PDFæ–‡æ¡£(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --no-images                   åœ¨ç”Ÿæˆçš„PDFæ–‡æ¡£ä¸­è¿‡æ»¤æ‰å›¾ç‰‡\n    --disable-internal-links      ç¦æ­¢é¡µé¢ä¸­çš„å†…é“¾ç”Ÿæˆè¶…é“¾æ¥\n    --enable-internal-links       å…è®¸é¡µé¢ä¸­çš„å†…é“¾ç”Ÿæˆè¶…è¿æ¥(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n-n, --disable-javascript          ç¦æ­¢WEBé¡µé¢æ‰§è¡Œ javascript\n    --enable-javascript           å…è®¸WEBé¡µé¢æ‰§è¡Œ javascript(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --javascript-delay <msec>     å»¶è¿Ÿä¸€å®šçš„æ¯«ç§’ç­‰å¾…javascript æ‰§è¡Œå®Œæˆ(é»˜è®¤å€¼æ˜¯200)\n    --load-error-handling <handler> æŒ‡å®šå½“é¡µé¢åŠ è½½å¤±è´¥åçš„åŠ¨ä½œï¼Œå¯ä»¥æŒ‡å®šä¸ºï¼šabort(ä¸­æ­¢)ã€\n                                    ignore(å¿½ç•¥)ã€skip(è·³è¿‡)ï¼›(é»˜è®¤å€¼æ˜¯ï¼šabort)\n    --load-media-error-handling <handler> æŒ‡å®šå½“åª’ä½“æ–‡ä»¶åŠ è½½å¤±è´¥åçš„åŠ¨ä½œï¼Œå¯ä»¥æŒ‡å®šä¸ºï¼š\n                                          abort(ä¸­æ­¢)ã€ignore(å¿½ç•¥)ã€skip(è·³è¿‡)ï¼›\n                                          (é»˜è®¤å€¼æ˜¯ï¼šignore)\n    --disable-local-file-access   ä¸å…è®¸ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶åŠ è½½å…¶ä»–çš„æœ¬åœ°æ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°\n                                   `--allow` æŒ‡å®šçš„ç›®å½•é™¤å¤–ã€‚\n    --enable-local-file-access    å…è®¸æœ¬åœ°æ–‡ä»¶åŠ è½½å…¶ä»–çš„æœ¬åœ°æ–‡ä»¶(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --minimum-font-size <int>     è®¾ç½®æœ€å°çš„å­—å·ï¼Œé™¤éå¿…è¦ä¸æ¨èä½¿ç”¨è¯¥å‚æ•°\n    --exclude-from-outline        æ‹’ç»åŠ è½½å½“å‰é¡µé¢åˆ°PDFæ–‡æ¡£çš„ç›®å½•å’Œå¤§çº²ä¸­\n    --include-in-outline          åŠ è½½å½“å‰é¡µé¢åˆ°PDFæ–‡æ¡£çš„ç›®å½•å’Œå¤§çº²ä¸­(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --page-offset <offset>        è®¾ç½®é¡µç çš„èµ·å§‹å€¼(é»˜è®¤å€¼ä¸º0)\n    --password <password>         HTTPèº«ä»½è®¤è¯çš„å¯†ç \n    --disable-plugins             ç¦æ­¢ä½¿ç”¨æ’ä»¶(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --enable-plugins              å…è®¸ä½¿ç”¨æ’ä»¶ï¼Œä½†æ’ä»¶å¯èƒ½å¹¶ä¸å·¥ä½œ\n    --post <name> <value>         æ·»åŠ ä¸€ä¸ªPOSTå­—æ®µï¼Œå¯ä»¥é‡å¤ä½¿ç”¨è¯¥å‚æ•°æ·»åŠ å¤šä¸ªPOSTå­—æ®µã€‚\n    --post-file <name> <value>    æ·»åŠ ä¸€ä¸ªPOSTæ–‡ä»¶ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨è¯¥å‚æ•°æ·»åŠ å¤šä¸ªæ–‡ä»¶ã€‚\n    --print-media-type            ç”¨æ˜¾ç¤ºåª’ä½“ç±»å‹ä»£æ›¿å±å¹•\n    --no-print-media-type         ä¸ç”¨æ˜¾ç¤ºåª’ä½“ç±»å‹ä»£æ›¿å±å¹•\n-p, --proxy <proxy>               ä½¿ç”¨ä»£ç†\n--radiobutton-checked-svg <path>  ä½¿ç”¨æŒ‡å®šçš„SVGæ–‡ä»¶æ¸²æŸ“é€‰ä¸­çš„å•é€‰æ¡†\n--radiobutton-svg <path>          ä½¿ç”¨æŒ‡å®šçš„SVGæ–‡ä»¶æ¸²æŸ“æœªé€‰ä¸­çš„å•é€‰æ¡†\n--run-sript <js>                  é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œä¸€ä¸ªé™„åŠ çš„JSæ–‡ä»¶ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨æ­¤å‚æ•°æŒ‡å®š\n                                  å¤šä¸ªè¦åœ¨é¡µé¢åŠ è½½å®Œæˆåè¦æ‰§è¡Œçš„JSæ–‡ä»¶ã€‚\n--disable-smart-shrinking         ä¸ä½¿ç”¨æ™ºèƒ½æ”¶ç¼©ç­–ç•¥\n--enable-smart-shrinking          ä½¿ç”¨æ™ºèƒ½æ”¶ç¼©ç­–ç•¥(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n--stop-slow-scripts               åœæ­¢è¿è¡Œç¼“æ…¢çš„javascriptä»£ç (è¿™æ˜¯é»˜è®¤è®¾ç½®)\n--no-stop-slow-scripts            ä¸åœæ­¢è¿è¡Œç¼“æ…¢çš„javascriptä»£ç \n--disable-toc-back-links          ç¦æ­¢ä»æ ‡é¢˜é“¾æ¥åˆ°ç›®å½•(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n--enable-toc-back-links           å…è®¸ä»æ ‡é¢˜é“¾æ¥åˆ°ç›®å½•\n--user-style-sheet <url>          è®¾ç½®ä¸€ä¸ªåœ¨æ¯ä¸ªé¡µé¢éƒ½åŠ è½½çš„ç”¨æˆ·è‡ªå®šä¹‰æ ·å¼è¡¨\n--username <username>             HTTPèº«è°çš„ç”¨æˆ·å\n--viewport-size <>                è®¾ç½®çª—å£å¤§å°,éœ€è¦ä½ è‡ªå®šä¹‰æ»šåŠ¨æ¡æˆ–csså±æ€§æ¥è‡ªé€‚åº”çª—å£å¤§å°ã€‚\n--window-status <windowStatus>    Wait until window.status is equal to\n                                  this string before rendering page\n--zoom <float>                    è®¾ç½®è½¬æ¢æˆPDFæ—¶é¡µé¢çš„ç¼©æ”¾æ¯”ä¾‹(é»˜è®¤ä¸º1)\n\n```\n\n\nä¸Šé¢ä»£ç æ®µä¸­åªæ˜¯å¯¹æ‰€æœ‰ **é¡µé¢å¯¹è±¡å‚æ•°** åšäº†ä¸ªå¤§æ¦‚çš„è¯´æ˜ï¼Œä¸‹é¢é’ˆå¯¹ä¸ªåˆ«ä¸»è¦å‚æ•°åšæ›´è¯¦ç»†çš„è®²è§£ã€‚\n\n\n### -allow\n\n\nè¿™ä¸ªå‚æ•°åªåœ¨â€œé¡µé¢å¯¹è±¡â€æ˜¯ä¸€ä¸ªæ–‡ä»¶æ—¶æœ‰æ•ˆï¼Œåœ¨â€œé¡µé¢å¯¹è±¡â€æ˜¯ä¸€ä¸ªurlæ—¶æ­¤å‚æ•°æ— æ•ˆã€‚\n\n\nè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ä¸ºHTMLé¡µé¢ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•ç”¨çš„æ–‡ä»¶æŒ‡å®šä¸€ä¸ªåŠ è½½æ–‡ä»¶çš„åŸºç›®å½•ã€‚ä¹Ÿå°±æ˜¯è¯´HTMLæ–‡ä»¶ä¸­æ‰€æœ‰ä»¥ç›¸å¯¹è·¯å¾„æŒ‡å®šçš„æ–‡ä»¶éƒ½ä¼šä» `--allow` å‚æ•°æŒ‡å®šçš„ç›®å½•è¿›è¡ŒåŠ è½½ã€‚å…¶å®åœ¨HTMLä¸­æŒ‡å®š `base` æ ‡ç­¾å¯ä»¥è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚å¦‚æœä¸¤è€…(`--allow`å‚æ•°å’Œ`base`æ ‡ç­¾)éƒ½æ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨å½“å‰å¤„ç†çš„HTMLæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä½œä¸ºåŸºç›®å½•åŠ è½½å½“å‰å¤„ç†çš„HTMLä¸­ç›¸å¯¹è·¯å¾„æŒ‡å®šçš„æ–‡ä»¶ã€‚\n\n\n### -background AND --no-background\n\n\nè¿™ä¸¤ä¸ªå‚æ•°æ˜¯ä¸€å¯¹ï¼Œç”¨æ¥æŒ‡å®šæ˜¯å¦åœ¨ç”Ÿæˆçš„PDFä¸­åº”ç”¨ç½‘é¡µçš„èƒŒæ™¯ï¼Œé»˜è®¤ `--background` å‚æ•°æ˜¯å¼€å¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤ç”Ÿæˆçš„PDFæ–‡æ¡£ä¸­æ˜¯å¸¦æœ‰HTMLé¡µé¢çš„èƒŒæ™¯å›¾ç‰‡æˆ–èƒŒæ™¯è‰²çš„ã€‚å¦‚æœå¼€å¯ `--no-backgroupd` å‚æ•°ï¼Œåˆ™ç”Ÿæˆçš„PDFæ–‡æ¡£ä¸­ä¸ä¼šæœ‰HTMLé¡µé¢ä¸­çš„èƒŒæ™¯å›¾ç‰‡å’ŒèƒŒæ™¯è‰²ã€‚\n\n\n### -debug-javascript ADN --no-debug-javascript\n\n\nè¿™ä¸¤ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šæ˜¯å¦åœ¨æ ‡å‡†è¾“å‡ºä¸­è¾“å‡ºjavascriptçš„è°ƒè¯•ä¿¡æ¯ï¼Œé»˜è®¤ `--no-debug-javasript` å‚æ•°æ˜¯å¼€å¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤ä¸ä¼šè¾“å‡ºjavascriptçš„è°ƒè¯•ä¿¡æ¯ã€‚ä¸‹å›¾æ˜¯æ‰“å¼€ `--debug-javascript` å‚æ•°çš„æ¼”ç¤ºã€‚\n\n\n![](https:////upload-images.jianshu.io/upload_images/3060014-c9a2fdee76719829.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/861/format/webp)\n\n- -debug-javascript\n\n### -disable-external-links AND --enable-external-links\n\n\nè¿™ä¸¤ä¸ªå‚æ•°æ˜¯ç”¨æ¥è®¾ç½®åœ¨é¡µé¢ä¸­çš„å¤–é“¾æ˜¯å¦ä»¥è¶…é“¾æ¥çš„å½¢å¼å‡ºç°åœ¨PDFæ–‡æ¡£ä¸­ã€‚å…³äºâ€œå¤–é“¾â€çš„å®šä¹‰è¯·ç§»æ¶ **æœ¯è¯­å®šä¹‰** ã€‚é»˜è®¤ `--enable-external-links` å‚æ•°è¢«æ‰“å¼€ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µæ˜¯é¡µé¢ä¸­çš„å¤–é“¾æ˜¯ä»¥è¶…é“¾æ¥çš„å½¢å¼å‡ºç°çš„PDFæ–‡æ¡£ä¸­çš„ï¼Œç‚¹å‡»å¯ä»¥æ‰“å¼€æŒ‡å®šçš„ç½‘é¡µã€‚\n\n\n### -exclude-from-outline AND --include-in-outline\n\n\nè¿™ä¸¤ä¸ªå‚æ•°ç”¨æ¥è®¾ç½®å½“å‰é¡µé¢å¯¹è±¡æ˜¯å¦åŒ…å«åˆ°ç›®å½•å’Œå¤§çº²ä¸­ã€‚\né»˜è®¤æƒ…å†µä¸‹ `--include-in-outline` å‚æ•°æ˜¯æ‰“å¼€çš„ã€‚ä¹Ÿå°±æ˜¯è¯´é»˜è®¤æƒ…å†µä¸‹ç”Ÿæˆçš„PDFæ–‡æ¡£ç›®å½•å’Œå¤§çº²ä¸­æ˜¯åŒ…å«å½“å‰é¡µé¢çš„ï¼Œå¦‚æœä½ ä¸æƒ³è®©å½“å‰é¡µé¢åŠ åˆ°ç›®å½•å’Œå¤§çº²ä¸­å¯ä»¥æ‰“å¼€ `--exclude-from-outline` å‚æ•°ã€‚\n\n\n### -post AND --post-file\n\n\nå½“ç›®æ ‡é¡µé¢éœ€è¦æ¥å—POSTè¡¨å•æ‰èƒ½æ­£ç¡®å¾—åˆ°å“åº”æ—¶ï¼Œå¯ä»¥ç”¨è¿™ä¸¤ä¸ªå‚æ•°ã€‚è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯ä»¥é‡å¤ä½¿ç”¨çš„ã€‚\n\n\nè¿˜æœ‰ä¸€ä¸ªåº”ç”¨åœºæ™¯æ˜¯ï¼Œç”¨äºè‡ªåŠ¨åŒ–çš„WEBåº”ç”¨æµ‹è¯•ä¸­ã€‚å¯ä»¥å¾—åˆ°PDFæ–‡æ¡£ä½œä¸ºæµ‹è¯•æŠ¥å‘Šã€‚\n\n- `-post-file` ä¹Ÿå¯ä»¥ç”¨äºè‡ªåŠ¨æ‰¹é‡ä¸Šä¼ æ–‡ä»¶çš„åœºæ™¯ã€‚\n\n### -run-sript\n\n\nå½“éœ€è¦å¯¹é¡µé¢è¿›è¡Œä¸€å®šçš„é¢„å¤„ç†åå†ç”ŸæˆPDFæ–‡æ¡£çš„åœºæ™¯ï¼Œä½¿ç”¨è¯¥å‚æ•°å†åˆé€‚ä¸è¿‡äº†ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥é‡å¤ä½¿ç”¨æŒ‡å®šå¤šä¸ªéœ€è¦åœ¨é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œçš„JSä»£ç ã€‚ä½ å¯ä»¥åœ¨è¿™äº›JSä¸­å¯¹é¡µé¢çš„ç»“æ„å’Œå†…å®¹è¿›å¤„ç†ï¼ŒJSæ‰§è¡Œå®Œæˆåæ‰ä¼šæŠŠå¯¹åº”çš„é¡µé¢ç”ŸæˆPDFæ–‡æ¡£ã€‚\n\n\n### -disable-internal-links AND --enable-internal-links\n\n\nè¿™ä¸¤ä¸ªå‚æ•°æ˜¯ç”¨æ¥è®¾ç½®åœ¨é¡µé¢ä¸­çš„å†…é“¾æ˜¯å¦ä»¥è¶…é“¾æ¥çš„å½¢å¼å‡ºç°åœ¨PDFæ–‡æ¡£ä¸­ã€‚å…³äºâ€œå†…é“¾â€çš„å®šä¹‰è¯·ç§»æ¶ **æœ¯è¯­å®šä¹‰** ã€‚é»˜è®¤ `--enable-internal-links` å‚æ•°è¢«æ‰“å¼€ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µæ˜¯é¡µé¢ä¸­çš„å†…é“¾æ˜¯ä»¥è¶…é“¾æ¥çš„å½¢å¼å‡ºç°çš„PDFæ–‡æ¡£ä¸­çš„ï¼Œç‚¹å‡»åœ¨å½“å‰PDFä¸­è·³è½¬åˆ°æŒ‡å®šé”šç‚¹ã€‚\n\n\n### -enable-toc-back-links AND --disable-toc-back-links\n\n\nè¿™ç»„å‚æ•°ç”¨æ¥è®¾ç½®ï¼Œæ˜¯å¦åœ¨PDFå†…å®¹ä¸­çš„Hæ ‡ç­¾å¤„ç”Ÿæˆè¶…é“¾æ¥ã€‚ç”Ÿæˆçš„è¶…é“¾æ¥ç‚¹å‡»åä¼šè·³è½¬åˆ°ç›®å½•å’Œå¤§çº²ä¸­è¯¥Hæ ‡ç­¾å¯¹åº”çš„é”šç‚¹ä½ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ `--disable-toc-back-links` å‚æ•°è¢«æ‰“å¼€ï¼Œä¸ä¼šåœ¨PDFæ–‡æ¡£çš„Hæ ‡ç­¾å¤„ç”Ÿæˆè¶…é“¾æ¥ã€‚\n\n\nå¦‚æœä½ éœ€è¦åœ¨é˜…è¯»PDFæ–‡æ¡£çš„å†…å®¹æ—¶å¿«é€Ÿå›åˆ°ç›®å½•ï¼Œä½ å¯ä»¥æ‰“å¼€ `--enable-toc-back-links` å‚æ•°ã€‚\n\n\n### -user-style-sheet\n\n\nè¿™ä¸ªå‚æ•°ç”¨æ¥åŠ è½½ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„æ ·å¼è¡¨ï¼Œç”¨æ¥æ”¹å˜HTMLé¡µé¢åŸæœ‰çš„æ ·å¼ã€‚éœ€è¦é«˜åº¦è‡ªå®šä¹‰é¡µé¢æ–°å¼çš„åŒå­¦å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ªå‚æ•°è¾¾åˆ°ç›®çš„ã€‚\n\n\n### é¡µçœ‰å’Œé¡µè„šå‚æ•°é€‰é¡¹\n\n\n```text\n    --footer-center <text>        åœ¨é¡µè„šçš„å±…ä¸­éƒ¨åˆ†æ˜¾ç¤ºé¡µè„šæ–‡æœ¬ <text>\n    --footer-font-name <name>     è®¾ç½®é¡µè„šçš„å­—ä½“ (é»˜è®¤ä¸º Arial)\n    --footer-font-size <size>     è®¾ç½®é¡µè„šçš„å­—ä½“å¤§å° (é»˜è®¤ä¸º 12)\n    --footer-html <url>           æ·»åŠ ä¸€ä¸ªhtmlä½œä¸ºé¡µè„š\n    --footer-left <text>          åœ¨é¡µè„šçš„å±…å·¦éƒ¨åˆ†æ˜¾ç¤ºé¡µè„šæ–‡æœ¬ <text>\n    --footer-line                 åœ¨é¡µè„šä¸Šæ–¹æ˜¾ç¤ºä¸€æ¡ç›´çº¿åˆ†éš”æ­£æ–‡\n    --no-footer-line              ä¸ä½¿ç”¨ç›´çº¿åˆ†éš”é¡µè„šä¸æ­£æ–‡(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --footer-right <text>         åœ¨é¡µè„šçš„å±…å³éƒ¨åˆ†æ˜¾ç¤ºé¡µè„šæ–‡æœ¬ <text>\n    --footer-spacing <real>       é¡µè„šä¸æ­£æ–‡ä¹‹é—´çš„è·ç¦»(é»˜è®¤ä¸ºé›¶)\n\n\n    --header-center <text>        åœ¨é¡µçœ‰çš„å±…ä¸­éƒ¨åˆ†æ˜¾ç¤ºé¡µçœ‰æ–‡æœ¬ <text>\n    --header-font-name <name>     è®¾ç½®é¡µçœ‰çš„å­—ä½“ (é»˜è®¤ä¸º Arial)\n    --header-font-size <size>     è®¾ç½®é¡µçœ‰çš„å­—ä½“å¤§å° (é»˜è®¤ä¸º 12)\n    --header-html <url>           æ·»åŠ ä¸€ä¸ªhtmlä½œä¸ºé¡µçœ‰\n    --header-left <text>          åœ¨é¡µçœ‰çš„å±…å·¦éƒ¨åˆ†æ˜¾ç¤ºé¡µçœ‰æ–‡æœ¬ <text>\n    --header-line                 åœ¨é¡µçœ‰ä¸‹æ–¹æ˜¾ç¤ºä¸€æ¡ç›´çº¿åˆ†éš”æ­£æ–‡\n    --no-header-line              ä¸ä½¿ç”¨ç›´çº¿åˆ†éš”é¡µçœ‰ä¸æ­£æ–‡(è¿™æ˜¯é»˜è®¤è®¾ç½®)\n    --header-right <text>         åœ¨é¡µçœ‰çš„å±…å³éƒ¨åˆ†æ˜¾ç¤ºé¡µçœ‰æ–‡æœ¬ <text>\n    --header-spacing <real>       é¡µçœ‰ä¸æ­£æ–‡ä¹‹é—´çš„è·ç¦»(é»˜è®¤ä¸ºé›¶)\n\n```\n\n\né¡µçœ‰é¡µè„šçš„è®¾ç½®æ¯”è¾ƒç®€å•ï¼Œçœ‹ä¸Šè¿°ä»£ç æ®µä¸­çš„è§£é‡Šå·²ç»éå¸¸æ˜äº†ï¼Œæ‰€ä»¥ä¸å†èµ˜è¿°ã€‚åé¢è¿˜æœ‰é’ˆå¯¹é¡µçœ‰ä¸é¡µè„šçš„å…¶ä»–ç›¸å…³ä»‹ç»ã€‚\n\n\n### ç›®å½•å¯¹è±¡å‚æ•°\n\n\n```text\n    --disable-dotted-lines        åœ¨ç›®å½•ä¸­ä¸ä½¿ç”¨è™šçº¿\n    --toc-header-text <text>      è®¾ç½®ç›®å½•çš„é¡µçœ‰æ–‡æœ¬\n    --toc-level-indentation <width> ç¬¬çº§æ ‡é¢˜åœ¨ç›®å½•ä¸­çš„ç¼©è¿›å®½åº¦(é»˜è®¤ä¸º1em)\n    --disable-toc-links           åœ¨ç›®å½•ä¸­ä¸ç”ŸæˆæŒ‡å‘å†…å®¹é”šç‚¹çš„è¶…é“¾æ¥\n    --toc-text-size-shrink <real> åœ¨ç›®å½•ä¸­æ¯çº§æ ‡é¢˜çš„ç¼©æ”¾æ¯”ä¾‹(é»˜è®¤ä¸º0.8)\n    --xsl-style-sheet <file>      ä½¿ç”¨è‡ªå®šä¹‰çš„ XSL æ ·å¼è¡¨æ˜¾ç¤ºç›®å½•å†…å®¹\n\n```\n\n\nâ€œç›®å½•å¯¹è±¡â€æˆ‘ä»¬ä¸€èˆ¬ç”¨ä¸åˆ°ï¼Œä¸Šè¿°ä»£ç æ®µä¸­çš„è®²è§£ä¹Ÿä¸éš¾æ‡‚ï¼Œæ‰€ä»¥ä¸é’ˆå¯¹æ¯ä¸€ä¸ªå…·ä½“å‚æ•°å†åšè¯¦ç»†çš„è®²è§£ã€‚\n\n\n## å…³äºé¡µé¢å°ºå¯¸è¯´æ˜\n\n\né»˜è®¤çš„é¡µé¢å°ºå¯¸æ˜¯ A4ï¼Œä½ å¯ä»¥ä½¿ç”¨ `--page-size` å‚æ•°æŒ‡å®šä½ æƒ³è¦çš„é¡µé¢å°ºå¯¸ï¼Œå¦‚ï¼šA3ï¼ŒLetter å’Œ Legalç­‰ã€‚æƒ³è¦æŸ¥çœ‹æœ¬ç¨‹åºæ”¯æŒçš„æ‰€æœ‰é¡µé¢å°ºå¯¸ï¼Œè¯·è®¿é—® [http://qt-project.org/doc/qt-4.8/qprinter.html#PaperSize-enum](http://qt-project.org/doc/qt-4.8/qprinter.html#PaperSize-enum)\n\n\nä½ è¿˜å¯ä»¥ä½¿ç”¨ `--page-height` å’Œ `--page-width` å¯¹é¡µé¢å°ºå¯¸è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ã€‚\n\n\n## ä»æ ‡å‡†è¾“å…¥è·å–å‚æ•°\n\n\nå¦‚æœä½ éœ€è¦å¯¹è®¸å¤šé¡µé¢è¿›è¡Œæ‰¹é‡çš„å¤„ç†ï¼Œå¹¶ä¸”æ„Ÿè§‰ wkhtmltopdf å¼€å¯æ¯”è¾ƒæ…¢ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨ `--read-args-from-stdin` å‚æ•°ã€‚\n\n\nwkhtmltopdf å‘½ä»¤ä¼šä¸º `--read-args-from-stdin` å‚æ•°å‘é€è¿‡æ¥çš„æ¯ä¸€è¡Œè¿›è¡Œä¸€æ¬¡å•ç‹¬å‘½ä»¤è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´æ­¤å‚æ•°æ¯è¯»å–ä¸€è¡Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ wkhtmltopdf å‘½ä»¤ã€‚è€Œæœ€ç»ˆæ‰§è¡Œçš„å‘½ä»¤ä¸­çš„å‚æ•°æ˜¯å‘½ä»¤è¡Œä¸­å‚æ•°ä¸æ­¤å‚æ•°è¯»å–çš„æ ‡å‡†è¾“å…¥æµä¸­å‚æ•°çš„ç»“åˆã€‚\n\n\nä¸‹é¢çš„ä»£ç æ®µæ˜¯ä¸€ä¸ªä¾‹å­:\n\n\n```text\necho \"<http://qt-project.org/doc/qt-4.8/qapplication.html> qapplication.pdf\" >> cmds\necho \"cover google.com <http://en.wikipedia.org/wiki/Qt_(software)> qt.pdf\" >> cmds\nwkhtmltopdf --read-args-from-stdin --book < cmds\n\n```\n\n\n## æŒ‡ä»¤ä¸€ä¸ªä»£ç†\n\n\né»˜è®¤æƒ…å†µä¸‹ä»£ç†ä¿¡æ¯å°†è¯»å–ç¯å¢ƒå˜é‡:proxyã€all_proxy å’Œ http_proxy,ä»£ç†é€‰é¡¹è¿˜å¯ä»¥é€šè¿‡æŒ‡å®š `-p` å‚æ•°å¼€å¯ã€‚\n\n\nä½¿ç”¨ BNF å¯¹ä»£ç†çš„å®šä¹‰å¦‚ä¸‹ï¼š\n\n\n```text\n<type> := \"http://\" | \"socks5://\"\n<serif> := <username> (\":\" <password>)? \"@\"\n<proxy> := \"None\" | <type>? <serif>? <host> (\":\" <port>)?\n\n```\n\n\nå¦‚æœä½ ä¸ç†Ÿæ‚‰ BNF çš„è¯ï¼Œä¸‹é¢çš„ä»£ç æ®µä¸­æ˜¯ä¸‰ä¸ªä¾‹å­:\n\n\n```text\n<http://user:password@myproxyserver:8080>\nsocks5://myproxyserver\nNone\n\n```\n\n\n## é¡µçœ‰å’Œé¡µè„š\n\n\né¡µçœ‰å’Œé¡µè„šå¯ä»¥ä½¿ç”¨å‚æ•° `--header-*` å’Œ `--footer-*` æ·»åŠ åˆ°æ–‡ä»¶ä¸­ã€‚æœ‰äº›å‚æ•°(å¦‚ `--footer-left`)éœ€è¦æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²`text`ä½œä¸ºå‚æ•°å€¼ã€‚ä½ å¯ä»¥åœ¨ `text`ä¸­æ’å…¥ä¸‹è¿°å˜é‡ï¼Œä»–ä»¬å°†ä¼šè¢«æ›¿æ¢æˆå¯¹åº”çš„å€¼ã€‚\n\n\n```text\n[page]       å½“å‰æ­£åœ¨è¢«è¾“å‡ºé¡µé¢çš„é¡µç \n[frompage]   ç¬¬ä¸€é¡µåœ¨æ–‡æ¡£ä¸­çš„é¡µç \n[topage]     æœ€åä¸€é¢åœ¨æ–‡æ¡£ä¸­çš„é¡µç \n[webpage]    å½“å‰æ­£åœ¨è¢«è¾“å‡ºé¡µé¢çš„URL\n[section]    å½“å‰æ­£åœ¨è¢«è¾“å‡ºçš„ç« èŠ‚çš„åå­—\n[subsection] å½“å‰æ­£åœ¨è¢«è¾“å‡ºçš„å°èŠ‚çš„åå­—\n[date]       æœ¬åœ°ç³»ç»Ÿæ ¼å¼çš„å½“å‰æ—¥æœŸ\n[isodate]    ISO 8601 æ ¼å¼çš„å½“å‰æ—¥æœŸ\n[time]       æœ¬åœ°ç³»ç»Ÿæ ¼å¼çš„å½“å‰æ—¶é—´\n[title]      å½“å‰å¯¹è±¡çš„æ ‡é¢˜\n[doctitle]   è¾“å‡ºæ–‡æ¡£çš„æ ‡é¢˜\n[sitepage]   å½“å‰æ­£åœ¨å¤„ç†çš„å¯¹è±¡ä¸­å½“å‰é¡µé¢çš„é¡µç \n[sitepages]  å½“å‰æ­£åœ¨å¤„ç†çš„å¯¹è±¡ä¸­çš„æ€»é¡µæ•°\n\n```\n\n\nä¸¾ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜å§ï¼Œ`--header-right \"Page [page] of [toPage]\"`, ä¼šåœ¨é¡µé¢çš„å³ä¸Šè§’ç”Ÿæˆä¸€ä¸ªç±»ä¼¼ `Page x of y` çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ `x` æ˜¯å½“å‰é¡µé¢çš„é¡µç ï¼Œ `y` æ˜¯å½“å‰æ–‡æ¡£æœ€åä¸€é¡µçš„é¡µç ã€‚\n\n\né¡µçœ‰å’Œé¡µè„šä¹Ÿå¯ä»¥é€šè¿‡ HTMLæ–‡æ¡£æ¥æä¾›ã€‚ åŒæ ·ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨å‘½ä»¤è¡Œå‚æ•° `--header-html header.html` æ¥ç”Ÿæˆé¡µçœ‰ï¼Œè€Œ header.html çš„å†…å®¹å¦‚ä¸‹:\n\n\n```text\n<html><head><script>\nfunction subst() {\n  var vars={};\n  var x=window.location.search.substring(1).split('&');\n  for (var i in x) {var z=x[i].split('=',2);vars[z[0]] = unescape(z[1]);}\n  var x=['frompage','topage','page','webpage','section','subsection','subsubsection'];\n  for (var i in x) {\n    var y = document.getElementsByClassName(x[i]);\n    for (var j=0; j<y.length; ++j) y[j].textContent = vars[x[i]];\n  }\n}\n</script></head><body style=\"border:0; margin: 0;\" onload=\"subst()\">\n<table style=\"border-bottom: 1px solid black; width: 100%\">\n  <tr>\n    <td class=\"section\"></td>\n    <td style=\"text-align:right\">\n      Page <span class=\"page\"></span> of <span class=\"topage\"></span>\n    </td>\n  </tr>\n</table>\n</body></html>\n\n```\n\n\n## å¤§çº²(Outlines)\n\n\nwkhtmltopdf å¯ä»¥ä½¿ç”¨ `--outline` å‘½ä»¤è¡Œå‚æ•°æ¥æŒ‡å®šåœ¨PDFå°±è¦ä¸­è¾“å‡ºåƒä¹¦æœ¬ä¸­ç›®å½•ä¸€æ ·çš„â€œå¤§çº²â€ï¼Œâ€œå¤§çº²â€æ˜¯åŸºæœ¬HTMLæ–‡æ¡£ä¸­Hæ ‡ç­¾ç”Ÿæˆçš„ï¼Œå…·ä½“çš„å¤§çº²çš„å±‚çº§å’Œå°è¯•è¯·ç§»æ­¥ **ç›®å½•**\n\n\nå¦‚æœHTMLæ–‡æ¡£ä¸­çš„Hæ ‡ç­¾ç­‰çº§æ¯”è¾ƒå¤šï¼Œå°±å¯ä»¥ç”Ÿæˆæ·±å±‚çº§æ ‘å½¢ç»“æ„çš„â€œå¤§çº²â€ï¼Œè€Œç”Ÿæˆâ€œå¤§çº²â€çš„çœŸå®æ·±åº¦æ˜¯é€šè¿‡ `--outline-depth` å‚æ•°æ¥æ§åˆ¶ã€‚\n\n\n## ç›®å½•\n\n\né€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ  TOCå¯¹è±¡ å¯ä»¥æŠŠä¸€ä¸ªç›®å½•æ·»åŠ åˆ°ç”Ÿæˆçš„PDFæ–‡æ¡£ä¸­ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç æ®µï¼š\n\n\n```text\nwkhtmltopdf toc <http://qt-project.org/doc/qt-4.8/qstring.html> qstring.pdf\n\n```\n\n\nç”Ÿæˆçš„ç›®å½•ä¹Ÿæ˜¯åŸºäºHTMLæ–‡æ¡£çš„Hæ ‡ç­¾ã€‚è¿‡ç¨‹æ˜¯é¦–å…ˆç”Ÿæˆä¸€ä¸ªXMLæ–‡æ¡£,ç„¶åä½¿ç”¨XSLTè½¬æ¢ä¸ºHTMLã€‚\nç”Ÿæˆçš„ XML æ–‡æ¡£å¯ä»¥é€šè¿‡ `--dump-outline` å‚æ•°æŸ¥çœ‹ã€‚\n\n\n```text\nwkhtmltopdf --dump-outline toc.xml <http://qt-project.org/doc/qt-4.8/qstring.html> qstring.pdf\n\n```\n\n\nä½ å¦‚æœæƒ³è¦ä½¿ç”¨è‡ªå®šä¹‰çš„XSLTæ–‡æ¡£å¯ä»¥é€šè¿‡ `--xsl-style-sheet` å‚æ•°æŒ‡å®š\n\n\n```text\nwkhtmltopdf toc --xsl-style-sheet my.xsl <http://qt-project.org/doc/qt-4.8/qstring.html> qstring.pdf\n\n```\n\n\nä½ å¯ä»¥ä½¿ç”¨ `--dump-default-toc-xsl` å‚æ•°æŠŠé»˜è®¤çš„ XSLT æ–‡æ¡£æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œç„¶ååŸºäºå®ƒåˆ›å»ºä½ çš„è‡ªå®šä¹‰ XSLT æ–‡æ¡£ã€‚\n\n\n```text\nwkhtmltopdf --dump-default-toc-xsl\n\n```\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-03-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "39",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å›¾åƒå¤„ç†"
        ],
        "summary": "wkhtmltopdfç²¾è®²(åŸæ–‡) ä½œè€…ï¼šJSON_NULLæœ¯è¯­å®šä¹‰æ–‡æ¡£å¯¹è±¡â€œæ–‡æ¡£å¯¹è±¡â€æ˜¯æŒ‡PDFæ–‡æ¡£ä¸­çš„æ–‡æ¡£å¯¹è±¡ï¼Œå…±æœ‰ä¸‰ç§ç±»å‹çš„â€œæ–‡æ¡£å¯¹è±¡â€ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯â€œé¡µé¢å¯¹è±¡â€ï¼Œâ€œå°é¢å¯¹è±¡â€å’Œâ€œç›®å½•å¯¹è±¡â€ã€‚é¡µé¢",
        "sort": "",
        "title": "wkhtmltopdfè¯¦ç»†ä½¿ç”¨",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "07c3aa88-08b7-4093-9ac6-0a495a187163"
        }
      ],
      "body": "",
      "realName": "wkhtmltopdfè¯¦ç»†ä½¿ç”¨",
      "relativePath": "/archives/wkhtmltopdfè¯¦ç»†ä½¿ç”¨.md"
    },
    {
      "id": "a60e468f-c55d-4add-a043-970fc03927d0",
      "doc_id": "a60e468f-c55d-4add-a043-970fc03927d0",
      "title": "a60e468f-c55d-4add-a043-970fc03927d0",
      "updated": 1696747320000,
      "body_original": "\n# wkhtmltopdf\n\n\n> â€œwkhtmltopdf\"ï¼Œæ˜¯ä¸€ä¸ªèƒ½å¤ŸæŠŠç½‘é¡µ/æ–‡ä»¶è½¬æ¢æˆPDFçš„å·¥å…·ã€‚å·¥å…·å…¨åå« \"wkhtmltopdf\" ;  æ˜¯ä¸€ä¸ªä½¿ç”¨ Qt WebKit å¼•æ“åšæ¸²æŸ“çš„ï¼Œèƒ½å¤ŸæŠŠhtml æ–‡æ¡£è½¬æ¢æˆ pdf æ–‡æ¡£ æˆ– å›¾ç‰‡(image) çš„**â€œå‘½ä»¤è¡Œå·¥å…·â€**ã€‚\n\n\n\tæ”¯æŒå¤šä¸ªå¹³å°ï¼Œå¯åœ¨winï¼Œlinuxï¼Œos x ç­‰ç³»ç»Ÿä¸‹è¿è¡Œã€‚\n\n\n## å®‰è£…\n\n\n        é€šè¿‡æ–‡ç« åº•éƒ¨çš„ä¸‹è½½è¿æ¥é€‰æ‹©é€‚åˆçš„ç‰ˆæœ¬**æ³¨æ„ç³»ç»Ÿç‰ˆæœ¬** æ­¤å¤„æŒ‰ç…§liunxç‰ˆæœ¬æ¥è®²è§£\n\n\n       liunxç‰ˆæœ¬çš„å®‰è£…ç›¸å¯¹æ¯”è¾ƒç®€å•ç›´æ¥è§£å‹å³å¯ è§£å‹åç›®å½•ä¸ºuseï¼Œé‡å‘½åä¸ºwkhtmltopdfï¼ˆå¼ºè¿«ç—‡ï¼‰ã€‚ ç›®å½•ç»“æ„\n\n\n`/wkhtmltopdf/local/bin/`\n\n\n![](https://blog-file.hehouhui.cn/202203152219619.png)\n\n- wkhtmltopdf æŠŠä¸€ä¸ªæ–‡ä»¶æˆ–ç½‘é¡µè½¬æˆpdf\n- wkhtmltoimage æŠŠä¸€ä¸ªæ–‡ä»¶æˆ–ç½‘é¡µè½¬æˆå›¾ç‰‡\n\n> å¦¥å¦¥çš„è§åçŸ¥æ„\n\n\n## ä½¿ç”¨\n\n\n### æŠŠä¸€ä¸ªhtmlæ–‡ä»¶è½¬æ¢æˆPDF\n\n\nå‘½ä»¤æ ¼å¼ ï¼š`wkhtmltopdf xxx.html xxx.pdf`\n\n\n```text\nwkhtmltopdf 1.html 1.pdf\nLoading pages (1/6)\nCounting pages (2/6)\nResolving links (4/6)\nLoading headers and footers (5/6)\nPrinting pages (6/6)\nDone\n\n```\n\n\nå½“ä½ çœ‹åˆ°ç±»ä¼¼ä¸Šé¢çš„å†…å®¹æ—¶ï¼Œè¯´è½¬æ¢å·²ç»å®Œæˆäº†ï¼Œå»æ‰“å¼€è½¬æ¢å¥½çš„pdfæ–‡æ¡£æ…¢æ…¢ç ”ç©¶å§ã€‚\n\n\n### æŠŠä¸€ä¸ª url æŒ‡å‘çš„ç½‘é¡µè½¬æ¢æˆPDF\n\n\nå‘½ä»¤æ ¼å¼ ï¼š `wkhtmltopdf url xxx.pdf`\n\n\n```text\nwkhtmltopdf www.yioks.com yioks.pdf\nLoading pages (1/6)\nQFont::setPixelSize: Pixel size <= 0 (0)                     ] 55%\nCounting pages (2/6)\nQFont::setPixelSize: Pixel size <= 0 (0)=====================] Object 1 of 1\nResolving links (4/6)\nLoading headers and footers (5/6)\nPrinting pages (6/6)\nDone\n\n```\n\n\nå½“ä½ çœ‹åˆ°å¦‚ä¸Šä¿¡æ¯æ—¶ä»£è¡¨è½¬æ¢æˆåŠŸï¼Œæ˜¯ä¸æ˜¯å¾ˆé…·ã€‚\n\n\n### æŠŠhtmlæ–‡ä»¶ å’Œ urlæŒ‡å‘çš„ç½‘é¡µ è½¬æ¢æˆå›¾ç‰‡\n\n\nå‘½ä»¤æ ¼å¼ ï¼š\n\n\n```text\nwkhtmltoimage xxx.html xxx.jpg\nwkhtmltoimage url xxx.jpg\n\n```\n\n\nå…¶å®å’Œè½¬pdfæ—¶çš„å‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å‘½ä»¤å’Œè¾“å‡ºæ–‡ä»¶çš„æ‰©å±•åå˜äº†ã€‚ä¸Šçš„å‘½ä»¤æ ¼å¼ä¸­ï¼Œæˆ‘æ˜¯æŠŠå›¾ç‰‡ä¿å­˜æˆäº† jpg æ ¼å¼ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ æ„¿æ„ä¹Ÿå¯ä»¥ä¿å­˜æˆå…¶ä»–å›¾ç‰‡æ ¼å¼(å¦‚ï¼špng)ï¼Œä½†æ–‡ä»¶å¯èƒ½ä¼šå˜å¤§å¾ˆå¤šå€ã€‚åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œjpgæ ¼å¼æ–‡ä»¶æ˜¯æœ€å°çš„ã€‚\n\n\n## ä½¿ç”¨è¿‡ç¨‹ä¸­çš„é—®é¢˜\n\n- liunxç¯å¢ƒä¸‹ä¸­æ–‡ä¹±ç \n- éƒ¨åˆ†liunxæœåŠ¡å™¨ç¼ºå°‘ä¾èµ–lib\n- *ä¸­æ–‡ä¹±ç  **\n\nliunxä¸­ç¼ºå°‘ä¸­æ–‡ï¼ˆå®‹ä½“ï¼‰å­—ä½“æ–‡ä»¶ï¼Œ\n\n\n([ä¸‹è½½å­—ä½“æ–‡ä»¶](https://blog-file.hehouhui.cn/202203152226460.zip))\n\n\næ”¾ç½®æœåŠ¡å™¨ä¸­ `/usr/share/fonts`ç›®å½•ä¸‹\n\n\n![](https://blog-file.hehouhui.cn/202203152228291.png)\n\n\n**ç¼ºå°‘lib**\n\n\nlibjpeg.so.62 çš„è§£å†³æ–¹æ¡ˆ\n\n\n![](https://blog-file.hehouhui.cn/202203152229619.png)\n\n\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä¸‹è½½ä¾èµ–\n\n\n`yum install fontconfig freetype libpng libjpeg libX11 libXext libXrender xorg-x11-fonts-Type1 xorg-x11-fonts-75dpi`\n\n\n## å…¶ä»–çš„htmlè½¬pdfæ–¹æ¡ˆ\n\n- itextpdf.html2pdf å¯è½¬æ¢æ ·å¼ç®€å•çš„htmlä½¿ç”¨ç®€å•é€Ÿåº¦å¿«ï¼Œå¯¹CSSæ ·å¼æ”¯æŒä¸æ˜¯å¾ˆå¥½ã€‚åœ¨contractä¸­çš„å®ç°ä¸º **PdfGeneratorIText**\n- lowagie.itext å¯è½¬æ¢è¾ƒå¤æ‚çš„htmlï¼Œä½†å¯¹æ ¼å¼æå…¶ä¸¥è‹›ã€‚é€Ÿåº¦å¿«\n\n> ä¹Ÿæœ‰å…¶ä»–å‡ æ¬¾è½¬æ¢å·¥å…·ä½†éƒ½æœ‰æˆ–å¤šæˆ–å°‘çš„ç¼ºé™·ï¼Œwkhtmltopdf è™½è¯´æ…¢è‡³å°‘æ ·å¼è¿˜è¡Œ\n\n\n## ä¸‹è½½é“¾æ¥\n\n\n[ã€å®˜ç½‘ã€‘](http://wkhtmltopdf.org/):[ã€](http://wkhtmltopdf.org/)[http://wkhtmltopdf.org/ã€‘](http://wkhtmltopdf.org/%E3%80%91)\n\n\n[ã€ä¸‹è½½åˆ—è¡¨ã€‘](http://wkhtmltopdf.org/downloads.html)\n\n\n([è¯¦ç»†ä½¿ç”¨](https://blog.hehouhui.cn/archives/39))\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-03-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "40",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å›¾åƒå¤„ç†"
        ],
        "summary": "â€œwkhtmltopdf\"ï¼Œæ˜¯ä¸€ä¸ªèƒ½å¤ŸæŠŠç½‘é¡µ/æ–‡ä»¶è½¬æ¢æˆPDFçš„å·¥å…·ã€‚å·¥å…·å…¨åå« \"wkhtmltopdf\" ; æ˜¯ä¸€ä¸ªä½¿ç”¨ Qt WebKit å¼•æ“åšæ¸²æŸ“çš„ï¼Œèƒ½å¤ŸæŠŠhtml æ–‡æ¡£è½¬æ¢æˆ pdf æ–‡æ¡£ æˆ– å›¾ç‰‡(image) çš„**â€œå‘½ä»¤è¡Œå·¥å…·â€**ã€‚\næ”¯æŒå¤šä¸ªå¹³å°ï¼Œå¯åœ¨winï¼Œlinuxï¼Œos x ç­‰ç³»ç»Ÿä¸‹è¿è¡Œã€‚",
        "sort": "",
        "title": "wkhtmltopdf å®‰è£…",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "a60e468f-c55d-4add-a043-970fc03927d0"
        }
      ],
      "body": "",
      "realName": "wkhtmltopdf å®‰è£…",
      "relativePath": "/archives/wkhtmltopdf å®‰è£….md"
    },
    {
      "id": "6a6aca31-1871-49f3-a600-5062cb673260",
      "doc_id": "6a6aca31-1871-49f3-a600-5062cb673260",
      "title": "6a6aca31-1871-49f3-a600-5062cb673260",
      "updated": 1696747320000,
      "body_original": "\n# \n\n\nSILK v3ç¼–ç æ˜¯Skypeå‘ç¬¬ä¸‰æ–¹å¼€å‘äººå‘˜å’Œç¡¬ä»¶åˆ¶é€ å•†æä¾›å…ç‰ˆç¨è®¤è¯(RF)çš„Silkå®½å¸¦éŸ³é¢‘ç¼–ç å™¨ï¼ŒSkypeåæ¥å°†å…¶å¼€æºã€‚å…·ä½“å¯è§Wikipediaã€‚\n\n\n> ä¹‹å‰ä¸€ç›´ä½¿ç”¨ffmpegæ¥è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œä½†æ˜¯å°†å¾®ä¿¡çš„amrè½¬ä¸ºmp3åè¯­éŸ³è´¨é‡ä¸ç†æƒ³ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘å‚æ•°æ²¡æœ‰è°ƒæ­£ç¡®ğŸ¤ªï¼‰ã€‚  \n> äºæ˜¯å°±ç»§ç»­æƒ³è§£å†³åŠæ³•ï¼Œåæ¥åœ¨githubçé€›æ—¶çœ‹åˆ°å¯ä»¥ä½¿ç”¨silk-v3-decoderæ¥åšè¿™ä»¶äº‹æƒ…ã€‚è™½ç„¶æœ¬è´¨ä¸Šè¿˜æ˜¯ä½¿ç”¨çš„ffmpegæ¥è½¬çš„ï¼Œåªæ˜¯å°è£…äº†ä¸€ä¸‹ã€‚\n\n\n([å‰å¾€silk-v3-decoder](https://github.com/kn007/silk-v3-decoder))\n\n\n++ç¯å¢ƒè¦æ±‚gccå’Œffmpegï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—è¦å®‰è£…ffmpegï¼Œgccæ˜¯æ‹¿æ¥ç¼–è¯‘silk-v3-decoderæºç ï¼Œffmpegæ˜¯æ‹¿æ¥è½¬æ¢æ ¼å¼çš„ã€‚++\n\n\n## å®‰è£…gcc\n\n\n```text\nyum -y install gcc\nyum -y install gcc-c++\n\n```\n\n\n## ffmpeg å®‰è£…\n\n\næ‰“å¼€å®˜ç½‘åœ°å€ï¼Œè¿›å…¥ä¸‹è½½é¡µï¼š[https://ffmpeg.org/download.html#build-linux](https://ffmpeg.org/download.html#build-linux)\n\n\n![](https://blog-file.hehouhui.cn/202203172321911.png)\n\n\né€‰æ‹©Linux Static Buildsä¸‹çš„æ„å»ºé€‰é¡¹ï¼Œè¿›å…¥è¯¦æƒ…é¡µ\n\n\n![](https://blog-file.hehouhui.cn/202203172323866.png)\n\n\nåœ¨åˆ—è¡¨ä¸­é€‰æ‹©é€‚åˆè‡ªå·±çš„ç‰ˆæœ¬ï¼Œé¼ æ ‡å³é”®ï¼Œå¤åˆ¶é“¾æ¥åœ°å€\n\n\n```text\n# ä¸‹è½½æ–‡ä»¶\nwget <https://johnvansickle.com/ffmpeg/builds/ffmpeg-git-amd64-static.tar.xz>\n\n# è§£å‹\nxz -d ffmpeg-git-amd64-static.tar.xz\n\n# å†æ¬¡è§£å‹\ntar -xvf ffmpeg-git-amd64-static.tar\n\n\n```\n\n\nå¾—åˆ°ç›®å½•\n\n\n![](https://blog-file.hehouhui.cn/202203172329558.png)\n\n\nffmpeg å’Œ ffprobe éƒ½åœ¨è¿™é‡Œ\n\n\n> å¦‚æœæƒ³è¦ffmpegå‘½ä»¤å…¨å±€å¯ç”¨ï¼Œå¯ä»¥åœ¨binç›®å½•åŠ ä¸ªé“¾æ¥ã€‚æ¯”å¦‚ï¼Œåˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå³å¯åœ¨:/usr/binç›®å½•ä¸‹åˆ›å»ºffmpegå’Œffprobeè½¯é“¾æ¥ã€‚\n\n\n```text\ncd /usr/bin\nln -s è§£å‹ç›®å½•/ffmpeg ffmpeg\nln -s è§£å‹ç›®å½•/ffprobe ffprobe\n\n```\n\n\n## ä¸‹è½½silk-v3-decoderæºç \n\n\n```text\n  <https://ghproxy.com/https://github.com/kn007/silk-v3-decoder/archive/refs/heads/master.zip>\n\n```\n\n\n![](https://blog-file.hehouhui.cn/202203172333398.png)\n\n\nç»™è„šæ­¥èµ‹æ‰§è¡Œæƒé™\n\n\n```text\n   chmod +x converter.sh\n   chmod +x converter_beta.sh\n\n```\n\n\n## ä½¿ç”¨\n\n\n```text\n   silk-v3-decoderç›®å½•/converter.sh silkéŸ³é¢‘æ–‡ä»¶è·¯å¾„ mp3\n\n```\n\n\n> ç¬¬ä¸€ä¸ªä¸ºæ‰§è¡Œè„šæœ¬ ç¬¬äºŒä¸ªä¸ºsilkéŸ³é¢‘å¦‚amræ–‡ä»¶è·¯å¾„  ç¬¬ä¸‰ä¸ªä¸ºéœ€è¦è½¬æ¢ä¸ºçš„éŸ³é¢‘æ ¼å¼\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-03-17",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "41",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Python",
          "å¥åº·"
        ],
        "summary": "ä¹‹å‰ä¸€ç›´ä½¿ç”¨ffmpegæ¥è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œä½†æ˜¯å°†å¾®ä¿¡çš„amrè½¬ä¸ºmp3åè¯­éŸ³è´¨é‡ä¸ç†æƒ³ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘å‚æ•°æ²¡æœ‰è°ƒæ­£ç¡®ğŸ¤ªï¼‰ã€‚\näºæ˜¯å°±ç»§ç»­æƒ³è§£å†³åŠæ³•ï¼Œåæ¥åœ¨githubçé€›æ—¶çœ‹åˆ°å¯ä»¥ä½¿ç”¨silk-v3-decoderæ¥åšè¿™ä»¶äº‹æƒ…ã€‚è™½ç„¶æœ¬è´¨ä¸Šè¿˜æ˜¯ä½¿ç”¨çš„ffmpegæ¥è½¬çš„ï¼Œåªæ˜¯å°è£…äº†ä¸€ä¸‹ã€‚",
        "sort": "",
        "title": "silk-v3-decoder ä¸€æ¬¾å¾®ä¿¡éŸ³é¢‘è½¬ç çš„å·¥å…·",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "6a6aca31-1871-49f3-a600-5062cb673260"
        }
      ],
      "body": "",
      "realName": "silk-v3-decoder ä¸€æ¬¾å¾®ä¿¡éŸ³é¢‘è½¬ç çš„å·¥å…·",
      "relativePath": "/archives/silk-v3-decoder ä¸€æ¬¾å¾®ä¿¡éŸ³é¢‘è½¬ç çš„å·¥å…·.md"
    },
    {
      "id": "0d2fc9f8-00d3-40d8-b7bb-cc4dbbb10251",
      "doc_id": "0d2fc9f8-00d3-40d8-b7bb-cc4dbbb10251",
      "title": "0d2fc9f8-00d3-40d8-b7bb-cc4dbbb10251",
      "updated": 1696747320000,
      "body_original": "\n# Gateway\n\n\n## **ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³**\n\n\n`API Gateway`ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯å‡ºç°åœ¨ç³»ç»Ÿè¾¹ç•Œä¸Šçš„ä¸€ä¸ªé¢å‘ API çš„ã€ä¸²è¡Œé›†ä¸­å¼çš„å¼ºç®¡æ§æœåŠ¡ï¼Œè¿™é‡Œçš„è¾¹ç•Œæ˜¯ç³»ç»ŸæœåŠ¡çš„è¾¹ç•Œï¼Œå¯ä»¥ç†è§£ä¸º`æœåŠ¡é˜²ç«å¢™`ï¼Œä¸»è¦èµ·åˆ°`éš”ç¦»å¤–éƒ¨è®¿é—®ä¸å†…éƒ¨ç³»ç»Ÿçš„ä½œç”¨`ã€‚åœ¨å¾®æœåŠ¡æ¦‚å¿µçš„æµè¡Œä¹‹å‰ï¼ŒAPI ç½‘å…³å°±å·²ç»è¯ç”Ÿäº†ï¼Œä¾‹å¦‚é“¶è¡Œã€è¯åˆ¸ç­‰é¢†åŸŸå¸¸è§çš„å‰ç½®æœºç³»ç»Ÿï¼Œå®ƒä¹Ÿæ˜¯è§£å†³è®¿é—®è®¤è¯ã€æŠ¥æ–‡è½¬æ¢ã€è®¿é—®ç»Ÿè®¡ç­‰é—®é¢˜çš„ã€‚\n\n\nAPI ç½‘å…³çš„æµè¡Œï¼Œæºäºè¿‘å‡ å¹´æ¥ç§»åŠ¨åº”ç”¨ä¸ä¼ä¸šé—´äº’è”éœ€æ±‚çš„å…´èµ·ã€‚ç§»åŠ¨åº”ç”¨ã€ä¼ä¸šäº’è”ï¼Œä½¿å¾—åå°æœåŠ¡æ”¯æŒçš„å¯¹è±¡ï¼Œä»ä»¥å‰å•ä¸€çš„Webåº”ç”¨ï¼Œæ‰©å±•åˆ°å¤šç§ä½¿ç”¨åœºæ™¯ï¼Œä¸”æ¯ç§ä½¿ç”¨åœºæ™¯å¯¹åå°æœåŠ¡çš„è¦æ±‚éƒ½ä¸å°½ç›¸åŒã€‚è¿™ä¸ä»…å¢åŠ äº†åå°æœåŠ¡çš„å“åº”é‡ï¼Œè¿˜å¢åŠ äº†åå°æœåŠ¡çš„å¤æ‚æ€§ã€‚`éšç€å¾®æœåŠ¡æ¶æ„æ¦‚å¿µçš„æå‡ºï¼ŒAPIç½‘å…³æˆä¸ºäº†å¾®æœåŠ¡æ¶æ„çš„ä¸€ä¸ªæ ‡é…ç»„ä»¶`ã€‚\n\n\nAPI ç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯ç³»ç»Ÿå¯¹å¤–çš„å”¯ä¸€å…¥å£ã€‚API ç½‘å…³å°è£…äº†ç³»ç»Ÿå†…éƒ¨æ¶æ„ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›å®šåˆ¶çš„ APIã€‚æ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æ¥å…¥å¾®æœåŠ¡ï¼Œåœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰éä¸šåŠ¡åŠŸèƒ½ã€‚API ç½‘å…³å¹¶ä¸æ˜¯å¾®æœåŠ¡åœºæ™¯ä¸­å¿…é¡»çš„ç»„ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ API ç½‘å…³ï¼Œåç«¯å¾®æœåŠ¡éƒ½å¯ä»¥é€šè¿‡ API å¾ˆå¥½åœ°æ”¯æŒå®¢æˆ·ç«¯çš„è®¿é—®ã€‚\n\n\n![](https://blog-file.hehouhui.cn/1280X1280.png)\n\n\nAPI ç½‘å…³å‡ºç°çš„åŸå› æ˜¯å¾®æœåŠ¡æ¶æ„çš„å‡ºç°ï¼Œä¸åŒçš„å¾®æœåŠ¡ä¸€èˆ¬ä¼šæœ‰ä¸åŒçš„ç½‘ç»œåœ°å€ï¼Œè€Œå¤–éƒ¨å®¢æˆ·ç«¯å¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡çš„æ¥å£æ‰èƒ½å®Œæˆä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœè®©å®¢æˆ·ç«¯ç›´æ¥ä¸å„ä¸ªå¾®æœåŠ¡é€šä¿¡ï¼Œä¼šæœ‰ä»¥ä¸‹çš„é—®é¢˜ï¼š\n\n- å®¢æˆ·ç«¯ä¼šå¤šæ¬¡è¯·æ±‚ä¸åŒçš„å¾®æœåŠ¡ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ã€‚\n- å­˜åœ¨è·¨åŸŸè¯·æ±‚ï¼Œåœ¨ä¸€å®šåœºæ™¯ä¸‹å¤„ç†ç›¸å¯¹å¤æ‚ã€‚\n- è®¤è¯å¤æ‚ï¼Œæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦ç‹¬ç«‹è®¤è¯ã€‚\n- éš¾ä»¥é‡æ„ï¼Œéšç€é¡¹ç›®çš„è¿­ä»£ï¼Œå¯èƒ½éœ€è¦é‡æ–°åˆ’åˆ†å¾®æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½å°†å¤šä¸ªæœåŠ¡åˆå¹¶æˆä¸€ä¸ªæˆ–è€…å°†ä¸€ä¸ªæœåŠ¡æ‹†åˆ†æˆå¤šä¸ªã€‚å¦‚æœå®¢æˆ·ç«¯ç›´æ¥ä¸å¾®æœåŠ¡é€šä¿¡ï¼Œé‚£ä¹ˆé‡æ„å°†ä¼šå¾ˆéš¾å®æ–½ã€‚\n- æŸäº›å¾®æœåŠ¡å¯èƒ½ä½¿ç”¨äº†é˜²ç«å¢™ / æµè§ˆå™¨ä¸å‹å¥½çš„åè®®ï¼Œç›´æ¥è®¿é—®ä¼šæœ‰ä¸€å®šçš„å›°éš¾ã€‚\n\n**APIç½‘å…³æ–¹å¼çš„æ ¸å¿ƒè¦ç‚¹æ˜¯ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æ¥å…¥å¾®æœåŠ¡ï¼Œ** åœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰çš„éä¸šåŠ¡åŠŸèƒ½ã€‚é€šå¸¸ï¼Œç½‘å…³ä¹Ÿæ˜¯æä¾›REST/HTTPçš„è®¿é—®APIã€‚\n\n\n## **ç½‘å…³è§£å†³äº†ä»€ä¹ˆé—®é¢˜**\n\n\nä½†å¯¹äºæœåŠ¡æ•°é‡ä¼—å¤šã€å¤æ‚åº¦æ¯”è¾ƒé«˜ã€è§„æ¨¡æ¯”è¾ƒå¤§çš„ä¸šåŠ¡æ¥è¯´ï¼Œå¼•å…¥ API ç½‘å…³ä¹Ÿæœ‰ä¸€ç³»åˆ—çš„å¥½å¤„ï¼š\n\n- èšåˆæ¥å£ä½¿å¾—æœåŠ¡å¯¹è°ƒç”¨è€…é€æ˜ï¼Œå®¢æˆ·ç«¯ä¸åç«¯çš„è€¦åˆåº¦é™ä½\n- èšåˆåå°æœåŠ¡ï¼ŒèŠ‚çœæµé‡ï¼Œæé«˜æ€§èƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ\n- æä¾›å®‰å…¨ã€æµæ§ã€è¿‡æ»¤ã€ç¼“å­˜ã€è®¡è´¹ã€ç›‘æ§ç­‰ API ç®¡ç†åŠŸèƒ½\n\n![](https://blog-file.hehouhui.cn/clip_image003.png)\n\n\nç½‘å…³åº”å½“å…·å¤‡ä»¥ä¸‹åŠŸèƒ½\n\n- æ€§èƒ½ï¼šAPI é«˜å¯ç”¨ï¼Œè´Ÿè½½å‡è¡¡ï¼Œå®¹é”™æœºåˆ¶ã€‚\n- å®‰å…¨ï¼šæƒé™èº«ä»½è®¤è¯ã€è„±æ•ï¼Œæµé‡æ¸…æ´—åˆ†å‘ï¼Œåç«¯ç­¾åï¼ˆä¿è¯å…¨é“¾è·¯å¯ä¿¡è°ƒç”¨ï¼‰ï¼Œé»‘åå•ï¼ˆéæ³•è°ƒç”¨çš„é™åˆ¶ï¼‰ã€‚\n- æ—¥å¿—ï¼šæ—¥å¿—è®°å½•ï¼Œä¸€æ—¦æ¶‰åŠåˆ†å¸ƒå¼ï¼Œå…¨é“¾è·¯è·Ÿè¸ªå¿…ä¸å¯å°‘ã€‚\n- ç¼“å­˜ï¼šæ•°æ®ç¼“å­˜ã€‚\n- ç›‘æ§ï¼šè®°å½•è¯·æ±‚å“åº”æ•°æ®ï¼ŒAPI è€—æ—¶åˆ†æï¼Œæ€§èƒ½ç›‘æ§ã€‚\n- é™æµï¼šæµé‡æ§åˆ¶ï¼Œé”™å³°æµæ§ï¼Œå¯ä»¥å®šä¹‰å¤šç§é™æµè§„åˆ™ã€‚\n- ç°åº¦ï¼šçº¿ä¸Šç°åº¦éƒ¨ç½²ï¼Œå¯ä»¥å‡å°é£é™©ã€‚\n- è·¯ç”±ï¼šåŠ¨æ€è·¯ç”±è§„åˆ™ã€‚\n\nä¸»è¦åŠŸèƒ½\n\n- æ•°æ®å¹³é¢ä¸»è¦åŠŸèƒ½æ˜¯æ¥å…¥ç”¨æˆ·çš„HTTPè¯·æ±‚å’Œå¾®æœåŠ¡è¢«æ‹†åˆ†åçš„èšåˆã€‚ä½¿ç”¨å¾®æœåŠ¡ç½‘å…³ç»Ÿä¸€å¯¹å¤–æš´éœ²åç«¯æœåŠ¡çš„APIå’Œå¥‘çº¦ï¼Œè·¯ç”±å’Œè¿‡æ»¤åŠŸèƒ½æ­£æ˜¯ç½‘å…³çš„æ ¸å¿ƒèƒ½åŠ›æ¨¡å—ã€‚å¦å¤–ï¼Œå¾®æœåŠ¡ç½‘å…³å¯ä»¥å®ç°æ‹¦æˆªæœºåˆ¶å’Œä¸“æ³¨è·¨æ¨ªåˆ‡é¢çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬åè®®è½¬æ¢ã€å®‰å…¨è®¤è¯ã€ç†”æ–­é™æµã€ç°åº¦å‘å¸ƒã€æ—¥å¿—ç®¡ç†ã€æµé‡ç›‘æ§ç­‰ã€‚\n- æ§åˆ¶å¹³é¢ä¸»è¦åŠŸèƒ½æ˜¯å¯¹åç«¯æœåŠ¡åšç»Ÿä¸€çš„ç®¡æ§å’Œé…ç½®ç®¡ç†ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ§åˆ¶ç½‘å…³çš„å¼¹æ€§ä¼¸ç¼©ï¼›å¯ä»¥ç»Ÿä¸€ä¸‹å‘é…ç½®ï¼›å¯ä»¥å¯¹ç½‘å…³æœåŠ¡æ·»åŠ æ ‡ç­¾ï¼›\n\n# **Spring Cloud Gateway**\n\n\n> Spring Cloud Gateway æ˜¯åŸºäº Spring ç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„ API ç½‘å…³ï¼ŒåŒ…æ‹¬ï¼šSpring 5ï¼ŒSpring Boot 2 å’Œ Project Reactorã€‚Spring Cloud Gateway æ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•æ¥è·¯ç”±åˆ° APIï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›è·¨é¢†åŸŸçš„å…³æ³¨ç‚¹ï¼Œä¾‹å¦‚ï¼šå®‰å…¨æ€§ï¼Œç›‘è§†/æŒ‡æ ‡ï¼Œé™æµç­‰ã€‚\n\n\n\tç”±äº Spring 5.0 æ”¯æŒ Nettyï¼ŒHttp2ï¼Œè€Œ Spring Boot 2.0 æ”¯æŒ Spring 5.0ï¼Œå› æ­¤ Spring Cloud Gateway å¤©ç„¶æ”¯æŒ Netty å’Œ Http2ã€‚\n\n\nSpring Cloud Gateway å»ºç«‹åœ¨[Spring Boot 2.x](https://spring.io/projects/spring-boot#learn)ã€[Spring WebFlux](https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html)å’Œ[Project Reactor](https://projectreactor.io/docs)ä¹‹ä¸Šï¼ˆåŸºäºâ¾¼æ€§èƒ½çš„Reactoræ¨¡å¼å“åº”å¼é€šä¿¡æ¡†æ¶Nettyï¼Œå¼‚æ­¥â¾®é˜»å¡æ¨¡å‹ï¼‰ã€‚å› æ­¤å½“ä½¿ç”¨ Spring Cloud Gateway æ—¶ï¼Œè®¸å¤šç†Ÿæ‚‰çš„åŒæ­¥åº“ï¼ˆä¾‹å¦‚ Spring Data å’Œ Spring Securityï¼‰å’Œæ¨¡å¼å¯èƒ½å¹¶ä¸é€‚ç”¨ã€‚\n\n\nSpring Cloud Gateway éœ€è¦ Spring Boot å’Œ `Spring Webflux` æä¾›çš„ `Netty` è¿è¡Œæ—¶ã€‚å®ƒä¸é€‚ç”¨äºä¼ ç»Ÿçš„ Servlet å®¹å™¨æˆ–æ„å»ºä¸º WAR æ—¶ã€‚\n\n\n## **æ ¸å¿ƒæ¦‚å¿µ**\n\n- **Route:** The basic building block of the gateway. It is defined by an ID, a destination URI, a collection of predicates, and a collection of filters. A route is matched if the aggregate predicate is true.\n\t- è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±\n- **Predicate**: This is a [Java 8 Function Predicate](https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html). The input type is a [Spring Framework ServerWebExchange](https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html). This lets you match on anything from the HTTP request, such as headers or parameters.\n\t- å‚è€ƒçš„æ˜¯java8çš„java.util.function.Predicateå¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ï¼‰ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±\n- **Filter**: These are instances of `GatewayFilter` that have been constructed with a specific factory. Here, you can modify requests and responses before or after sending the downstream request.\n\t- æŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚\n\nå·¥ä½œæµç¨‹\n\n\n![](https://blog-file.hehouhui.cn/clip_image005.png)\n\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯å‘ `Spring Cloud Gateway` å‘å‡ºè¯·æ±‚ã€‚å†ç”±ç½‘å…³å¤„ç†ç¨‹åº `Gateway Handler Mapping` æ˜ å°„ç¡®å®šä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ°ç½‘å…³ Web å¤„ç†ç¨‹åº `Gateway Web Handler`ã€‚è¯¥å¤„ç†ç¨‹åºé€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚è¿‡æ»¤å™¨ç”±è™šçº¿åˆ†éš”çš„åŸå› æ˜¯ï¼Œè¿‡æ»¤å™¨å¯ä»¥åœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰å’Œä¹‹åè¿è¡Œé€»è¾‘ã€‚æ‰€æœ‰ `pre` è¿‡æ»¤å™¨é€»è¾‘å‡è¢«æ‰§è¡Œã€‚ç„¶åå‘å‡ºä»£ç†è¯·æ±‚ã€‚å‘å‡ºä»£ç†è¯·æ±‚åï¼Œå°†è¿è¡Œ `post` è¿‡æ»¤å™¨é€»è¾‘ã€‚\n\n\n## **Predicate æ–­è¨€**\n\n\nSpringCloud Gateway åŒ…æ‹¬è®¸å¤šå†…ç½®çš„Route Predicateå·¥å‚ã€‚æ‰€æœ‰è¿™äº›Predicateéƒ½ä¸HTTPè¯·æ±‚çš„ä¸åŒå±æ€§åŒ¹é…ã€‚å¤šä¸ªRoute Predicateå·¥å‚å¯ä»¥è¿›è¡Œç»„åˆã€‚\n\n\nSpringCloud Gateway åˆ›å»ºRouteå¯¹è±¡æ—¶ï¼Œä½¿ç”¨RoutePredicateFactoryåˆ›å»ºPredicateå¯¹è±¡ï¼ŒPredicateå¯¹è±¡å¯ä»¥èµ‹å€¼ç»™Routeã€‚SpringCloud Gateway åŒ…å«è®¸å¤šå†…ç½®çš„RoutePredicateFactoriesã€‚\n\n\næ‰€æœ‰è¿™äº›æ–­è¨€éƒ½åŒ¹é…HTTPè¯·æ±‚çš„ä¸åŒå±æ€§ã€‚å¤šç§æ–­è¨€å·¥å‚å¯ä»¥ç»„åˆï¼Œå¹¶é€šè¿‡é€»è¾‘andã€‚\n\n\n> SpringCloud Gateway å°†è·¯ç”±åŒ¹é…ä½œä¸ºSpring WebFlux HandlerMappingåŸºç¡€æ¶æ„çš„ä¸€éƒ¨åˆ†ã€‚\n\n\n```text\nserver:\n  port: 11001\nspring:\n  application:\n    name: gateway\n  cloud:\n    gateway:\n      discovery:\n        locator:\n          enabled: true  #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±\n      routes:\n        - id: blog-admin #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å\n          #uri: <http://localhost:8001>   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€\n          uri: lb://blog-service\n          predicates:\n            - Path=/api/admin/**   #æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±\n   - id: blog\n      #uri: <http://localhost:8001>   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€\n      uri: lb://blog-service\n      predicates:\n        - Path=/archives/**   #æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±\n        #- After=2020-03-08T10:59:34.102+08:00[Asia/Shanghai]\n        #- Cookie=username,zhangshuai #å¹¶ä¸”Cookieæ˜¯username=zhangshuaiæ‰èƒ½è®¿é—®\n        #- Header=X-Request-Id, \\\\d+ #è¯·æ±‚å¤´ä¸­è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼\n        #- Host=**.atguigu.com\n        #- Method=GET\n        #- Query=username, \\\\d+ #è¦æœ‰å‚æ•°åç§°å¹¶ä¸”æ˜¯æ­£æ•´æ•°æ‰èƒ½è·¯ç”±\n\n```\n\n\n### **å†…ç½®è°“è¯æ–­è¨€**\n\n- **After Route Predicate Factory** åŒ¹é…åœ¨æŒ‡å®šæ—¥æœŸæ—¶é—´ä¹‹åå‘ç”Ÿçš„è¯·æ±‚\n\t- å‚æ•°ï¼šdatetime\n\t- æ³¨æ„æ—¶é—´æ ¼å¼å¸¦æ—¶åŒº ZonedDateTime\n\t- `spring: cloud: gateway: routes: - id: after_route_test uri: <https://www.hehouhui.cn> predicates: - After=2022-07-10T17:42:00.789-07:00[Asia/Shanghai]`\n- **Before Route Predicate Factory** åŒ¹é…åœ¨æŒ‡å®šæ—¥æœŸæ—¶é—´ä¹‹å‰å‘ç”Ÿçš„è¯·æ±‚\n\n\t```text\n\tå‚æ•°ï¼šdatetime\n\t\n\t```\n\n\næ³¨æ„æ—¶é—´æ ¼å¼å¸¦æ—¶åŒº ZonedDateTime\n\n\n```text\n spring:\n  cloud:\n    gateway:\n      routes:\n      - id: before_route_test\n        uri: <https://www.hehouhui.cn>\n        predicates:\n        - Before=2022-07-10T17:43:48.789-07:00[Asia/Shanghai]\n\n```\n\n- **Between Route Predicate Factory** åŒ¹é…åœ¨æŒ‡å®šèŒƒå›´æ—¥æœŸæ—¶é—´å‘ç”Ÿçš„è¯·æ±‚\n\t- å‚æ•°ï¼šdatetime1 å¼€å§‹\n\t- datetime2 ç»“æŸ\n\t- æ³¨æ„æ—¶é—´æ ¼å¼å¸¦æ—¶åŒº ZonedDateTime\n\t- `spring: cloud: gateway: routes: - id: between_route_test uri: <https://www.hehouhui.cn> predicates: - Between=2022-07-10T17:42:30.789-07:00[Asia/Shanghai],2022-07-10T17:42:59.789-07:00[Asia/Shanghai]`\n- **Cookie Route Predicate Factory** åŒ¹é…åœ¨æŒ‡å®šåŒ…å«æŒ‡å®šcookie å€¼çš„è¯·æ±‚\n\nå‚æ•°ï¼šname cookieåç§°\n\n- regexp åŒ¹é…å€¼çš„æ­£åˆ™\n- `spring: cloud: gateway: routes: - id: cookie_route_test uri: <https://www.hehouhui.cn> predicates: - Cookie=token,allow_account`\n- **Header Route Predicate Factory** åŒ¹é…åœ¨æŒ‡å®šåŒ…å«æŒ‡å®šè¯·æ±‚å¤´çš„è¯·æ±‚\n\nå‚æ•°ï¼šname è¯·æ±‚å¤´çš„åç§°\n\n\n```text\n               regexp åŒ¹é…å€¼çš„æ­£åˆ™\n\n```\n\n\n```text\n spring:\n  cloud:\n    gateway:\n      routes:\n      - id: handler_route_test\n        uri: <https://www.hehouhui.cn>\n        predicates:\n        - Handler=User-Agent,*Mac OS*\n\n```\n\n- **Host Route Predicate Factory** è¯·æ±‚ä¸»æœºåœ°å€åŒ¹é…\n\n\t```text\n\tå‚æ•°ï¼š patterns æ­£åˆ™é›†åˆ\n\t\n\t```\n\n\n```text\n spring:\n  cloud:\n    gateway:\n      routes:\n      - id: host_route_test\n        uri: <https://www.hehouhui.cn>\n        predicates:\n        - Host=blog.hehouhui.cn\n\n```\n\n- **Method Route Predicate Factory** è¯·æ±‚æ–¹æ³•çš„åŒ¹é…\n\n\t```text\n\tå‚æ•°ï¼š methods é›†åˆ\n\t\n\t```\n\n\n```text\n spring:\n  cloud:\n    gateway:\n      routes:\n      - id: method_route_test\n        uri: <https://www.hehouhui.cn>\n        predicates:\n        - Method=Get,Post\n\n```\n\n- **Path Route Predicate Factory** è¯·æ±‚è·¯ç”±è§„åˆ™åŒ¹é…\n\n\t```text\n\tå‚æ•°ï¼špatterns åŒ¹é…é›†åˆ\n\t\n\t```\n\n\n```text\nspring:\n  cloud:\n    gateway:\n      routes:\n      - id: path_route_test\n        uri: <https://www.hehouhui.cn>\n        predicates:\n        - Path=/test/**\n\n```\n\n- **Query Route Predicate Factory** è¯·æ±‚å‚æ•° url ï¼Ÿåçš„å‚æ•°\n\n\t```text\n\tå‚æ•°  param å‚æ•°å\n\t\n\t          regexp å‚æ•°åŒ¹é…å€¼ï¼Œå¦‚æœä¸ºç©ºçš„æƒ…å†µä¸‹è¡¨ç¤ºä»»ä½•å€¼\n\t\n\t```\n\n\n```text\nspring:\n  cloud:\n    gateway:\n      routes:\n      - id: query_route_test\n        uri: <https://www.hehouhui.cn>\n        predicates:\n        - Query=name,laiweihua\n\n```\n\n- **RemoteAddr Route Predicate Factory** å®¢æˆ·ç«¯è¯·æ±‚IPåŒ¹é…\n\n\t```text\n\tå‚æ•°ï¼šsources æ³¨æ„æ­¤å¤„ä¸ºcidræ ¼å¼ CIDR è¡¨ç¤ºæ³•ï¼ˆIPv4 æˆ– IPv6ï¼‰å­—ç¬¦ä¸²\n\t\n\t```\n\n\n```text\nspring:\n  cloud:\n    gateway:\n      routes:\n      - id: remoteAddr_route_test\n        uri: <https://www.hehouhui.cn>\n        predicates:\n        - RemoteAddr=192.168.1.1/24\n\n```\n\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒRemoteAddr è·¯ç”±è°“è¯å·¥å‚ä½¿ç”¨æ¥è‡ªä¼ å…¥è¯·æ±‚çš„è¿œç¨‹åœ°å€ã€‚å¦‚æœ Spring Cloud Gateway ä½äºä»£ç†å±‚åé¢ï¼Œè¿™å¯èƒ½ä¸å®é™…å®¢æˆ·ç«¯ IP åœ°å€ä¸åŒ¹é…ã€‚\n\n\nå¯ä»¥é€šè¿‡è®¾ç½®è‡ªå®šä¹‰æ¥è‡ªå®šä¹‰è§£æè¿œç¨‹åœ°å€çš„æ–¹å¼`RemoteAddressResolver`ã€‚Spring Cloud Gateway å¸¦æœ‰ä¸€ä¸ªåŸºäº[X-Forwarded-For æ ‡å¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For)çš„éé»˜è®¤è¿œç¨‹åœ°å€è§£æå™¨ï¼Œ`XForwardedRemoteAddressResolver`.\n\n\n`XForwardedRemoteAddressResolver`æœ‰ä¸¤ä¸ªé™æ€æ„é€ æ–¹æ³•ï¼Œå®ƒä»¬é‡‡ç”¨ä¸åŒçš„å®‰å…¨æ–¹æ³•ï¼š\n\n- `XForwardedRemoteAddressResolver::trustAll`è¿”å›`RemoteAddressResolver`å§‹ç»ˆé‡‡ç”¨åœ¨`X-Forwarded-For`æ ‡å¤´ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ª IP åœ°å€çš„ aã€‚è¿™ç§æ–¹æ³•å®¹æ˜“å—åˆ°æ¬ºéª—ï¼Œå› ä¸ºæ¶æ„å®¢æˆ·ç«¯å¯ä»¥ä¸º è®¾ç½®åˆå§‹å€¼ï¼Œ`X-Forwarded-For`è§£æå™¨ä¼šæ¥å—è¯¥å€¼ã€‚\n- `XForwardedRemoteAddressResolver::maxTrustedIndex`é‡‡ç”¨ä¸ Spring Cloud Gateway å‰è¿è¡Œçš„å—ä¿¡ä»»åŸºç¡€æ¶æ„æ•°é‡ç›¸å…³çš„ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ Spring Cloud Gateway åªèƒ½é€šè¿‡ HAProxy è®¿é—®ï¼Œåˆ™åº”ä½¿ç”¨å€¼ 1ã€‚å¦‚æœåœ¨è®¿é—® Spring Cloud Gateway ä¹‹å‰éœ€è¦ä¸¤è·³å¯ä¿¡åŸºç¡€æ¶æ„ï¼Œåˆ™åº”ä½¿ç”¨å€¼ 2ã€‚\n- **Weight Route Predicate Factory** æƒé‡è·¯ç”±åŒ¹é…\n\n\tå‚æ•°ï¼š group è‡ªå®šä¹‰åˆ†ç»„åç§°\n\n\n\t```text\n\t        weight æƒé‡\n\t\n\t```\n\n\n```text\nspring:\n  cloud:\n    gateway:\n      routes:\n      - id: weight_high\n        uri: <https://www.hehouhui.cn>\n        predicates:\n        - Weight=group, 8\n      - id: weight_low\n        uri: <https://blog.hehouhui.cn>\n        predicates:\n        - Weight=group, 2\n\n```\n\n\n```text\n  è¯¥è·¯ç”±ä¼šå°†çº¦ 80% çš„æµé‡è½¬å‘åˆ° <https://www.hehouhui.cn>ï¼Œå°†çº¦ 20% çš„æµé‡è½¬å‘åˆ°https://blog.hehouhui.cn\n\n```\n\n- **XForwarded Remote Addr Route Predicate Factory** æ ¹æ® X-Forwarded-Forè¯·æ±‚å¤´åŒ¹é…\n\n\tå‚æ•°ï¼šsources  æ³¨æ„æ­¤å¤„ä¸ºcidræ ¼å¼\n\n\n```text\nspring:\n  cloud:\n    gateway:\n      routes:\n      - id: xforwarded_route\n        uri: <https://www.hehouhui.cn>\n        predicates:\n        - XForwardedRemoteAddr=192.168.1.1/24\n\n```\n\n\n## **Filterè¿‡æ»¤å™¨**\n\n\n### **GlobaFilter å…¨å±€è¿‡æ»¤å™¨**\n\n\n> GlobaFilter å…¨å±€è¿‡æ»¤å™¨ï¼Œä¸éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œç³»ç»Ÿåˆå§‹åŒ–æ—¶åŠ è½½ï¼Œå¹¶ä½œç”¨åœ¨æ¯ä¸ªè·¯ç”±ä¸Šã€‚ SpringCloud Gateway æ ¸å¿ƒçš„åŠŸèƒ½ä¹Ÿæ˜¯é€šè¿‡å†…ç½®çš„å…¨å±€è¿‡æ»¤å™¨æ¥å®Œæˆ\n\n\n| ç±»å                               | ä½œç”¨                                                                                                       |\n| -------------------------------- | -------------------------------------------------------------------------------------------------------- |\n| CustomGlobalFilter               | ç»„åˆæ‰€æœ‰è¿‡æ»¤å™¨çš„æ’åº,åŒ…å«GlobaFilterå’ŒGatewayFilterã€‚Gateway åŒºåˆ†è¿‡æ»¤å™¨é€»è¾‘æ‰§è¡Œçš„â€œå‰â€å’Œâ€œåâ€é˜¶æ®µï¼Œå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„è¿‡æ»¤å™¨æ˜¯â€œå‰â€é˜¶æ®µçš„ç¬¬ä¸€ä¸ªå’Œâ€œåâ€é˜¶æ®µçš„æœ€åä¸€ä¸ª -é˜¶æ®µã€‚ |\n| ForwardRoutingFilter             | forward://å¼€å¤´çš„urlåè®®å°†ä¼šè¢«è½¬å‘                                                                                  |\n| ReactiveLoadBalancerClientFilter | å°†ä»¥lb://å¼€å¤´çš„url ç»è¿‡ ReactorLoadBalancer è·¯ç”±åŠ è½½è½¬æ¢                                                              |\n| NettyRoutingFilter               | httpæˆ–è€…httpsåè®® ç”±Netty è¿‡æ»¤å™¨è¿è¡Œã€‚å®ƒä½¿ç”¨ NettyHttpClientå‘å‡ºä¸‹æ¸¸ä»£ç†è¯·æ±‚                                                   |\n| NettyWriteResponseFilter         | å¹¶å°†ä»£ç†å“åº”å†™å›ç½‘å…³å®¢æˆ·ç«¯å“åº”                                                                                          |\n| RouteToRequestUrlFilter          | å°† Routeå¯¹è±¡è½¬ä¸ºURL,å¹¶å­˜å‚¨åŸRouteä¿¡æ¯                                                                               |\n| WebsocketRoutingFilter           | å°†ä»¥ws,wssæˆ–è¯·æ±‚å¤´Upgrade = WebSocketçš„http,https ä»¥We bsocketåè®®æ‰§è¡Œ                                               |\n| GatewayMetricsFilter             | è·¯ç”±æŒ‡æ ‡æ•°æ®æ”¶é›†ç”¨äºé›†æˆGrafanaä»ªè¡¨æ¿                                                                                   |\n|                                  |                                                                                                          |\n\n\n### **AbstractGatewayFilterFactory å±€éƒ¨è¿‡æ»¤å™¨å·¥å‚**\n\n\n> GatewayFilterå±€éƒ¨è¿‡æ»¤å™¨ï¼Œæ˜¯é’ˆå¯¹å•ä¸ªè·¯ç”±çš„è¿‡æ»¤å™¨ã€‚ åœ¨SpringCloud Gatewayç»„ä»¶ä¸­æä¾›äº†å¤§é‡å†…ç½®çš„å±€éƒ¨è¿‡æ»¤å™¨ï¼Œå¯¹è¯·æ±‚å’Œå“åº”åè¿‡æ»¤æ“ä½œã€‚\n\n\n> éµå¾ªçº¦å®šå¤§äºé…ç½®çš„æ€æƒ³ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶é…ç½®å±€éƒ¨è¿‡æ»¤å™¨åç§°ï¼Œå¹¶ä¸ºå…¶åˆ¶å®šå¯¹åº”çš„å€¼ã€‚å°±å¯ä»¥è®©å…¶ç”Ÿæ•ˆã€‚\n\n\n| åç§°                            | ä½œç”¨                                                        | å‚æ•°                                                                                                                                                                            |\n| ----------------------------- | --------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| AddRequestHeader              | ä¸ºè·¯ç”±æ·»åŠ è¯·æ±‚å¤´                                                  | name,value                                                                                                                                                                    |\n| AddRequestParameter           | ä¸ºè·¯ç”±æ·»åŠ è¯·æ±‚queryå‚æ•°(æ‹¼æ¥åœ¨urlå)                                   | name,value                                                                                                                                                                    |\n| AddResponseHeader             | ä¸ºè·¯ç”±æ·»åŠ å“åº”å¤´                                                  | name,value                                                                                                                                                                    |\n| DedupeResponseHeader          | å“åº”å¤´å»é‡,é»˜è®¤å–å“åº”å¤´çš„é¦–ä¸ªvalueï¼Œæœ€ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†è‡ª2.2.5ç‰ˆæœ¬åç½‘å…³å’Œä¸‹æ¸¸æœåŠ¡éƒ½å¤„ç†äº†CORSçš„bug | name,strategy                                                                                                                                                                 |\n| CircuitBreaker                | è·¯ç”±æ–­è·¯å™¨ï¼Œåœ¨æœåŠ¡å¼‚å¸¸æˆ–è€…è¿”å›æŒ‡å®šçŠ¶æ€ç æ—¶è½¬å‘è·¯ç”±è‡³æŒ‡å®š fallbackUri                  | name,fallbackUri,routeId,statusCodes                                                                                                                                          |\n| FallbackHeaders               | åœ¨æ‰§è¡Œè¯·æ±‚è½¬å‘æ—¶æ·»åŠ æŒ‡å®šçš„è¯·æ±‚å¤´ä¿¡æ¯                                        |                                                                                                                                                                               |\n| MapRequestHeader              | copyè¯·æ±‚å¤´ä¸­æŒ‡å®šå€¼åˆ°æ–°çš„è¯·æ±‚å¤´ä¸­                                        | fromHeader,toHeader                                                                                                                                                           |\n| PrefixPath                    | ä¸ºè·¯ç”±URLæ·»åŠ ç»Ÿä¸€å‰ç¼€                                              | prefix                                                                                                                                                                        |\n| PreserveHostHeader            | æ— ç‰¹æ®Šé€»è¾‘ï¼Œåªæ˜¯æ ‡è®°ä¸€ä¸‹è·¯ç”±ä¸ºåŸå§‹è¯·æ±‚                                       |                                                                                                                                                                               |\n| RequestRateLimiter            | è·¯ç”±é™æµï¼Œç”±KeyResolverè§£æå‡ºè·¯ç”±ç»†ç²’åº¦ï¼ŒRateLimiterè¿›è¡Œé™æµå¤„ç†               | keyResolver, **rate-limiter.replenish-rate ,rate-limiter.burst-capacity,rate-limiter.requested-tokens**ã€‚requestedTokensæ¯æ¬¡è¯·æ±‚æ¶ˆè€—å¤šå°‘ä»¤ç‰Œï¼ŒburstCapacityä»¤ç‰Œæ¡¶æ€»å®¹é‡ï¼ŒreplenishRateæ¯å¤šå°‘ç§’ç”Ÿäº§ä¸€æšä»¤ç‰Œ |\n| RedirectTo                    | è¯·æ±‚è½¬å‘                                                      |                                                                                                                                                                               |\n| RemoveRequestHeader           | åˆ é™¤è¯·æ±‚å¤´                                                     |                                                                                                                                                                               |\n| RemoveResponseHeader          | åˆ é™¤å“åº”å¤´                                                     |                                                                                                                                                                               |\n| RemoveRequestParameter        | åˆ é™¤è¯·æ±‚å‚æ•°                                                    |                                                                                                                                                                               |\n| RequestHeaderSize             | ç´¯è®¡è¯·æ±‚å¤´value byteså¤§å°ä¸è¶…è¿‡æœ€å¤§å€¼                                  |                                                                                                                                                                               |\n| RewritePath                   | é‡å†™Path                                                    |                                                                                                                                                                               |\n| RewriteLocationResponseHeader | ä¿®æ”¹Locationçš„å€¼                                              |                                                                                                                                                                               |\n| RewriteResponseHeader         | é‡å†™å“åº”å¤´å€¼                                                    |                                                                                                                                                                               |\n| SaveSession                   | ä¿å­˜session                                                 |                                                                                                                                                                               |\n| SecureHeaders                 | å®‰å…¨ç”Ÿå‘½è¯·æ±‚å¤´                                                   |                                                                                                                                                                               |\n| SetPath                       | è®¾ç½®æ–°Path                                                   |                                                                                                                                                                               |\n| SetRequestHeader              | è®¾ç½®è¯·æ±‚å¤´                                                     |                                                                                                                                                                               |\n| SetResponseHeader             | è®¾ç½®å“åº”å¤´                                                     |                                                                                                                                                                               |\n| SetStatus                     | è®¾ç½®çŠ¶æ€ç                                                      |                                                                                                                                                                               |\n| StripPrefix                   | è·¯ç”±æ‘˜é™¤ä»¥/åˆ†å‰²                                                  | parts                                                                                                                                                                         |\n| Retry                         | è·¯ç”±é‡è¯•                                                      | retriesï¼šé‡è¯•æ¬¡æ•°,statuses: åˆ¤æ–­å¯é‡è¯•çš„çŠ¶æ€å—é»˜è®¤5xx,methods: æ”¯æŒé‡è¯•çš„è¯·æ±‚æ–¹æ³•,exceptions: é‡è¯•çš„æŠ›å‡ºå¼‚å¸¸åˆ—è¡¨                                                                                                |\n| RequestSize                   | é€šè¿‡Content-lengthåˆ¤æ–­æ˜¯å¦è¶…è¿‡æœ€å¤§è¯·æ±‚å¤§å°                              |                                                                                                                                                                               |\n| SetRequestHostHeader          | æ¸…é™¤åŸè¯·æ±‚å¤´Hostï¼Œå¹¶æ·»åŠ æ–°å€¼                                          |                                                                                                                                                                               |\n| ModifyRequestBody             | ä¿®æ”¹è¯·æ±‚ä½“                                                     |                                                                                                                                                                               |\n| ModifyResponseBody            | ä¿®æ”¹å“åº”ä½“                                                     |                                                                                                                                                                               |\n| TokenRelay                    | OAuth2æ ‡å‡†è®¤è¯æœåŠ¡ï¼Œæ‰§è¡Œæˆæƒè®¤è¯åå¹¶å°†ä¿¡æ¯ä¼ é€’ä¸‹æ¸¸æœåŠ¡                            |                                                                                                                                                                               |\n| CacheRequestBody              | ç¼“å­˜è¯·æ±‚ä½“                                                     |                                                                                                                                                                               |\n\n\n### RouteLocator\n\n\n    è·¯ç”±é…ç½®åŠ è½½\n\n\n### ConfigurationService\n\n\nè·¯ç”±&è°“è¯&è¿‡æ»¤å™¨å·¥ç¨‹ç­‰åŠ¨æ€é…ç½®ç­‰å®ç°\n\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-03-05",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "46",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "å¾®æœåŠ¡",
          "åˆ†å¸ƒå¼"
        ],
        "summary": "API ç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯ç³»ç»Ÿå¯¹å¤–çš„å”¯ä¸€å…¥å£ã€‚API ç½‘å…³å°è£…äº†ç³»ç»Ÿå†…éƒ¨æ¶æ„ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›å®šåˆ¶çš„ APIã€‚æ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æ¥å…¥å¾®æœåŠ¡ï¼Œåœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰éä¸šåŠ¡åŠŸèƒ½ã€‚API ç½‘å…³å¹¶ä¸æ˜¯å¾®æœåŠ¡åœºæ™¯ä¸­å¿…é¡»çš„ç»„ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ API ç½‘å…³ï¼Œåç«¯å¾®æœåŠ¡éƒ½å¯ä»¥é€šè¿‡ API å¾ˆå¥½åœ°æ”¯æŒå®¢æˆ·ç«¯çš„è®¿é—®",
        "sort": "",
        "title": "APIç½‘å…³ä¹‹Gateway",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "0d2fc9f8-00d3-40d8-b7bb-cc4dbbb10251"
        }
      ],
      "body": "",
      "realName": "APIç½‘å…³ä¹‹Gateway",
      "relativePath": "/archives/APIç½‘å…³ä¹‹Gateway.md"
    },
    {
      "id": "397d5281-9f11-4c6f-8430-399176cc403d",
      "doc_id": "397d5281-9f11-4c6f-8430-399176cc403d",
      "title": "397d5281-9f11-4c6f-8430-399176cc403d",
      "updated": 1696747320000,
      "body_original": "\n# Mysqlæ•°æ®åº“\n\n\n## å­˜å‚¨å¼•æ“\n\n\n### MyISAMå¼•æ“\n\n\n    ä¸æ”¯æŒäº‹åŠ¡\n\n\næ”¯æŒè¡¨çº§é”ï¼ˆMySqlæ”¯æŒä¸¤ç§è¡¨çº§é”ï¼Œè¡¨å…±äº«è¯»é”å’Œè¡¨ç‹¬å å†™é”ï¼‰ï¼Œä½†ä¸æ”¯æŒè¡Œçº§é”\n\n\nå­˜å‚¨è¡¨çš„æ€»è¡Œæ•°\n\n\nä¸€ä¸ªMyISAMè¡¨æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼šç´¢å¼•æ–‡ä»¶ï¼ˆ.MYIï¼‰ï¼Œè¡¨ç»“æ„æ–‡ä»¶(.frm)ï¼Œæ•°æ®æ–‡ä»¶(.MYD)\n\n\né‡‡ç”¨éèšé›†ç´¢å¼•ï¼šå³ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†å¼€çš„ï¼Œç´¢å¼•æ–‡ä»¶çš„æ•°æ®åŸŸå­˜å‚¨æŒ‡å‘æ•°æ®æ–‡ä»¶çš„æŒ‡é’ˆ\n\n\nè·¨å¹³å°åº”ç”¨æ›´æ–¹ä¾¿ï¼ˆè¡¨ä¿å­˜ä¸ºæ–‡ä»¶å½¢å¼ï¼‰\n\n\næ”¯æŒä¸‰ç§ä¸åŒçš„å­˜å‚¨æ ¼å¼ï¼š\n\n\nï¼ˆ1ï¼‰é™æ€è¡¨ï¼šå­˜å‚¨è¿…é€Ÿï¼Œå®¹æ˜“ç¼“å­˜ï¼Œå‡ºç°æ•…éšœå®¹æ˜“æ¢å¤ï¼›ä½†æ˜¯å ç”¨å†…å­˜å¤šï¼Œå› ä¸ºä¼šæŒ‰åˆ—å®½åº¦è¡¥è¶³ç©ºæ ¼\n\n\nï¼ˆ2ï¼‰åŠ¨æ€è¡¨ï¼šå ç”¨ç©ºé—´å°‘ï¼Œä½†æ˜¯é¢‘ç¹æ›´æ–°å’Œåˆ é™¤å®¹æ˜“äº§ç”Ÿç¢ç‰‡ï¼Œéœ€è¦å®šæœŸæ•´ç†ï¼ˆOPTIMIZE TABLEï¼‰ï¼Œå¹¶ä¸”å‡ºç°æ•…éšœéš¾ä»¥æ¢å¤ã€‚\n\n\nï¼ˆ3ï¼‰å‹ç¼©è¡¨ï¼šå æ®çš„ç£ç›˜ç©ºé—´éå¸¸å°ï¼ˆæ¯ä¸ªè®°å½•è¢«å•ç‹¬å‹ç¼©ï¼Œæ‰€ä»¥è®¿é—®å¼€æ”¯å¾ˆå°ï¼‰ã€‚\n\n\n### InnoDbå¼•æ“\n\n\næ”¯æŒäº‹åŠ¡\n\n\næ”¯æŒè¡Œçº§é”ï¼ˆä»…åœ¨æ¡ä»¶è¯­å¥ä¸­åŒ…æ‹¬ä¸»é”®ç´¢å¼•æ—¶ï¼‰\n\n\nå†…å­˜ä½¿ç”¨ç‡ä½\n\n\næŸ¥è¯¢æ•ˆç‡å’Œå†™çš„æ•ˆç‡æ›´ä½\n\n\né‡‡ç”¨èšé›†ç´¢å¼•ï¼Œç´¢å¼•å’Œæ•°æ®å­˜åœ¨ä¸€èµ·ï¼Œå¶å­ç»“ç‚¹ç›´æ¥å­˜çš„æ˜¯æ•°æ®ã€‚\n\n\næ”¯æŒå¤–é”®\n\n\n> æ³¨ï¼šMyISAMåœ¨æŸ¥è¯¢æ—¶çš„æ€§èƒ½æ¯”InnoDBé«˜ï¼Œå› ä¸ºå®ƒé‡‡ç”¨çš„è¾…ç´¢å¼•å’Œä¸»é”®ç´¢å¼•ç±»ä¼¼ï¼Œæ‰€ä»¥é€šè¿‡è¾…ç´¢å¼•æŸ¥æ‰¾æ•°æ®æ—¶åªéœ€è¦é€šè¿‡è¾…ç´¢å¼•æ ‘å°±å¯ä»¥æŸ¥æ‰¾åˆ°ï¼Œè€ŒInnoDBéœ€è¦å…ˆé€šè¿‡è¾…ç´¢å¼•æŸ¥æ‰¾åˆ°ä¸»ç´¢å¼•ï¼Œå†é€šè¿‡ä¸»ç´¢å¼•æ ‘æŸ¥æ‰¾åˆ°æ•°æ®ã€‚\n\n\n### MyISAMå’ŒInnoDBåŒºåˆ«\n\n\nMyISAMæ˜¯MySQLçš„é»˜è®¤æ•°æ®åº“å¼•æ“ï¼ˆ5.5ç‰ˆä¹‹å‰ï¼‰ã€‚è™½ç„¶æ€§èƒ½æä½³ï¼Œè€Œä¸”æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°ç­‰ï¼Œä½†MyISAMä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œè€Œä¸”æœ€å¤§çš„ç¼ºé™·å°±æ˜¯å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ã€‚ä¸è¿‡ï¼Œ5.5ç‰ˆæœ¬ä¹‹åï¼ŒMySQLå¼•å…¥äº†InnoDBï¼ˆäº‹åŠ¡æ€§æ•°æ®åº“å¼•æ“ï¼‰ï¼ŒMySQL 5.5ç‰ˆæœ¬åé»˜è®¤çš„å­˜å‚¨å¼•æ“ä¸ºInnoDBã€‚\n\n\nå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ InnoDB å­˜å‚¨å¼•æ“ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä½¿ç”¨ MyISAM ä¹Ÿæ˜¯åˆé€‚çš„æ¯”å¦‚è¯»å¯†é›†çš„æƒ…å†µä¸‹ã€‚ï¼ˆå¦‚æœä½ ä¸ä»‹æ„ MyISAM å´©æºƒæ¢å¤é—®é¢˜çš„è¯ï¼‰ã€‚\n\n\n**ä¸¤è€…çš„å¯¹æ¯”ï¼š**\n\n1. **æ˜¯å¦æ”¯æŒè¡Œçº§é”** : MyISAM åªæœ‰è¡¨çº§é”(table-level locking)ï¼Œè€ŒInnoDB æ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºè¡Œçº§é”ã€‚\n2. **æ˜¯å¦æ”¯æŒäº‹åŠ¡å’Œå´©æºƒåçš„å®‰å…¨æ¢å¤ï¼š MyISAM** å¼ºè°ƒçš„æ˜¯æ€§èƒ½ï¼Œæ¯æ¬¡æŸ¥è¯¢å…·æœ‰åŸå­æ€§,å…¶æ‰§è¡Œé€Ÿåº¦æ¯”InnoDBç±»å‹æ›´å¿«ï¼Œä½†æ˜¯ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚ä½†æ˜¯**InnoDB** æä¾›äº‹åŠ¡æ”¯æŒï¼Œå¤–éƒ¨é”®ç­‰é«˜çº§æ•°æ®åº“åŠŸèƒ½ã€‚ å…·æœ‰äº‹åŠ¡(commit)ã€å›æ»š(rollback)å’Œå´©æºƒä¿®å¤èƒ½åŠ›(crash recovery capabilities)çš„äº‹åŠ¡å®‰å…¨(transaction-safe (ACID compliant))å‹è¡¨ã€‚\n3. **æ˜¯å¦æ”¯æŒå¤–é”®ï¼š** MyISAMä¸æ”¯æŒï¼Œè€ŒInnoDBæ”¯æŒã€‚\n4. **æ˜¯å¦æ”¯æŒMVCC** ï¼šä»… InnoDB æ”¯æŒã€‚åº”å¯¹é«˜å¹¶å‘äº‹åŠ¡, MVCCæ¯”å•çº¯çš„åŠ é”æ›´é«˜æ•ˆ;MVCCåªåœ¨ `READ COMMITTED` å’Œ `REPEATABLE READ` ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹å·¥ä½œ;MVCCå¯ä»¥ä½¿ç”¨ ä¹è§‚(optimistic)é” å’Œ æ‚²è§‚(pessimistic)é”æ¥å®ç°;å„æ•°æ®åº“ä¸­MVCCå®ç°å¹¶ä¸ç»Ÿä¸€ã€‚æ¨èé˜…è¯»ï¼š[MySQL-InnoDB-MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶](https://segmentfault.com/a/1190000012650596)\n5. ......\n\nã€ŠMySQLé«˜æ€§èƒ½ã€‹ä¸Šé¢æœ‰ä¸€å¥è¯è¿™æ ·å†™åˆ°:\n\n\n> ä¸è¦è½»æ˜“ç›¸ä¿¡â€œMyISAMæ¯”InnoDBå¿«â€ä¹‹ç±»çš„ç»éªŒä¹‹è°ˆï¼Œè¿™ä¸ªç»“è®ºå¾€å¾€ä¸æ˜¯ç»å¯¹çš„ã€‚åœ¨å¾ˆå¤šæˆ‘ä»¬å·²çŸ¥åœºæ™¯ä¸­ï¼ŒInnoDBçš„é€Ÿåº¦éƒ½å¯ä»¥è®©MyISAMæœ›å°˜è«åŠï¼Œå°¤å…¶æ˜¯ç”¨åˆ°äº†èšç°‡ç´¢å¼•ï¼Œæˆ–è€…éœ€è¦è®¿é—®çš„æ•°æ®éƒ½å¯ä»¥æ”¾å…¥å†…å­˜çš„åº”ç”¨ã€‚\n\n\nä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬é€‰æ‹© InnoDB éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æŸäº›æƒ…å†µä¸‹ä½ å¹¶ä¸åœ¨ä¹å¯æ‰©å±•èƒ½åŠ›å’Œå¹¶å‘èƒ½åŠ›ï¼Œä¹Ÿä¸éœ€è¦äº‹åŠ¡æ”¯æŒï¼Œä¹Ÿä¸åœ¨ä¹å´©æºƒåçš„å®‰å…¨æ¢å¤é—®é¢˜çš„è¯ï¼Œé€‰æ‹©MyISAMä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯éœ€è¦è€ƒè™‘åˆ°è¿™äº›é—®é¢˜çš„ã€‚\n\n\n### MEMORY\n\n\nåªå¯¹åº”ä¸€ä¸ªç£ç›˜æ–‡ä»¶.frmï¼Œç”¨æ¥å­˜å‚¨è¡¨ç»“æ„\n\n\nè®¿é—®é€Ÿåº¦éå¸¸å¿«ï¼Œå› ä¸ºä»–çš„æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œä½†æ˜¯ä¸€æ—¦æœåŠ¡å…³é—­ï¼Œæ•°æ®å°±ä¼šä¸¢å¤±\n\n\nå¯ä»¥æŒ‡å®šHashç´¢å¼•æˆ–BTREEç´¢å¼•\n\n\né»˜è®¤å­˜å‚¨æ•°æ®å¤§å°ä¸è¶…è¿‡16MBï¼Œä½†å¯ä»¥è°ƒæ•´\n\n\nåº”ç”¨åœºæ™¯ï¼šæ¯”å¦‚ä½œä¸ºç»Ÿè®¡æ“ä½œçš„çš„ä¸­é—´ç»“æœè¡¨ï¼Œä¾¿äºé«˜æ•ˆåœ°å¯¹ä¸­é—´ç»“æœåˆ†æå¹¶å¾—åˆ°æœ€ç»ˆç»“æœã€‚\n\n\n### MERGE\n\n\nä¸€ç»„MyISAMè¡¨çš„ç»„åˆï¼Œè¿™äº›MyISAMè¡¨ç»“æ„å¿…é¡»å®Œå…¨ç›¸åŒ\n\n\nå¯¹MERGEè¡¨çš„æ“ä½œå®é™…ä¸Šæ˜¯å¯¹å…¶å­è¡¨è¿›è¡Œçš„\n\n\nå¯ä»¥é€šè¿‡æŒ‡å®šINSERT_METHOD=LASTæ¥åˆ¶å®šæ’å…¥æ•°æ®çš„è¡¨ï¼ˆè¿™é‡ŒæŒ‡å®šä¸ºæœ€åä¸€ä¸ªè¡¨ï¼‰\n\n\n### å‚è€ƒ\n\n\n[1] ã€Šæ·±å…¥æµ…å‡ºMySQLã€‹\n\n\n[2] å¹³è¡¡æŸ¥æ‰¾æ ‘ä¹‹Bæ ‘ï¼š[http://www.cnblogs.com/yangecnu/p/Introduce-B-Tree-and-B-Plus-Tree.html](http://www.cnblogs.com/yangecnu/p/Introduce-B-Tree-and-B-Plus-Tree.html)\n\n\n[3] Bæ ‘ï¼ŒB+æ ‘ï¼ŒB*æ ‘ï¼š[https://www.jianshu.com/p/db226e0196b4](https://www.jianshu.com/p/db226e0196b4)\n\n\n## æ•°æ®ç»“æ„\n\n\n### Bæ ‘ï¼ˆB-Treeï¼‰\n\n\nBæ ‘æ˜¯2-3æ ‘çš„ä¸€ç§æ‰©å±•ï¼Œå¯¹äºMé˜¶(Må°±æ˜¯æ ‘çš„é«˜åº¦ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸ºä¸€ä¸ªå››é˜¶çš„æ ‘)çš„Bæ ‘æ¥è¯´ï¼š\n\n\nï¼ˆ1ï¼‰æ ¹èŠ‚ç‚¹è‡³å°‘æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹\n\n\nï¼ˆ2ï¼‰æ¯ä¸ªèŠ‚ç‚¹è‡³å¤šæœ‰M-1ä¸ªkeyï¼Œä»¥å‡åºæ’åˆ—ï¼Œä»¥åŠNk+1ä¸ªæŒ‡é’ˆï¼Œå…¶ä¸­Nkä»£è¡¨keyçš„æ•°é‡ã€‚\n\n\nï¼ˆ3ï¼‰å¯¹äºä¸€ä¸ªkey1æ¥è¯´ï¼Œå®ƒå·¦ä¾§çš„æŒ‡é’ˆæŒ‡å‘çš„å­èŠ‚ç‚¹çš„keyå€¼<=key1,å³ä¾§å­æŒ‡é’ˆæŒ‡å‘çš„å­èŠ‚ç‚¹çš„keyå€¼>key1ï¼ˆè¯¦è§ä¸‹å›¾ï¼‰\n\n\nï¼ˆ4ï¼‰å…¶ä»–èŠ‚ç‚¹è‡³å°‘æœ‰M/2ä¸ªå­èŠ‚ç‚¹\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LWJjMDIzZTQ3YmM3NGNmYTEuanBn?x-oss-process=image/format,png)\n\n\nä»–çš„æ’å…¥è¿‡ç¨‹å’Œçº¢é»‘æ ‘å¾ˆç›¸ä¼¼ï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š\n\n\nï¼ˆ1ï¼‰å½“è¦æ’å…¥ä¸€ä¸ªæ–°å€¼æ—¶ï¼Œé¦–å…ˆæ ¹æ®ç¬¬ä¸‰æ¡åŸåˆ™æ‰¾åˆ°ä»–åœ¨å¶å­èŠ‚ç‚¹çš„ä½ç½®å¹¶æ’å…¥\n\n\nï¼ˆ2ï¼‰å¦‚æœå½“å‰å¶å­èŠ‚ç‚¹çš„keyæ•°ç›®ç­‰äºMï¼Œé‚£ä¹ˆå°±è¦æ‹†åˆ†ï¼Œæ‹†åˆ†çš„è¿‡ç¨‹å°±æ˜¯æŠŠæ‰€æœ‰keyé€šè¿‡ä¸€ä¸ªä¸­é—´å€¼ï¼ˆå¦‚M=4å–ç¬¬äºŒä¸ªæ•°ï¼ŒM=5å–ç¬¬ä¸‰ä¸ªæ•°ï¼‰ï¼Œåˆ†æˆç›¸åŒçš„ä¸¤ä»½ï¼ˆå¦‚æœMæ˜¯å¶æ•°ä¼šç›¸å·®ä¸€ï¼‰ï¼Œç„¶åä¸­é—´æ•°ä¸ºçˆ¶èŠ‚ç‚¹ï¼Œä¸¤è¾¹çš„æ ‘ä½œä¸ºå·¦å³å­èŠ‚ç‚¹ï¼Œä½†è¦æ³¨æ„ä¸­é—´æ•°æ˜¯æ’å…¥åˆ°ä»–ä»¬çš„çˆ¶èŠ‚ç‚¹ä¸­çš„ï¼Œè€Œä¸æ˜¯æ–°ç”Ÿæˆä¸€æ£µæ ‘ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å¦‚æœè¿™æ—¶å€™çˆ¶èŠ‚ç‚¹çš„keyæ ‘ç­‰äºMï¼Œé‚£ä¹ˆå°±è¦é€šè¿‡ç›¸åŒçš„å˜æ¢æŠŠkeyå€¼æ¥ç€å‘ä¸Šä¼ é€’ï¼Œç›´åˆ°keyæ•°<Mã€‚\n\n\n**Bæ ‘ç”±æ¥**\n\n\n> å®šä¹‰ï¼šB-æ ‘æ˜¯ä¸€ç±»æ ‘ï¼ŒåŒ…æ‹¬B-æ ‘ã€B+æ ‘ã€B*æ ‘ç­‰ï¼Œæ˜¯ä¸€æ£µè‡ªå¹³è¡¡çš„æœç´¢æ ‘ï¼Œå®ƒç±»ä¼¼æ™®é€šçš„å¹³è¡¡äºŒå‰æ ‘ï¼Œä¸åŒçš„ä¸€ç‚¹æ˜¯B-æ ‘å…è®¸æ¯ä¸ªèŠ‚ç‚¹æœ‰æ›´å¤šçš„å­èŠ‚ç‚¹ã€‚  \n> B-æ ‘æ˜¯ä¸“é—¨ä¸ºå¤–éƒ¨å­˜å‚¨å™¨è®¾è®¡çš„ï¼Œå¦‚ç£ç›˜ï¼Œå®ƒå¯¹äºè¯»å–å’Œå†™å…¥å¤§å—æ•°æ®æœ‰è‰¯å¥½çš„æ€§èƒ½ï¼Œæ‰€ä»¥ä¸€èˆ¬è¢«ç”¨åœ¨æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ä¸­ã€‚\n\n\nå®šä¹‰åªéœ€è¦çŸ¥é“B-æ ‘å…è®¸æ¯ä¸ªèŠ‚ç‚¹æœ‰æ›´å¤šçš„å­èŠ‚ç‚¹å³å¯ï¼ˆå¤šå‰æ ‘ï¼‰ã€‚å­èŠ‚ç‚¹æ•°é‡ä¸€èˆ¬åœ¨ä¸Šåƒï¼Œå…·ä½“æ•°é‡ä¾èµ–å¤–éƒ¨å­˜å‚¨å™¨çš„ç‰¹æ€§ã€‚\n\n\nå…ˆæ¥çœ‹çœ‹ä¸ºä»€ä¹ˆä¼šå‡ºç°B-æ ‘è¿™ç±»æ•°æ®ç»“æ„ã€‚\n\n\n> ä¼ ç»Ÿç”¨æ¥æœç´¢çš„å¹³è¡¡äºŒå‰æ ‘æœ‰å¾ˆå¤šï¼Œå¦‚ AVL æ ‘ï¼Œçº¢é»‘æ ‘ç­‰ã€‚è¿™äº›æ ‘åœ¨ä¸€èˆ¬æƒ…å†µä¸‹æŸ¥è¯¢æ€§èƒ½éå¸¸å¥½ï¼Œä½†å½“æ•°æ®éå¸¸å¤§çš„æ—¶å€™å®ƒä»¬å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚\n\n\n\tåŸå› å½“æ•°æ®é‡éå¸¸å¤§æ—¶ï¼Œå†…å­˜ä¸å¤Ÿç”¨ï¼Œå¤§éƒ¨åˆ†æ•°æ®åªèƒ½å­˜æ”¾åœ¨ç£ç›˜ä¸Šï¼Œåªæœ‰éœ€è¦çš„æ•°æ®æ‰åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä¸€èˆ¬è€Œè¨€å†…å­˜è®¿é—®çš„æ—¶é—´çº¦ä¸º 50 nsï¼Œè€Œç£ç›˜åœ¨ 10 ms å·¦å³ã€‚é€Ÿåº¦ç›¸å·®äº†è¿‘ 5 ä¸ªæ•°é‡çº§ï¼Œç£ç›˜è¯»å–æ—¶é—´è¿œè¿œè¶…è¿‡äº†æ•°æ®åœ¨å†…å­˜ä¸­æ¯”è¾ƒçš„æ—¶é—´ã€‚\n\n\n\tè¿™è¯´æ˜ç¨‹åºå¤§éƒ¨åˆ†æ—¶é—´ä¼šé˜»å¡åœ¨ç£ç›˜ IO ä¸Šã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æé«˜ç¨‹åºæ€§èƒ½ï¼Ÿå‡å°‘ç£ç›˜ IO æ¬¡æ•°ï¼Œåƒ AVL æ ‘ï¼Œçº¢é»‘æ ‘è¿™ç±»å¹³è¡¡äºŒå‰æ ‘ä»è®¾è®¡ä¸Šæ— æ³•â€œè¿åˆâ€ç£ç›˜ã€‚\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LTI0Njk5ZTFmZTNmYzlhZGY?x-oss-process=image/format,png)\n\n\nä¸Šå›¾æ˜¯ä¸€é¢—ç®€å•çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œå¹³è¡¡äºŒå‰æ ‘æ˜¯é€šè¿‡æ—‹è½¬æ¥ä¿æŒå¹³è¡¡çš„ï¼Œè€Œæ—‹è½¬æ˜¯å¯¹æ•´æ£µæ ‘çš„æ“ä½œï¼Œè‹¥éƒ¨åˆ†åŠ è½½åˆ°å†…å­˜ä¸­åˆ™æ— æ³•å®Œæˆæ—‹è½¬æ“ä½œã€‚å…¶æ¬¡å¹³è¡¡äºŒå‰æ ‘çš„é«˜åº¦ç›¸å¯¹è¾ƒå¤§ä¸º log nï¼ˆåº•æ•°ä¸º2ï¼‰ï¼Œè¿™æ ·é€»è¾‘ä¸Šå¾ˆè¿‘çš„èŠ‚ç‚¹å®é™…å¯èƒ½éå¸¸è¿œï¼Œæ— æ³•å¾ˆå¥½çš„åˆ©ç”¨ç£ç›˜é¢„è¯»ï¼ˆå±€éƒ¨æ€§åŸç†ï¼‰ï¼Œæ‰€ä»¥è¿™ç±»å¹³è¡¡äºŒå‰æ ‘åœ¨æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿä¸Šçš„é€‰æ‹©å°±è¢« pass äº†ã€‚\n\n\n> ç©ºé—´å±€éƒ¨æ€§åŸç†ï¼šå¦‚æœä¸€ä¸ªå­˜å‚¨å™¨çš„æŸä¸ªä½ç½®è¢«è®¿é—®ï¼Œé‚£ä¹ˆå°†å®ƒé™„è¿‘çš„ä½ç½®ä¹Ÿä¼šè¢«è®¿é—®ã€‚\n\n\næˆ‘ä»¬ä»â€œè¿åˆâ€ç£ç›˜çš„è§’åº¦æ¥çœ‹çœ‹B-æ ‘çš„è®¾è®¡ã€‚\n\n\n**ç´¢å¼•çš„æ•ˆç‡ä¾èµ–**ä¸**ç£ç›˜ IO** çš„æ¬¡æ•°ï¼Œ**å¿«é€Ÿç´¢å¼•**éœ€è¦æœ‰æ•ˆçš„å‡å°‘ç£ç›˜ IO æ¬¡æ•°ï¼Œå¦‚ä½•å¿«é€Ÿç´¢å¼•å‘¢ï¼Ÿ\n\n\n> ç´¢å¼•çš„åŸç†å…¶å®æ˜¯ä¸æ–­çš„ç¼©å°æŸ¥æ‰¾èŒƒå›´ï¼Œå°±å¦‚æˆ‘ä»¬å¹³æ—¶ç”¨å­—å…¸æŸ¥å•è¯ä¸€æ ·ï¼Œå…ˆæ‰¾é¦–å­—æ¯ç¼©å°èŒƒå›´ï¼Œå†ç¬¬äºŒä¸ªå­—æ¯ç­‰ç­‰ã€‚\n\n\n\tå¹³è¡¡äºŒå‰æ ‘æ˜¯æ¯æ¬¡å°†èŒƒå›´åˆ†å‰²ä¸ºä¸¤ä¸ªåŒºé—´ã€‚ä¸ºäº†æ›´å¿«ï¼ŒB-æ ‘æ¯æ¬¡å°†èŒƒå›´åˆ†å‰²ä¸ºå¤šä¸ªåŒºé—´ï¼ŒåŒºé—´è¶Šå¤šï¼Œå®šä½æ•°æ®è¶Šå¿«è¶Šç²¾ç¡®ã€‚é‚£ä¹ˆå¦‚æœèŠ‚ç‚¹ä¸ºåŒºé—´èŒƒå›´ï¼Œæ¯ä¸ªèŠ‚ç‚¹å°±è¾ƒå¤§äº†ã€‚æ‰€ä»¥æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç”³è¯·é¡µå¤§å°çš„ç©ºé—´ï¼ˆç£ç›˜å­˜å‚¨å•ä½æ˜¯æŒ‰ block åˆ†çš„ï¼Œä¸€èˆ¬ä¸º 512 Byteã€‚\n\n\n\tç£ç›˜ IO ä¸€æ¬¡è¯»å–è‹¥å¹²ä¸ª blockï¼Œæˆ‘ä»¬ç§°ä¸ºä¸€é¡µï¼Œå…·ä½“å¤§å°å’Œæ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œä¸€èˆ¬ä¸º 4 kï¼Œ8 kæˆ– 16 kï¼‰ï¼Œè®¡ç®—æœºå†…å­˜åˆ†é…æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡ IOã€‚\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LWI2ZDQ3NTQzMDRmYTg5NTU?x-oss-process=image/format,png)\n\n\nä¸Šå›¾æ˜¯ä¸€æ£µç®€åŒ–çš„B-æ ‘ï¼Œå¤šå‰çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼Œæœ‰æ•ˆçš„é™ä½äº†B-æ ‘çš„é«˜åº¦ï¼Œä¸ºåº•æ•°å¾ˆå¤§çš„ log nï¼Œåº•æ•°å¤§å°ä¸èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°ç›®æœ‰å…³ï¼Œä¸€èˆ¬ä¸€æ£µB-æ ‘çš„é«˜åº¦åœ¨ 3 å±‚å·¦å³ã€‚\n\n\nå±‚æ•°ä½ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒºç¡®å®šçš„èŒƒå›´æ›´ç²¾ç¡®ï¼ŒèŒƒå›´ç¼©å°çš„é€Ÿåº¦è¶Šå¿«ï¼ˆæ¯”äºŒå‰æ ‘æ·±å±‚æ¬¡çš„æœç´¢è‚¯å®šå¿«å¾ˆå¤šï¼‰ã€‚ä¸Šé¢è¯´äº†ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦è¿›è¡Œä¸€æ¬¡ IOï¼Œé‚£ä¹ˆæ€» IO çš„æ¬¡æ•°å°±ç¼©å‡ä¸ºäº† log n æ¬¡ã€‚B-æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯ n ä¸ªæœ‰åºçš„åºåˆ—(a1,a2,a3â€¦an)ï¼Œå¹¶å°†è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ†å‰²æˆ n+1 ä¸ªåŒºé—´æ¥è¿›è¡Œç´¢å¼•(X1< a1, a2 < X2 < a3, â€¦ , an+1 < Xn < anXn+1 > an)ã€‚\n\n\n> ç‚¹è¯„ï¼šBæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½æ˜¯å­˜å¤šä¸ªå€¼çš„ï¼Œä¸åƒäºŒå‰æ ‘é‚£æ ·ï¼Œä¸€ä¸ªèŠ‚ç‚¹å°±ä¸€ä¸ªå€¼ï¼ŒBæ ‘æŠŠæ¯ä¸ªèŠ‚ç‚¹éƒ½ç»™äº†ä¸€ç‚¹çš„èŒƒå›´åŒºé—´ï¼ŒåŒºé—´æ›´å¤šçš„æƒ…å†µä¸‹ï¼Œæœç´¢ä¹Ÿå°±æ›´å¿«äº†ï¼Œæ¯”å¦‚ï¼šæœ‰1-100ä¸ªæ•°ï¼ŒäºŒå‰æ ‘ä¸€æ¬¡åªèƒ½åˆ†ä¸¤ä¸ªèŒƒå›´ï¼Œ0-50å’Œ51-100ï¼Œè€ŒBæ ‘ï¼Œåˆ†æˆ4ä¸ªèŒƒå›´ 1-25ï¼Œ 25-50ï¼Œ51-75ï¼Œ76-100ä¸€æ¬¡å°±èƒ½ç­›é€‰èµ°å››åˆ†ä¹‹ä¸‰çš„æ•°æ®ã€‚æ‰€ä»¥ä½œä¸ºå¤šå‰æ ‘çš„Bæ ‘æ˜¯æ›´å¿«çš„\n\n\n### B+Treeï¼ˆæ ‘ï¼‰\n\n\nå­˜å‚¨å¼•æ“å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸€ç§å¤šå‰å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œç‰¹ç‚¹ï¼ˆå¯¹äºMé˜¶çš„B+æ ‘ï¼‰ï¼š\n\n\nï¼ˆ1ï¼‰é™¤å¶å­ç»“ç‚¹å¤–æ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰Mä¸ªé”®ä»¥åŠMä¸ªæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚\n\n\nï¼ˆ2ï¼‰æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚\n\n\nï¼ˆ3ï¼‰éå¶å­ç»“ç‚¹çš„å­æ ‘æŒ‡é’ˆä¸å…³é”®å­—ï¼ˆKeyï¼‰ä¸ªæ•°ç›¸åŒï¼›\n\n\nï¼ˆ4ï¼‰éå¶å­ç»“ç‚¹çš„å­æ ‘æŒ‡é’ˆP[i]ï¼ŒæŒ‡å‘å…³é”®å­—å€¼å±äº[K[i], K[i+1])çš„å­æ ‘ï¼ˆB-æ ‘æ˜¯å¼€åŒºé—´ï¼‰ï¼›\n\n\nï¼ˆ5ï¼‰ä¸ºæ‰€æœ‰å¶å­ç»“ç‚¹å¢åŠ ä¸€ä¸ªé“¾æŒ‡é’ˆï¼›\n\n\nï¼ˆ6ï¼‰æ‰€æœ‰å…³é”®å­—ï¼ˆkeyï¼‰éƒ½åœ¨å¶å­ç»“ç‚¹å‡ºç°ï¼›ï¼Œå› æ­¤æ‰€æœ‰æŸ¥æ‰¾åªä¼šåœ¨å¶å­ç»“ç‚¹å‘½ä¸­\n\n\nç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LTMwYjcwYWFhMjg0MDM4MDMuanBn?x-oss-process=image/format,png)\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LTJhYTFjMTdkMTY4OGI3OTk?x-oss-process=image/format,png)\n\n\n**å› ä¸ºå†…èŠ‚ç‚¹å¹¶ä¸å­˜å‚¨ dataï¼Œæ‰€ä»¥ä¸€èˆ¬B+æ ‘çš„å¶èŠ‚ç‚¹å’Œå†…èŠ‚ç‚¹å¤§å°ä¸åŒï¼Œè€ŒB-æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¤§å°ä¸€èˆ¬æ˜¯ç›¸åŒçš„ï¼Œä¸ºä¸€é¡µã€‚**\n\n\nä¸ºäº†å¢åŠ  **åŒºé—´è®¿é—®æ€§**ï¼Œä¸€èˆ¬ä¼šå¯¹B+æ ‘åšä¸€äº›ä¼˜åŒ–ã€‚\nå¦‚ä¸‹å›¾å¸¦é¡ºåºè®¿é—®çš„B+æ ‘ã€‚\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LTg5MTkwOTQzNzk0M2Q4ODg?x-oss-process=image/format,png)\n\n\n**ç›¸æ¯”Bæ ‘çš„ä¼˜ç‚¹ï¼š**\n\n\nï¼ˆ1ï¼‰æ”¯æŒèŒƒå›´æŸ¥æ‰¾\n\n\nï¼ˆ2ï¼‰éå†æ›´æ–¹ä¾¿\n\n\nï¼ˆ3ï¼‰èŠ‚çœç©ºé—´ï¼šå› ä¸ºB+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹æ‰å­˜æ•°æ®ï¼Œå› æ­¤å†…éƒ¨èŠ‚ç‚¹ä¸éœ€è¦åªæƒ³å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆã€‚\n\n\nï¼ˆ4ï¼‰æ‰€æœ‰æŸ¥è¯¢æ“ä½œéƒ½éœ€è¦å‘½ä¸­å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ˜¯ç›¸åŒçš„ã€‚\n\n\n> PS: B*æ ‘å°±æ˜¯åœ¨B+æ ‘åŸºç¡€ä¸Šï¼Œä¸ºéå¶å­ç»“ç‚¹ä¹Ÿå¢åŠ é“¾è¡¨æŒ‡é’ˆ\n\n\n### Bæ ‘ä¸B+Treeçš„åŒºåˆ«\n\n\n1 .  **B+æ ‘å†…èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œæ‰€æœ‰ data å­˜å‚¨åœ¨å¶èŠ‚ç‚¹å¯¼è‡´æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦å›ºå®šä¸º log nã€‚è€ŒB-æ ‘æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸å›ºå®šï¼Œä¸ key åœ¨æ ‘ä¸­çš„ä½ç½®æœ‰å…³ï¼Œæœ€å¥½ä¸ºO(1)ã€‚**\n\n\nå¦‚ä¸‹æ‰€ç¤ºB-æ ‘/B+æ ‘æŸ¥è¯¢èŠ‚ç‚¹ key ä¸º 50 çš„ dataã€‚\n\n\nB-æ ‘ï¼š\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LWQ2MmVjNmU4M2VlYmUwNmY?x-oss-process=image/format,png)\n\n\n> ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œkey ä¸º 50 çš„èŠ‚ç‚¹å°±åœ¨ç¬¬ä¸€å±‚ï¼ŒB-æ ‘åªéœ€è¦ä¸€æ¬¡ç£ç›˜ IO å³å¯å®ŒæˆæŸ¥æ‰¾ã€‚æ‰€ä»¥è¯´B-æ ‘çš„æŸ¥è¯¢æœ€å¥½æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚\n\n\nB+æ ‘ï¼š\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LWQ2OTBmYWJlOGM5MTkyODE?x-oss-process=image/format,png)\n\n\n**ç”±äºB+æ ‘æ‰€æœ‰çš„ data åŸŸéƒ½åœ¨æ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥æŸ¥è¯¢ key ä¸º 50çš„èŠ‚ç‚¹å¿…é¡»ä»æ ¹èŠ‚ç‚¹ç´¢å¼•åˆ°å¶èŠ‚ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦å›ºå®šä¸º O(log n)ã€‚**\n\n\n> ç‚¹è¯„ï¼šBæ ‘çš„ç”±äºæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰keyå’Œdataï¼Œæ‰€ä»¥æŸ¥è¯¢çš„æ—¶å€™å¯èƒ½ä¸éœ€è¦O(logn)çš„å¤æ‚åº¦ï¼Œç”šè‡³æœ€å¥½çš„æƒ…å†µæ˜¯O(1)å°±å¯ä»¥æ‰¾åˆ°æ•°æ®ï¼Œè€ŒB+æ ‘ç”±äºåªæœ‰å¶å­èŠ‚ç‚¹ä¿å­˜äº†dataï¼Œæ‰€ä»¥å¿…é¡»ç»å†O(logn)å¤æ‚åº¦æ‰èƒ½æ‰¾åˆ°æ•°æ®\n\n1. **B+æ ‘å¶èŠ‚ç‚¹ä¸¤ä¸¤ç›¸è¿å¯å¤§å¤§å¢åŠ åŒºé—´è®¿é—®æ€§ï¼Œå¯ä½¿ç”¨åœ¨èŒƒå›´æŸ¥è¯¢ç­‰ï¼Œè€ŒB-æ ‘æ¯ä¸ªèŠ‚ç‚¹ key å’Œ data åœ¨ä¸€èµ·ï¼Œåˆ™æ— æ³•åŒºé—´æŸ¥æ‰¾ã€‚**\n\n`æ ¹æ®ç©ºé—´å±€éƒ¨æ€§åŸç†`ï¼šå¦‚æœä¸€ä¸ªå­˜å‚¨å™¨çš„æŸä¸ªä½ç½®è¢«è®¿é—®ï¼Œé‚£ä¹ˆå°†å®ƒé™„è¿‘çš„ä½ç½®ä¹Ÿä¼šè¢«è®¿é—®ã€‚\n\n\n> B+æ ‘å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨å±€éƒ¨æ€§åŸç†ï¼Œè‹¥æˆ‘ä»¬è®¿é—®èŠ‚ç‚¹ keyä¸º 50ï¼Œåˆ™ key ä¸º 55ã€60ã€62 çš„èŠ‚ç‚¹å°†æ¥ä¹Ÿå¯èƒ½è¢«è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç£ç›˜é¢„è¯»åŸç†æå‰å°†è¿™äº›æ•°æ®è¯»å…¥å†…å­˜ï¼Œå‡å°‘äº†ç£ç›˜ IO çš„æ¬¡æ•°ã€‚  \n> å½“ç„¶B+æ ‘ä¹Ÿèƒ½å¤Ÿå¾ˆå¥½çš„å®ŒæˆèŒƒå›´æŸ¥è¯¢ã€‚æ¯”å¦‚æŸ¥è¯¢ key å€¼åœ¨ 50-70 ä¹‹é—´çš„èŠ‚ç‚¹ã€‚\n\n\n> ç‚¹è¯„ï¼šç”±äºB+æ ‘çš„å¶å­èŠ‚ç‚¹çš„æ•°æ®éƒ½æ˜¯ä½¿ç”¨é“¾è¡¨è¿æ¥èµ·æ¥çš„ï¼Œè€Œä¸”ä»–ä»¬åœ¨ç£ç›˜é‡Œæ˜¯é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥å½“è¯»åˆ°æŸä¸ªå€¼çš„æ—¶å€™ï¼Œç£ç›˜é¢„è¯»åŸç†å°±ä¼šæå‰æŠŠè¿™äº›æ•°æ®éƒ½è¯»è¿›å†…å­˜ï¼Œä½¿å¾—èŒƒå›´æŸ¥è¯¢å’Œæ’åºéƒ½å¾ˆå¿«\n\n1. **B+æ ‘æ›´é€‚åˆå¤–éƒ¨å­˜å‚¨ã€‚ç”±äºå†…èŠ‚ç‚¹æ—  data åŸŸï¼Œæ¯ä¸ªèŠ‚ç‚¹èƒ½ç´¢å¼•çš„èŒƒå›´æ›´å¤§æ›´ç²¾ç¡®**\n\nè¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œç”±äºB-æ ‘èŠ‚ç‚¹å†…éƒ¨æ¯ä¸ª key éƒ½å¸¦ç€ data åŸŸï¼Œè€ŒB+æ ‘èŠ‚ç‚¹åªå­˜å‚¨ key çš„å‰¯æœ¬ï¼ŒçœŸå®çš„ key å’Œ data åŸŸéƒ½åœ¨å¶å­èŠ‚ç‚¹å­˜å‚¨ã€‚\n\n\n      å‰é¢è¯´è¿‡ç£ç›˜æ˜¯åˆ† block çš„ï¼Œä¸€æ¬¡ç£ç›˜ IO ä¼šè¯»å–è‹¥å¹²ä¸ª blockï¼Œå…·ä½“å’Œæ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œé‚£ä¹ˆç”±äºç£ç›˜ IO æ•°æ®å¤§å°æ˜¯å›ºå®šçš„ï¼Œåœ¨ä¸€æ¬¡ IO ä¸­ï¼Œå•ä¸ªå…ƒç´ è¶Šå°ï¼Œé‡å°±è¶Šå¤§ã€‚\n\n\nè¿™å°±æ„å‘³ç€B+æ ‘å•æ¬¡ç£ç›˜ IO çš„ä¿¡æ¯é‡å¤§äºB-æ ‘ï¼Œä»è¿™ç‚¹æ¥çœ‹B+æ ‘ç›¸å¯¹B-æ ‘ç£ç›˜ IO æ¬¡æ•°å°‘ã€‚\n\n\n> ç‚¹è¯„ï¼šç”±äºBæ ‘çš„èŠ‚ç‚¹éƒ½å­˜äº†keyå’Œdataï¼Œè€ŒB+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹å­˜dataï¼Œéå¶å­èŠ‚ç‚¹éƒ½åªæ˜¯ç´¢å¼•å€¼ï¼Œæ²¡æœ‰å®é™…çš„æ•°æ®ï¼Œè¿™å°±æ—¶B+æ ‘åœ¨ä¸€æ¬¡IOé‡Œé¢ï¼Œèƒ½è¯»å‡ºçš„ç´¢å¼•å€¼æ›´å¤šã€‚ä»è€Œå‡å°‘æŸ¥è¯¢æ—¶å€™éœ€è¦çš„IOæ¬¡æ•°ï¼\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LTBmNmUxZjdiODkyMWI2ZjM?x-oss-process=image/format,png)\n\n\n> ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºç›¸åŒå¤§å°çš„åŒºåŸŸï¼ŒB-æ ‘ä»…æœ‰ 2 ä¸ª keyï¼Œè€ŒB+æ ‘æœ‰ 3 ä¸ª keyã€‚\n\n\n### ä¸ºä»€ä¹ˆä½¿ç”¨B-Treeï¼ˆB+Treeï¼‰\n\n\n      `ä¸Šæ–‡è¯´è¿‡ï¼Œçº¢é»‘æ ‘ç­‰æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ç´¢å¼•ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ç³»ç»Ÿæ™®éé‡‡ç”¨B-/+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œè¿™ä¸€èŠ‚å°†ç»“åˆè®¡ç®—æœºç»„æˆåŸç†ç›¸å…³çŸ¥è¯†è®¨è®ºB-/+Treeä½œä¸ºç´¢å¼•çš„ç†è®ºåŸºç¡€ã€‚`\n\n\n> ä¸€èˆ¬æ¥è¯´ï¼Œç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨çš„ç£ç›˜ä¸Šã€‚è¿™æ ·çš„è¯ï¼Œç´¢å¼•æŸ¥æ‰¾è¿‡ç¨‹ä¸­å°±è¦äº§ç”Ÿç£ç›˜I/Oæ¶ˆè€—ï¼Œç›¸å¯¹äºå†…å­˜å­˜å–ï¼ŒI/Oå­˜å–çš„æ¶ˆè€—è¦é«˜å‡ ä¸ªæ•°é‡çº§ï¼Œæ‰€ä»¥è¯„ä»·ä¸€ä¸ªæ•°æ®ç»“æ„ä½œä¸ºç´¢å¼•çš„ä¼˜åŠ£æœ€é‡è¦çš„æŒ‡æ ‡å°±æ˜¯åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­ç£ç›˜I/Oæ“ä½œæ¬¡æ•°çš„æ¸è¿›å¤æ‚åº¦ã€‚\n\n\n\tæ¢å¥è¯è¯´ï¼Œç´¢å¼•çš„ç»“æ„ç»„ç»‡è¦å°½é‡å‡å°‘æŸ¥æ‰¾è¿‡ç¨‹ä¸­ç£ç›˜I/Oçš„å­˜å–æ¬¡æ•°ã€‚ä¸‹é¢å…ˆä»‹ç»å†…å­˜å’Œç£ç›˜å­˜å–åŸç†ï¼Œç„¶åå†ç»“åˆè¿™äº›åŸç†åˆ†æB-/+Treeä½œä¸ºç´¢å¼•çš„æ•ˆç‡ã€‚\n\n\n### å­˜å‚¨æ•°æ®æœ€å°å•å…ƒ\n\n\næˆ‘ä»¬éƒ½çŸ¥é“è®¡ç®—æœºåœ¨å­˜å‚¨æ•°æ®çš„æ—¶å€™ï¼Œæœ‰æœ€å°å­˜å‚¨å•å…ƒï¼Œè¿™å°±å¥½æ¯”æˆ‘ä»¬ä»Šå¤©è¿›è¡Œç°é‡‘çš„æµé€šæœ€å°å•ä½æ˜¯ä¸€æ¯›ã€‚\n\n\nåœ¨è®¡ç®—æœºä¸­ç£ç›˜å­˜å‚¨æ•°æ®æœ€å°å•å…ƒæ˜¯æ‰‡åŒºï¼Œä¸€ä¸ªæ‰‡åŒºçš„å¤§å°æ˜¯512å­—èŠ‚ï¼Œè€Œæ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚XFS/EXT4ï¼‰ä»–çš„æœ€å°å•å…ƒæ˜¯å—ï¼Œä¸€ä¸ªå—çš„å¤§å°æ˜¯4k\n\n\nè€Œå¯¹äºæˆ‘ä»¬çš„InnoDBå­˜å‚¨å¼•æ“ä¹Ÿæœ‰è‡ªå·±çš„æœ€å°å‚¨å­˜å•å…ƒâ€”â€”é¡µï¼ˆPageï¼‰ï¼Œä¸€ä¸ªé¡µçš„å¤§å°æ˜¯16Kã€‚\n\n\nä¸‹é¢å‡ å¼ å›¾å¯ä»¥å¸®ä½ ç†è§£æœ€å°å­˜å‚¨å•å…ƒï¼š\n\n\næ–‡ä»¶ç³»ç»Ÿä¸­ä¸€ä¸ªæ–‡ä»¶å¤§å°åªæœ‰1ä¸ªå­—èŠ‚ï¼Œä½†ä¸å¾—ä¸å ç£ç›˜ä¸Š4KBçš„ç©ºé—´ã€‚\n\n\nç£ç›˜æ‰‡åŒºã€æ–‡ä»¶ç³»ç»Ÿã€InnoDBå­˜å‚¨å¼•æ“éƒ½æœ‰å„è‡ªçš„æœ€å°å­˜å‚¨å•å…ƒã€‚\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LTAyMzJiODIzZTNmMWViM2E?x-oss-process=image/format,png)\n\n\nåœ¨MySQLä¸­æˆ‘ä»¬çš„InnoDBé¡µçš„å¤§å°é»˜è®¤æ˜¯16kï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®ï¼š\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LWVkNzFhNWIzZWVmNDMxZGM?x-oss-process=image/format,png)\n\n\n> æ•°æ®è¡¨ä¸­çš„æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨é¡µä¸­çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªé¡µä¸­èƒ½å­˜å‚¨å¤šå°‘è¡Œæ•°æ®å‘¢ï¼Ÿå‡è®¾ä¸€è¡Œæ•°æ®çš„å¤§å°æ˜¯1kï¼Œé‚£ä¹ˆä¸€ä¸ªé¡µå¯ä»¥å­˜æ”¾16è¡Œè¿™æ ·çš„æ•°æ®ã€‚\n\n\n### ä¸»å­˜å­˜å–åŸç†\n\n\nç›®å‰è®¡ç®—æœºä½¿ç”¨çš„ä¸»å­˜åŸºæœ¬éƒ½æ˜¯éšæœºè¯»å†™å­˜å‚¨å™¨ï¼ˆRAMï¼‰ï¼Œç°ä»£RAMçš„ç»“æ„å’Œå­˜å–åŸç†æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œæœ¬æ–‡æŠ›å´å…·ä½“å·®åˆ«ï¼ŒæŠ½è±¡å‡ºä¸€ä¸ªååˆ†ç®€å•çš„å­˜å–æ¨¡å‹æ¥è¯´æ˜RAMçš„å·¥ä½œåŸç†ã€‚\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LTBmODlkNzBlYTM0YTI1OTkucG5n?x-oss-process=image/format,png)\n\n\n`ä»æŠ½è±¡è§’åº¦çœ‹`ï¼Œä¸»å­˜æ˜¯ä¸€ç³»åˆ—çš„å­˜å‚¨å•å…ƒç»„æˆçš„çŸ©é˜µï¼Œæ¯ä¸ªå­˜å‚¨å•å…ƒå­˜å‚¨å›ºå®šå¤§å°çš„æ•°æ®ã€‚æ¯ä¸ªå­˜å‚¨å•å…ƒæœ‰å”¯ä¸€çš„åœ°å€ï¼Œç°ä»£ä¸»å­˜çš„ç¼–å€è§„åˆ™æ¯”è¾ƒå¤æ‚\n\n\n    è¿™é‡Œå°†å…¶ç®€åŒ–æˆä¸€ä¸ª`äºŒç»´åœ°å€`ï¼šé€šè¿‡ä¸€ä¸ªè¡Œåœ°å€å’Œä¸€ä¸ªåˆ—åœ°å€å¯ä»¥å”¯ä¸€å®šä½åˆ°ä¸€ä¸ªå­˜å‚¨å•å…ƒã€‚å›¾5å±•ç¤ºäº†ä¸€ä¸ª4 x 4çš„ä¸»å­˜æ¨¡å‹ã€‚\n\n\n**ä¸»å­˜çš„å­˜å–è¿‡ç¨‹å¦‚ä¸‹ï¼š**\n\n\n> å½“ç³»ç»Ÿéœ€è¦è¯»å–ä¸»å­˜æ—¶ï¼Œåˆ™å°†åœ°å€ä¿¡å·æ”¾åˆ°åœ°å€æ€»çº¿ä¸Šä¼ ç»™ä¸»å­˜ï¼Œä¸»å­˜è¯»åˆ°åœ°å€ä¿¡å·åï¼Œè§£æä¿¡å·å¹¶å®šä½åˆ°æŒ‡å®šå­˜å‚¨å•å…ƒï¼Œç„¶åå°†æ­¤å­˜å‚¨å•å…ƒæ•°æ®æ”¾åˆ°æ•°æ®æ€»çº¿ä¸Šï¼Œä¾›å…¶å®ƒéƒ¨ä»¶è¯»å–ã€‚\n\n\n> å†™ä¸»å­˜çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œç³»ç»Ÿå°†è¦å†™å…¥å•å…ƒåœ°å€å’Œæ•°æ®åˆ†åˆ«æ”¾åœ¨åœ°å€æ€»çº¿å’Œæ•°æ®æ€»çº¿ä¸Šï¼Œä¸»å­˜è¯»å–ä¸¤ä¸ªæ€»çº¿çš„å†…å®¹ï¼Œåšç›¸åº”çš„å†™æ“ä½œã€‚\n\n\nè¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œä¸»å­˜å­˜å–çš„æ—¶é—´ä»…ä¸å­˜å–æ¬¡æ•°å‘ˆçº¿æ€§å…³ç³»ï¼Œå› ä¸ºä¸å­˜åœ¨æœºæ¢°æ“ä½œï¼Œä¸¤æ¬¡å­˜å–çš„æ•°æ®çš„â€œè·ç¦»â€ä¸ä¼šå¯¹æ—¶é—´æœ‰ä»»ä½•å½±å“ï¼Œä¾‹å¦‚ï¼Œå…ˆå–A0å†å–A1å’Œå…ˆå–A0å†å–D3çš„æ—¶é—´æ¶ˆè€—æ˜¯ä¸€æ ·çš„ã€‚\n\n\n### ç£ç›˜å­˜å–åŸç†\n\n\nä¸Šæ–‡è¯´è¿‡ï¼Œç´¢å¼•ä¸€èˆ¬ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç´¢å¼•æ£€ç´¢éœ€è¦ç£ç›˜I/Oæ“ä½œã€‚ä¸ä¸»å­˜ä¸åŒï¼Œç£ç›˜I/Oå­˜åœ¨æœºæ¢°è¿åŠ¨è€—è´¹ï¼Œå› æ­¤ç£ç›˜I/Oçš„æ—¶é—´æ¶ˆè€—æ˜¯å·¨å¤§çš„ã€‚\n\n\nå›¾6æ˜¯ç£ç›˜çš„æ•´ä½“ç»“æ„ç¤ºæ„å›¾ã€‚\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LTA3Njg5ZDJjNTM5YzY1MGIucG5n?x-oss-process=image/format,png)\n\n\nä¸€ä¸ªç£ç›˜ç”±å¤§å°ç›¸åŒä¸”åŒè½´çš„åœ†å½¢ç›˜ç‰‡ç»„æˆï¼Œç£ç›˜å¯ä»¥è½¬åŠ¨ï¼ˆå„ä¸ªç£ç›˜å¿…é¡»åŒæ­¥è½¬åŠ¨ï¼‰ã€‚åœ¨ç£ç›˜çš„ä¸€ä¾§æœ‰ç£å¤´æ”¯æ¶ï¼Œç£å¤´æ”¯æ¶å›ºå®šäº†ä¸€ç»„ç£å¤´ï¼Œæ¯ä¸ªç£å¤´è´Ÿè´£å­˜å–ä¸€ä¸ªç£ç›˜çš„å†…å®¹ã€‚ç£å¤´ä¸èƒ½è½¬åŠ¨ï¼Œä½†æ˜¯å¯ä»¥æ²¿ç£ç›˜åŠå¾„æ–¹å‘è¿åŠ¨ï¼ˆå®é™…æ˜¯æ–œåˆ‡å‘è¿åŠ¨ï¼‰ï¼Œæ¯ä¸ªç£å¤´åŒä¸€æ—¶åˆ»ä¹Ÿå¿…é¡»æ˜¯åŒè½´çš„ï¼Œå³ä»æ­£ä¸Šæ–¹å‘ä¸‹çœ‹ï¼Œæ‰€æœ‰ç£å¤´ä»»ä½•æ—¶å€™éƒ½æ˜¯é‡å çš„ï¼ˆä¸è¿‡ç›®å‰å·²ç»æœ‰å¤šç£å¤´ç‹¬ç«‹æŠ€æœ¯ï¼Œå¯ä¸å—æ­¤é™åˆ¶ï¼‰ã€‚\n\n\nå›¾7æ˜¯ç£ç›˜ç»“æ„çš„ç¤ºæ„å›¾ã€‚\n\n\n![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDQ2MDg3LWZiZDUyMTlkMmVkNWQ3YzUucG5n?x-oss-process=image/format,png)\n\n\nç›˜ç‰‡è¢«åˆ’åˆ†æˆä¸€ç³»åˆ—åŒå¿ƒç¯ï¼Œåœ†å¿ƒæ˜¯ç›˜ç‰‡ä¸­å¿ƒï¼Œæ¯ä¸ªåŒå¿ƒç¯å«åšä¸€ä¸ªç£é“ï¼Œæ‰€æœ‰åŠå¾„ç›¸åŒçš„ç£é“ç»„æˆä¸€ä¸ªæŸ±é¢ã€‚ç£é“è¢«æ²¿åŠå¾„çº¿åˆ’åˆ†æˆä¸€ä¸ªä¸ªå°çš„æ®µï¼Œ**æ¯ä¸ªæ®µå«åšä¸€ä¸ªæ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒºæ˜¯ç£ç›˜çš„æœ€å°å­˜å‚¨å•å…ƒ**ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä¸‹é¢å‡è®¾ç£ç›˜åªæœ‰ä¸€ä¸ªç›˜ç‰‡å’Œä¸€ä¸ªç£å¤´ã€‚\n\n\n> å½“éœ€è¦ä»ç£ç›˜è¯»å–æ•°æ®æ—¶ï¼Œç³»ç»Ÿä¼šå°†æ•°æ®é€»è¾‘åœ°å€ä¼ ç»™ç£ç›˜ï¼Œç£ç›˜çš„æ§åˆ¶ç”µè·¯æŒ‰ç…§å¯»å€é€»è¾‘å°†é€»è¾‘åœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ï¼Œå³ç¡®å®šè¦è¯»çš„æ•°æ®åœ¨å“ªä¸ªç£é“ï¼Œå“ªä¸ªæ‰‡åŒºã€‚\n\n\n\t    ä¸ºäº†è¯»å–è¿™ä¸ªæ‰‡åŒºçš„æ•°æ®ï¼Œéœ€è¦å°†ç£å¤´æ”¾åˆ°è¿™ä¸ªæ‰‡åŒºä¸Šæ–¹ï¼Œä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç£å¤´éœ€è¦ç§»åŠ¨å¯¹å‡†ç›¸åº”ç£é“ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšå¯»é“ï¼Œæ‰€è€—è´¹æ—¶é—´å«åšå¯»é“æ—¶é—´ï¼Œç„¶åç£ç›˜æ—‹è½¬å°†ç›®æ ‡æ‰‡åŒºæ—‹è½¬åˆ°ç£å¤´ä¸‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—è´¹çš„æ—¶é—´å«åšæ—‹è½¬æ—¶é—´ã€‚\n\n\n### å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»\n\n\n> ç”±äºå­˜å‚¨ä»‹è´¨çš„ç‰¹æ€§ï¼Œç£ç›˜æœ¬èº«å­˜å–å°±æ¯”ä¸»å­˜æ…¢å¾ˆå¤šï¼Œå†åŠ ä¸Šæœºæ¢°è¿åŠ¨è€—è´¹ï¼Œç£ç›˜çš„å­˜å–é€Ÿåº¦å¾€å¾€æ˜¯ä¸»å­˜çš„å‡ ç™¾åˆ†åˆ†ä¹‹ä¸€ï¼Œå› æ­¤ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè¦å°½é‡å‡å°‘ç£ç›˜I/Oã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ï¼Œå³ä½¿åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œç£ç›˜ä¹Ÿä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œé¡ºåºå‘åè¯»å–ä¸€å®šé•¿åº¦çš„æ•°æ®æ”¾å…¥å†…å­˜ã€‚è¿™æ ·åšçš„ç†è®ºä¾æ®æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­è‘—åçš„å±€éƒ¨æ€§åŸç†ï¼š\n\n\nå½“ä¸€ä¸ªæ•°æ®è¢«ç”¨åˆ°æ—¶ï¼Œå…¶é™„è¿‘çš„æ•°æ®ä¹Ÿé€šå¸¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨ã€‚\n\n\nç¨‹åºè¿è¡ŒæœŸé—´æ‰€éœ€è¦çš„æ•°æ®é€šå¸¸æ¯”è¾ƒé›†ä¸­ã€‚\n\n\nç”±äºç£ç›˜é¡ºåºè¯»å–çš„æ•ˆç‡å¾ˆé«˜ï¼ˆä¸éœ€è¦å¯»é“æ—¶é—´ï¼Œåªéœ€å¾ˆå°‘çš„æ—‹è½¬æ—¶é—´ï¼‰ï¼Œå› æ­¤å¯¹äºå…·æœ‰å±€éƒ¨æ€§çš„ç¨‹åºæ¥è¯´ï¼Œé¢„è¯»å¯ä»¥æé«˜I/Oæ•ˆç‡ã€‚\n\n\né¢„è¯»çš„é•¿åº¦ä¸€èˆ¬ä¸ºé¡µï¼ˆpageï¼‰çš„æ•´å€æ•°ã€‚é¡µæ˜¯è®¡ç®—æœºç®¡ç†å­˜å‚¨å™¨çš„é€»è¾‘å—ï¼Œç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿå¾€å¾€å°†ä¸»å­˜å’Œç£ç›˜å­˜å‚¨åŒºåˆ†å‰²ä¸ºè¿ç»­çš„å¤§å°ç›¸ç­‰çš„å—ï¼Œæ¯ä¸ªå­˜å‚¨å—ç§°ä¸ºä¸€é¡µï¼ˆåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­ï¼Œé¡µå¾—å¤§å°é€šå¸¸ä¸º4kï¼‰ï¼Œä¸»å­˜å’Œç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚å½“ç¨‹åºè¦è¯»å–çš„æ•°æ®ä¸åœ¨ä¸»å­˜ä¸­æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šå‘ç£ç›˜å‘å‡ºè¯»ç›˜ä¿¡å·ï¼Œç£ç›˜ä¼šæ‰¾åˆ°æ•°æ®çš„èµ·å§‹ä½ç½®å¹¶å‘åè¿ç»­è¯»å–ä¸€é¡µæˆ–å‡ é¡µè½½å…¥å†…å­˜ä¸­ï¼Œç„¶åå¼‚å¸¸è¿”å›ï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚\n\n\n**æ‰€ä»¥IOä¸€æ¬¡å°±æ˜¯è¯»ä¸€é¡µçš„å¤§å°**\n\n\n## ç´¢å¼•\n\n\nMySQLç´¢å¼•ä½¿ç”¨çš„æ•°æ®ç»“æ„ä¸»è¦æœ‰**BTreeç´¢å¼•** å’Œ **å“ˆå¸Œç´¢å¼•** ã€‚å¯¹äºå“ˆå¸Œç´¢å¼•æ¥è¯´ï¼Œåº•å±‚çš„æ•°æ®ç»“æ„å°±æ˜¯å“ˆå¸Œè¡¨ï¼Œå› æ­¤åœ¨ç»å¤§å¤šæ•°éœ€æ±‚ä¸ºå•æ¡è®°å½•æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©å“ˆå¸Œç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½æœ€å¿«ï¼›å…¶ä½™å¤§éƒ¨åˆ†åœºæ™¯ï¼Œå»ºè®®é€‰æ‹©BTreeç´¢å¼•ã€‚\n\n\nMySQLçš„BTreeç´¢å¼•ä½¿ç”¨çš„æ˜¯Bæ ‘ä¸­çš„B+Treeï¼Œä½†å¯¹äºä¸»è¦çš„ä¸¤ç§å­˜å‚¨å¼•æ“çš„å®ç°æ–¹å¼æ˜¯ä¸åŒçš„ã€‚\n\n- **MyISAM:** B+Treeå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ã€‚åœ¨ç´¢å¼•æ£€ç´¢çš„æ—¶å€™ï¼Œé¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶ data åŸŸçš„å€¼ï¼Œç„¶åä»¥ data åŸŸçš„å€¼ä¸ºåœ°å€è¯»å–ç›¸åº”çš„æ•°æ®è®°å½•ã€‚è¿™è¢«ç§°ä¸ºâ€œéèšç°‡ç´¢å¼•â€ã€‚\n- **InnoDB:** å…¶æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚ç›¸æ¯”MyISAMï¼Œç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œå…¶è¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚è¿™è¢«ç§°ä¸ºâ€œèšç°‡ç´¢å¼•ï¼ˆæˆ–èšé›†ç´¢å¼•ï¼‰â€ã€‚è€Œå…¶ä½™çš„ç´¢å¼•éƒ½ä½œä¸ºè¾…åŠ©ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•çš„dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ï¼Œè¿™ä¹Ÿæ˜¯å’ŒMyISAMä¸åŒçš„åœ°æ–¹ã€‚**åœ¨æ ¹æ®ä¸»ç´¢å¼•æœç´¢æ—¶ï¼Œç›´æ¥æ‰¾åˆ°keyæ‰€åœ¨çš„èŠ‚ç‚¹å³å¯å–å‡ºæ•°æ®ï¼›åœ¨æ ¹æ®è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾æ—¶ï¼Œåˆ™éœ€è¦å…ˆå–å‡ºä¸»é”®çš„å€¼ï¼Œå†èµ°ä¸€éä¸»ç´¢å¼•ã€‚** **å› æ­¤ï¼Œåœ¨è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œä¹Ÿä¸å»ºè®®ä½¿ç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™æ ·ä¼šé€ æˆä¸»ç´¢å¼•é¢‘ç¹åˆ†è£‚ã€‚** PSï¼šæ•´ç†è‡ªã€ŠJavaå·¥ç¨‹å¸ˆä¿®ç‚¼ä¹‹é“ã€‹\n\n### Hashç´¢å¼•\n\n\n> Hash ç´¢å¼•ç»“æ„çš„ç‰¹æ®Šæ€§ï¼Œå…¶æ£€ç´¢æ•ˆç‡éå¸¸é«˜ï¼Œç´¢å¼•çš„æ£€ç´¢å¯ä»¥ä¸€æ¬¡å®šä½ï¼Œä¸åƒB-Tree ç´¢å¼•éœ€è¦ä»æ ¹èŠ‚ç‚¹åˆ°æèŠ‚ç‚¹ï¼Œæœ€åæ‰èƒ½è®¿é—®åˆ°é¡µèŠ‚ç‚¹è¿™æ ·å¤šæ¬¡çš„IOè®¿é—®ï¼Œæ‰€ä»¥ Hash ç´¢å¼•çš„æŸ¥è¯¢æ•ˆç‡è¦è¿œé«˜äº B-Tree ç´¢å¼•ã€‚\n\n\nå¯ èƒ½å¾ˆå¤šäººåˆæœ‰ç–‘é—®äº†ï¼Œæ—¢ç„¶ Hash ç´¢å¼•çš„æ•ˆç‡è¦æ¯” B-Tree é«˜å¾ˆå¤šï¼Œä¸ºä»€ä¹ˆå¤§å®¶ä¸éƒ½ç”¨ Hash ç´¢å¼•è€Œè¿˜è¦ä½¿ç”¨ B-Tree ç´¢å¼•å‘¢ï¼Ÿä»»ä½•äº‹ç‰©éƒ½æ˜¯æœ‰ä¸¤é¢æ€§çš„ï¼ŒHash ç´¢å¼•ä¹Ÿä¸€æ ·ï¼Œè™½ç„¶ Hash ç´¢å¼•æ•ˆç‡é«˜ï¼Œä½†æ˜¯ Hash ç´¢å¼•æœ¬èº«ç”±äºå…¶ç‰¹æ®Šæ€§ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šé™åˆ¶å’Œå¼Šç«¯ï¼Œä¸»è¦æœ‰ä»¥ä¸‹è¿™äº›ã€‚\n\n\nï¼ˆ1ï¼‰Hash ç´¢å¼•ä»…ä»…èƒ½æ»¡è¶³\"=\",\"IN\"å’Œ\"<=>\"æŸ¥è¯¢ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ã€‚\n\n\n> ç”±äº Hash ç´¢å¼•æ¯”è¾ƒçš„æ˜¯è¿›è¡Œ Hash è¿ç®—ä¹‹åçš„ Hash å€¼ï¼Œæ‰€ä»¥å®ƒåªèƒ½ç”¨äºç­‰å€¼çš„è¿‡æ»¤ï¼Œä¸èƒ½ç”¨äºåŸºäºèŒƒå›´çš„è¿‡æ»¤ï¼Œå› ä¸ºç»è¿‡ç›¸åº”çš„ Hash ç®—æ³•å¤„ç†ä¹‹åçš„ Hash å€¼çš„å¤§å°å…³ç³»ï¼Œå¹¶ä¸èƒ½ä¿è¯å’ŒHashè¿ç®—å‰å®Œå…¨ä¸€æ ·ã€‚\n\n\nï¼ˆ2ï¼‰Hash ç´¢å¼•æ— æ³•è¢«ç”¨æ¥é¿å…æ•°æ®çš„æ’åºæ“ä½œã€‚\n\n\n> ç”±äº Hash ç´¢å¼•ä¸­å­˜æ”¾çš„æ˜¯ç»è¿‡ Hash è®¡ç®—ä¹‹åçš„ Hash å€¼ï¼Œè€Œä¸”Hashå€¼çš„å¤§å°å…³ç³»å¹¶ä¸ä¸€å®šå’Œ Hash è¿ç®—å‰çš„é”®å€¼å®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥æ•°æ®åº“æ— æ³•åˆ©ç”¨ç´¢å¼•çš„æ•°æ®æ¥é¿å…ä»»ä½•æ’åºè¿ç®—ï¼›\n\n\nï¼ˆ3ï¼‰Hash ç´¢å¼•ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢ã€‚\n\n\n> å¯¹äºç»„åˆç´¢å¼•ï¼ŒHash ç´¢å¼•åœ¨è®¡ç®— Hash å€¼çš„æ—¶å€™æ˜¯ç»„åˆç´¢å¼•é”®åˆå¹¶åå†ä¸€èµ·è®¡ç®— Hash å€¼ï¼Œè€Œä¸æ˜¯å•ç‹¬è®¡ç®— Hash å€¼ï¼Œæ‰€ä»¥é€šè¿‡ç»„åˆç´¢å¼•çš„å‰é¢ä¸€ä¸ªæˆ–å‡ ä¸ªç´¢å¼•é”®è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼ŒHash ç´¢å¼•ä¹Ÿæ— æ³•è¢«åˆ©ç”¨ã€‚\n\n\nï¼ˆ4ï¼‰Hash ç´¢å¼•åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸èƒ½é¿å…è¡¨æ‰«æã€‚\n\n\n> å‰é¢å·²ç»çŸ¥é“ï¼ŒHash ç´¢å¼•æ˜¯å°†ç´¢å¼•é”®é€šè¿‡ Hash è¿ç®—ä¹‹åï¼Œå°† Hashè¿ç®—ç»“æœçš„ Hash å€¼å’Œæ‰€å¯¹åº”çš„è¡ŒæŒ‡é’ˆä¿¡æ¯å­˜æ”¾äºä¸€ä¸ª Hash è¡¨ä¸­ï¼Œç”±äºä¸åŒç´¢å¼•é”®å­˜åœ¨ç›¸åŒ Hash å€¼ï¼Œæ‰€ä»¥å³ä½¿å–æ»¡è¶³æŸä¸ª Hash é”®å€¼çš„æ•°æ®çš„è®°å½•æ¡æ•°ï¼Œä¹Ÿæ— æ³•ä» Hash ç´¢å¼•ä¸­ç›´æ¥å®ŒæˆæŸ¥è¯¢ï¼Œè¿˜æ˜¯è¦é€šè¿‡è®¿é—®è¡¨ä¸­çš„å®é™…æ•°æ®è¿›è¡Œç›¸åº”çš„æ¯”è¾ƒï¼Œå¹¶å¾—åˆ°ç›¸åº”çš„ç»“æœã€‚\n\n\nï¼ˆ5ï¼‰Hash ç´¢å¼•é‡åˆ°å¤§é‡Hashå€¼ç›¸ç­‰çš„æƒ…å†µåæ€§èƒ½å¹¶ä¸ä¸€å®šå°±ä¼šæ¯”B-Treeç´¢å¼•é«˜ã€‚\n\n\n> å¯¹äºé€‰æ‹©æ€§æ¯”è¾ƒä½çš„ç´¢å¼•é”®ï¼Œå¦‚æœåˆ›å»º Hash ç´¢å¼•ï¼Œé‚£ä¹ˆå°†ä¼šå­˜åœ¨å¤§é‡è®°å½•æŒ‡é’ˆä¿¡æ¯å­˜äºåŒä¸€ä¸ª Hash å€¼ç›¸å…³è”ã€‚è¿™æ ·è¦å®šä½æŸä¸€æ¡è®°å½•æ—¶å°±ä¼šéå¸¸éº»çƒ¦ï¼Œä¼šæµªè´¹å¤šæ¬¡è¡¨æ•°æ®çš„è®¿é—®ï¼Œè€Œé€ æˆæ•´ä½“æ€§èƒ½ä½ä¸‹ã€‚\n\n\n(6)  hashç´¢å¼•æŸ¥æ‰¾æ•°æ®åŸºæœ¬ä¸Šèƒ½ä¸€æ¬¡å®šä½æ•°æ®ï¼Œå½“ç„¶æœ‰å¤§é‡ç¢°æ’çš„è¯æ€§èƒ½ä¹Ÿä¼šä¸‹é™ã€‚è€Œbtreeç´¢å¼•å°±å¾—åœ¨èŠ‚ç‚¹ä¸ŠæŒ¨ç€æŸ¥æ‰¾äº†ï¼Œå¾ˆæ˜æ˜¾åœ¨æ•°æ®ç²¾ç¡®æŸ¥æ‰¾æ–¹é¢hashç´¢å¼•çš„æ•ˆç‡æ˜¯è¦é«˜äºbtreeçš„ï¼›\n\n\n(7)  é‚£ä¹ˆä¸ç²¾ç¡®æŸ¥æ‰¾å‘¢ï¼Œä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå› ä¸ºhashç®—æ³•æ˜¯åŸºäºç­‰å€¼è®¡ç®—çš„ï¼Œæ‰€ä»¥å¯¹äºâ€œlikeâ€ç­‰èŒƒå›´æŸ¥æ‰¾hashç´¢å¼•æ— æ•ˆï¼Œä¸æ”¯æŒï¼›\n\n\n(8)  å¯¹äºbtreeæ”¯æŒçš„è”åˆç´¢å¼•çš„æœ€ä¼˜å‰ç¼€ï¼Œhashä¹Ÿæ˜¯æ— æ³•æ”¯æŒçš„ï¼Œè”åˆç´¢å¼•ä¸­çš„å­—æ®µè¦ä¹ˆå…¨ç”¨è¦ä¹ˆå…¨ä¸ç”¨ã€‚æèµ·æœ€ä¼˜å‰ç¼€å±…ç„¶éƒ½æ³›èµ·è¿·ç³Šäº†ï¼Œçœ‹æ¥æœ‰æ—¶å€™æ”¾ç©ºå¾—å¤ªå‰å®³ï¼›\n\n\n(9)  hashä¸æ”¯æŒç´¢å¼•æ’åºï¼Œç´¢å¼•å€¼å’Œè®¡ç®—å‡ºæ¥çš„hashå€¼å¤§å°å¹¶ä¸ä¸€å®šä¸€è‡´ã€‚\n\n\n### B-Tree ç´¢å¼•\n\n\nB-tree ç´¢å¼•å¯ä»¥ç”¨äºä½¿ç”¨ =, >, >=, <, <= æˆ–è€… BETWEEN è¿ç®—ç¬¦çš„åˆ—æ¯”è¾ƒã€‚å¦‚æœ LIKE çš„å‚æ•°æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»¥é€šé…ç¬¦èµ·å§‹çš„å¸¸é‡å­—ç¬¦ä¸²çš„è¯ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ç§ç´¢å¼•ã€‚æ¯”å¦‚ï¼Œä»¥ä¸‹ SELECT è¯­å¥å°±ä½¿ç”¨ç´¢å¼•ï¼š\n\n\n```text\n1.  SELECT * FROM tbl_name WHERE key_col LIKE 'Patrick%';\n2.  SELECT * FROM tbl_name WHERE key_col LIKE 'Pat%_ck%';\n\n```\n\n\nåœ¨ç¬¬ä¸€ä¸ªå¥å­ä¸­ï¼Œåªä¼šè€ƒè™‘ 'Patrick' <= key_col < 'Patricl' çš„è®°å½•ã€‚ç¬¬äºŒå¥ä¸­ï¼Œåˆ™åªä¼šè€ƒè™‘ 'Pat' <= key_col < 'Pau' çš„è®°å½•ã€‚\nä»¥ä¸‹ SELECT è¯­å¥ä¸ä½¿ç”¨ç´¢å¼•ï¼š\n\n\n```text\n1.  SELECT * FROM tbl_name WHERE key_col LIKE '%Patrick%';\n2.  SELECT * FROM tbl_name WHERE key_col LIKE other_col;\n\n```\n\n\nç¬¬ä¸€å¥é‡Œé¢ï¼ŒLIKE çš„å€¼èµ·å§‹äºä¸€ä¸ªé€šé…ç¬¦ã€‚åœ¨ç¬¬äºŒå¥é‡Œï¼ŒLIKE çš„å€¼ä¸æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚å¦‚æœä½ è¿™æ ·ä½¿ç”¨ï¼š ... LIKE '%string%'ï¼Œå…¶ä¸­çš„ string ä¸å¤§äºä¸‰ä¸ªå­—ç¬¦ï¼ŒMySql å°†ä½¿ç”¨ Turbo Boyer-Moore ç®—æ³•æ¥å¯¹è¯¥å­—ç¬¦ä¸²è¡¨è¾¾å¼è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä½¿ç”¨è¿™ç§è¡¨è¾¾å¼æ¥è®©æŸ¥è¯¢æ›´åŠ è¿…é€Ÿã€‚å¦‚æœ col_name åˆ—åˆ›å»ºäº†ç´¢å¼•ï¼Œé‚£ä¹ˆä¸€ä¸ªä½¿ç”¨äº† col_name IS NULL çš„æŸ¥è¯¢æ˜¯å¯ä»¥ä½¿ç”¨è¯¥ç´¢å¼•çš„ã€‚ä»»ä½•æ²¡æœ‰æ¶µç›– WHERE ä»å¥ä¸­æ‰€æœ‰ AND çº§åˆ«çš„æ¡ä»¶çš„ç´¢å¼•å°†ä¸ä¼šè¢«ä½¿ç”¨ã€‚æ¢å¥è¯è®²ï¼Œè¦æƒ³ä½¿ç”¨ç´¢å¼•ï¼Œè¯¥ç´¢å¼•çš„å‰å¯¼åˆ—å¿…é¡»åœ¨æ¯ä¸€ä¸ª AND ç»„åˆä¸­ä½¿ç”¨åˆ°ã€‚\nä»¥ä¸‹ WHERE ä»å¥ä½¿ç”¨ç´¢å¼•ï¼š\n\n\n```text\n1.  ... WHERE index_part1=1 AND index_part2=2 AND other_column=3\n\n4.  /* index = 1 OR index = 2 */\n5.  ... WHERE index=1 OR A=10 AND index=2\n\n8.  /* optimized like \"index_part1='hello'\" */\n9.  ... WHERE index_part1='hello' AND index_part3=5\n\n12.  /* Can use index on index1 but not on index2 or index3 */\n13.  ... WHERE index1=1 AND index2=2 OR index1=3 AND index3=3;\n\n```\n\n\nè¿™äº› WHERE ä»å¥ä¸ä½¿ç”¨ç´¢å¼•ï¼š\n\n\n```text\n1.  /* index_part1 is not used */\n2.  WHERE index_part2=1 AND index_part3=2\n\n5.  /*  Index is not used in both parts of the WHERE clause  */\n6.  WHERE index=1 OR A=10\n\n9.  /* No index spans all rows  */\n10.  WHERE index_part1=1 OR index_part2=10\n\n```\n\n\næœ‰æ—¶ï¼Œå³ä½¿æœ‰ç´¢å¼•å¯ä»¥ä½¿ç”¨ï¼Œ[MySQL](http://lib.csdn.net/base/mysql) ä¹Ÿä¸ä½¿ç”¨ä»»ä½•ç´¢å¼•ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µçš„åœºæ™¯ä¹‹ä¸€å°±æ˜¯ä¼˜åŒ–å™¨ä¼°ç®—å‡ºä½¿ç”¨è¯¥ç´¢å¼•å°†è¦æ±‚ MySql å»è®¿é—®è¿™å¼ è¡¨çš„ç»å¤§éƒ¨åˆ†è®°å½•ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¡¨æ‰«æå¯èƒ½æ›´å¿«ï¼Œå› ä¸ºå®ƒè¦æ±‚æ›´å°‘é‡çš„æŸ¥è¯¢ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™æ ·çš„ä¸€ä¸ªæŸ¥è¯¢ä½¿ç”¨äº† LIMIT æ¥æ£€ç´¢åªæ˜¯å°‘é‡çš„è®°å½•æ—¶ï¼ŒMySql è¿˜æ˜¯ä¼šä½¿ç”¨ç´¢å¼•ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿæ›´å¿«åœ°æ‰¾åˆ°è¿™ç‚¹è®°å½•å¹¶å°†å…¶è¿”å›ã€‚\n\n\n## äº‹åŠ¡\n\n\n**äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚**\n\n\näº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦1000å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œå°±æ˜¯ï¼šå°†å°æ˜çš„ä½™é¢å‡å°‘1000å…ƒï¼Œå°†å°çº¢çš„ä½™é¢å¢åŠ 1000å…ƒã€‚ä¸‡ä¸€åœ¨è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´çªç„¶å‡ºç°é”™è¯¯æ¯”å¦‚é“¶è¡Œç³»ç»Ÿå´©æºƒï¼Œå¯¼è‡´å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢æ²¡æœ‰å¢åŠ ï¼Œè¿™æ ·å°±ä¸å¯¹äº†ã€‚äº‹åŠ¡å°±æ˜¯ä¿è¯è¿™ä¸¤ä¸ªå…³é”®æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚\n\n\n### [äº‹åŠ¡çš„å››å¤§ç‰¹æ€§(ACID)](https://snailclimb.gitee.io/javaguide/#/docs/database/MySQL?id=%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7acid)\n\n\n![](https://blog-file.hehouhui.cn/image.png)\n\n\n> äº‹åŠ¡å¤„ç†å¯ä»¥ç¡®ä¿é™¤éäº‹åŠ¡æ€§å•å…ƒå†…çš„æ‰€æœ‰æ“ä½œéƒ½æˆåŠŸå®Œæˆï¼Œå¦åˆ™ä¸ä¼šæ°¸ä¹…æ›´æ–°é¢å‘æ•°æ®çš„èµ„æºã€‚é€šè¿‡å°†ä¸€ç»„ç›¸å…³æ“ä½œç»„åˆä¸ºä¸€ä¸ªè¦ä¹ˆå…¨éƒ¨æˆåŠŸè¦ä¹ˆå…¨éƒ¨å¤±è´¥çš„å•å…ƒï¼Œå¯ä»¥ç®€åŒ–é”™è¯¯æ¢å¤å¹¶ä½¿åº”ç”¨ç¨‹åºæ›´åŠ å¯é ã€‚ä¸€ä¸ªé€»è¾‘å·¥ä½œå•å…ƒè¦æˆä¸ºäº‹åŠ¡ï¼Œå¿…é¡»æ»¡è¶³æ‰€è°“çš„ACID(åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§)å±æ€§ï¼š\n\n1. **åŸå­æ€§(Atomicity)**\n\n\täº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›\n\n\n\t> äº‹åŠ¡å¿…é¡»æ˜¯åŸå­å·¥ä½œå•å…ƒï¼›å¯¹äºå…¶æ•°æ®ä¿®æ”¹ï¼Œè¦ä¹ˆå…¨éƒ½æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚é€šå¸¸ï¼Œä¸æŸä¸ªäº‹åŠ¡å…³è”çš„æ“ä½œå…·æœ‰å…±åŒçš„ç›®æ ‡ï¼Œå¹¶ä¸”æ˜¯ç›¸äº’ä¾èµ–çš„ã€‚å¦‚æœç³»ç»Ÿåªæ‰§è¡Œè¿™äº›æ“ä½œçš„ä¸€ä¸ªå­é›†ï¼Œåˆ™å¯èƒ½ä¼šç ´åäº‹åŠ¡çš„æ€»ä½“ç›®æ ‡ã€‚åŸå­æ€§æ¶ˆé™¤äº†ç³»ç»Ÿå¤„ç†æ“ä½œå­é›†çš„å¯èƒ½æ€§ã€‚\n\n2. **ä¸€è‡´æ€§(Consistency)**\n\n\tæ‰§è¡Œäº‹åŠ¡åï¼Œæ•°æ®åº“ä»ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€å˜åŒ–åˆ°å¦ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ï¼›\n\n\n\t> äº‹åŠ¡åœ¨å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚åœ¨ç›¸å…³æ•°æ®åº“ä¸­ï¼Œæ‰€æœ‰è§„åˆ™éƒ½å¿…é¡»åº”ç”¨äºäº‹åŠ¡çš„ä¿®æ”¹ï¼Œä»¥ä¿æŒæ‰€æœ‰æ•°æ®çš„å®Œæ•´æ€§ã€‚äº‹åŠ¡ç»“æŸæ—¶ï¼Œæ‰€æœ‰çš„å†…éƒ¨æ•°æ®ç»“æ„ï¼ˆå¦‚ B æ ‘ç´¢å¼•æˆ–åŒå‘é“¾è¡¨ï¼‰éƒ½å¿…é¡»æ˜¯æ­£ç¡®çš„ã€‚æŸäº›ç»´æŠ¤ä¸€è‡´æ€§çš„è´£ä»»ç”±åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æ‰¿æ‹…ï¼Œä»–ä»¬å¿…é¡»ç¡®ä¿åº”ç”¨ç¨‹åºå·²å¼ºåˆ¶æ‰€æœ‰å·²çŸ¥çš„å®Œæ•´æ€§çº¦æŸã€‚ä¾‹å¦‚ï¼Œå½“å¼€å‘ç”¨äºè½¬å¸çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œåº”é¿å…åœ¨è½¬å¸è¿‡ç¨‹ä¸­ä»»æ„ç§»åŠ¨å°æ•°ç‚¹ã€‚\n\n3. **éš”ç¦»æ€§(Isolation)**\n\n\tå¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›\n\n\n> ç”±å¹¶å‘äº‹åŠ¡æ‰€ä½œçš„ä¿®æ”¹å¿…é¡»ä¸ä»»ä½•å…¶å®ƒå¹¶å‘äº‹åŠ¡æ‰€ä½œçš„ä¿®æ”¹éš”ç¦»ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ—¶æ•°æ®æ‰€å¤„>çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€å¹¶å‘äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹åçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚è¿™ç§°ä¸ºå¯ä¸²è¡Œæ€§ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿé‡æ–°è£…è½½èµ·å§‹æ•°æ®ï¼Œå¹¶ä¸”é‡æ’­ä¸€ç³»åˆ—äº‹åŠ¡ï¼Œä»¥ä½¿æ•°æ®ç»“æŸæ—¶çš„çŠ¶æ€ä¸åŸå§‹äº‹åŠ¡æ‰§è¡Œçš„çŠ¶æ€ç›¸åŒã€‚å½“äº‹åŠ¡å¯åºåˆ—åŒ–æ—¶å°†è·å¾—æœ€é«˜çš„éš”ç¦»çº§åˆ«ã€‚åœ¨æ­¤çº§åˆ«ä¸Šï¼Œä»ä¸€ç»„å¯å¹¶è¡Œæ‰§è¡Œçš„äº‹åŠ¡è·å¾—çš„ç»“æœä¸é€šè¿‡è¿ç»­è¿è¡Œæ¯ä¸ªäº‹åŠ¡æ‰€è·å¾—çš„ç»“æœç›¸åŒã€‚ç”±äºé«˜åº¦éš”ç¦»ä¼šé™åˆ¶å¯å¹¶è¡Œæ‰§è¡Œçš„äº‹åŠ¡æ•°ï¼Œæ‰€ä»¥ä¸€äº›åº”ç”¨ç¨‹åºé™ä½éš”ç¦»çº§åˆ«ä»¥æ¢å–æ›´å¤§çš„ååé‡ã€‚\n\n1. Â· **æŒä¹…æ€§(Durabilityï¼‰**\n\n\tä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚\n\n\n\t> äº‹åŠ¡å®Œæˆä¹‹åï¼Œå®ƒå¯¹äºç³»ç»Ÿçš„å½±å“æ˜¯æ°¸ä¹…æ€§çš„ã€‚è¯¥ä¿®æ”¹å³ä½¿å‡ºç°è‡´å‘½çš„ç³»ç»Ÿæ•…éšœä¹Ÿå°†ä¸€ç›´ä¿æŒã€‚\n\n\n### [å¹¶å‘äº‹åŠ¡å¸¦æ¥å“ªäº›é—®é¢˜?](https://snailclimb.gitee.io/javaguide/#/docs/database/MySQL?id=%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E5%B8%A6%E6%9D%A5%E5%93%AA%E4%BA%9B%E9%97%AE%E9%A2%98)\n\n\nåœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒçš„æ•°æ®æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼ˆå¤šä¸ªç”¨æˆ·å¯¹åŒä¸€æ•°æ®è¿›è¡Œæ“ä½œï¼‰ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹çš„é—®é¢˜ã€‚\n\n- **è„è¯»ï¼ˆDirty readï¼‰:** å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è®¿é—®æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§ä¿®æ”¹è¿˜æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ã€‚å› ä¸ºè¿™ä¸ªæ•°æ®æ˜¯è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°çš„è¿™ä¸ªæ•°æ®æ˜¯â€œè„æ•°æ®â€ï¼Œä¾æ®â€œè„æ•°æ®â€æ‰€åšçš„æ“ä½œå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ã€‚\n- **ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰:** æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¯¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹äº†è¿™ä¸ªæ•°æ®ã€‚è¿™æ ·ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…çš„ä¿®æ”¹ç»“æœå°±è¢«ä¸¢å¤±ï¼Œå› æ­¤ç§°ä¸ºä¸¢å¤±ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼šäº‹åŠ¡1è¯»å–æŸè¡¨ä¸­çš„æ•°æ®A=20ï¼Œäº‹åŠ¡2ä¹Ÿè¯»å–A=20ï¼Œäº‹åŠ¡1ä¿®æ”¹A=A-1ï¼Œäº‹åŠ¡2ä¹Ÿä¿®æ”¹A=A-1ï¼Œæœ€ç»ˆç»“æœA=19ï¼Œäº‹åŠ¡1çš„ä¿®æ”¹è¢«ä¸¢å¤±ã€‚\n- **ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatablereadï¼‰:** æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚\n- **å¹»è¯»ï¼ˆPhantom readï¼‰:** å¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡ï¼ˆT2ï¼‰æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰å°±ä¼šå‘ç°å¤šäº†ä¸€äº›åŸæœ¬ä¸å­˜åœ¨çš„è®°å½•ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»ã€‚\n\n**ä¸å¯é‡å¤è¯»å’Œå¹»è¯»åŒºåˆ«ï¼š**\n\n\nä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹æ¯”å¦‚å¤šæ¬¡è¯»å–ä¸€æ¡è®°å½•å‘ç°å…¶ä¸­æŸäº›åˆ—çš„å€¼è¢«ä¿®æ”¹ï¼Œå¹»è¯»çš„é‡ç‚¹åœ¨äºæ–°å¢æˆ–è€…åˆ é™¤æ¯”å¦‚å¤šæ¬¡è¯»å–ä¸€æ¡è®°å½•å‘ç°è®°å½•å¢å¤šæˆ–å‡å°‘äº†ã€‚\n\n\n### [äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›?MySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯?](https://snailclimb.gitee.io/javaguide/#/docs/database/MySQL?id=%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E6%9C%89%E5%93%AA%E4%BA%9Bmysql%E7%9A%84%E9%BB%98%E8%AE%A4%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E6%98%AF)\n\n\n**SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼š**\n\n- **READ-UNCOMMITTED(è¯»å–æœªæäº¤)ï¼š** æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ**å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»**ã€‚\n- **READ-COMMITTED(è¯»å–å·²æäº¤)ï¼š** å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ**å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ**ã€‚\n- **REPEATABLE-READ(å¯é‡å¤è¯»)ï¼š** å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ**å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ**ã€‚\n- **SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)ï¼š** æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»**ã€‚\n\n---\n\n\n| éš”ç¦»çº§åˆ«             | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»å½±è¯» |\n| ---------------- | -- | ----- | --- |\n| READ-UNCOMMITTED | âˆš  | âˆš     | âˆš   |\n| READ-COMMITTED   | Ã—  | âˆš     | âˆš   |\n| REPEATABLE-READ  | Ã—  | Ã—     | âˆš   |\n| SERIALIZABLE     | Ã—  | Ã—     | Ã—   |\n\n\nMySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ **REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰**ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`SELECT @@tx_isolation;`å‘½ä»¤æ¥æŸ¥çœ‹ï¼ŒMySQL 8.0 è¯¥å‘½ä»¤æ”¹ä¸º`SELECT @@transaction_isolation;`\n\n\n### **äº‹åŠ¡ä¿å­˜ç‚¹(SavePoint)**\n\n\n> æœ‰ä¸€ä¸ªæ•°æ®åº“ç®¡ç†å‘˜ï¼Œåœ¨æ—©ä¸Šçš„æ—¶å€™ï¼Œè®¾ç½®äº†ä¸€ä¸ªä¿å­˜ç‚¹a1ï¼Œç„¶åå·¥ä½œï¼ˆå¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼‰ï¼Œåˆ°äº†ä¸­åˆä»–åˆè®¾ç½®äº†ä¸€ä¸ªä¿å­˜ç‚¹a2ï¼Œåˆ°äº†ä¸‹åˆä»–åˆç»§ç»­å·¥ä½œï¼ˆè¿˜æ˜¯å¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼‰ï¼Œç„¶ååˆ°äº†æ™šä¸Šã€‚çªç„¶ä¹‹é—´ï¼Œä»–æ‰§è¡Œäº†ä¸€ä¸ªå¾ˆæ„šè ¢çš„æ“ä½œï¼ŒæŠŠæ•°æ®åº“é‡Œçš„æ•°æ®å…¨éƒ¨ç»™åˆ é™¤äº†ï¼ï¼ï¼ï¼\n\n\né‚£è¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿå¥½åœ¨ä»–åœ¨æ—©ä¸Šå’Œä¸­åˆçš„æ—¶å€™è®¾ç½®äº†ä¿å­˜ç‚¹ï¼Œç„¶ååªè¦å›åˆ°ä¿å­˜ç‚¹å°±å¯ä»¥äº†ã€‚\n\n\nrollback to xxxSavePoint\n\n\nå½“äº‹åŠ¡commitä¹‹åï¼Œäº‹åŠ¡ä¸­è®¾ç½®çš„SavePointå°±å–æ¶ˆäº†\n\n\n### **äº‹åŠ¡å¹¶å‘**\n\n\nä¸¤ä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶è®¿é—®æ•°æ®åº“è¡¨ç›¸åŒçš„è¡Œæ—¶ï¼Œå¯èƒ½å­˜åœ¨ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š\n\n\n1ã€`å¹»æƒ³è¯»`ï¼šäº‹åŠ¡T1è¯»å–ä¸€æ¡æŒ‡å®šwhereæ¡ä»¶çš„è¯­å¥ï¼Œè¿”å›ç»“æœé›†ã€‚æ­¤æ—¶äº‹åŠ¡T2æ’å…¥ä¸€è¡Œæ–°è®°å½•ï¼Œæ°å¥½æ»¡è¶³T1çš„whereæ¡ä»¶ã€‚ç„¶åT1ä½¿ç”¨ç›¸åŒçš„æ¡ä»¶å†æ¬¡æŸ¥è¯¢ï¼Œç»“æœé›†ä¸­å¯ä»¥çœ‹åˆ°T2æ’å…¥çš„è®°å½•ï¼Œè¿™æ¡æ–°çºªå½•å°±æ˜¯å¹»æƒ³ã€‚\n\n\n2ã€`ä¸å¯é‡å¤è¯»å–`ï¼šäº‹åŠ¡T1è¯»å–ä¸€è¡Œè®°å½•ï¼Œç´§æ¥ç€äº‹åŠ¡T2ä¿®æ”¹äº†T1åˆšåˆšè¯»å–çš„è®°å½•ï¼Œç„¶åT1å†æ¬¡æŸ¥è¯¢ï¼Œå‘ç°ä¸ç¬¬ä¸€æ¬¡è¯»å–çš„è®°å½•ä¸åŒï¼Œè¿™ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚\n\n\n3ã€`è„è¯»`ï¼šäº‹åŠ¡T1æ›´æ–°äº†ä¸€è¡Œè®°å½•ï¼Œè¿˜æœªæäº¤æ‰€åšçš„ä¿®æ”¹ï¼Œè¿™ä¸ªT2è¯»å–äº†æ›´æ–°åçš„æ•°æ®ï¼Œç„¶åT1æ‰§è¡Œå›æ»šæ“ä½œï¼Œå–æ¶ˆåˆšæ‰çš„ä¿®æ”¹ï¼Œæ‰€ä»¥T2æ‰€è¯»å–çš„è¡Œå°±æ— æ•ˆï¼Œä¹Ÿå°±æ˜¯è„æ•°æ®ã€‚\n\n\n### äº‹åŠ¡å®ç°åŸç†\n\n\n**æ•°æ®åº“ç³»ç»Ÿæ˜¯é€šè¿‡å¹¶å‘æ§åˆ¶æŠ€æœ¯å’Œæ—¥å¿—æ¢å¤æŠ€æœ¯æ¥é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿçš„ã€‚**\n\n\n> å¹¶å‘æ§åˆ¶æŠ€æœ¯ä¿è¯äº†äº‹åŠ¡çš„éš”ç¦»æ€§,ä½¿æ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€ä¸ä¼šå› ä¸ºå¹¶å‘æ‰§è¡Œçš„æ“ä½œè¢«ç ´åã€‚  \n> æ—¥å¿—æ¢å¤æŠ€æœ¯ä¿è¯äº†äº‹åŠ¡çš„åŸå­æ€§,ä½¿ä¸€è‡´æ€§çŠ¶æ€ä¸ä¼šå› äº‹åŠ¡æˆ–ç³»ç»Ÿæ•…éšœè¢«ç ´åã€‚åŒæ—¶ä½¿å·²æäº¤çš„å¯¹æ•°æ®åº“çš„ä¿®æ”¹ä¸ä¼šå› ç³»ç»Ÿå´©æºƒè€Œä¸¢å¤±,ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚\n\n\n![](https://blog-file.hehouhui.cn/20220221101406.png)\n\n\n### å¹¶å‘å¼‚å¸¸\n\n\n> åœ¨è®²è§£å¹¶å‘æ§åˆ¶æŠ€æœ¯å‰,å…ˆç®€å•ä»‹ç»ä¸‹æ•°æ®åº“å¸¸è§çš„å¹¶å‘å¼‚å¸¸ã€‚\n\n\n### è„å†™\n\n\nè„å†™æ˜¯æŒ‡äº‹åŠ¡å›æ»šäº†å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®é¡¹çš„å·²æäº¤ä¿®æ”¹,æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µ\n\n\n![](https://blog-file.hehouhui.cn/20220221101453.png)\n\n\n### ä¸¢å¤±æ›´æ–°\n\n- ä¸¢å¤±æ›´æ–°æ˜¯æŒ‡äº‹åŠ¡è¦†ç›–äº†å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®çš„å·²æäº¤ä¿®æ”¹,å¯¼è‡´è¿™äº›ä¿®æ”¹å¥½åƒä¸¢å¤±äº†ä¸€æ ·ã€‚\n\n\t![](https://blog-file.hehouhui.cn/20220221101626.png)\n\n\näº‹åŠ¡1å’Œäº‹åŠ¡2è¯»å–Açš„å€¼éƒ½ä¸º10,äº‹åŠ¡2å…ˆå°†AåŠ ä¸Š10å¹¶æäº¤ä¿®æ”¹,ä¹‹åäº‹åŠ¡2å°†Aå‡å°‘10å¹¶æäº¤ä¿®æ”¹,Açš„å€¼æœ€åä¸º,å¯¼è‡´äº‹åŠ¡2å¯¹Açš„ä¿®æ”¹å¥½åƒä¸¢å¤±äº†ä¸€æ ·\n\n\n### è„è¯»\n\n- è„è¯»æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®\n\n\t![](https://blog-file.hehouhui.cn/20220221101652.png)\n\n\nåœ¨äº‹åŠ¡1å¯¹Açš„å¤„ç†è¿‡ç¨‹ä¸­,äº‹åŠ¡2è¯»å–äº†Açš„å€¼,ä½†ä¹‹åäº‹åŠ¡1å›æ»š,å¯¼è‡´äº‹åŠ¡2è¯»å–çš„Aæ˜¯æœªæäº¤çš„è„æ•°æ®ã€‚\n\n\n### ä¸å¯é‡å¤è¯»\n\n- ä¸å¯é‡å¤è¯»æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡å¯¹åŒä¸€æ•°æ®çš„è¯»å–ç»“æœå‰åä¸ä¸€è‡´ã€‚è„è¯»å’Œä¸å¯é‡å¤è¯»çš„åŒºåˆ«åœ¨äº:å‰è€…è¯»å–çš„æ˜¯äº‹åŠ¡æœªæäº¤çš„è„æ•°æ®,åè€…è¯»å–çš„æ˜¯äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®,åªä¸è¿‡å› ä¸ºæ•°æ®è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹è¿‡å¯¼è‡´å‰åä¸¤æ¬¡è¯»å–çš„ç»“æœä¸ä¸€æ ·,æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µ\n\n\t![](https://blog-file.hehouhui.cn/1422237-20181122103147288-996731595.png)\n\n\nç”±äºäº‹åŠ¡2å¯¹Açš„å·²æäº¤ä¿®æ”¹,äº‹åŠ¡1å‰åä¸¤æ¬¡è¯»å–çš„ç»“æœä¸ä¸€è‡´ã€‚\n\n\n### å¹»è¯»\n\n- å¹»è¯»æ˜¯æŒ‡äº‹åŠ¡è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®æ—¶ï¼Œå› ä¸ºå…¶ä»–äº‹åŠ¡çš„æ“ä½œå¯¼è‡´å‰åä¸¤æ¬¡è¯»å–çš„ç»“æœä¸ä¸€è‡´ã€‚å¹»è¯»å’Œä¸å¯é‡å¤è¯»çš„åŒºåˆ«åœ¨äº,ä¸å¯é‡å¤è¯»æ˜¯é’ˆå¯¹ç¡®å®šçš„æŸä¸€è¡Œæ•°æ®è€Œè¨€,è€Œå¹»è¯»æ˜¯é’ˆå¯¹ä¸ç¡®å®šçš„å¤šè¡Œæ•°æ®ã€‚å› è€Œå¹»è¯»é€šå¸¸å‡ºç°åœ¨å¸¦æœ‰æŸ¥è¯¢æ¡ä»¶çš„èŒƒå›´æŸ¥è¯¢ä¸­,æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µ:\n\n\t![](https://blog-file.hehouhui.cn/1422237-20181122103158043-533492513.png)\n\n\näº‹åŠ¡1æŸ¥è¯¢A<5çš„æ•°æ®,ç”±äºäº‹åŠ¡2æ’å…¥äº†ä¸€æ¡A=4çš„æ•°æ®,å¯¼è‡´äº‹åŠ¡1ä¸¤æ¬¡æŸ¥è¯¢å¾—åˆ°çš„ç»“æœä¸ä¸€æ ·\n\n\n### å¹¶å‘æ§åˆ¶\n\n\n> å¹¶å‘æ§åˆ¶æŠ€æœ¯æ˜¯å®ç°äº‹åŠ¡éš”ç¦»æ€§ä»¥åŠä¸åŒéš”ç¦»çº§åˆ«çš„å…³é”®,å®ç°æ–¹å¼æœ‰å¾ˆå¤š,æŒ‰ç…§å…¶å¯¹å¯èƒ½å†²çªçš„æ“ä½œé‡‡å–çš„ä¸åŒç­–ç•¥å¯ä»¥åˆ†ä¸ºä¹è§‚å¹¶å‘æ§åˆ¶å’Œæ‚²è§‚å¹¶å‘æ§åˆ¶ä¸¤å¤§ç±»ã€‚\n\n- ä¹è§‚å¹¶å‘æ§åˆ¶:å¯¹äºå¹¶å‘æ‰§è¡Œå¯èƒ½å†²çªçš„æ“ä½œ,å‡å®šå…¶ä¸ä¼šçœŸçš„å†²çª,å…è®¸å¹¶å‘æ‰§è¡Œ,ç›´åˆ°çœŸæ­£å‘ç”Ÿå†²çªæ—¶æ‰å»è§£å†³å†²çª,æ¯”å¦‚è®©äº‹åŠ¡å›æ»šã€‚\n- æ‚²è§‚å¹¶å‘æ§åˆ¶:å¯¹äºå¹¶å‘æ‰§è¡Œå¯èƒ½å†²çªçš„æ“ä½œ,å‡å®šå…¶å¿…å®šå‘ç”Ÿå†²çª,é€šè¿‡è®©äº‹åŠ¡ç­‰å¾…(é”)æˆ–è€…ä¸­æ­¢(æ—¶é—´æˆ³æ’åº)çš„æ–¹å¼ä½¿å¹¶è¡Œçš„æ“ä½œä¸²è¡Œæ‰§è¡Œã€‚\n\n### åŸºäºå°é”çš„å¹¶å‘æ§åˆ¶\n\n\næ ¸å¿ƒæ€æƒ³:å¯¹äºå¹¶å‘å¯èƒ½å†²çªçš„æ“ä½œ,æ¯”å¦‚è¯»-å†™,å†™-è¯»,å†™-å†™,é€šè¿‡é”ä½¿å®ƒä»¬äº’æ–¥æ‰§è¡Œã€‚\né”é€šå¸¸åˆ†ä¸ºå…±äº«é”å’Œæ’ä»–é”ä¸¤ç§ç±»å‹\n\n- 1.å…±äº«é”(S):äº‹åŠ¡Tå¯¹æ•°æ®AåŠ å…±äº«é”,å…¶ä»–äº‹åŠ¡åªèƒ½å¯¹AåŠ å…±äº«é”ä½†ä¸èƒ½åŠ æ’ä»–é”ã€‚\n- 2.æ’ä»–é”(X):äº‹åŠ¡Tå¯¹æ•°æ®AåŠ æ’ä»–é”,å…¶ä»–äº‹åŠ¡å¯¹Aæ—¢ä¸èƒ½åŠ å…±äº«é”ä¹Ÿä¸èƒ½åŠ æ’ä»–é”\n\nåŸºäºé”çš„å¹¶å‘æ§åˆ¶æµç¨‹:\n\n1. äº‹åŠ¡æ ¹æ®è‡ªå·±å¯¹æ•°æ®é¡¹è¿›è¡Œçš„æ“ä½œç±»å‹ç”³è¯·ç›¸åº”çš„é”(è¯»ç”³è¯·å…±äº«é”,å†™ç”³è¯·æ’ä»–é”)\n2. ç”³è¯·é”çš„è¯·æ±‚è¢«å‘é€ç»™é”ç®¡ç†å™¨ã€‚é”ç®¡ç†å™¨æ ¹æ®å½“å‰æ•°æ®é¡¹æ˜¯å¦å·²ç»æœ‰é”ä»¥åŠç”³è¯·çš„å’ŒæŒæœ‰çš„é”æ˜¯å¦å†²çªå†³å®šæ˜¯å¦ä¸ºè¯¥è¯·æ±‚æˆäºˆé”ã€‚\n3. è‹¥é”è¢«æˆäºˆ,åˆ™ç”³è¯·é”çš„äº‹åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œ;è‹¥è¢«æ‹’ç»,åˆ™ç”³è¯·é”çš„äº‹åŠ¡å°†è¿›è¡Œç­‰å¾…,ç›´åˆ°é”è¢«å…¶ä»–äº‹åŠ¡é‡Šæ”¾ã€‚\n\nå¯èƒ½å‡ºç°çš„é—®é¢˜:\n\n- æ­»é”:å¤šä¸ªäº‹åŠ¡æŒæœ‰é”å¹¶äº’ç›¸å¾ªç¯ç­‰å¾…å…¶ä»–äº‹åŠ¡çš„é”å¯¼è‡´æ‰€æœ‰äº‹åŠ¡éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œã€‚\n- é¥¥é¥¿:æ•°æ®é¡¹Aä¸€ç›´è¢«åŠ å…±äº«é”,å¯¼è‡´äº‹åŠ¡ä¸€ç›´æ— æ³•è·å–Açš„æ’ä»–é”ã€‚\n\nå¯¹äºå¯èƒ½å‘ç”Ÿå†²çªçš„å¹¶å‘æ“ä½œ,é”ä½¿å®ƒä»¬ç”±å¹¶è¡Œå˜ä¸ºä¸²è¡Œæ‰§è¡Œ,æ˜¯ä¸€ç§æ‚²è§‚çš„å¹¶å‘æ§åˆ¶ã€‚\n\n\n### åŸºäºæ—¶é—´æˆ³çš„å¹¶å‘æ§åˆ¶\n\n\næ ¸å¿ƒæ€æƒ³:å¯¹äºå¹¶å‘å¯èƒ½å†²çªçš„æ“ä½œ,åŸºäºæ—¶é—´æˆ³æ’åºè§„åˆ™é€‰å®šæŸäº‹åŠ¡ç»§ç»­æ‰§è¡Œ,å…¶ä»–äº‹åŠ¡å›æ»šã€‚\n\n\nç³»ç»Ÿä¼šåœ¨æ¯ä¸ªäº‹åŠ¡å¼€å§‹æ—¶èµ‹äºˆå…¶ä¸€ä¸ªæ—¶é—´æˆ³,è¿™ä¸ªæ—¶é—´æˆ³å¯ä»¥æ˜¯ç³»ç»Ÿæ—¶é’Ÿä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªä¸æ–­ç´¯åŠ çš„è®¡æ•°å™¨å€¼,å½“äº‹åŠ¡å›æ»šæ—¶ä¼šä¸ºå…¶èµ‹äºˆä¸€ä¸ªæ–°çš„æ—¶é—´æˆ³,å…ˆå¼€å§‹çš„äº‹åŠ¡æ—¶é—´æˆ³å°äºåå¼€å§‹äº‹åŠ¡çš„æ—¶é—´æˆ³ã€‚\n\n\næ¯ä¸€ä¸ªæ•°æ®é¡¹Qæœ‰ä¸¤ä¸ªæ—¶é—´æˆ³ç›¸å…³çš„å­—æ®µ:\nW-timestamp(Q):æˆåŠŸæ‰§è¡Œwrite(Q)çš„æ‰€æœ‰äº‹åŠ¡çš„æœ€å¤§æ—¶é—´æˆ³\nR-timestamp(Q):æˆåŠŸæ‰§è¡Œread(Q)çš„æ‰€æœ‰äº‹åŠ¡çš„æœ€å¤§æ—¶é—´æˆ³\n\n\næ—¶é—´æˆ³æ’åºè§„åˆ™å¦‚ä¸‹:\n\n1. å‡è®¾äº‹åŠ¡Tå‘å‡ºread(Q),Tçš„æ—¶é—´æˆ³ä¸ºTS\na.è‹¥TS(T)<W-timestamp(Q),åˆ™Téœ€è¦è¯»å…¥çš„Qå·²è¢«è¦†ç›–ã€‚æ­¤\nreadæ“ä½œå°†è¢«æ‹’ç»,Tå›æ»šã€‚\nb.è‹¥TS(T)>=W-timestamp(Q),åˆ™æ‰§è¡Œreadæ“ä½œ,åŒæ—¶æŠŠ\nR-timestamp(Q)è®¾ç½®ä¸ºTS(T)ä¸R-timestamp(Q)ä¸­çš„æœ€å¤§å€¼\n2. å‡è®¾äº‹åŠ¡Tå‘å‡ºwrite(Q)\na.è‹¥TS(T)<R-timestamp(Q),writeæ“ä½œè¢«æ‹’ç»,Tå›æ»šã€‚\nb.è‹¥TS(T)<W-timestamp(Q),åˆ™writeæ“ä½œè¢«æ‹’ç»,Tå›æ»šã€‚\nc.å…¶ä»–æƒ…å†µ:ç³»ç»Ÿæ‰§è¡Œwriteæ“ä½œ,å°†W-timestamp(Q)è®¾ç½®\nä¸ºTS(T)ã€‚\n\nåŸºäºæ—¶é—´æˆ³æ’åºå’ŒåŸºäºé”å®ç°çš„æœ¬è´¨ä¸€æ ·:å¯¹äºå¯èƒ½å†²çªçš„å¹¶å‘æ“ä½œ,ä»¥ä¸²è¡Œçš„æ–¹å¼å–ä»£å¹¶å‘æ‰§è¡Œ,å› è€Œå®ƒä¹Ÿæ˜¯ä¸€ç§æ‚²è§‚å¹¶å‘æ§åˆ¶ã€‚å®ƒä»¬çš„åŒºåˆ«ä¸»è¦æœ‰ä¸¤ç‚¹:\n\n- åŸºäºé”æ˜¯è®©å†²çªçš„äº‹åŠ¡è¿›è¡Œç­‰å¾…,è€ŒåŸºäºæ—¶é—´æˆ³æ’åºæ˜¯è®©å†²çªçš„äº‹åŠ¡å›æ»šã€‚\n- åŸºäºé”å†²çªäº‹åŠ¡çš„æ‰§è¡Œæ¬¡åºæ˜¯æ ¹æ®å®ƒä»¬ç”³è¯·é”çš„é¡ºåº,å…ˆç”³è¯·çš„å…ˆæ‰§è¡Œ;è€ŒåŸºäºæ—¶é—´æˆ³æ’åºæ˜¯æ ¹æ®ç‰¹å®šçš„æ—¶é—´æˆ³æ’åºè§„åˆ™ã€‚\n\n### åŸºäºæœ‰æ•ˆæ€§æ£€æŸ¥çš„å¹¶å‘æ§åˆ¶\n\n\næ ¸å¿ƒæ€æƒ³:äº‹åŠ¡å¯¹æ•°æ®çš„æ›´æ–°é¦–å…ˆåœ¨è‡ªå·±çš„å·¥ä½œç©ºé—´è¿›è¡Œ,ç­‰åˆ°è¦å†™å›æ•°æ®åº“æ—¶æ‰è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥,å¯¹ä¸ç¬¦åˆè¦æ±‚çš„äº‹åŠ¡è¿›è¡Œå›æ»šã€‚\n\n\nåŸºäºæœ‰æ•ˆæ€§æ£€æŸ¥çš„äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¼šè¢«åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:\n\n1. è¯»é˜¶æ®µ:æ•°æ®é¡¹è¢«è¯»å…¥å¹¶ä¿å­˜åœ¨äº‹åŠ¡çš„å±€éƒ¨å˜é‡ä¸­ã€‚æ‰€æœ‰writeæ“ä½œéƒ½æ˜¯å¯¹å±€éƒ¨å˜é‡è¿›è¡Œ,å¹¶ä¸å¯¹æ•°æ®åº“è¿›è¡ŒçœŸæ­£çš„æ›´æ–°ã€‚\n2. æœ‰æ•ˆæ€§æ£€æŸ¥é˜¶æ®µ:å¯¹äº‹åŠ¡è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥,åˆ¤æ–­æ˜¯å¦å¯ä»¥æ‰§è¡Œwriteæ“ä½œè€Œä¸è¿åå¯ä¸²è¡Œæ€§ã€‚å¦‚æœå¤±è´¥,åˆ™å›æ»šè¯¥äº‹åŠ¡ã€‚\n3. å†™é˜¶æ®µ:äº‹åŠ¡å·²é€šè¿‡æœ‰æ•ˆæ€§æ£€æŸ¥,åˆ™å°†ä¸´æ—¶å˜é‡ä¸­çš„ç»“æœæ›´æ–°åˆ°æ•°æ®åº“ä¸­ã€‚\n\næœ‰æ•ˆæ€§æ£€æŸ¥é€šå¸¸ä¹Ÿæ˜¯é€šè¿‡å¯¹äº‹åŠ¡çš„æ—¶é—´æˆ³è¿›è¡Œæ¯”è¾ƒå®Œæˆçš„,ä¸è¿‡å’ŒåŸºäºæ—¶é—´æˆ³æ’åºçš„è§„åˆ™ä¸ä¸€æ ·ã€‚\n\n\nè¯¥æ–¹æ³•å…è®¸å¯èƒ½å†²çªçš„æ“ä½œå¹¶å‘æ‰§è¡Œ,å› ä¸ºæ¯ä¸ªäº‹åŠ¡æ“ä½œçš„éƒ½æ˜¯è‡ªå·±å·¥ä½œç©ºé—´çš„å±€éƒ¨å˜é‡,ç›´åˆ°æœ‰æ•ˆæ€§æ£€æŸ¥é˜¶æ®µå‘ç°äº†å†²çªæ‰å›æ»šã€‚å› è€Œè¿™æ˜¯ä¸€ç§ä¹è§‚çš„å¹¶å‘ç­–ç•¥ã€‚\n\n\n### åŸºäºå¿«ç…§éš”ç¦»çš„å¹¶å‘æ§åˆ¶\n\n\nå¿«ç…§éš”ç¦»æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(mvcc)çš„ä¸€ç§å®ç°æ–¹å¼ã€‚\n\n\nå…¶æ ¸å¿ƒæ€æƒ³æ˜¯:æ•°æ®åº“ä¸ºæ¯ä¸ªæ•°æ®é¡¹ç»´æŠ¤å¤šä¸ªç‰ˆæœ¬(å¿«ç…§),æ¯ä¸ªäº‹åŠ¡åªå¯¹å±äºè‡ªå·±çš„ç§æœ‰å¿«ç…§è¿›è¡Œæ›´æ–°,åœ¨äº‹åŠ¡çœŸæ­£æäº¤å‰è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥,ä½¿å¾—äº‹åŠ¡æ­£å¸¸æäº¤æ›´æ–°æˆ–è€…å¤±è´¥å›æ»šã€‚\n\n\nç”±äºå¿«ç…§éš”ç¦»å¯¼è‡´äº‹åŠ¡çœ‹ä¸åˆ°å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®é¡¹çš„æ›´æ–°,ä¸ºäº†é¿å…å‡ºç°ä¸¢å¤±æ›´æ–°é—®é¢˜,å¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆé¿å…ï¼š\n\n- å…ˆæäº¤è€…è·èƒœ:å¯¹äºæ‰§è¡Œè¯¥æ£€æŸ¥çš„äº‹åŠ¡T,åˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–äº‹åŠ¡å·²ç»å°†æ›´æ–°å†™å…¥æ•°æ®åº“,æ˜¯åˆ™Tå›æ»šå¦åˆ™Tæ­£å¸¸æäº¤ã€‚\n- å…ˆæ›´æ–°è€…è·èƒœ:é€šè¿‡é”æœºåˆ¶ä¿è¯ç¬¬ä¸€ä¸ªè·å¾—é”çš„äº‹åŠ¡æäº¤å…¶æ›´æ–°,ä¹‹åè¯•å›¾æ›´æ–°çš„äº‹åŠ¡ä¸­æ­¢ã€‚\n\näº‹åŠ¡é—´å¯èƒ½å†²çªçš„æ“ä½œé€šè¿‡æ•°æ®é¡¹çš„ä¸åŒç‰ˆæœ¬çš„å¿«ç…§ç›¸äº’éš”ç¦»,åˆ°çœŸæ­£è¦å†™å…¥æ•°æ®åº“æ—¶æ‰è¿›è¡Œå†²çªæ£€æµ‹ã€‚å› è€Œè¿™ä¹Ÿæ˜¯ä¸€ç§ä¹è§‚å¹¶å‘æ§åˆ¶ã€‚\n\n\n### äº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä»¥åŠå¯èƒ½äº§ç”Ÿçš„é—®é¢˜\n\n\n![](https://blog-file.hehouhui.cn/1422237-20181122103254113-1342077140.png)\n\n\näº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹å¯ä»¥ç®€åŒ–å¦‚ä¸‹:\n\n1. ç³»ç»Ÿä¼šä¸ºæ¯ä¸ªäº‹åŠ¡å¼€è¾Ÿä¸€ä¸ªç§æœ‰å·¥ä½œåŒº\n2. äº‹åŠ¡è¯»æ“ä½œå°†ä»ç£ç›˜ä¸­æ‹·è´æ•°æ®é¡¹åˆ°å·¥ä½œåŒºä¸­,åœ¨æ‰§è¡Œå†™æ“ä½œå‰æ‰€æœ‰çš„æ›´æ–°éƒ½ä½œç”¨äºå·¥ä½œåŒºä¸­çš„æ‹·è´.\n3. äº‹åŠ¡çš„å†™æ“ä½œå°†æŠŠæ•°æ®è¾“å‡ºåˆ°å†…å­˜çš„ç¼“å†²åŒºä¸­,ç­‰åˆ°åˆé€‚çš„æ—¶é—´å†ç”±ç¼“å†²åŒºç®¡ç†å™¨å°†æ•°æ®å†™å…¥åˆ°ç£ç›˜ã€‚\n\nç”±äºæ•°æ®åº“å­˜åœ¨ç«‹å³ä¿®æ”¹å’Œå»¶è¿Ÿä¿®æ”¹,æ‰€ä»¥åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨ä»¥ä¸‹æƒ…å†µ:\n\n- åœ¨äº‹åŠ¡æäº¤å‰å‡ºç°æ•…éšœ,ä½†æ˜¯äº‹åŠ¡å¯¹æ•°æ®åº“çš„éƒ¨åˆ†ä¿®æ”¹å·²ç»å†™å…¥ç£ç›˜æ•°æ®åº“ä¸­ã€‚è¿™å¯¼è‡´äº†äº‹åŠ¡çš„åŸå­æ€§è¢«ç ´åã€‚\n- åœ¨ç³»ç»Ÿå´©æºƒå‰äº‹åŠ¡å·²ç»æäº¤,ä½†æ•°æ®è¿˜åœ¨å†…å­˜ç¼“å†²åŒºä¸­,æ²¡æœ‰å†™å…¥ç£ç›˜ã€‚ç³»ç»Ÿæ¢å¤æ—¶å°†ä¸¢å¤±æ­¤æ¬¡å·²æäº¤çš„ä¿®æ”¹ã€‚è¿™æ˜¯å¯¹äº‹åŠ¡æŒä¹…æ€§çš„ç ´åã€‚\n\n### æ—¥å¿—çš„ç§ç±»å’Œæ ¼å¼\n\n- ``:æè¿°ä¸€æ¬¡æ•°æ®åº“å†™æ“ä½œ,Tæ˜¯æ‰§è¡Œå†™æ“ä½œçš„äº‹åŠ¡çš„å”¯ä¸€æ ‡è¯†,Xæ˜¯è¦å†™çš„æ•°æ®é¡¹,V1æ˜¯æ•°æ®é¡¹çš„æ—§å€¼,V2æ˜¯æ•°æ®é¡¹çš„æ–°å€¼ã€‚\n- ``:å¯¹æ•°æ®åº“å†™æ“ä½œçš„æ’¤é”€æ“ä½œ,å°†äº‹åŠ¡Tçš„Xæ•°æ®é¡¹æ¢å¤ä¸ºæ—§å€¼V1ã€‚åœ¨äº‹åŠ¡æ¢å¤é˜¶æ®µæ’å…¥ã€‚\n- ``: äº‹åŠ¡Tå¼€å§‹\n- ``: äº‹åŠ¡Tæäº¤\n- ``: äº‹åŠ¡Tä¸­æ­¢\n\nå…³äºæ—¥å¿—,æœ‰ä»¥ä¸‹ä¸¤æ¡è§„åˆ™\n\n- 1.ç³»ç»Ÿåœ¨å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹å‰ä¼šåœ¨æ—¥å¿—æ–‡ä»¶æœ«å°¾è¿½åŠ ç›¸åº”çš„æ—¥å¿—è®°å½•ã€‚\n- 2.å½“ä¸€ä¸ªäº‹åŠ¡çš„commitæ—¥å¿—è®°å½•å†™å…¥åˆ°ç£ç›˜æˆåŠŸå,ç§°è¿™ä¸ªäº‹åŠ¡å·²æäº¤,ä½†äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¯èƒ½å¹¶æœªå†™å…¥ç£ç›˜\n\n### æ—¥å¿—æ¢å¤çš„æ ¸å¿ƒæ€æƒ³\n\n- æ’¤é”€äº‹åŠ¡undo:å°†äº‹åŠ¡æ›´æ–°çš„æ‰€æœ‰æ•°æ®é¡¹æ¢å¤ä¸ºæ—¥å¿—ä¸­çš„æ—§å€¼,äº‹åŠ¡æ’¤é”€å®Œæ¯•æ—¶å°†æ’å…¥ä¸€æ¡``è®°å½•ã€‚\n- é‡åšäº‹åŠ¡redo:å°†äº‹åŠ¡æ›´æ–°çš„æ‰€æœ‰æ•°æ®é¡¹æ¢å¤ä¸ºæ—¥å¿—ä¸­çš„æ–°å€¼ã€‚\n\näº‹åŠ¡æ­£å¸¸å›æ»š/å› äº‹åŠ¡æ•…éšœä¸­æ­¢å°†è¿›è¡Œredo\nç³»ç»Ÿä»å´©æºƒä¸­æ¢å¤æ—¶å°†å…ˆè¿›è¡Œredoå†è¿›è¡Œundoã€‚\n\n\nä»¥ä¸‹äº‹åŠ¡å°†è¿›è¡Œundo:æ—¥å¿—ä¸­åªåŒ…æ‹¬`è®°å½•,ä½†æ—¢ä¸åŒ…æ‹¬`è®°å½•ä¹Ÿä¸åŒ…æ‹¬``è®°å½•.\n\n\nä»¥ä¸‹äº‹åŠ¡å°†è¿›è¡Œredo:æ—¥å¿—ä¸­åŒ…æ‹¬`è®°å½•,ä¹ŸåŒ…æ‹¬`è®°å½•æˆ–``è®°å½•ã€‚\n\n\nå‡è®¾ç³»ç»Ÿä»å´©æºƒä¸­æ¢å¤æ—¶æ—¥å¿—è®°å½•å¦‚ä¸‹\n\n\n```text\n<T0 start>\n<T0,A,1000,950>\n<T0,B,2000,2050>\n<T0 commit>\n<T1 start>\n<T1,C,700,600>\n\n```\n\n\nç”±äºT0æ—¢æœ‰startè®°å½•åˆæœ‰commitè®°å½•,å°†ä¼šå¯¹äº‹åŠ¡T0è¿›è¡Œé‡åš,æ‰§è¡Œç›¸åº”çš„redoæ“ä½œã€‚\nç”±äºT1åªæœ‰startè®°å½•,å°†ä¼šå¯¹T1è¿›è¡Œæ’¤é”€,æ‰§è¡Œç›¸åº”çš„undoæ“ä½œ,æ’¤é”€å®Œæ¯•å°†å†™å…¥ä¸€æ¡abortè®°å½•ã€‚\n\n\n### äº‹åŠ¡æ•…éšœä¸­æ­¢/æ­£å¸¸å›æ»šçš„æ¢å¤æµç¨‹\n\n1. ä»åå¾€å‰æ‰«ææ—¥å¿—,å¯¹äºäº‹åŠ¡Tçš„æ¯ä¸ªå½¢å¦‚``çš„è®°å½•,å°†æ—§å€¼V1å†™å…¥æ•°æ®é¡¹Xä¸­ã€‚\n2. å¾€æ—¥å¿—ä¸­å†™ä¸€ä¸ªç‰¹æ®Šçš„åªè¯»è®°å½•``,è¡¨ç¤ºå°†æ•°æ®é¡¹æ¢å¤æˆæ—§å€¼V1,\nè¿™æ˜¯ä¸€ä¸ªåªè¯»çš„è¡¥å¿è®°å½•,ä¸éœ€è¦æ ¹æ®å®ƒè¿›è¡Œundoã€‚\n3. ä¸€æ—¦å‘ç°äº†`æ—¥å¿—è®°å½•,å°±åœæ­¢ç»§ç»­æ‰«æ,å¹¶å¾€æ—¥å¿—ä¸­å†™ä¸€ä¸ª` æ—¥å¿—è®°å½•ã€‚\n\n\t![](https://blog-file.hehouhui.cn/1422237-20181122103326981-1784817664.png)\n\n\n### ç³»ç»Ÿå´©æºƒæ—¶çš„æ¢å¤è¿‡ç¨‹(å¸¦æ£€æŸ¥ç‚¹)\n\n\næ£€æŸ¥ç‚¹æ˜¯å½¢å¦‚``çš„ç‰¹æ®Šçš„æ—¥å¿—è®°å½•,Læ˜¯å†™å…¥æ£€æŸ¥ç‚¹è®°å½•æ—¶è¿˜æœªæäº¤çš„äº‹åŠ¡çš„é›†åˆ,ç³»ç»Ÿä¿è¯åœ¨æ£€æŸ¥ç‚¹ä¹‹å‰å·²ç»æäº¤çš„äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹å·²ç»å†™å…¥ç£ç›˜,ä¸éœ€è¦è¿›è¡Œredoã€‚æ£€æŸ¥ç‚¹å¯ä»¥åŠ å¿«æ¢å¤çš„è¿‡ç¨‹ã€‚\n\n\nç³»ç»Ÿå¥”æºƒæ—¶çš„æ¢å¤è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ:é‡åšé˜¶æ®µå’Œæ’¤é”€é˜¶æ®µã€‚\n\n\né‡åšé˜¶æ®µ:\n\n1. ç³»ç»Ÿä»æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹å¼€å§‹æ­£å‘çš„æ‰«ææ—¥å¿—,å°†è¦é‡åšçš„äº‹åŠ¡çš„åˆ—è¡¨undo-listè®¾ç½®ä¸ºæ£€æŸ¥ç‚¹æ—¥å¿—è®°å½•ä¸­çš„Låˆ—è¡¨ã€‚\n2. å‘ç°`çš„æ›´æ–°è®°å½•æˆ–`çš„è¡¥å¿æ’¤é”€è®°å½•,å°±é‡åšè¯¥æ“ä½œã€‚\n3. å‘ç°``è®°å½•,å°±æŠŠTåŠ å…¥åˆ°undo-listä¸­ã€‚\n4. å‘ç°`æˆ–`è®°å½•,å°±æŠŠTä»undo-listä¸­å»é™¤ã€‚\n\næ’¤é”€é˜¶æ®µ:\n\n1. ç³»ç»Ÿä»å°¾éƒ¨å¼€å§‹åå‘æ‰«ææ—¥å¿—\n2. å‘ç°å±äºundo-listä¸­çš„äº‹åŠ¡çš„æ—¥å¿—è®°å½•,å°±æ‰§è¡Œundoæ“ä½œ\n3. å‘ç°undo-listä¸­äº‹åŠ¡çš„Tçš„`è®°å½•,å°±å†™å…¥ä¸€æ¡`è®°å½•,\nå¹¶æŠŠTä»undo-listä¸­å»é™¤ã€‚\n\n4.undo-listä¸ºç©º,åˆ™æ’¤é”€é˜¶æ®µç»“æŸ\n\n\næ€»ç»“:å…ˆå°†æ—¥å¿—è®°å½•ä¸­æ‰€æœ‰äº‹åŠ¡çš„æ›´æ–°æŒ‰é¡ºåºé‡åšä¸€é,åœ¨é’ˆå¯¹éœ€è¦æ’¤é”€çš„äº‹åŠ¡æŒ‰ç›¸åçš„é¡ºåºæ‰§è¡Œå…¶æ›´æ–°æ“ä½œçš„æ’¤é”€æ“ä½œã€‚\n\n\n### æ€»ç»“\n\n\näº‹åŠ¡æ˜¯æ•°æ®åº“ç³»ç»Ÿè¿›è¡Œå¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½,æ˜¯æ•°æ®åº“ç³»ç»Ÿè¿›è¡Œæ•…éšœæ¢å¤çš„åŸºæœ¬å•ä½,ä»è€Œä¹Ÿæ˜¯ä¿æŒæ•°æ®åº“çŠ¶æ€ä¸€è‡´æ€§çš„åŸºæœ¬å•ä½ã€‚ACIDæ˜¯äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§,æ•°æ®åº“ç³»ç»Ÿæ˜¯é€šè¿‡å¹¶å‘æ§åˆ¶æŠ€æœ¯å’Œæ—¥å¿—æ¢å¤æŠ€æœ¯æ¥å¯¹äº‹åŠ¡çš„ACIDè¿›è¡Œä¿è¯çš„,ä»è€Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å…³äºæ•°æ®åº“äº‹åŠ¡çš„æ¦‚å¿µä½“ç³»ç»“æ„ã€‚\n\n\n![](https://blog-file.hehouhui.cn/1422237-20181122103402725-726722235.png)\n\n\n## æ•…éšœä¸æ•…éšœæ¢å¤æŠ€æœ¯\n\n\næ•°æ®åº“è¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°æ•…éšœ,è¿™äº›æ•…éšœåŒ…æ‹¬äº‹åŠ¡æ•…éšœå’Œç³»ç»Ÿæ•…éšœä¸¤å¤§ç±»\n\n- äº‹åŠ¡æ•…éšœ:æ¯”å¦‚éæ³•è¾“å…¥,ç³»ç»Ÿå‡ºç°æ­»é”,å¯¼è‡´äº‹åŠ¡æ— æ³•ç»§ç»­æ‰§è¡Œã€‚\n- ç³»ç»Ÿæ•…éšœ:æ¯”å¦‚ç”±äºè½¯ä»¶æ¼æ´æˆ–ç¡¬ä»¶é”™è¯¯å¯¼è‡´ç³»ç»Ÿå´©æºƒæˆ–ä¸­æ­¢ã€‚\n\nè¿™äº›æ•…éšœå¯èƒ½ä¼šå¯¹äº‹åŠ¡å’Œæ•°æ®åº“çŠ¶æ€é€ æˆç ´å,å› è€Œå¿…é¡»æä¾›ä¸€ç§æŠ€æœ¯æ¥å¯¹å„ç§æ•…éšœè¿›è¡Œæ¢å¤,ä¿è¯æ•°æ®åº“ä¸€è‡´æ€§,äº‹åŠ¡çš„åŸå­æ€§ä»¥åŠæŒä¹…æ€§ã€‚æ•°æ®åº“é€šå¸¸ä»¥æ—¥å¿—çš„æ–¹å¼è®°å½•æ•°æ®åº“çš„æ“ä½œä»è€Œåœ¨æ•…éšœæ—¶è¿›è¡Œæ¢å¤,å› è€Œå¯ä»¥ç§°ä¹‹ä¸ºæ—¥å¿—æ¢å¤æŠ€æœ¯ã€‚\n\n\n## [é”æœºåˆ¶ä¸InnoDBé”ç®—æ³•](https://snailclimb.gitee.io/javaguide/#/docs/database/MySQL?id=%E9%94%81%E6%9C%BA%E5%88%B6%E4%B8%8Einnodb%E9%94%81%E7%AE%97%E6%B3%95)\n\n\n**MyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨çš„é”ï¼š**\n\n- MyISAMé‡‡ç”¨è¡¨çº§é”(table-level locking)ã€‚\n- InnoDBæ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºè¡Œçº§é”\n\n**è¡¨çº§é”å’Œè¡Œçº§é”å¯¹æ¯”ï¼š**\n\n- **è¡¨çº§é”ï¼š** MySQLä¸­é”å®š **ç²’åº¦æœ€å¤§** çš„ä¸€ç§é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚å…¶é”å®šç²’åº¦æœ€å¤§ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ï¼ŒMyISAMå’Œ InnoDBå¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚\n- **è¡Œçº§é”ï¼š** MySQLä¸­é”å®š **ç²’åº¦æœ€å°** çš„ä¸€ç§é”ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚\n\nè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒï¼š MySQLé”æœºåˆ¶ç®€å•äº†è§£ä¸€ä¸‹ï¼š[https://blog.csdn.net/qq_34337272/article/details/80611486](https://blog.csdn.net/qq_34337272/article/details/80611486)\n\n\n### è¡Œé”\n\n\n    A recordlockisalockonanindexrecord.Recordlocksalwayslockindexrecords, evenifatableisdefinedwithnoindexes.Forsuch cases,InnoDBcreates a hidden clusteredindexanduses thisindexforrecordlocking.\n\n\nä¸Šæ–‡å‡ºè‡ªMySQLçš„å®˜æ–¹æ–‡æ¡£ï¼Œä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¡Œé”æ˜¯ä½œç”¨åœ¨ç´¢å¼•ä¸Šçš„ï¼Œå“ªæ€•ä½ åœ¨å»ºè¡¨çš„æ—¶å€™æ²¡æœ‰å®šä¹‰ä¸€ä¸ªç´¢å¼•ï¼ŒInnoDBä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªèšç°‡ç´¢å¼•å¹¶å°†å…¶ä½œä¸ºé”ä½œç”¨çš„ç´¢å¼•ã€‚\n\n\nè¿™é‡Œè¿˜æ˜¯è®²ä¸€ä¸‹InnoDBä¸­çš„èšç°‡ç´¢å¼•ã€‚æ¯ä¸€ä¸ªInnoDBè¡¨éƒ½éœ€è¦ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªã€‚å¦‚æœä½ ä¸ºè¯¥è¡¨è¡¨å®šä¹‰ä¸€ä¸ªä¸»é”®ï¼Œé‚£ä¹ˆMySQLå°†ä½¿ç”¨ä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•ï¼›å¦‚æœä½ ä¸ä¸ºå®šä¹‰ä¸€ä¸ªä¸»é”®ï¼Œé‚£ä¹ˆMySQLå°†ä¼šæŠŠç¬¬ä¸€ä¸ªå”¯ä¸€ç´¢å¼•(è€Œä¸”è¦æ±‚NOT NULL)ä½œä¸ºèšç°‡ç´¢å¼•ï¼›å¦‚æœä¸Šè¯‰ä¸¤ç§æƒ…å†µéƒ½GGï¼Œé‚£ä¹ˆMySQLå°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåå­—ä¸º çš„éšè—èšç°‡ç´¢å¼•ã€‚\n\n\nå› ä¸ºæ˜¯èšç°‡ç´¢å¼•ï¼Œæ‰€ä»¥B+æ ‘ä¸Šçš„å¶å­èŠ‚ç‚¹éƒ½å­˜å‚¨äº†æ•°æ®è¡Œï¼Œé‚£ä¹ˆå¦‚æœç°åœ¨æ˜¯äºŒçº§ç´¢å¼•å‘¢ï¼ŸInnoDBä¸­çš„äºŒçº§ç´¢å¼•çš„å¶èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼(æˆ–è€…è¯´èšç°‡ç´¢å¼•çš„å€¼)ï¼Œæ‰€ä»¥é€šè¿‡äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œè¿˜éœ€è¦å°†å¯¹åº”çš„ä¸»é”®å»èšç°‡ç´¢å¼•ä¸­å†æ¬¡è¿›è¡ŒæŸ¥è¯¢ã€‚\n\n\nå…³äºç´¢å¼•çš„é—®é¢˜å°±åˆ°è¿™ï¼Œæˆ‘ä»¬ç”¨ä¸€å¼ ç›´è§‚çš„å›¾æ¥è¡¨ç¤ºè¡Œé”ï¼š\n\n\n![](https://img-blog.csdnimg.cn/img_convert/63ebdaf075f09b127f9ca322af07fcab.png)\n\n\næ¥ä¸‹æ¥ä»¥ä¸¤æ¡SQLçš„æ‰§è¡Œä¸ºä¾‹ï¼Œè®²è§£ä¸€ä¸‹InnoDBå¯¹äºå•è¡Œæ•°æ®çš„åŠ é”åŸç†ï¼š\n\n\nupdateusersetage =10whereid=49;\n\n\nupdateusersetage =10wherename='Tom';\n\n\nç¬¬ä¸€æ¡SQLä½¿ç”¨ä¸»é”®æŸ¥è¯¢ï¼Œåªéœ€è¦åœ¨ id = 49 è¿™ä¸ªä¸»é”®ç´¢å¼•ä¸ŠåŠ ä¸Šé”ã€‚ç¬¬äºŒæ¡ SQL ä½¿ç”¨äºŒçº§ç´¢å¼•æ¥æŸ¥è¯¢ï¼Œé‚£ä¹ˆé¦–å…ˆåœ¨ name = Tom è¿™ä¸ªç´¢å¼•ä¸ŠåŠ å†™é”ï¼Œç„¶åç”±äºä½¿ç”¨ InnoDB äºŒçº§ç´¢å¼•è¿˜éœ€å†æ¬¡æ ¹æ®ä¸»é”®ç´¢å¼•æŸ¥è¯¢ï¼Œæ‰€ä»¥è¿˜éœ€è¦åœ¨ id = 49 è¿™ä¸ªä¸»é”®ç´¢å¼•ä¸ŠåŠ é”ã€‚\n\n\nä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ä¸»é”®ç´¢å¼•éœ€è¦åŠ ä¸€æŠŠé”ï¼Œä½¿ç”¨äºŒçº§ç´¢å¼•éœ€è¦åœ¨äºŒçº§ç´¢å¼•å’Œä¸»é”®ç´¢å¼•ä¸Šå„åŠ ä¸€æŠŠé”ã€‚\n\n\næ ¹æ®ç´¢å¼•å¯¹å•è¡Œæ•°æ®è¿›è¡Œæ›´æ–°çš„åŠ é”åŸç†äº†è§£äº†ï¼Œé‚£å¦‚æœæ›´æ–°æ“ä½œæ¶‰åŠå¤šä¸ªè¡Œå‘¢ï¼Œæ¯”å¦‚ä¸‹é¢ SQL çš„æ‰§è¡Œåœºæ™¯ã€‚\n\n\nupdateusersetage =10whereid>49;\n\n\nä¸Šè¿° SQL çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚MySQL Server ä¼šæ ¹æ® WHERE æ¡ä»¶è¯»å–ç¬¬ä¸€æ¡æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œç„¶å InnoDB å¼•æ“ä¼šå°†ç¬¬ä¸€æ¡è®°å½•è¿”å›å¹¶åŠ é”ï¼Œæ¥ç€ MySQL Server å‘èµ·æ›´æ–°æ”¹è¡Œè®°å½•çš„ UPDATE è¯·æ±‚ï¼Œæ›´æ–°è¿™æ¡è®°å½•ã€‚ä¸€æ¡è®°å½•æ“ä½œå®Œæˆï¼Œå†è¯»å–ä¸‹ä¸€æ¡è®°å½•ï¼Œç›´è‡³æ²¡æœ‰åŒ¹é…çš„è®°å½•ä¸ºæ­¢ã€‚\n\n\n![](https://img-blog.csdnimg.cn/img_convert/39bea16e38602978f21fb5f6f50e92d4.png)\n\n\n**InnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§ï¼š**\n\n- Record lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”\n- Gap lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«\n- Next-key lockï¼šrecord+gap é”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«\n\n**ç›¸å…³çŸ¥è¯†ç‚¹ï¼š**\n\n1. innodbå¯¹äºè¡Œçš„æŸ¥è¯¢ä½¿ç”¨next-key lock\n2. Next-locking keyingä¸ºäº†è§£å†³Phantom Problemå¹»è¯»é—®é¢˜\n3. å½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼Œå°†next-key locké™çº§ä¸ºrecord key\n4. Gapé”è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†é˜»æ­¢å¤šä¸ªäº‹åŠ¡å°†è®°å½•æ’å…¥åˆ°åŒä¸€èŒƒå›´å†…ï¼Œè€Œè¿™ä¼šå¯¼è‡´å¹»è¯»é—®é¢˜çš„äº§ç”Ÿ\n5. æœ‰ä¸¤ç§æ–¹å¼æ˜¾å¼å…³é—­gapé”ï¼šï¼ˆé™¤äº†å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥å¤–ï¼Œå…¶ä½™æƒ…å†µä»…ä½¿ç”¨record lockï¼‰ A. å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRC B. å°†å‚æ•°innodb_locks_unsafe_for_binlogè®¾ç½®ä¸º1\n\n### è¡¨é”\n\n\nä¸Šé¢æˆ‘ä»¬è®²è§£è¡Œé”çš„æ—¶å€™ï¼Œæ“ä½œè¯­å¥ä¸­çš„æ¡ä»¶åˆ¤æ–­åˆ—éƒ½æ˜¯æœ‰å»ºç«‹ç´¢å¼•çš„ï¼Œé‚£ä¹ˆå¦‚æœç°åœ¨çš„åˆ¤æ–­åˆ—ä¸å­˜åœ¨ç´¢å¼•å‘¢ï¼ŸInnoDBæ—¢æ”¯æŒè¡Œé”ï¼Œä¹Ÿæ”¯æŒè¡¨é”ï¼Œå½“æ²¡æœ‰æŸ¥è¯¢åˆ—æ²¡æœ‰ç´¢å¼•æ—¶ï¼ŒInnoDBå°±ä¸ä¼šå»æä»€ä¹ˆè¡Œé”äº†ï¼Œæ¯•ç«Ÿè¡Œé”ä¸€å®šè¦æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥å®ƒç°åœ¨æè¡¨é”ï¼ŒæŠŠæ•´å¼ è¡¨ç»™é”ä½äº†ã€‚é‚£ä¹ˆå…·ä½“å•¥æ˜¯è¡¨é”ï¼Ÿè¿˜æœ‰å…¶ä»–ä»€ä¹ˆæƒ…å†µä¸‹ä¹Ÿä¼šè¿›è¡Œé”è¡¨å‘¢ï¼Ÿ\n\n\nè¡¨é”ä½¿ç”¨çš„æ˜¯ä¸€æ¬¡æ€§é”æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¼šè¯å¼€å§‹çš„åœ°æ–¹ä½¿ç”¨ lock å‘½ä»¤å°†åç»­éœ€è¦ç”¨åˆ°çš„è¡¨éƒ½åŠ ä¸Šé”ï¼Œåœ¨è¡¨é‡Šæ”¾å‰ï¼Œåªèƒ½è®¿é—®è¿™äº›åŠ é”çš„è¡¨ï¼Œä¸èƒ½è®¿é—®å…¶ä»–è¡¨ï¼Œç›´åˆ°æœ€åé€šè¿‡ unlock tables é‡Šæ”¾æ‰€æœ‰è¡¨é”ã€‚\n\n\né™¤äº†ä½¿ç”¨ unlock tables æ˜¾ç¤ºé‡Šæ”¾é”ä¹‹å¤–ï¼Œä¼šè¯æŒæœ‰å…¶ä»–è¡¨é”æ—¶æ‰§è¡Œlock table è¯­å¥ä¼šé‡Šæ”¾ä¼šè¯ä¹‹å‰æŒæœ‰çš„é”ï¼›ä¼šè¯æŒæœ‰å…¶ä»–è¡¨é”æ—¶æ‰§è¡Œ start transaction æˆ–è€… begin å¼€å¯äº‹åŠ¡æ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾ä¹‹å‰æŒæœ‰çš„é”ã€‚\n\n\n![](https://img-blog.csdnimg.cn/img_convert/c0db3b3234e3875aaf94d6add3b14269.png)\n\n\nè¡¨é”ç”± MySQL Server å®ç°ï¼Œè¡Œé”åˆ™æ˜¯å­˜å‚¨å¼•æ“å®ç°ï¼Œä¸åŒçš„å¼•æ“å®ç°çš„ä¸åŒã€‚åœ¨ MySQL çš„å¸¸ç”¨å¼•æ“ä¸­ InnoDB æ”¯æŒè¡Œé”ï¼Œè€Œ MyISAM åˆ™åªèƒ½ä½¿ç”¨ MySQL Server æä¾›çš„è¡¨é”ã€‚\n\n\n## æ—¥å¿—\n\n\nMySQLä¸­æœ‰ä»¥ä¸‹æ—¥å¿—æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š\n\n\n1ï¼š**é‡åšæ—¥å¿—ï¼ˆredo logï¼‰**\n\n\n2ï¼š**å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰**\n\n\n3ï¼š**äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰**\n\n\n4ï¼š**é”™è¯¯æ—¥å¿—ï¼ˆerrorlogï¼‰**\n\n\n5ï¼š**æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow query logï¼‰**\n\n\n6ï¼š**ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼ˆgeneral logï¼‰**\n\n\n7ï¼š**ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰ã€‚**\n\n\nå…¶ä¸­é‡åšæ—¥å¿—å’Œå›æ»šæ—¥å¿—ä¸äº‹åŠ¡æ“ä½œæ¯æ¯ç›¸å…³ï¼ŒäºŒè¿›åˆ¶æ—¥å¿—ä¹Ÿä¸äº‹åŠ¡æ“ä½œæœ‰ä¸€å®šçš„å…³ç³»ï¼Œè¿™ä¸‰ç§æ—¥å¿—ï¼Œå¯¹ç†è§£MySQLä¸­çš„äº‹åŠ¡æ“ä½œæœ‰ç€é‡è¦çš„æ„ä¹‰ã€‚\n\n\n### é‡åšæ—¥å¿—ï¼ˆredo logï¼‰\n\n\n**ä½œç”¨ï¼š**\n\n\nç¡®ä¿äº‹åŠ¡çš„æŒä¹…æ€§ã€‚redoæ—¥å¿—è®°å½•äº‹åŠ¡æ‰§è¡Œåçš„çŠ¶æ€ï¼Œç”¨æ¥æ¢å¤æœªå†™å…¥data fileçš„å·²æˆåŠŸäº‹åŠ¡æ›´æ–°çš„æ•°æ®ã€‚é˜²æ­¢åœ¨å‘ç”Ÿæ•…éšœçš„æ—¶é—´ç‚¹ï¼Œå°šæœ‰è„é¡µæœªå†™å…¥ç£ç›˜ï¼Œåœ¨é‡å¯[mysql](https://www.2cto.com/database/MySQL/)æœåŠ¡çš„æ—¶å€™ï¼Œæ ¹æ®redo logè¿›è¡Œé‡åšï¼Œä»è€Œè¾¾åˆ°äº‹åŠ¡çš„æŒä¹…æ€§è¿™ä¸€ç‰¹æ€§ã€‚\n\n\n**å†…å®¹ï¼š**\n\n\nç‰©ç†æ ¼å¼çš„æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯ç‰©ç†æ•°æ®é¡µé¢çš„ä¿®æ”¹çš„ä¿¡æ¯ï¼Œå…¶redo logæ˜¯é¡ºåºå†™å…¥redo log fileçš„ç‰©ç†æ–‡ä»¶ä¸­å»çš„ã€‚\n\n\n**ä»€ä¹ˆæ—¶å€™äº§ç”Ÿï¼š**\n\n\näº‹åŠ¡å¼€å§‹ä¹‹åå°±äº§ç”Ÿredo logï¼Œredo logçš„è½ç›˜å¹¶ä¸æ˜¯éšç€äº‹åŠ¡çš„æäº¤æ‰å†™å…¥çš„ï¼Œè€Œæ˜¯åœ¨äº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¾¿å¼€å§‹å†™å…¥redo logæ–‡ä»¶ä¸­ã€‚\n\n\n**ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ï¼š**\n\n\nå½“å¯¹åº”äº‹åŠ¡çš„è„é¡µå†™å…¥åˆ°ç£ç›˜ä¹‹åï¼Œredo logçš„ä½¿å‘½ä¹Ÿå°±å®Œæˆäº†ï¼Œé‡åšæ—¥å¿—å ç”¨çš„ç©ºé—´å°±å¯ä»¥é‡ç”¨ï¼ˆè¢«è¦†ç›–ï¼‰ã€‚\n\n\n**å¯¹åº”çš„ç‰©ç†æ–‡ä»¶ï¼š**\n\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹åº”çš„ç‰©ç†æ–‡ä»¶ä½äº[æ•°æ®åº“](https://www.2cto.com/database/)çš„dataç›®å½•ä¸‹çš„ib_logfile1&ib_logfile2\n\n\ninnodb_log_group_home_dir æŒ‡å®šæ—¥å¿—æ–‡ä»¶ç»„æ‰€åœ¨çš„è·¯å¾„ï¼Œé»˜è®¤./ ï¼Œè¡¨ç¤ºåœ¨æ•°æ®åº“çš„æ•°æ®ç›®å½•ä¸‹ã€‚\n\n\ninnodb_log_files_in_group æŒ‡å®šé‡åšæ—¥å¿—æ–‡ä»¶ç»„ä¸­æ–‡ä»¶çš„æ•°é‡ï¼Œé»˜è®¤2\n\n\n**å…³äºæ–‡ä»¶çš„å¤§å°å’Œæ•°é‡ï¼Œç”±ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°é…ç½®ï¼š**\n\n\ninnodb_log_file_size é‡åšæ—¥å¿—æ–‡ä»¶çš„å¤§å°ã€‚\n\n\ninnodb_mirrored_log_groups æŒ‡å®šäº†æ—¥å¿—é•œåƒæ–‡ä»¶ç»„çš„æ•°é‡ï¼Œé»˜è®¤1\n\n\n**å…¶ä»–ï¼š**\n\n\nå¾ˆé‡è¦ä¸€ç‚¹ï¼Œredo logæ˜¯ä»€ä¹ˆæ—¶å€™å†™ç›˜çš„ï¼Ÿå‰é¢è¯´äº†æ˜¯åœ¨äº‹ç‰©å¼€å§‹ä¹‹åé€æ­¥å†™ç›˜çš„ã€‚\n\n\nä¹‹æ‰€ä»¥è¯´é‡åšæ—¥å¿—æ˜¯åœ¨äº‹åŠ¡å¼€å§‹ä¹‹åé€æ­¥å†™å…¥é‡åšæ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸ä¸€å®šæ˜¯äº‹åŠ¡æäº¤æ‰å†™å…¥é‡åšæ—¥å¿—ç¼“å­˜ï¼ŒåŸå› å°±æ˜¯ï¼Œé‡åšæ—¥å¿—æœ‰ä¸€ä¸ªç¼“å­˜åŒºInnodb_log_bufferï¼ŒInnodb_log_bufferçš„é»˜è®¤å¤§å°ä¸º8M(è¿™é‡Œè®¾ç½®çš„16M),Innodbå­˜å‚¨å¼•æ“å…ˆå°†é‡åšæ—¥å¿—å†™å…¥innodb_log_bufferä¸­ã€‚\n\n\n![](https://www.2cto.com/uploadfile/Collfiles/20180313/20180313092754205.png)\n\n\nç„¶åä¼šé€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼å°†innodbæ—¥å¿—ç¼“å†²åŒºçš„æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜\n\n\nMaster Thread æ¯ç§’ä¸€æ¬¡æ‰§è¡Œåˆ·æ–°Innodb_log_bufferåˆ°é‡åšæ—¥å¿—æ–‡ä»¶ã€‚\n\n\næ¯ä¸ªäº‹åŠ¡æäº¤æ—¶ä¼šå°†é‡åšæ—¥å¿—åˆ·æ–°åˆ°é‡åšæ—¥å¿—æ–‡ä»¶ã€‚\n\n\nå½“é‡åšæ—¥å¿—ç¼“å­˜å¯ç”¨ç©ºé—´ å°‘äºä¸€åŠæ—¶ï¼Œé‡åšæ—¥å¿—ç¼“å­˜è¢«åˆ·æ–°åˆ°é‡åšæ—¥å¿—æ–‡ä»¶\n\n\nç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œé‡åšæ—¥å¿—é€šè¿‡ä¸æ­¢ä¸€ç§æ–¹å¼å†™å…¥åˆ°ç£ç›˜ï¼Œå°¤å…¶æ˜¯å¯¹äºç¬¬ä¸€ç§æ–¹å¼ï¼ŒInnodb_log_bufferåˆ°é‡åšæ—¥å¿—æ–‡ä»¶æ˜¯Master Threadçº¿ç¨‹çš„å®šæ—¶ä»»åŠ¡ã€‚\n\n\nå› æ­¤é‡åšæ—¥å¿—çš„å†™ç›˜ï¼Œå¹¶ä¸ä¸€å®šæ˜¯éšç€äº‹åŠ¡çš„æäº¤æ‰å†™å…¥é‡åšæ—¥å¿—æ–‡ä»¶çš„ï¼Œè€Œæ˜¯éšç€äº‹åŠ¡çš„å¼€å§‹ï¼Œé€æ­¥å¼€å§‹çš„ã€‚\n\n\nå¦å¤–å¼•ç”¨ã€ŠMySQLæŠ€æœ¯å†…å¹• Innodb å­˜å‚¨å¼•æ“ã€‹ï¼ˆpage37ï¼‰ä¸Šçš„åŸè¯ï¼š\n\n\nå³ä½¿æŸä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ï¼ŒInnodbå­˜å‚¨å¼•æ“ä»ç„¶æ¯ç§’ä¼šå°†é‡åšæ—¥å¿—ç¼“å­˜åˆ·æ–°åˆ°é‡åšæ—¥å¿—æ–‡ä»¶ã€‚\n\n\nè¿™ä¸€ç‚¹æ˜¯å¿…é¡»è¦çŸ¥é“çš„ï¼Œå› ä¸ºè¿™å¯ä»¥å¾ˆå¥½åœ°è§£é‡Šå†å¤§çš„äº‹åŠ¡çš„æäº¤ï¼ˆcommitï¼‰çš„æ—¶é—´ä¹Ÿæ˜¯å¾ˆçŸ­æš‚çš„ã€‚\n\n\n### å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰\n\n\n**ä½œç”¨ï¼š**\n\n\nä¿è¯æ•°æ®çš„åŸå­æ€§ï¼Œä¿å­˜äº†äº‹åŠ¡å‘ç”Ÿä¹‹å‰çš„æ•°æ®çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨äºå›æ»šï¼ŒåŒæ—¶å¯ä»¥æä¾›å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ä¸‹çš„è¯»ï¼ˆMVCCï¼‰ï¼Œä¹Ÿå³éé”å®šè¯»\n\n\n**å†…å®¹ï¼š**\n\n\né€»è¾‘æ ¼å¼çš„æ—¥å¿—ï¼Œåœ¨æ‰§è¡Œundoçš„æ—¶å€™ï¼Œä»…ä»…æ˜¯å°†æ•°æ®ä»é€»è¾‘ä¸Šæ¢å¤è‡³äº‹åŠ¡ä¹‹å‰çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯ä»ç‰©ç†é¡µé¢ä¸Šæ“ä½œå®ç°çš„ï¼Œè¿™ä¸€ç‚¹æ˜¯ä¸åŒäºredo logçš„ã€‚\n\n\n**ä»€ä¹ˆæ—¶å€™äº§ç”Ÿï¼š**\n\n\näº‹åŠ¡å¼€å§‹ä¹‹å‰ï¼Œå°†å½“å‰æ˜¯çš„ç‰ˆæœ¬ç”Ÿæˆundo logï¼Œundo ä¹Ÿä¼šäº§ç”Ÿ redo æ¥ä¿è¯undo logçš„å¯é æ€§\n\n\n**ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ï¼š**\n\n\nå½“äº‹åŠ¡æäº¤ä¹‹åï¼Œundo logå¹¶ä¸èƒ½ç«‹é©¬è¢«åˆ é™¤ï¼Œè€Œæ˜¯æ”¾å…¥å¾…æ¸…ç†çš„é“¾è¡¨ï¼Œç”±purgeçº¿ç¨‹åˆ¤æ–­æ˜¯å¦ç”±å…¶ä»–äº‹åŠ¡åœ¨ä½¿ç”¨undoæ®µä¸­è¡¨çš„ä¸Šä¸€ä¸ªäº‹åŠ¡ä¹‹å‰çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå†³å®šæ˜¯å¦å¯ä»¥æ¸…ç†undo logçš„æ—¥å¿—ç©ºé—´ã€‚\n\n\n**å¯¹åº”çš„ç‰©ç†æ–‡ä»¶ï¼š**\n\n\nMySQL5.6ä¹‹å‰ï¼Œundoè¡¨ç©ºé—´ä½äºå…±äº«è¡¨ç©ºé—´çš„å›æ»šæ®µä¸­ï¼Œå…±äº«è¡¨ç©ºé—´çš„é»˜è®¤çš„åç§°æ˜¯ibdataï¼Œä½äºæ•°æ®æ–‡ä»¶ç›®å½•ä¸­ã€‚\n\n\nMySQL5.6ä¹‹åï¼Œundoè¡¨ç©ºé—´å¯ä»¥é…ç½®æˆç‹¬ç«‹çš„æ–‡ä»¶ï¼Œä½†æ˜¯æå‰éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œå®Œæˆæ•°æ®åº“åˆå§‹åŒ–åç”Ÿæ•ˆä¸”ä¸å¯æ”¹å˜undo logæ–‡ä»¶çš„ä¸ªæ•°\n\n\nå¦‚æœåˆå§‹åŒ–æ•°æ®åº“ä¹‹å‰æ²¡æœ‰è¿›è¡Œç›¸å…³é…ç½®ï¼Œé‚£ä¹ˆå°±æ— æ³•é…ç½®æˆç‹¬ç«‹çš„è¡¨ç©ºé—´äº†ã€‚\n\n\n**å…³äºMySQL5.7ä¹‹åçš„ç‹¬ç«‹undo è¡¨ç©ºé—´é…ç½®å‚æ•°å¦‚ä¸‹ï¼š**\n\n\ninnodb_undo_directory = /data/un[dos](https://www.2cto.com/os/dos/)pace/ â€“undoç‹¬ç«‹è¡¨ç©ºé—´çš„å­˜æ”¾ç›®å½• innodb_undo_logs = 128 â€“å›æ»šæ®µä¸º128KB innodb_undo_tablespaces = 4 â€“æŒ‡å®šæœ‰4ä¸ªundo logæ–‡ä»¶\n\n\nå¦‚æœundoä½¿ç”¨çš„å…±äº«è¡¨ç©ºé—´ï¼Œè¿™ä¸ªå…±äº«è¡¨ç©ºé—´ä¸­åˆä¸ä»…ä»…æ˜¯å­˜å‚¨äº†undoçš„ä¿¡æ¯ï¼Œå…±äº«è¡¨ç©ºé—´çš„é»˜è®¤ä¸ºä¸MySQLçš„æ•°æ®ç›®å½•ä¸‹é¢ï¼Œå…¶å±æ€§ç”±å‚æ•°innodb_data_file_pathé…ç½®ã€‚\n\n\n![](https://www.2cto.com/uploadfile/Collfiles/20180313/20180313092754206.png)\n\n\n**å…¶ä»–ï¼š**\n\n\nundoæ˜¯åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰ä¿å­˜çš„è¢«ä¿®æ”¹æ•°æ®çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œäº§ç”Ÿundoæ—¥å¿—çš„æ—¶å€™ï¼ŒåŒæ ·ä¼šä¼´éšç±»ä¼¼äºä¿æŠ¤äº‹åŠ¡æŒä¹…åŒ–æœºåˆ¶çš„redologçš„äº§ç”Ÿã€‚\n\n\né»˜è®¤æƒ…å†µä¸‹undoæ–‡ä»¶æ˜¯ä¿æŒåœ¨å…±äº«è¡¨ç©ºé—´çš„ï¼Œä¹Ÿå³ibdatafileæ–‡ä»¶ä¸­ï¼Œå½“æ•°æ®åº“ä¸­å‘ç”Ÿä¸€äº›å¤§çš„äº‹åŠ¡æ€§æ“ä½œçš„æ—¶å€™ï¼Œè¦ç”Ÿæˆå¤§é‡çš„undoä¿¡æ¯ï¼Œå…¨éƒ¨ä¿å­˜åœ¨å…±äº«è¡¨ç©ºé—´ä¸­çš„ã€‚\n\n\nå› æ­¤å…±äº«è¡¨ç©ºé—´å¯èƒ½ä¼šå˜çš„å¾ˆå¤§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯undo æ—¥å¿—ä½¿ç”¨å…±äº«è¡¨ç©ºé—´çš„æ—¶å€™ï¼Œè¢«â€œæ’‘å¤§â€çš„å…±äº«è¡¨ç©ºé—´æ˜¯ä¸ä¼šä¹Ÿä¸èƒ½è‡ªåŠ¨æ”¶ç¼©çš„ã€‚\n\n\nå› æ­¤ï¼Œmysql5.7ä¹‹åçš„â€œç‹¬ç«‹undo è¡¨ç©ºé—´â€çš„é…ç½®å°±æ˜¾å¾—å¾ˆæœ‰å¿…è¦äº†ã€‚\n\n\n### äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰\n\n\n**ä½œç”¨ï¼š**\n\n\nç”¨äºå¤åˆ¶ï¼Œåœ¨ä¸»ä»å¤åˆ¶ä¸­ï¼Œä»åº“åˆ©ç”¨ä¸»åº“ä¸Šçš„binlogè¿›è¡Œé‡æ’­ï¼Œå®ç°ä¸»ä»åŒæ­¥ã€‚\n\n\nç”¨äºæ•°æ®åº“çš„åŸºäºæ—¶é—´ç‚¹çš„è¿˜åŸã€‚\n\n\n**å†…å®¹ï¼š**\n\n\né€»è¾‘æ ¼å¼çš„æ—¥å¿—ï¼Œå¯ä»¥ç®€å•è®¤ä¸ºå°±æ˜¯æ‰§è¡Œè¿‡çš„äº‹åŠ¡ä¸­çš„sqlè¯­å¥ã€‚\n\n\nä½†åˆä¸å®Œå…¨æ˜¯sqlè¯­å¥è¿™ä¹ˆç®€å•ï¼Œè€Œæ˜¯åŒ…æ‹¬äº†æ‰§è¡Œçš„sqlè¯­å¥ï¼ˆå¢åˆ æ”¹ï¼‰åå‘çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ„å‘³ç€deleteå¯¹åº”ç€deleteæœ¬èº«å’Œå…¶åå‘çš„insertï¼›updateå¯¹åº”ç€updateæ‰§è¡Œå‰åçš„ç‰ˆæœ¬çš„ä¿¡æ¯ï¼›insertå¯¹åº”ç€deleteå’Œinsertæœ¬èº«çš„ä¿¡æ¯ã€‚\n\n\nåœ¨ä½¿ç”¨mysqlbinlogè§£æbinlogä¹‹åä¸€äº›éƒ½ä¼šçœŸç›¸å¤§ç™½ã€‚\n\n\nå› æ­¤å¯ä»¥åŸºäºbinlogåšåˆ°ç±»ä¼¼äºoracleçš„é—ªå›åŠŸèƒ½ï¼Œå…¶å®éƒ½æ˜¯ä¾èµ–äºbinlogä¸­çš„æ—¥å¿—è®°å½•ã€‚\n\n\n**ä»€ä¹ˆæ—¶å€™äº§ç”Ÿï¼š**\n\n\näº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§å°†äº‹åŠ¡ä¸­çš„sqlè¯­å¥ï¼ˆä¸€ä¸ªäº‹ç‰©å¯èƒ½å¯¹åº”å¤šä¸ªsqlè¯­å¥ï¼‰æŒ‰ç…§ä¸€å®šçš„æ ¼å¼è®°å½•åˆ°binlogä¸­ã€‚\n\n\nè¿™é‡Œä¸redo logå¾ˆæ˜æ˜¾çš„å·®å¼‚å°±æ˜¯redo logå¹¶ä¸ä¸€å®šæ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™åˆ·æ–°åˆ°ç£ç›˜ï¼Œredo logæ˜¯åœ¨äº‹åŠ¡å¼€å§‹ä¹‹åå°±å¼€å§‹é€æ­¥å†™å…¥ç£ç›˜ã€‚\n\n\nå› æ­¤å¯¹äºäº‹åŠ¡çš„æäº¤ï¼Œå³ä¾¿æ˜¯è¾ƒå¤§çš„äº‹åŠ¡ï¼Œæäº¤ï¼ˆcommitï¼‰éƒ½æ˜¯å¾ˆå¿«çš„ï¼Œä½†æ˜¯åœ¨å¼€å¯äº†bin_logçš„æƒ…å†µä¸‹ï¼Œå¯¹äºè¾ƒå¤§äº‹åŠ¡çš„æäº¤ï¼Œå¯èƒ½ä¼šå˜å¾—æ¯”è¾ƒæ…¢ä¸€äº›ã€‚\n\n\nè¿™æ˜¯å› ä¸ºbinlogæ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ä¸€æ¬¡æ€§å†™å…¥çš„é€ æˆçš„ï¼Œè¿™äº›å¯ä»¥é€šè¿‡æµ‹è¯•éªŒè¯ã€‚\n\n\n**ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ï¼š**\n\n\nbinlogçš„é»˜è®¤æ˜¯ä¿æŒæ—¶é—´ç”±å‚æ•°expire_logs_daysé…ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºéæ´»åŠ¨çš„æ—¥å¿—æ–‡ä»¶ï¼Œåœ¨ç”Ÿæˆæ—¶é—´è¶…è¿‡expire_logs_daysé…ç½®çš„å¤©æ•°ä¹‹åï¼Œä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚\n\n\n![](https://www.2cto.com/uploadfile/Collfiles/20180313/20180313092754207.png)\n\n\n**å¯¹åº”çš„ç‰©ç†æ–‡ä»¶ï¼š**\n\n\né…ç½®æ–‡ä»¶çš„è·¯å¾„ä¸ºlog_bin_basenameï¼Œbinlogæ—¥å¿—æ–‡ä»¶æŒ‰ç…§æŒ‡å®šå¤§å°ï¼Œå½“æ—¥å¿—æ–‡ä»¶è¾¾åˆ°æŒ‡å®šçš„æœ€å¤§çš„å¤§å°ä¹‹åï¼Œè¿›è¡Œæ»šåŠ¨æ›´æ–°ï¼Œç”Ÿæˆæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚\n\n\nå¯¹äºæ¯ä¸ªbinlogæ—¥å¿—æ–‡ä»¶ï¼Œé€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„indexæ–‡ä»¶æ¥ç»„ç»‡ã€‚\n\n\n![](https://www.2cto.com/uploadfile/Collfiles/20180313/20180313092754208.png)\n\n\n**å…¶ä»–ï¼š**\n\n\näºŒè¿›åˆ¶æ—¥å¿—çš„ä½œç”¨ä¹‹ä¸€æ˜¯è¿˜åŸæ•°æ®åº“çš„ï¼Œè¿™ä¸redo logå¾ˆç±»ä¼¼ï¼Œå¾ˆå¤šäººæ··æ·†è¿‡ï¼Œä½†æ˜¯ä¸¤è€…æœ‰æœ¬è´¨çš„ä¸åŒ\n\n\n**ä½œç”¨ä¸åŒ**ï¼šredo logæ˜¯ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§çš„ï¼Œæ˜¯äº‹åŠ¡å±‚é¢çš„ï¼Œbinlogä½œä¸ºè¿˜åŸçš„åŠŸèƒ½ï¼Œæ˜¯æ•°æ®åº“å±‚é¢çš„ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç²¾ç¡®åˆ°äº‹åŠ¡å±‚é¢çš„ï¼‰ï¼Œè™½ç„¶éƒ½æœ‰è¿˜åŸçš„æ„æ€ï¼Œä½†æ˜¯å…¶ä¿æŠ¤æ•°æ®çš„å±‚æ¬¡æ˜¯ä¸ä¸€æ ·çš„ã€‚\n\n\n**å†…å®¹ä¸åŒ**ï¼šredo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œæ˜¯æ•°æ®é¡µé¢çš„ä¿®æ”¹ä¹‹åçš„ç‰©ç†è®°å½•ï¼Œbinlogæ˜¯é€»è¾‘æ—¥å¿—ï¼Œå¯ä»¥ç®€å•è®¤ä¸ºè®°å½•çš„å°±æ˜¯sqlè¯­å¥\n\n\nå¦å¤–ï¼Œä¸¤è€…æ—¥å¿—äº§ç”Ÿçš„æ—¶é—´ï¼Œå¯ä»¥é‡Šæ”¾çš„æ—¶é—´ï¼Œåœ¨å¯é‡Šæ”¾çš„æƒ…å†µä¸‹æ¸…ç†æœºåˆ¶ï¼Œéƒ½æ˜¯å®Œå…¨ä¸åŒçš„ã€‚\n\n\næ¢å¤æ•°æ®æ—¶å€™çš„æ•ˆç‡ï¼ŒåŸºäºç‰©ç†æ—¥å¿—çš„redo logæ¢å¤æ•°æ®çš„æ•ˆç‡è¦é«˜äºè¯­å¥é€»è¾‘æ—¥å¿—çš„binlog\n\n\nå…³äºäº‹åŠ¡æäº¤æ—¶ï¼Œredo logå’Œbinlogçš„å†™å…¥é¡ºåºï¼Œä¸ºäº†ä¿è¯ä¸»ä»å¤åˆ¶æ—¶å€™çš„ä¸»ä»ä¸€è‡´ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬ä½¿ç”¨binlogè¿›è¡ŒåŸºäºæ—¶é—´ç‚¹è¿˜åŸçš„æƒ…å†µï¼‰ï¼Œæ˜¯è¦ä¸¥æ ¼ä¸€è‡´çš„ï¼ŒMySQLé€šè¿‡ä¸¤é˜¶æ®µæäº¤è¿‡ç¨‹æ¥å®Œæˆäº‹åŠ¡çš„ä¸€è‡´æ€§çš„ï¼Œä¹Ÿå³redo logå’Œbinlogçš„ä¸€è‡´æ€§çš„ï¼Œç†è®ºä¸Šæ˜¯å…ˆå†™redo logï¼Œå†å†™binlogï¼Œä¸¤ä¸ªæ—¥å¿—éƒ½æäº¤æˆåŠŸï¼ˆåˆ·å…¥ç£ç›˜ï¼‰ï¼Œäº‹åŠ¡æ‰ç®—çœŸæ­£çš„å®Œæˆã€‚\n\n\n### **é”™è¯¯æ—¥å¿—**\n\n\né”™è¯¯æ—¥å¿—è®°å½•ç€mysqldå¯åŠ¨å’Œåœæ­¢,ä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯çš„ç›¸å…³ä¿¡æ¯ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿè®°å½•é”™è¯¯æ—¥å¿—çš„åŠŸèƒ½æ˜¯å…³é—­çš„ï¼Œé”™è¯¯ä¿¡æ¯è¢«è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºã€‚\nã€€ã€€æŒ‡å®šæ—¥å¿—è·¯å¾„ä¸¤ç§æ–¹æ³•:\nã€€ã€€ã€€ã€€ç¼–è¾‘my.cnf å†™å…¥ log-error=[path]\nã€€ã€€ã€€ã€€é€šè¿‡å‘½ä»¤å‚æ•°é”™è¯¯æ—¥å¿— mysqld_safe â€“user=mysql â€“log-error=[path] &\n\n\næ˜¾ç¤ºé”™è¯¯æ—¥å¿—çš„å‘½ä»¤ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰\n\n\n![](https://img2018.cnblogs.com/blog/885859/201904/885859-20190418111428261-484993255.png)\n\n\n### **æ™®é€šæŸ¥è¯¢æ—¥å¿—**\n\n\nè®°å½•äº†æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¯ä¸€ä¸ªæŸ¥è¯¢æˆ–æ˜¯å‘½ä»¤ï¼Œæ— è®ºè¿™äº›æŸ¥è¯¢æˆ–æ˜¯å‘½ä»¤æ˜¯å¦æ­£ç¡®ç”šè‡³æ˜¯å¦åŒ…å«è¯­æ³•é”™è¯¯ï¼Œgeneral log éƒ½ä¼šå°†å…¶è®°å½•ä¸‹æ¥ ï¼Œè®°å½•çš„æ ¼å¼ä¸º {Time ï¼ŒId ï¼ŒCommandï¼ŒArgument }ã€‚ä¹Ÿæ­£å› ä¸ºmysqlæœåŠ¡å™¨éœ€è¦ä¸æ–­åœ°è®°å½•æ—¥å¿—ï¼Œå¼€å¯General logä¼šäº§ç”Ÿä¸å°çš„ç³»ç»Ÿå¼€é”€ã€‚ å› æ­¤ï¼ŒMysqlé»˜è®¤æ˜¯æŠŠGeneral logå…³é—­çš„ã€‚\n\n\næŸ¥çœ‹æ—¥å¿—çš„å­˜æ”¾æ–¹å¼ï¼šshow variables like â€˜log_outputâ€™;\n\n\n![](https://blog-file.hehouhui.cn/885859-20190418111501042-772781517.png)\n\n\nå¦‚æœè®¾ç½®mysql> set global log_output=â€™tableâ€™ çš„è¯ï¼Œåˆ™æ—¥å¿—ç»“æœä¼šè®°å½•åˆ°åä¸ºgengera_logçš„è¡¨ä¸­ï¼Œè¿™è¡¨çš„é»˜è®¤å¼•æ“éƒ½æ˜¯CSV\nã€€ã€€å¦‚æœè®¾ç½®è¡¨æ•°æ®åˆ°æ–‡ä»¶set global log_output=file;\nã€€ã€€è®¾ç½®general logçš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š\nã€€ã€€ã€€ã€€set global general_log_file=â€™/tmp/general.logâ€™;\nã€€ã€€ã€€ã€€å¼€å¯general logï¼š set global general_log=on;\nã€€ã€€ã€€ã€€å…³é—­general logï¼š set global general_log=off;\n\n\n![](https://blog-file.hehouhui.cn/885859-20190418111501042-772781517-1645409187723.png)\n\n\nç„¶ååœ¨ç”¨ï¼šshow global variables like â€˜general_logâ€™\n\n\n![](https://blog-file.hehouhui.cn/885859-20190418111551171-1738333923.png)\n\n\n### æ…¢æŸ¥è¯¢æ—¥å¿—\n\n\næ…¢æ—¥å¿—è®°å½•æ‰§è¡Œæ—¶é—´è¿‡é•¿å’Œæ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢è¯­å¥ï¼ŒæŠ¥é”™selectã€updateã€deleteä»¥åŠinsertè¯­å¥ï¼Œæ…¢æ—¥å¿—åªä¼šè®°å½•æ‰§è¡ŒæˆåŠŸçš„è¯­å¥ã€‚\nã€€ã€€1. æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¶é—´ï¼š\nã€€ã€€show variables like â€œlong_query_timeâ€;é»˜è®¤10s\n\n\n![](9)\n\n\n2. æŸ¥çœ‹æ…¢æŸ¥è¯¢é…ç½®æƒ…å†µï¼š\nã€€ã€€show status like â€œ%slow_queries%â€;\n\n\n![](https://blog-file.hehouhui.cn/885859-20190418111656450-521011638.png)\n\n\n3. æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—è·¯å¾„ï¼š\nã€€ã€€show variables like â€œ%slow%â€;\n\n\n![](https://blog-file.hehouhui.cn/885859-20190418111712973-766266117.png)\n\n\n4. å¼€å¯æ…¢æ—¥å¿—\n\n\n![](https://blog-file.hehouhui.cn/885859-20190418111737882-1420825238.png)\n\n\næŸ¥çœ‹å·²ç»å¼€å¯ï¼š\n\n\n![](https://blog-file.hehouhui.cn/885859-20190418111753391-1884429309.png)\n\n\n## ä¼˜åŒ–\n\n\n### å¤§è¡¨ä¼˜åŒ–\n\n\n> å½“MySQLå•è¡¨è®°å½•æ•°è¿‡å¤§æ—¶ï¼Œæ•°æ®åº“çš„CRUDæ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ï¼Œä¸€äº›å¸¸è§çš„ä¼˜åŒ–æªæ–½å¦‚ä¸‹ï¼š\n\n\n### [1. é™å®šæ•°æ®çš„èŒƒå›´](https://snailclimb.gitee.io/javaguide/#/docs/database/MySQL?id=_1-%E9%99%90%E5%AE%9A%E6%95%B0%E6%8D%AE%E7%9A%84%E8%8C%83%E5%9B%B4)\n\n\nåŠ¡å¿…ç¦æ­¢ä¸å¸¦ä»»ä½•é™åˆ¶æ•°æ®èŒƒå›´æ¡ä»¶çš„æŸ¥è¯¢è¯­å¥ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬å½“ç”¨æˆ·åœ¨æŸ¥è¯¢è®¢å•å†å²çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶åœ¨ä¸€ä¸ªæœˆçš„èŒƒå›´å†…ï¼›\n\n\n### [2. è¯»/å†™åˆ†ç¦»](https://snailclimb.gitee.io/javaguide/#/docs/database/MySQL?id=_2-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB)\n\n\nç»å…¸çš„æ•°æ®åº“æ‹†åˆ†æ–¹æ¡ˆï¼Œä¸»åº“è´Ÿè´£å†™ï¼Œä»åº“è´Ÿè´£è¯»ï¼›\n\n\n### [3. å‚ç›´åˆ†åŒº](https://snailclimb.gitee.io/javaguide/#/docs/database/MySQL?id=_3-%E5%9E%82%E7%9B%B4%E5%88%86%E5%8C%BA)\n\n\n**æ ¹æ®æ•°æ®åº“é‡Œé¢æ•°æ®è¡¨çš„ç›¸å…³æ€§è¿›è¡Œæ‹†åˆ†ã€‚** ä¾‹å¦‚ï¼Œç”¨æˆ·è¡¨ä¸­æ—¢æœ‰ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯åˆæœ‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¯ä»¥å°†ç”¨æˆ·è¡¨æ‹†åˆ†æˆä¸¤ä¸ªå•ç‹¬çš„è¡¨ï¼Œç”šè‡³æ”¾åˆ°å•ç‹¬çš„åº“åšåˆ†åº“ã€‚\n\n\n**ç®€å•æ¥è¯´å‚ç›´æ‹†åˆ†æ˜¯æŒ‡æ•°æ®è¡¨åˆ—çš„æ‹†åˆ†ï¼ŒæŠŠä¸€å¼ åˆ—æ¯”è¾ƒå¤šçš„è¡¨æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ã€‚**\n\n\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ ·æ¥è¯´å¤§å®¶åº”è¯¥å°±æ›´å®¹æ˜“ç†è§£äº†ã€‚\n\n\n![](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9E%82%E7%9B%B4%E5%88%86%E5%8C%BA.png)\n\n- **å‚ç›´æ‹†åˆ†çš„ä¼˜ç‚¹ï¼š** å¯ä»¥ä½¿å¾—åˆ—æ•°æ®å˜å°ï¼Œåœ¨æŸ¥è¯¢æ—¶å‡å°‘è¯»å–çš„Blockæ•°ï¼Œå‡å°‘I/Oæ¬¡æ•°ã€‚æ­¤å¤–ï¼Œå‚ç›´åˆ†åŒºå¯ä»¥ç®€åŒ–è¡¨çš„ç»“æ„ï¼Œæ˜“äºç»´æŠ¤ã€‚\n- **å‚ç›´æ‹†åˆ†çš„ç¼ºç‚¹ï¼š** ä¸»é”®ä¼šå‡ºç°å†—ä½™ï¼Œéœ€è¦ç®¡ç†å†—ä½™åˆ—ï¼Œå¹¶ä¼šå¼•èµ·Joinæ“ä½œï¼Œå¯ä»¥é€šè¿‡åœ¨åº”ç”¨å±‚è¿›è¡ŒJoinæ¥è§£å†³ã€‚æ­¤å¤–ï¼Œå‚ç›´åˆ†åŒºä¼šè®©äº‹åŠ¡å˜å¾—æ›´åŠ å¤æ‚ï¼›\n\n### [4. æ°´å¹³åˆ†åŒº](https://snailclimb.gitee.io/javaguide/#/docs/database/MySQL?id=_4-%E6%B0%B4%E5%B9%B3%E5%88%86%E5%8C%BA)\n\n\n**ä¿æŒæ•°æ®è¡¨ç»“æ„ä¸å˜ï¼Œé€šè¿‡æŸç§ç­–ç•¥å­˜å‚¨æ•°æ®åˆ†ç‰‡ã€‚è¿™æ ·æ¯ä¸€ç‰‡æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„è¡¨æˆ–è€…åº“ä¸­ï¼Œè¾¾åˆ°äº†åˆ†å¸ƒå¼çš„ç›®çš„ã€‚ æ°´å¹³æ‹†åˆ†å¯ä»¥æ”¯æ’‘éå¸¸å¤§çš„æ•°æ®é‡ã€‚**\n\n\næ°´å¹³æ‹†åˆ†æ˜¯æŒ‡æ•°æ®è¡¨è¡Œçš„æ‹†åˆ†ï¼Œè¡¨çš„è¡Œæ•°è¶…è¿‡200ä¸‡è¡Œæ—¶ï¼Œå°±ä¼šå˜æ…¢ï¼Œè¿™æ—¶å¯ä»¥æŠŠä¸€å¼ çš„è¡¨çš„æ•°æ®æ‹†æˆå¤šå¼ è¡¨æ¥å­˜æ”¾ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯è¡¨æ‹†åˆ†æˆå¤šä¸ªç”¨æˆ·ä¿¡æ¯è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§å¯¹æ€§èƒ½é€ æˆå½±å“ã€‚\n\n\n![](https://blog-file.hehouhui.cn/20220221101205.png)\n\n\næ°´å¹³æ‹†åˆ†å¯ä»¥æ”¯æŒéå¸¸å¤§çš„æ•°æ®é‡ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šåˆ†è¡¨ä»…ä»…æ˜¯è§£å†³äº†å•ä¸€è¡¨æ•°æ®è¿‡å¤§çš„é—®é¢˜ï¼Œä½†ç”±äºè¡¨çš„æ•°æ®è¿˜æ˜¯åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå…¶å®å¯¹äºæå‡MySQLå¹¶å‘èƒ½åŠ›æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œæ‰€ä»¥ **æ°´å¹³æ‹†åˆ†æœ€å¥½åˆ†åº“** ã€‚\n\n\næ°´å¹³æ‹†åˆ†èƒ½å¤Ÿ **æ”¯æŒéå¸¸å¤§çš„æ•°æ®é‡å­˜å‚¨ï¼Œåº”ç”¨ç«¯æ”¹é€ ä¹Ÿå°‘**ï¼Œä½† **åˆ†ç‰‡äº‹åŠ¡éš¾ä»¥è§£å†³** ï¼Œè·¨èŠ‚ç‚¹Joinæ€§èƒ½è¾ƒå·®ï¼Œé€»è¾‘å¤æ‚ã€‚ã€ŠJavaå·¥ç¨‹å¸ˆä¿®ç‚¼ä¹‹é“ã€‹çš„ä½œè€…æ¨è **å°½é‡ä¸è¦å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå› ä¸ºæ‹†åˆ†ä¼šå¸¦æ¥é€»è¾‘ã€éƒ¨ç½²ã€è¿ç»´çš„å„ç§å¤æ‚åº¦** ï¼Œä¸€èˆ¬çš„æ•°æ®è¡¨åœ¨ä¼˜åŒ–å¾—å½“çš„æƒ…å†µä¸‹æ”¯æ’‘åƒä¸‡ä»¥ä¸‹çš„æ•°æ®é‡æ˜¯æ²¡æœ‰å¤ªå¤§é—®é¢˜çš„ã€‚å¦‚æœå®åœ¨è¦åˆ†ç‰‡ï¼Œå°½é‡é€‰æ‹©å®¢æˆ·ç«¯åˆ†ç‰‡æ¶æ„ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸€æ¬¡å’Œä¸­é—´ä»¶çš„ç½‘ç»œI/Oã€‚\n\n\n**è¡¥å……ä¸€ä¸‹æ•°æ®åº“åˆ†ç‰‡çš„ä¸¤ç§å¸¸è§æ–¹æ¡ˆï¼š**\n\n- **å®¢æˆ·ç«¯ä»£ç†ï¼š** **åˆ†ç‰‡é€»è¾‘åœ¨åº”ç”¨ç«¯ï¼Œå°è£…åœ¨jaråŒ…ä¸­ï¼Œé€šè¿‡ä¿®æ”¹æˆ–è€…å°è£…JDBCå±‚æ¥å®ç°ã€‚** å½“å½“ç½‘çš„ **Sharding-JDBC** ã€é˜¿é‡Œçš„TDDLæ˜¯ä¸¤ç§æ¯”è¾ƒå¸¸ç”¨çš„å®ç°ã€‚\n- **ä¸­é—´ä»¶ä»£ç†ï¼š** **åœ¨åº”ç”¨å’Œæ•°æ®ä¸­é—´åŠ äº†ä¸€ä¸ªä»£ç†å±‚ã€‚åˆ†ç‰‡é€»è¾‘ç»Ÿä¸€ç»´æŠ¤åœ¨ä¸­é—´ä»¶æœåŠ¡ä¸­ã€‚** æˆ‘ä»¬ç°åœ¨è°ˆçš„ **Mycat** ã€360çš„Atlasã€ç½‘æ˜“çš„DDBç­‰ç­‰éƒ½æ˜¯è¿™ç§æ¶æ„çš„å®ç°ã€‚\n",
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-02-21",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "38",
        "catalog": [
          "archives"
        ],
        "tags": [
          "mysql"
        ],
        "summary": "Mysqlæ•°æ®åº“å­˜å‚¨å¼•æ“MyISAMå¼•æ“ ä¸æ”¯æŒäº‹åŠ¡æ”¯æŒè¡¨çº§é”ï¼ˆMySqlæ”¯æŒä¸¤ç§è¡¨çº§é”ï¼Œè¡¨å…±äº«è¯»é”å’Œè¡¨ç‹¬å å†™é”ï¼‰ï¼Œä½†ä¸æ”¯æŒè¡Œçº§é”å­˜å‚¨è¡¨çš„æ€»è¡Œæ•°ä¸€ä¸ªMyISAMè¡¨æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼šç´¢å¼•æ–‡ä»¶ï¼ˆ.MYI",
        "sort": "",
        "title": "Mysqlæ•°æ®ç»“æ„&é”",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "catalog": [
        {
          "title": "archives",
          "doc_id": "397d5281-9f11-4c6f-8430-399176cc403d"
        }
      ],
      "body": "",
      "realName": "Mysqlæ•°æ®ç»“æ„&é”",
      "relativePath": "/archives/Mysqlæ•°æ®ç»“æ„&é”.md"
    }
  ],
  "catalog": [
    {
      "object": "page",
      "id": "f8b19b63-1f95-492f-afb0-70b7d69ca735",
      "created_time": "2023-09-15T07:15:00.000Z",
      "last_edited_time": "2023-10-08T06:40:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151532992.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-09-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "spring-boot-tenant-202309",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "å¾®æœåŠ¡",
          "SAAS"
        ],
        "summary": "å¸¸è§çš„æŠ€æœ¯é€‰æ‹©åŒ…æ‹¬ï¼š\nâ€¢ æ•°æ®åº“çº§å¤šç§Ÿæˆ·ï¼šä½¿ç”¨å¤šä¸ªæ•°æ®åº“å®ä¾‹åˆ†åˆ«å­˜å‚¨å„ä¸ªç§Ÿæˆ·çš„æ•°æ®ï¼Œæ¯ä¸ªç§Ÿæˆ·å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“ã€‚\nâ€¢ æ¨¡å¼çº§å¤šç§Ÿæˆ·ï¼šä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“å®ä¾‹ï¼Œä½†æ˜¯ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ›å»ºç‹¬ç«‹çš„æ•°æ®åº“æ¨¡å¼ï¼Œå®ç°æ•°æ®éš”ç¦»ã€‚\nâ€¢ è¡¨çº§å¤šç§Ÿæˆ·ï¼šåœ¨åŒä¸€ä¸ªæ•°æ®åº“æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ä¸åŒçš„è¡¨æ¥å­˜å‚¨å„ä¸ªç§Ÿæˆ·çš„æ•°æ®ï¼Œå®ç°æ•°æ®éš”ç¦»ã€‚\nâ€¢ åº”ç”¨çº§å¤šç§Ÿæˆ·ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­å®ç°ç§Ÿæˆ·éš”ç¦»ï¼Œä¾‹å¦‚ä½¿ç”¨Spring Cloudç­‰å¾®æœåŠ¡æ¡†æ¶ã€‚\nâ€¢ å®¹å™¨çº§å¤šç§Ÿæˆ·ï¼šä½¿ç”¨å®¹å™¨æŠ€æœ¯ï¼Œä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ›å»ºç‹¬ç«‹çš„å®¹å™¨ï¼Œå®ç°èµ„æºéš”ç¦»å’Œæ§åˆ¶ã€‚\n4 å®ç°å¤šç§Ÿæˆ·æ¶æ„çš„æ³¨æ„äº‹é¡¹\nâ€¢ ä¿è¯ç§Ÿæˆ·æ•°æ®çš„éš”ç¦»æ€§å’Œå®‰å…¨æ€§ã€‚\nâ€¢ è®¾è®¡åˆç†çš„ç§Ÿæˆ·æ•°æ®ç»“æ„å’Œå…³ç³»æ¨¡å‹ã€‚\nâ€¢ ç»Ÿä¸€ç®¡ç†ç§Ÿæˆ·çš„é…ç½®å’Œæƒé™ã€‚\nâ€¢ ä¿è¯ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ä¼¸ç¼©æ€§ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•ã€‚\nâ€¢ ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚\nâ€¢ å¯¹ç§Ÿæˆ·æ•°æ®è¿›è¡Œå¤‡ä»½å’Œæ¢å¤ï¼Œä¿è¯æ•°æ®çš„å¯é æ€§å’Œå®Œæ•´æ€§ã€‚",
        "sort": "",
        "title": "Spring Boot å®ç°å¤šç§Ÿæˆ·æ¶æ„ï¼šæ”¯æŒåº”ç”¨å¤šç§Ÿæˆ·éƒ¨ç½²å’Œç®¡ç†",
        "status": "Published",
        "updated": "2023-10-08 14:40:00"
      },
      "url": "https://www.notion.so/Spring-Boot-f8b19b631f95492fafb070b7d69ca735",
      "public_url": "https://honesty-blog.notion.site/Spring-Boot-f8b19b631f95492fafb070b7d69ca735"
    },
    {
      "object": "page",
      "id": "3a5d9238-0fa8-4154-a6d5-92340f2ad733",
      "created_time": "2023-09-15T04:10:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202309151218999.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-09-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "springcloud-data-202309",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "å¾®æœåŠ¡"
        ],
        "summary": "å¾®æœåŠ¡ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†æˆ‘ä»¬ç¨‹åºæ‹†åˆ†ä¸ºæœ€å°åŒ–å•å…ƒæ¥æä¾›æœåŠ¡ã€‚åœ¨ä¸€ä½“åŒ–ç³»ç»Ÿä¸­ï¼Œå„ä¸ªå¾®æœåŠ¡ä¹Ÿæ˜¯ä¸å¯èƒ½ç‹¬ç«‹å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå¾®æœåŠ¡ä¹‹é—´æ¶‰åŠåˆ°çš„æ•°æ®ä¾èµ–é—®é¢˜ï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬ä»åœºæ™¯å…¥æ‰‹æ¥åˆ†æè€ƒè™‘æ­¤ç±»é—®é¢˜ã€‚",
        "sort": "",
        "title": "å¾®æœåŠ¡ä¹‹é—´çš„æ•°æ®ä¾èµ–é—®é¢˜ï¼Œè¯¥å¦‚ä½•è§£å†³ï¼Ÿ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/3a5d92380fa84154a6d592340f2ad733",
      "public_url": "https://honesty-blog.notion.site/3a5d92380fa84154a6d592340f2ad733"
    },
    {
      "object": "page",
      "id": "28f5e6a0-2d06-439d-b947-b7121480c146",
      "created_time": "2023-09-12T07:52:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202309121610208.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-09-12",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "redis-key-202309",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Redis"
        ],
        "summary": "åšä¸€äº›Cç«¯ä¸šåŠ¡ï¼Œä¸å¯é¿å…çš„è¦å¼•å…¥ä¸€çº§ç¼“å­˜æ¥ä»£æ›¿æ•°æ®åº“çš„å‹åŠ›å¹¶ä¸”å‡å°‘ä¸šåŠ¡å“åº”æ—¶é—´ï¼Œå…¶å®æ¯æ¬¡å¼•å…¥ä¸€ä¸ªä¸­é—´ä»¶æ¥è§£å†³é—®é¢˜çš„åŒæ—¶ï¼Œå¿…ç„¶ä¼šå¸¦æ¥å¾ˆå¤šæ–°çš„é—®é¢˜éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚\né‚£ä¹ˆå…¶å®è¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–é—®é¢˜æ¯”å¦‚ä½¿ç”¨Redisä½œä¸ºä¸€çº§ç¼“å­˜æ—¶å¯èƒ½å¸¦æ¥çš„çƒ­keyã€å¤§keyç­‰é—®é¢˜ï¼Œæœ¬æ–‡æˆ‘ä»¬å°±çƒ­keyï¼ˆhot keyï¼‰é—®é¢˜æ¥è®¨è®ºï¼Œå¦‚ä½•åˆç†çš„è§£å†³çƒ­keyé—®é¢˜ã€‚",
        "sort": "",
        "title": "Redis çƒ­keyæ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•å¯¼è‡´çš„ï¼Ÿæœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Ÿ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Redis-key-28f5e6a02d06439db947b7121480c146",
      "public_url": "https://honesty-blog.notion.site/Redis-key-28f5e6a02d06439db947b7121480c146"
    },
    {
      "object": "page",
      "id": "121dcfb7-7028-42d1-998e-b81fe6e0d870",
      "created_time": "2023-09-06T09:02:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://source.unsplash.com/random/720x480/?encryption"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "â„¢ï¸"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-09-06",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "spring-restclient-2023",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "Java"
        ],
        "summary": "Spring æ¡†æ¶ä¸€ç›´æä¾›äº†ä¸¤ç§ä¸åŒçš„å®¢æˆ·ç«¯æ¥æ‰§è¡Œ http è¯·æ±‚:\nâ€¢ RestTemplate: å®ƒåœ¨ Spring 3 ä¸­è¢«å¼•å…¥ï¼Œæä¾›åŒæ­¥çš„é˜»å¡å¼é€šä¿¡ã€‚\nâ€¢ WebClient: å®ƒåœ¨ Spring 5 çš„ Spring WebFlux åº“ä¸­ä½œä¸ºä¸€éƒ¨åˆ†è¢«å‘å¸ƒã€‚å®ƒæä¾›äº†æµå¼ API,éµå¾ªå“åº”å¼æ¨¡å‹ã€‚\nRestTemplate çš„æ–¹æ³•æš´éœ²äº†å¤ªå¤šçš„ HTTP ç‰¹æ€§,å¯¼è‡´äº†å¤§é‡é‡è½½çš„æ–¹æ³•ï¼Œä½¿ç”¨æˆæœ¬è¾ƒé«˜ã€‚WebClient æ˜¯ RestTemplate çš„æ›¿ä»£å“,æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨ã€‚å®ƒæ˜¯ Spring Web Reactive é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚\nç°åœ¨ Spring 6.1 M1 ç‰ˆæœ¬å¼•å…¥äº† RestClientã€‚ä¸€ä¸ªæ–°çš„åŒæ­¥ http å®¢æˆ·ç«¯,å…¶å·¥ä½œæ–¹å¼ä¸ WebClient ç±»ä¼¼,ä½¿ç”¨ä¸ RestTemplate ç›¸åŒçš„åŸºç¡€è®¾æ–½ã€‚",
        "sort": "",
        "title": "HttpClient? RestTemplateï¼ŸWebClient? ä¸~æ˜¯ RestClient",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/HttpClient-RestTemplate-WebClient-RestClient-121dcfb7702842d1998eb81fe6e0d870",
      "public_url": "https://honesty-blog.notion.site/HttpClient-RestTemplate-WebClient-RestClient-121dcfb7702842d1998eb81fe6e0d870"
    },
    {
      "object": "page",
      "id": "613b560e-75d7-4f45-88e9-b487310cfe82",
      "created_time": "2023-06-02T07:11:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202306021513432.png"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "â˜•"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-06-02",
        "type": "Post",
        "category": "ç¢ç‰‡æ‚æ–‡",
        "urlname": "lkcoffee-shanghai-coffee-activities-20230602",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å’–å•¡",
          "æ•´æ´»",
          "æŠ€æœ¯æµ"
        ],
        "summary": "æœ€è¿‘ç‘å¹¸åœ¨ææ´»åŠ¨ï¼Œæ¯å¤©å…è´¹é€10000ä»½å’–å•¡ï¼Œæˆ‘æ˜¯ä¸ªç‹‚çƒ­å–å’–å•¡çš„äººå„¿ï¼Œä»Šå¤©æœ€åä¸€å¤©æ¥æ•´ä¸ªæ´»å„¿ï¼Œç‚¹å¼€ç‘å¹¸å’–å•¡å°ç¨‹åºä¸»é¡µï¼Œbanner æ è½®æ’­å›¾ä¸­æœ‰ä¸€å¼ æµ·æŠ¥å…¥å£ï¼Œæ“ä½œä¸€é€šä¸‹æ¥ï¼Œæœç„¶ï¼Œæ²¡æŠ¢åˆ°ã€‚\næ‰‹é€Ÿä¸å¤Ÿå¿«ä¸æ˜¯ä¸»è¦åŸå› ï¼Œæ‰‹æŒ‡æ“ä½œå»¶è¿Ÿ + ç³»ç»Ÿé¡µé¢è·³è½¬è€—æ—¶åŠ èµ·æ¥åˆ° http å‘å‡ºå°±å·²ç»è€½è¯¯äº†1 -2 ç§’é’Ÿäº†ï¼Œè¿™ä¸ªæ—¶é—´æ‰æ˜¯å…³é”®ï¼Œæœ¬æ–‡ä»æŠ€æœ¯è§’åº¦æ¢è®¨ä¸‹æ€ä¹ˆåœ¨æœ€å°æˆæœ¬æ¯”å¦‚å‡ åˆ†é’Ÿå†…ï¼Œå®ç°ä¸€ä¸ªå°å·¥å…·ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚",
        "sort": "",
        "title": "ä¸Šæµ·å’–å•¡æ–‡åŒ–å‘¨ä¹‹è–…ç‘å¹¸ç¾Šæ¯›",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/613b560e75d74f4588e9b487310cfe82",
      "public_url": "https://honesty-blog.notion.site/613b560e75d74f4588e9b487310cfe82"
    },
    {
      "object": "page",
      "id": "d8051be9-7bd7-4b59-a482-f05b9fb15699",
      "created_time": "2023-05-23T04:03:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://plus.hutool.cn/images/logo.jpg"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-05-23",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "hutool-beanutil-error",
        "catalog": [
          "archives"
        ],
        "tags": [
          "BUG",
          "Java",
          "hutool"
        ],
        "summary": "Hutoolæ˜¯ä¸€ä¸ªå°è€Œå…¨çš„Javaå·¥å…·ç±»åº“ï¼Œé€šè¿‡é™æ€æ–¹æ³•å°è£…ï¼Œé™ä½ç›¸å…³APIçš„å­¦ä¹ æˆæœ¬ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œä½¿Javaæ‹¥æœ‰å‡½æ•°å¼è¯­è¨€èˆ¬çš„ä¼˜é›…ï¼Œè®©Javaè¯­è¨€ä¹Ÿå¯ä»¥â€œç”œç”œçš„â€ã€‚ JavaBeanæ˜¯ä¸€ä¸ªæ‹¥æœ‰å¯¹å±æ€§è¿›è¡Œsetå’Œgetæ–¹æ³•çš„ç±»ã€‚å®ƒå¯ä»¥è¢«ç®€å•åœ°å®šä¹‰ä¸ºåŒ…å«setXXXå’ŒgetXXXæ–¹æ³•çš„å¯¹è±¡ã€‚åœ¨Hutoolä¸­ï¼Œåˆ¤å®šBeançš„æ–¹æ³•ä¸ºï¼šæ˜¯å¦å­˜åœ¨åªæœ‰ä¸€ä¸ªå‚æ•°çš„setXXXæ–¹æ³•ã€‚Beanå·¥å…·ç±»ä¸»è¦æ“ä½œsetXXXå’ŒgetXXXæ–¹æ³•ï¼Œå¦‚å°†Beanå¯¹è±¡è½¬ä¸ºMapç­‰ã€‚",
        "sort": "",
        "title": "Hutool 5.8.8  BeanUtil.copyProperties è‡´å‘½å¼‚å¸¸",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Hutool-5-8-8-BeanUtil-copyProperties-d8051be97bd74b59a482f05b9fb15699",
      "public_url": "https://honesty-blog.notion.site/Hutool-5-8-8-BeanUtil-copyProperties-d8051be97bd74b59a482f05b9fb15699"
    },
    {
      "object": "page",
      "id": "50c530fc-8d3c-4f6b-9956-3be2602e1be8",
      "created_time": "2023-04-28T05:50:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://static.effie.co/blog/2021/05/20210524053542357-1024x796.png?x-oss-process=image/auto-orient,1/quality,q_90/format,webp"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "âœï¸"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-21",
        "type": "Post",
        "category": "å­¦ä¹ æ€è€ƒ",
        "urlname": "efficient-learning-methods-pq4r",
        "catalog": [
          "archives"
        ],
        "tags": [
          "æ–‡å­—",
          "æ€è€ƒ",
          "å­¦ä¹ "
        ],
        "summary": "åœ¨ 21 ä¸–çºªçš„ä»Šå¤©ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½è¦é¢ä¸´å¤§é‡çš„çŸ¥è¯†å’Œä¿¡æ¯ã€‚æˆ‘ä»¬æ¯ä¸ªäººéƒ½éœ€è¦ä¸æ–­å­¦ä¹ æ–°çŸ¥è¯†ã€æ–°æ€æƒ³å’Œè¿›è¡Œæ–°çš„å®è·µã€‚\nè¿™æ„å‘³ç€ï¼Œå­¦ä¹ ä¸å†æ˜¯å­¦ç”Ÿé˜¶æ®µæ‰éœ€è¦åšçš„äº‹æƒ…ï¼Œç»ˆèº«æ•™è‚²åº”è¯¥æˆä¸ºæˆ‘ä»¬å·¥ä½œå’Œç”Ÿæ´»çš„æœ‰æœºç»„æˆéƒ¨åˆ†ã€‚\nåœ¨è‡ªæˆ‘å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šäººéƒ½ä¼šå°è¯•å¯»æ‰¾é«˜æ•ˆçš„å­¦ä¹ æ–¹æ³•ï¼Œä»¥ä¾¿æå‡è‡ªå·±çš„å­¦ä¹ èƒ½åŠ›å’Œå­¦ä¹ æ•ˆç‡ã€‚\næ¥ä¸‹æ¥æˆ‘åˆ†äº«çš„å­¦ä¹ æ–¹æ³•ï¼Œä¸ä»…æ˜¯æˆ‘è‡ªå·±åˆ‡èº«å®è·µæœ‰æ•ˆï¼Œä¹Ÿæœ‰ç§‘å­¦ä¾æ®ä½œä¸ºæ”¯æ’‘ã€‚",
        "sort": "",
        "title": "ä½ æœ‰ä»€ä¹ˆå€¼å¾—åˆ†äº«çš„é«˜æ•ˆå­¦ä¹ æ–¹æ³•ï¼Ÿ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/50c530fc8d3c4f6b99563be2602e1be8",
      "public_url": "https://honesty-blog.notion.site/50c530fc8d3c4f6b99563be2602e1be8"
    },
    {
      "object": "page",
      "id": "8900fb84-5f49-4f66-a5fa-fd34b7fd832a",
      "created_time": "2023-04-28T05:45:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://static.effie.co/blog/2021/08/20210816143032448-1024x512.png?x-oss-process=image/auto-orient,1/quality,q_90/format,webp"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "ğŸ“–"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-25",
        "type": "Post",
        "category": "å­¦ä¹ æ€è€ƒ",
        "urlname": "active-reading-becoming-better-reader",
        "catalog": [
          "archives"
        ],
        "tags": [
          "æ–‡å­—",
          "æ€è€ƒ",
          "å­¦ä¹ "
        ],
        "summary": "ä¸»åŠ¨é˜…è¯»æ˜¯ä¸€ç§ç§¯æã€æ·±å…¥çš„é˜…è¯»æ–¹å¼ï¼Œå®ƒéœ€è¦è¯»è€…åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åˆ©ç”¨å¤šç§ç­–ç•¥ï¼Œå¦‚æé—®ã€æ¦‚æ‹¬ã€ç¬”è®°ã€æ¨ç†ç­‰ï¼Œä¸ä»…ç†è§£æ–‡å­—è¡¨æ„ï¼Œè¿˜è¦åŠ æ·±å¯¹å…¶èƒŒåæ¶µä¹‰çš„ç†è§£å’Œè®°å¿†ï¼ŒåŒæ—¶ï¼Œå°†è‡ªå·±çš„ç»éªŒå’ŒçŸ¥è¯†è¿ç”¨åˆ°é˜…è¯»ä¸­å»ï¼Œä»¥è¾¾åˆ°æ›´å¥½çš„é˜…è¯»æ•ˆæœã€‚ä¸»åŠ¨é˜…è¯»èƒ½å¤Ÿæé«˜æˆ‘ä»¬çš„é˜…è¯»èƒ½åŠ›å’Œæ€ç»´æ°´å¹³ï¼ŒåŸ¹å…»æˆ‘ä»¬æ‰¹åˆ¤æ€§åœ°æ€è€ƒå’Œåˆ†æé—®é¢˜çš„èƒ½åŠ›ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°æŒæ¡çŸ¥è¯†å’Œä¿¡æ¯ã€‚",
        "sort": "",
        "title": "ä¸»åŠ¨é˜…è¯»ï¼šæˆä¸ºæ›´å¥½çš„é˜…è¯»è€…",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/8900fb845f494f66a5fafd34b7fd832a",
      "public_url": "https://honesty-blog.notion.site/8900fb845f494f66a5fafd34b7fd832a"
    },
    {
      "object": "page",
      "id": "3a77d2b4-f1df-48cc-bdc1-3192e46e674c",
      "created_time": "2023-04-28T05:26:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://developers.redhat.com/sites/default/files/styles/article_feature/public/blog/2019/12/keycloak10.png?itok=-ExiELH9"
        }
      },
      "icon": {
        "type": "external",
        "external": {
          "url": "https://www.notion.so/icons/lock-keyhole_blue.svg"
        }
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-28",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "api-login-and-jwt-token-generation-using-keycloak",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å¼€å‘",
          "å»ºç«™",
          "Java",
          "keycloak",
          "oauth"
        ],
        "summary": "Red Hat SSO (æˆ–Keycloak)æ˜¯é¢†å…ˆçš„Web SSOäº§å“ä¹‹ä¸€ï¼Œæ”¯æŒSAML 2.0ã€OpenID Connectå’ŒOAuth 2.0ç­‰æ ‡å‡†ï¼Œå¼ºå¤§ä¹‹å¤„åœ¨äºå¯é€šè¿‡å¤šç§æ–¹å¼ç›´æ¥è®¿é—®Keycloakï¼ŒåŒ…æ‹¬APIè°ƒç”¨ç”Ÿæˆå’ŒéªŒè¯JWTä»¤ç‰Œã€‚æ“ä½œä»…é™APIè°ƒç”¨ï¼Œæ— éœ€æš´éœ²Keycloakçš„UIç»™å…¬ä¼—ã€‚",
        "sort": "",
        "title": "ä½¿ç”¨ Keycloak çš„ API ç™»å½•å’Œ JWT ä»¤ç‰Œç”Ÿæˆ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Keycloak-API-JWT-3a77d2b4f1df48ccbdc13192e46e674c",
      "public_url": "https://honesty-blog.notion.site/Keycloak-API-JWT-3a77d2b4f1df48ccbdc13192e46e674c"
    },
    {
      "object": "page",
      "id": "7d7311ba-8ed2-4a90-91ac-5d2b4a503c4c",
      "created_time": "2023-04-28T05:06:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://www.keycloak.org/docs/latest/authorization_services/images/getting-started/hello-world/create-realm.png"
        }
      },
      "icon": {
        "type": "external",
        "external": {
          "url": "https://www.notion.so/icons/lock-keyhole_blue.svg"
        }
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-28T13:13:00.000+08:00",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "authentication-and-authorization-using-the-keycloak-rest-api",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å¼€å‘",
          "å»ºç«™",
          "Java",
          "oauth",
          "keycloak"
        ],
        "summary": "Keycloak REST API å¯ä»¥è¢«ç”¨æ¥è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚ä½¿ç”¨è¯¥APIï¼Œå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°åœ¨å…¶åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨æ€§éªŒè¯å’ŒæˆæƒåŠŸèƒ½ï¼ŒåŒæ—¶ä½¿ç”¨Keycloakçš„å†…ç½®åŠŸèƒ½è¿›è¡Œç®¡ç†å’Œé…ç½®ã€‚Keycloakçš„REST APIè¿˜æä¾›äº†è®¸å¤šä¸åŒçš„ç»ˆç«¯ç‚¹æ¥è¿›è¡Œç”¨æˆ·å’Œè§’è‰²ç®¡ç†ã€è®¤è¯äº‹ä»¶å’ŒSAMLå…ƒæ•°æ®çš„è®¿é—®ç­‰ã€‚ ä½œä¸ºä¸€ä¸ªåŸºäºå¼€æºçš„èº«ä»½å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ŒKeycloakçš„REST APIå¯¹äºä»»ä½•éœ€è¦å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œè®¤è¯å’Œæˆæƒçš„å¼€å‘äººå‘˜éƒ½éå¸¸æœ‰å¸®åŠ©ã€‚",
        "sort": "",
        "title": "ä½¿ç”¨ Keycloak REST API è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Keycloak-REST-API-7d7311ba8ed24a9091ac5d2b4a503c4c",
      "public_url": "https://honesty-blog.notion.site/Keycloak-REST-API-7d7311ba8ed24a9091ac5d2b4a503c4c"
    },
    {
      "object": "page",
      "id": "e454567c-abfe-4f35-9826-05e8eff97c1f",
      "created_time": "2023-04-27T11:24:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102204351.png"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "ğŸ—’ï¸"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-27",
        "type": "Post",
        "category": "å­¦ä¹ æ€è€ƒ",
        "urlname": "iot-prospect-for-java",
        "catalog": [
          "archives"
        ],
        "tags": [
          "æ€è€ƒ",
          "ç‰©è”ç½‘"
        ],
        "summary": "ç‰©è”ç½‘çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚æ™ºèƒ½å®¶å±…ã€æ™ºæ…§åŸå¸‚ã€æ™ºèƒ½åŒ»ç–—ã€æ™ºèƒ½åˆ¶é€ ç­‰ã€‚æ™ºèƒ½å®¶å±…å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°å®¶ç”µä¹‹é—´çš„äº’è”äº’é€šï¼Œä¾‹å¦‚æ™ºèƒ½é—¨é”ã€æ™ºèƒ½éŸ³å“ã€æ™ºèƒ½å®¶ç”µç­‰ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹æœºAPPæˆ–è€…è¯­éŸ³æ§åˆ¶å®Œæˆå¯¹å®¶ä¸­è®¾å¤‡çš„æ“ä½œã€‚æ™ºæ…§åŸå¸‚å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°åŸå¸‚åŸºç¡€è®¾æ–½ä¹‹é—´çš„äº’è”äº’é€šå’Œæ•°æ®å…±äº«ï¼Œä¾‹å¦‚æ™ºèƒ½äº¤é€šã€æ™ºèƒ½åœè½¦ã€æ™ºèƒ½ç…§æ˜ç­‰ï¼Œå®ç°åŸå¸‚çš„æ™ºèƒ½åŒ–ç®¡ç†å’Œä¼˜åŒ–ã€‚æ™ºèƒ½åŒ»ç–—å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°åŒ»ç–—è®¾å¤‡ä¹‹é—´çš„äº’è”äº’é€šå’Œæ•°æ®å…±äº«ï¼Œä¾‹å¦‚æ™ºèƒ½å¥åº·ç›‘æµ‹è®¾å¤‡ã€æ™ºèƒ½æ‰‹ç¯ã€æ™ºèƒ½åº·å¤ä»ªç­‰ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æé«˜åŒ»ç–—è®¾å¤‡çš„ä½¿ç”¨æ•ˆç‡å’ŒåŒ»ç–—æœåŠ¡çš„è´¨é‡ã€‚æ™ºèƒ½åˆ¶é€ å¯ä»¥é€šè¿‡ç‰©è”ç½‘æŠ€æœ¯å®ç°å·¥ä¸šè®¾å¤‡ä¹‹é—´çš„äº’è”äº’é€šå’Œæ•°æ®å…±äº«ï¼Œä¾‹å¦‚æ™ºèƒ½æœºåºŠã€æ™ºèƒ½ç‰©æµã€æ™ºèƒ½è´¨æ£€ç­‰ï¼Œå¯ä»¥æé«˜ç”Ÿäº§çº¿çš„è‡ªåŠ¨åŒ–ç¨‹åº¦å’Œç”Ÿäº§æ•ˆç‡ã€‚",
        "sort": "",
        "title": "ç‰©è”ç½‘å‘å±•åŠå‰æ™¯å¦‚ä½•ï¼Ÿç‰©è”ç½‘å¼€å‘æœ‰å“ªäº›æ¿å—ï¼Ÿjava å¦‚ä½•é©±åŠ¨ä¸‡ç‰©äº’è”ï¼Ÿ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/java-e454567cabfe4f35982605e8eff97c1f",
      "public_url": "https://honesty-blog.notion.site/java-e454567cabfe4f35982605e8eff97c1f"
    },
    {
      "object": "page",
      "id": "4f23b21c-584b-4922-a7dc-1fa3e68e609f",
      "created_time": "2023-04-24T09:01:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "file",
        "file": {
          "url": "https://s3.us-west-2.amazonaws.com/secure.notion-static.com/bd13b709-62b4-45ef-bdf2-cb1a84350da2/WX20230424-180802.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20231031%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20231031T090551Z&X-Amz-Expires=3600&X-Amz-Signature=7112ee3f4c6b8625857badaac59d4a0d8684e84f5b2f06e9fbcdf53e0ab3e839&X-Amz-SignedHeaders=host&x-id=GetObject",
          "expiry_time": "2023-10-31T10:05:51.029Z"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "ğŸ—’ï¸"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-24T00:00:00.000+08:00",
        "type": "Post",
        "category": "åˆ›ä½œåˆ†äº«",
        "urlname": "notion-ai-writely",
        "catalog": [
          "archives"
        ],
        "tags": [
          "æ–‡å­—",
          "å·¥å…·",
          "chatgpt",
          "notion"
        ],
        "summary": "ä½œä¸ºNiotionAiçš„é‡åº¦ä¾èµ–è€…ï¼Œæœ€è¿‘è§‚å¯Ÿåˆ°ä¸€ä¸ªæ¯”NotionAIæ›´å¼ºå¤§è€Œä¸”è¿˜å…è´¹çš„æ’ä»¶ã€‚ä¸€æ¬¾åŸºäºchatGPTæŠ€æœ¯çš„å†™ä½œç¥å™¨Writelyã€‚å€ŸåŠ©è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ï¼ŒWritelyå¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€æ¨èå†…å®¹ï¼Œå¹¶è¿›è¡Œè¯­æ³•çº é”™ä¼˜åŒ–ã€‚åŒæ—¶æä¾›å¤šç§æ¨¡æ¿å’Œä¸»é¢˜ï¼Œè®©å†™ä½œæ›´åŠ é«˜æ•ˆå®ç”¨ã€‚è¯¥å·¥å…·é€‚åˆåˆå­¦è€…å’Œä¸“ä¸šå†™ä½œè€…ä½¿ç”¨",
        "sort": "",
        "title": "Notion AIå¹³æ›¿ Writely åŸºäºchatGPTå…è´¹å®ç°çš„å†™ä½œç¥å™¨",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Notion-AI-Writely-chatGPT-4f23b21c584b4922a7dc1fa3e68e609f",
      "public_url": "https://honesty-blog.notion.site/Notion-AI-Writely-chatGPT-4f23b21c584b4922a7dc1fa3e68e609f"
    },
    {
      "object": "page",
      "id": "387ccffe-e894-442f-9471-2460619d4e62",
      "created_time": "2023-04-15T14:42:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102210908.png"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "ğŸ—’ï¸"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2023-04-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "redis-01",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å¼€å‘",
          "å¾®æœåŠ¡",
          "åˆ†å¸ƒå¼",
          "Redis",
          "ç¼“å­˜"
        ],
        "summary": "Redisæ˜¯ä¸€ç§é«˜æ€§èƒ½çš„key-valueå­˜å‚¨ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\n1. å†…å­˜å­˜å‚¨ï¼šRediså°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œé€šå¸¸æ¯”åŸºäºç£ç›˜çš„å­˜å‚¨ç³»ç»Ÿå¿«å‡ ä¸ªæ•°é‡çº§ã€‚\n2. æ•°æ®ç»“æ„å¤šæ ·ï¼šRedisæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆç­‰ï¼Œä¸°å¯Œçš„æ•°æ®ç»“æ„ä½¿Rediså¯ä»¥æ”¯æŒæ›´å¤šçš„åº”ç”¨åœºæ™¯ã€‚\n3. æŒä¹…åŒ–ï¼šRedisæ”¯æŒå°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œä»¥ä¿è¯æ•°æ®çš„å¯é æ€§ã€‚\n4. é«˜å¹¶å‘æ€§ï¼šRedisé‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼Œå‡å°‘äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œä»è€Œä½¿å¾—Rediså…·æœ‰æ›´é«˜çš„å¹¶å‘æ€§ã€‚\n5. åˆ†å¸ƒå¼ï¼šRedisæä¾›äº†é›†ç¾¤æ¨¡å¼ï¼Œå¯ä»¥å°†æ•°æ®åˆ†å¸ƒåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå®ç°æ°´å¹³æ‰©å±•ã€‚",
        "sort": "",
        "title": "Redis å…¥æ‰‹çŸ¥è¯†ç‚¹",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Redis-387ccffee894442f94712460619d4e62",
      "public_url": "https://honesty-blog.notion.site/Redis-387ccffee894442f94712460619d4e62"
    },
    {
      "object": "page",
      "id": "921e862a-78e5-4248-97a1-0fc04c2c558b",
      "created_time": "2023-03-30T06:41:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://www.notion.so/images/page-cover/nasa_fingerprints_of_water_on_the_sand.jpg"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-01-22",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "45",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java"
        ],
        "summary": "Stringå¯¹è±¡å¸¸é‡æ± String å¯¹è±¡çš„ä¸¤ç§åˆ›å»ºæ–¹å¼ï¼šString str1 = \"abcd\";//å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æœ‰æ²¡æœ‰\"abcd\"ï¼Œå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­",
        "sort": "",
        "title": "JavaåŸºç¡€-String",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Java-String-921e862a78e5424897a10fc04c2c558b",
      "public_url": "https://honesty-blog.notion.site/Java-String-921e862a78e5424897a10fc04c2c558b"
    },
    {
      "object": "page",
      "id": "f9af0c25-a672-4cac-bc8e-43bb190216fb",
      "created_time": "2023-03-30T06:40:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://www.notion.so/images/page-cover/woodcuts_11.jpg"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-01-26",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "43",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java"
        ],
        "summary": "å¯¹è±¡ï¼Œç±»ç±»åŠ è½½ä¸€ä¸ªç±»çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹ï¼šClass æ–‡ä»¶éœ€è¦åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ä¹‹åæ‰èƒ½è¿è¡Œå’Œä½¿ç”¨ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºæ˜¯å¦‚ä½•åŠ è½½è¿™äº› Class æ–‡ä»¶å‘¢ï¼Ÿç³»ç»ŸåŠ è½½ Class ç±»å‹çš„æ–‡ä»¶ä¸»è¦ä¸‰æ­¥:åŠ è½½->è¿æ¥",
        "sort": "",
        "title": "JavaåŸºç¡€-class",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Java-class-f9af0c25a6724cacbc8e43bb190216fb",
      "public_url": "https://honesty-blog.notion.site/Java-class-f9af0c25a6724cacbc8e43bb190216fb"
    },
    {
      "object": "page",
      "id": "54c4aad1-0a7a-4a4b-9906-1f54a3810362",
      "created_time": "2023-03-30T06:38:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://www.notion.so/images/page-cover/webb1.jpg"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-02-25",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "22",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java",
          "å¼‚æ­¥ç¼–ç¨‹",
          "å¤šçº¿ç¨‹"
        ],
        "summary": "çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€å—å†…å­˜ç©ºé—´å’Œä¸€ç»„ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚",
        "sort": "",
        "title": "JavaåŸºç¡€-çº¿ç¨‹&å¹¶å‘",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Java-54c4aad10a7a4a4b99061f54a3810362",
      "public_url": "https://honesty-blog.notion.site/Java-54c4aad10a7a4a4b99061f54a3810362"
    },
    {
      "object": "page",
      "id": "ba68c9c4-7d5d-4640-80d9-c123616ea287",
      "created_time": "2023-03-30T06:37:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": null,
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-03-08",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "44",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java",
          "æ•°æ®ç»“æ„"
        ],
        "summary": "è¿™ç¯‡æ–‡ç« è®²è§£äº†Javaé›†åˆä¸­çš„ArrayListï¼Œå®ƒæ˜¯ä¸€ç§åŠ¨æ€æ•°ç»„ï¼Œå¯ä»¥å¿«é€Ÿéšæœºè®¿é—®ã€‚ç›¸æ¯”äºVectorï¼ŒArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯LinkedListåˆ™ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ã€‚æ­¤å¤–ï¼ŒArrayListå®ç°äº†å¤šä¸ªæ¥å£ï¼ŒåŒ…æ‹¬Listã€RandomAccessã€Cloneableå’ŒSerializableã€‚å› æ­¤ï¼ŒArrayListåœ¨å®é™…åº”ç”¨ä¸­éå¸¸å¸¸è§ã€‚\né™¤äº†ArrayListï¼Œæ–‡ç« è¿˜ä»‹ç»äº†Javaä¸­çš„å…¶ä»–é›†åˆç±»å‹ï¼Œå¦‚LinkedListå’ŒHashMapã€‚LinkedListæ˜¯ä¸€ç§åŒå‘é“¾è¡¨ï¼Œå¯ä»¥åœ¨ä»»æ„ä½ç½®è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œä½†æ˜¯ä¸æ”¯æŒéšæœºè®¿é—®ã€‚è€ŒHashMapæ˜¯ä¸€ç§åŸºäºå“ˆå¸Œè¡¨å®ç°çš„Mapï¼Œå¯ä»¥ç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚HashMapä½¿ç”¨æ•°ç»„å’Œé“¾è¡¨ç»“åˆçš„æ–¹å¼ï¼Œæ¥è§£å†³å“ˆå¸Œå†²çªçš„é—®é¢˜ï¼ŒJDK1.8ä¹‹åè¿˜å¼•å…¥äº†çº¢é»‘æ ‘æ¥ä¼˜åŒ–æ€§èƒ½ã€‚\næ–‡ç« è¿˜ä»‹ç»äº†ä¸€äº›Javaé›†åˆä¸­çš„åº•å±‚å®ç°ç»†èŠ‚ï¼Œä¾‹å¦‚HashMapä¸­çš„æ‰°åŠ¨å‡½æ•°ã€loadFactoråŠ è½½å› å­ã€thresholdä¸´ç•Œå€¼ç­‰ã€‚è¿™äº›ç»†èŠ‚å¯¹äºç†è§£é›†åˆçš„å·¥ä½œåŸç†éå¸¸é‡è¦ï¼Œä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨Javaé›†åˆã€‚\næ€»ä¹‹ï¼ŒJavaé›†åˆæ˜¯Javaç¼–ç¨‹ä¸­éå¸¸å¸¸ç”¨çš„ä¸€éƒ¨åˆ†ï¼ŒæŒæ¡å¥½é›†åˆçš„ä½¿ç”¨æ–¹æ³•å’Œåº•å±‚å®ç°ç»†èŠ‚ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼–å†™æ›´é«˜æ•ˆã€æ›´æ˜“ç»´æŠ¤çš„Javaä»£ç ã€‚",
        "sort": "",
        "title": "JavaåŸºç¡€-é›†åˆ",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Java-ba68c9c47d5d464080d9c123616ea287",
      "public_url": "https://honesty-blog.notion.site/Java-ba68c9c47d5d464080d9c123616ea287"
    },
    {
      "object": "page",
      "id": "f2eefe59-c1ef-4dba-847d-6525d1ddc518",
      "created_time": "2023-03-30T06:35:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102223244.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-03-12",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "42",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java",
          "Jvm"
        ],
        "summary": "JavaåŸºç¡€-JVMæ˜¯Javaå¼€å‘è€…å¿…é¡»è¦æŒæ¡çš„é‡è¦çŸ¥è¯†ç‚¹ä¹‹ä¸€ï¼ŒJVMå…¨ç§°ä¸ºJava Virtual Machineï¼ˆJavaè™šæ‹Ÿæœºï¼‰ï¼Œå®ƒæ˜¯Javaç¨‹åºè¿è¡Œçš„ç¯å¢ƒï¼Œåœ¨Javaç¼–ç¨‹ä¸­å…·æœ‰æå…¶é‡è¦çš„ä½œç”¨ã€‚\nä½œä¸ºJavaè¯­è¨€çš„æ ¸å¿ƒï¼ŒJVMèƒ½å¤Ÿé€šè¿‡å°†Javaä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œå†é€šè¿‡å­—èŠ‚ç çš„è§£é‡Šå™¨å®ç°Javaç¨‹åºçš„è¿è¡Œã€‚JVMè´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºçš„å†…å­˜ã€å¤šçº¿ç¨‹ã€åƒåœ¾å›æ”¶ç­‰æ“ä½œï¼Œæ˜¯å®ç°è·¨å¹³å°ã€è‡ªåŠ¨åƒåœ¾å›æ”¶ã€å®‰å…¨æ€§é«˜ç­‰ç‰¹æ€§çš„å…³é”®ã€‚\nè¦æ·±å…¥ç†è§£JVMï¼Œéœ€è¦æŒæ¡JVMçš„å†…éƒ¨æœºåˆ¶ï¼ŒåŒ…æ‹¬è™šæ‹Ÿæœºç±»åŠ è½½å™¨ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸã€å­—èŠ‚ç æ‰§è¡Œå¼•æ“ç­‰æ–¹é¢ã€‚æ­¤å¤–ï¼Œå¯¹äºJVMçš„æ€§èƒ½è°ƒä¼˜åŠæ•…éšœæ’æŸ¥ä¹Ÿéå¸¸é‡è¦ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚\næ€»ä¹‹ï¼ŒæŒæ¡JavaåŸºç¡€-JVMæ˜¯Javaå¼€å‘è€…å¿…é¡»è¦å…·å¤‡çš„çŸ¥è¯†æŠ€èƒ½ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£Javaç¨‹åºçš„è¿è¡Œæœºåˆ¶ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œæå‡åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä»¥åŠç¨³å®šæ€§ã€‚",
        "sort": "",
        "title": "JavaåŸºç¡€-JVM",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Java-JVM-f2eefe59c1ef4dba847d6525d1ddc518",
      "public_url": "https://honesty-blog.notion.site/Java-JVM-f2eefe59c1ef4dba847d6525d1ddc518"
    },
    {
      "object": "page",
      "id": "bcd4f723-5f6a-4d94-90a1-63bb8c6dbfcf",
      "created_time": "2023-03-30T06:32:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102220554.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-06-02",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "18",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "ç¼“å­˜"
        ],
        "summary": "Spring Cacheæ˜¯Springæ¡†æ¶ç”¨äºæ”¯æŒç¼“å­˜çš„æ¨¡å—ã€‚å®ƒæä¾›äº†ä¸€ç»„ç¼“å­˜æŠ½è±¡ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†ä¸åŒçš„ç¼“å­˜æŠ€æœ¯é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œæé«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚Spring Cacheé€šè¿‡ä½¿ç”¨è½»é‡çº§çš„æ³¨é‡Šæ¥å®šä¹‰ç¼“å­˜çš„è¡Œä¸ºï¼Œä»è€Œå‡å°‘äº†ç¼“å­˜æ“ä½œçš„å¤æ‚æ€§ã€‚æ­¤å¤–ï¼ŒSpring Cacheè¿˜æ”¯æŒäº‹åŠ¡æ€§ç¼“å­˜ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚æ€»ä½“æ¥è¯´ï¼ŒSpring Cacheæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥æå¤§åœ°æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚",
        "sort": "",
        "title": "spring cache",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/spring-cache-bcd4f7235f6a4d9490a163bb8c6dbfcf",
      "public_url": "https://honesty-blog.notion.site/spring-cache-bcd4f7235f6a4d9490a163bb8c6dbfcf"
    },
    {
      "object": "page",
      "id": "76be662e-68e2-4e75-8d51-c66197e850d3",
      "created_time": "2023-03-30T06:30:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102218981.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2020-07-23",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "9",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "Java",
          "Redis"
        ],
        "summary": "è®°å½•ä¸€æ¬¡scanå’Œkeysçš„ä½¿ç”¨,scanå’Œkeyéƒ½æ˜¯redisæœç´¢keyçš„å€¼å‡½æ•°,ä½†å®ç°å´å®Œå…¨ä¸åŒã€‚ç”Ÿäº§ç¯å¢ƒç”¨keyçš„åŒå­¦å‡†å¤‡å¥½è·‘è·¯å§~keysWarning: consider KEYS as a",
        "sort": "",
        "title": "RedisOperations scan ç”¨æ³•",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/RedisOperations-scan-76be662e68e24e758d51c66197e850d3",
      "public_url": "https://honesty-blog.notion.site/RedisOperations-scan-76be662e68e24e758d51c66197e850d3"
    },
    {
      "object": "page",
      "id": "a1eb98de-4986-46c0-b1ac-6846629d0819",
      "created_time": "2023-03-30T06:28:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://www.notion.so/images/page-cover/nasa_tim_peake_spacewalk.jpg"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2021-04-10",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "21",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "Java",
          "å“åº”å¼",
          "å¼‚æ­¥ç¼–ç¨‹",
          "WebFlux"
        ],
        "summary": "webFlux åˆè¯†LambdaLambda è¡¨è¾¾å¼ï¼Œæœ‰æ—¶å€™ä¹Ÿç§°ä¸ºåŒ¿åå‡½æ•°æˆ–ç®­å¤´å‡½æ•°ï¼Œå‡ ä¹åœ¨å½“å‰çš„å„ç§ä¸»æµçš„ç¼–ç¨‹è¯­è¨€ä¸­éƒ½æœ‰å®ƒçš„èº«å½±ã€‚Java8 ä¸­å¼•å…¥ Lambda è¡¨è¾¾å¼ï¼Œä½¿åŸæœ¬éœ€è¦ç”¨åŒ¿åç±»å®ç°æ¥å£",
        "sort": "",
        "title": "å“åº”å¼å¼€å‘ä¹‹webFlux & Reactor",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/webFlux-Reactor-a1eb98de498646c0b1ac6846629d0819",
      "public_url": "https://honesty-blog.notion.site/webFlux-Reactor-a1eb98de498646c0b1ac6846629d0819"
    },
    {
      "object": "page",
      "id": "44263dbd-e5d6-4365-a72e-b0ff92bd0220",
      "created_time": "2023-03-30T06:26:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://www.notion.so/images/page-cover/webb2.jpg"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "ğŸ¥…"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2021-08-27",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "20",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "å¾®æœåŠ¡",
          "åˆ†å¸ƒå¼",
          "Redis"
        ],
        "summary": "åœ¨SpringCloudä½“ç³»ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æœåŠ¡ä¹‹é—´çš„è°ƒç”¨æ˜¯é€šè¿‡httpåè®®è¿›è¡Œè°ƒç”¨çš„ã€‚è€Œæ³¨å†Œä¸­å¿ƒçš„ä¸»è¦ç›®çš„å°±æ˜¯ç»´æŠ¤è¿™äº›æœåŠ¡çš„æœåŠ¡åˆ—è¡¨ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Springä¸­ï¼Œæä¾›äº†RestTemplateã€‚RestTemplateæ˜¯Springæä¾›çš„ç”¨äºè®¿é—®RestæœåŠ¡çš„å®¢æˆ·ç«¯ã€‚è€Œåœ¨SpringCloudä¸­ä¹Ÿæ˜¯ä½¿ç”¨æ­¤æœåŠ¡è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„ã€‚",
        "sort": "",
        "title": "RestTemplateä¸OpenFeign",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/RestTemplate-OpenFeign-44263dbde5d64365a72eb0ff92bd0220",
      "public_url": "https://honesty-blog.notion.site/RestTemplate-OpenFeign-44263dbde5d64365a72eb0ff92bd0220"
    },
    {
      "object": "page",
      "id": "f81c2940-d22e-4782-9d95-d16b57f6d3f4",
      "created_time": "2023-03-30T06:25:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102218848.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2021-12-18",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "23",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å¾®æœåŠ¡",
          "åˆ†å¸ƒå¼",
          "Redis"
        ],
        "summary": "ä¸€è‡´æ€§hashåœ¨Redis é›†ç¾¤æ¨¡å¼Clusterä¸­ï¼ŒRedisé‡‡ç”¨çš„æ˜¯åˆ†ç‰‡Shardingçš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®é‡‡ç”¨ä¸€å®šçš„åˆ†åŒºç­–ç•¥ï¼Œåˆ†å‘åˆ°ç›¸åº”çš„é›†ç¾¤èŠ‚ç‚¹ä¸­ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°HASHç®—æ³•è¿›è¡Œç¼“å­˜æ—¶ï¼Œä¼šå‡º",
        "sort": "",
        "title": "Redisé›†ç¾¤ä¸ç‰¹æ€§",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Redis-f81c2940d22e47829d95d16b57f6d3f4",
      "public_url": "https://honesty-blog.notion.site/Redis-f81c2940d22e47829d95d16b57f6d3f4"
    },
    {
      "object": "page",
      "id": "807ec69b-8970-4659-8443-d224934a8e7f",
      "created_time": "2023-03-30T06:22:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102216883.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2021-12-27",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "24",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "Java"
        ],
        "summary": "springBoot ä¸‰æ¿æ–§AOPaopæ˜¯ä¸€ç§é¢å‘åˆ‡é¢ç¼–ç¨‹ èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆç¼“å­˜ï¼Œé”ï¼‰ å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯",
        "sort": "",
        "title": "springBootä¸‰å‰‘å®¢",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/springBoot-807ec69b897046598443d224934a8e7f",
      "public_url": "https://honesty-blog.notion.site/springBoot-807ec69b897046598443d224934a8e7f"
    },
    {
      "object": "page",
      "id": "747841e4-eeac-4349-88b0-63fc6421cf0c",
      "created_time": "2023-03-30T06:18:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://blog-file.hehouhui.cn/image-1647847160115.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-02-08",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "37",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Java"
        ],
        "summary": "synchronized å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œsynchronizedå…³é”®å­—å¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å¦å¤–ï¼Œåœ¨ Ja",
        "sort": "",
        "title": "JavaåŸºç¡€-é”",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Java-747841e4eeac434988b063fc6421cf0c",
      "public_url": "https://honesty-blog.notion.site/Java-747841e4eeac434988b063fc6421cf0c"
    },
    {
      "object": "page",
      "id": "397d5281-9f11-4c6f-8430-399176cc403d",
      "created_time": "2023-03-30T06:16:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102214388.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-02-21",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "38",
        "catalog": [
          "archives"
        ],
        "tags": [
          "mysql"
        ],
        "summary": "Mysqlæ•°æ®åº“å­˜å‚¨å¼•æ“MyISAMå¼•æ“ ä¸æ”¯æŒäº‹åŠ¡æ”¯æŒè¡¨çº§é”ï¼ˆMySqlæ”¯æŒä¸¤ç§è¡¨çº§é”ï¼Œè¡¨å…±äº«è¯»é”å’Œè¡¨ç‹¬å å†™é”ï¼‰ï¼Œä½†ä¸æ”¯æŒè¡Œçº§é”å­˜å‚¨è¡¨çš„æ€»è¡Œæ•°ä¸€ä¸ªMyISAMè¡¨æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼šç´¢å¼•æ–‡ä»¶ï¼ˆ.MYI",
        "sort": "",
        "title": "Mysqlæ•°æ®ç»“æ„&é”",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/Mysql-397d52819f114c6f8430399176cc403d",
      "public_url": "https://honesty-blog.notion.site/Mysql-397d52819f114c6f8430399176cc403d"
    },
    {
      "object": "page",
      "id": "07c3aa88-08b7-4093-9ac6-0a495a187163",
      "created_time": "2023-03-30T06:14:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://blog-file.hehouhui.cn/image-1647847511877.png"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "ğŸ—’ï¸"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-03-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "39",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å›¾åƒå¤„ç†"
        ],
        "summary": "wkhtmltopdfç²¾è®²(åŸæ–‡) ä½œè€…ï¼šJSON_NULLæœ¯è¯­å®šä¹‰æ–‡æ¡£å¯¹è±¡â€œæ–‡æ¡£å¯¹è±¡â€æ˜¯æŒ‡PDFæ–‡æ¡£ä¸­çš„æ–‡æ¡£å¯¹è±¡ï¼Œå…±æœ‰ä¸‰ç§ç±»å‹çš„â€œæ–‡æ¡£å¯¹è±¡â€ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯â€œé¡µé¢å¯¹è±¡â€ï¼Œâ€œå°é¢å¯¹è±¡â€å’Œâ€œç›®å½•å¯¹è±¡â€ã€‚é¡µé¢",
        "sort": "",
        "title": "wkhtmltopdfè¯¦ç»†ä½¿ç”¨",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/wkhtmltopdf-07c3aa8808b740939ac60a495a187163",
      "public_url": "https://honesty-blog.notion.site/wkhtmltopdf-07c3aa8808b740939ac60a495a187163"
    },
    {
      "object": "page",
      "id": "a60e468f-c55d-4add-a043-970fc03927d0",
      "created_time": "2023-03-30T06:09:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102132809.jpeg"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "ğŸ—’ï¸"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-03-15",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "40",
        "catalog": [
          "archives"
        ],
        "tags": [
          "å›¾åƒå¤„ç†"
        ],
        "summary": "â€œwkhtmltopdf\"ï¼Œæ˜¯ä¸€ä¸ªèƒ½å¤ŸæŠŠç½‘é¡µ/æ–‡ä»¶è½¬æ¢æˆPDFçš„å·¥å…·ã€‚å·¥å…·å…¨åå« \"wkhtmltopdf\" ; æ˜¯ä¸€ä¸ªä½¿ç”¨ Qt WebKit å¼•æ“åšæ¸²æŸ“çš„ï¼Œèƒ½å¤ŸæŠŠhtml æ–‡æ¡£è½¬æ¢æˆ pdf æ–‡æ¡£ æˆ– å›¾ç‰‡(image) çš„**â€œå‘½ä»¤è¡Œå·¥å…·â€**ã€‚\næ”¯æŒå¤šä¸ªå¹³å°ï¼Œå¯åœ¨winï¼Œlinuxï¼Œos x ç­‰ç³»ç»Ÿä¸‹è¿è¡Œã€‚",
        "sort": "",
        "title": "wkhtmltopdf å®‰è£…",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/wkhtmltopdf-a60e468fc55d4adda043970fc03927d0",
      "public_url": "https://honesty-blog.notion.site/wkhtmltopdf-a60e468fc55d4adda043970fc03927d0"
    },
    {
      "object": "page",
      "id": "6a6aca31-1871-49f3-a600-5062cb673260",
      "created_time": "2023-03-27T03:18:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102212132.png"
        }
      },
      "icon": {
        "type": "emoji",
        "emoji": "ğŸ—’ï¸"
      },
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-03-17",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "41",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Python",
          "å¥åº·"
        ],
        "summary": "ä¹‹å‰ä¸€ç›´ä½¿ç”¨ffmpegæ¥è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œä½†æ˜¯å°†å¾®ä¿¡çš„amrè½¬ä¸ºmp3åè¯­éŸ³è´¨é‡ä¸ç†æƒ³ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘å‚æ•°æ²¡æœ‰è°ƒæ­£ç¡®ğŸ¤ªï¼‰ã€‚\näºæ˜¯å°±ç»§ç»­æƒ³è§£å†³åŠæ³•ï¼Œåæ¥åœ¨githubçé€›æ—¶çœ‹åˆ°å¯ä»¥ä½¿ç”¨silk-v3-decoderæ¥åšè¿™ä»¶äº‹æƒ…ã€‚è™½ç„¶æœ¬è´¨ä¸Šè¿˜æ˜¯ä½¿ç”¨çš„ffmpegæ¥è½¬çš„ï¼Œåªæ˜¯å°è£…äº†ä¸€ä¸‹ã€‚",
        "sort": "",
        "title": "silk-v3-decoder ä¸€æ¬¾å¾®ä¿¡éŸ³é¢‘è½¬ç çš„å·¥å…·",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/silk-v3-decoder-6a6aca31187149f3a6005062cb673260",
      "public_url": "https://honesty-blog.notion.site/silk-v3-decoder-6a6aca31187149f3a6005062cb673260"
    },
    {
      "object": "page",
      "id": "0d2fc9f8-00d3-40d8-b7bb-cc4dbbb10251",
      "created_time": "2023-03-27T03:18:00.000Z",
      "last_edited_time": "2023-10-08T06:42:00.000Z",
      "created_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "last_edited_by": {
        "object": "user",
        "id": "a62f8c60-4c10-40c8-aa57-ef88b58f25a4"
      },
      "cover": {
        "type": "external",
        "external": {
          "url": "https://cdn.jsdelivr.net/gh/listener-He/images@default/202305102209640.png"
        }
      },
      "icon": null,
      "parent": {
        "type": "database_id",
        "database_id": "e2aef2eb-e7a1-4fc0-94f9-a186b6be6efa"
      },
      "archived": false,
      "properties": {
        "password": "",
        "icon": "",
        "date": "2022-03-05",
        "type": "Post",
        "category": "æŠ€æœ¯åˆ†äº«",
        "urlname": "46",
        "catalog": [
          "archives"
        ],
        "tags": [
          "Spring",
          "å¾®æœåŠ¡",
          "åˆ†å¸ƒå¼"
        ],
        "summary": "API ç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯ç³»ç»Ÿå¯¹å¤–çš„å”¯ä¸€å…¥å£ã€‚API ç½‘å…³å°è£…äº†ç³»ç»Ÿå†…éƒ¨æ¶æ„ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›å®šåˆ¶çš„ APIã€‚æ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æ¥å…¥å¾®æœåŠ¡ï¼Œåœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰éä¸šåŠ¡åŠŸèƒ½ã€‚API ç½‘å…³å¹¶ä¸æ˜¯å¾®æœåŠ¡åœºæ™¯ä¸­å¿…é¡»çš„ç»„ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ API ç½‘å…³ï¼Œåç«¯å¾®æœåŠ¡éƒ½å¯ä»¥é€šè¿‡ API å¾ˆå¥½åœ°æ”¯æŒå®¢æˆ·ç«¯çš„è®¿é—®",
        "sort": "",
        "title": "APIç½‘å…³ä¹‹Gateway",
        "status": "Published",
        "updated": "2023-10-08 14:42:00"
      },
      "url": "https://www.notion.so/API-Gateway-0d2fc9f800d340d8b7bbcc4dbbb10251",
      "public_url": "https://honesty-blog.notion.site/API-Gateway-0d2fc9f800d340d8b7bbcc4dbbb10251"
    }
  ]
}